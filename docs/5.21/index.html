<!DOCTYPE html>
<html lang="en">
  <head>
    <title>GRDB  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="GRDB  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">GRDB 5.21.0 Docs</a> (89% documented)</p>
        <p class="header-right"><a href="https://github.com/groue/GRDB.swift"><img src="img/gh.png" alt="GitHub"/>View on GitHub</a></p>
        <p class="header-right"><a href="dash-feed://http%3A%2F%2Fgroue.github.io%2FGRDB.swift%2Fdocs%2F5.21%2Fdocsets%2FGRDB.xml"><img src="img/dash.png" alt="Dash"/>Install in Dash</a></p>
        <div class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </div>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">GRDB Reference</a>
        <img id="carat" src="img/carat.png" alt=""/>
        GRDB  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/AnyCursor.html">AnyCursor</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/AnyDatabaseCancellable.html">AnyDatabaseCancellable</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/AnyDatabaseReader.html">AnyDatabaseReader</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/AnyDatabaseWriter.html">AnyDatabaseWriter</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ColumnDefinition.html">ColumnDefinition</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ColumnDefinition/GeneratedColumnQualification.html">– GeneratedColumnQualification</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Database.html">Database</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Database/BusyMode.html">– BusyMode</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Database/CheckpointMode.html">– CheckpointMode</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Database/CollationName.html">– CollationName</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Database/ColumnType.html">– ColumnType</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Database/ConflictResolution.html">– ConflictResolution</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Database/ForeignKeyAction.html">– ForeignKeyAction</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Database/TracingOptions.html">– TracingOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Database/TraceEvent.html">– TraceEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Database/TransactionCompletion.html">– TransactionCompletion</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Database/TransactionKind.html">– TransactionKind</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Database/TransactionObservationExtent.html">– TransactionObservationExtent</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DatabaseCollation.html">DatabaseCollation</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DatabaseFunction.html">DatabaseFunction</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DatabaseFuture.html">DatabaseFuture</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DatabasePool.html">DatabasePool</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DatabaseQueue.html">DatabaseQueue</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DatabaseSnapshot.html">DatabaseSnapshot</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DatabaseValueCursor.html">DatabaseValueCursor</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/FTS3TableDefinition.html">FTS3TableDefinition</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/FTS4ColumnDefinition.html">FTS4ColumnDefinition</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/FTS4TableDefinition.html">FTS4TableDefinition</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/FTS5ColumnDefinition.html">FTS5ColumnDefinition</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/FTS5TableDefinition.html">FTS5TableDefinition</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/FastDatabaseValueCursor.html">FastDatabaseValueCursor</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/FastNullableDatabaseValueCursor.html">FastNullableDatabaseValueCursor</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/NullableDatabaseValueCursor.html">NullableDatabaseValueCursor</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Record.html">Record</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/RecordCursor.html">RecordCursor</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Row.html">Row</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Row/ScopesView.html">– ScopesView</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Row/ScopesTreeView.html">– ScopesTreeView</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Row/PrefetchedRowsView.html">– PrefetchedRowsView</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/RowCursor.html">RowCursor</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SQLStatementCursor.html">SQLStatementCursor</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SharedValueObservation.html">SharedValueObservation</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Statement.html">Statement</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/TableAlias.html">TableAlias</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/TableAlteration.html">TableAlteration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/TableDefinition.html">TableDefinition</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ValueObservationScheduler.html">ValueObservationScheduler</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/DatabaseColumnDecodingStrategy.html">DatabaseColumnDecodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DatabaseColumnEncodingStrategy.html">DatabaseColumnEncodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DatabaseDateDecodingStrategy.html">DatabaseDateDecodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DatabaseDateEncodingStrategy.html">DatabaseDateEncodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DatabaseEventKind.html">DatabaseEventKind</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DatabasePublishers.html">DatabasePublishers</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DatabasePublishers/Read.html">– Read</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DatabasePublishers/DatabaseRegion.html">– DatabaseRegion</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DatabasePublishers/Write.html">– Write</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DatabasePublishers/Migrate.html">– Migrate</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DatabasePublishers/Value.html">– Value</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DatabaseUUIDEncodingStrategy.html">DatabaseUUIDEncodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PersistenceError.html">PersistenceError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/SQLDateModifier.html">SQLDateModifier</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/SharedValueObservationExtent.html">SharedValueObservationExtent</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ValueReducers.html">ValueReducers</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ValueReducers.html#/s:4GRDB13ValueReducersO5FetchV">– Fetch</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ValueReducers.html#/s:4GRDB13ValueReducersO3MapV">– Map</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ValueReducers.html#/s:4GRDB13ValueReducersO16RemoveDuplicatesV">– RemoveDuplicates</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ValueReducers.html#/s:4GRDB13ValueReducersO5TraceV">– Trace</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/Bool.html">Bool</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/CGFloat.html">CGFloat</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/ClosedRange.html">ClosedRange</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Collection.html">Collection</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Column.html">Column</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/ColumnExpression.html">ColumnExpression</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/CountableClosedRange.html">CountableClosedRange</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/CountableRange.html">CountableRange</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Data.html">Data</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Database.html">Database</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Date.html">Date</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Decimal.html">Decimal</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Dictionary.html">Dictionary</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Double.html">Double</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Float.html">Float</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Int.html">Int</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Int16.html">Int16</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Int32.html">Int32</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Int64.html">Int64</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Int8.html">Int8</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/NSData.html">NSData</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/NSDate.html">NSDate</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/NSNull.html">NSNull</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/NSNumber.html">NSNumber</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/NSString.html">NSString</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/NSURL.html">NSURL</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/NSUUID.html">NSUUID</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Optional.html">Optional</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Range.html">Range</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/RangeReplaceableCollection.html">RangeReplaceableCollection</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Sequence.html">Sequence</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Set.html">Set</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/String.html">String</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/TableRecord.html">TableRecord</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/TableRequest.html">TableRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/UInt.html">UInt</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/UInt16.html">UInt16</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/UInt32.html">UInt32</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/UInt64.html">UInt64</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/UInt8.html">UInt8</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions.html#/s:10Foundation3URLV">URL</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/UUID.html">UUID</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1nopyAA13SQLExpressionVAA22SQLSpecificExpressible_pF">!(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1nopyAA20AssociationAggregateVyxGAElF">!(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2neoiyAA13SQLExpressionVAA14SQLExpressible_pSg_AA22SQLSpecificExpressible_ptF">!=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2neoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA14SQLExpressible_pSgtF">!=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2neoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AaE_ptF">!=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2neoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_SbtF">!=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2neoiyAA13SQLExpressionVSb_AA22SQLSpecificExpressible_ptF">!=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2neoiyAA20AssociationAggregateVyxGAA14SQLExpressible_p_AEtlF">!=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2neoiyAA20AssociationAggregateVyxGAE_AA14SQLExpressible_ptlF">!=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2neoiyAA20AssociationAggregateVyxGAE_AEtlF">!=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2neoiyAA20AssociationAggregateVyxGAE_SbtlF">!=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2neoiyAA20AssociationAggregateVyxGSb_AEtlF">!=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3neeoiyAA13SQLExpressionVAA14SQLExpressible_pSg_AA22SQLSpecificExpressible_ptF">!==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3neeoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA14SQLExpressible_pSgtF">!==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3neeoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AaE_ptF">!==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3neeoiyAA20AssociationAggregateVyxGAA14SQLExpressible_p_AEtlF">!==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3neeoiyAA20AssociationAggregateVyxGAE_AA14SQLExpressible_ptlF">!==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3neeoiyAA20AssociationAggregateVyxGAE_AEtlF">!==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2aaoiyAA13SQLExpressionVAA14SQLExpressible_p_AA22SQLSpecificExpressible_ptF">&amp;&amp;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2aaoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA14SQLExpressible_ptF">&amp;&amp;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2aaoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AaE_ptF">&amp;&amp;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2aaoiyAA20AssociationAggregateVyxGAE_AEtlF">&amp;&amp;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1moiyAA13SQLExpressionVAA14SQLExpressible_p_AA22SQLSpecificExpressible_ptF">*(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1moiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA14SQLExpressible_ptF">*(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1moiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AaE_ptF">*(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1moiyAA20AssociationAggregateVyxGAA14SQLExpressible_p_AEtlF">*(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1moiyAA20AssociationAggregateVyxGAE_AA14SQLExpressible_ptlF">*(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1moiyAA20AssociationAggregateVyxGAE_AEtlF">*(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2meoiyAA16ColumnAssignmentVAA0C10Expression_p_AA14SQLExpressible_ptF">*=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1poiyAA13SQLExpressionVAA14SQLExpressible_p_AA22SQLSpecificExpressible_ptF">+(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1poiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA14SQLExpressible_ptF">+(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1poiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AaE_ptF">+(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1poiyAA20AssociationAggregateVyxGAA14SQLExpressible_p_AEtlF">+(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1poiyAA20AssociationAggregateVyxGAE_AA14SQLExpressible_ptlF">+(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1poiyAA20AssociationAggregateVyxGAE_AEtlF">+(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2peoiyAA16ColumnAssignmentVAA0C10Expression_p_AA14SQLExpressible_ptF">+=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1sopyAA13SQLExpressionVAA22SQLSpecificExpressible_pF">-(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1sopyAA20AssociationAggregateVyxGAElF">-(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1soiyAA13SQLExpressionVAA14SQLExpressible_p_AA22SQLSpecificExpressible_ptF">-(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1soiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA14SQLExpressible_ptF">-(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1soiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AaE_ptF">-(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1soiyAA20AssociationAggregateVyxGAA14SQLExpressible_p_AEtlF">-(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1soiyAA20AssociationAggregateVyxGAE_AA14SQLExpressible_ptlF">-(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1soiyAA20AssociationAggregateVyxGAE_AEtlF">-(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2seoiyAA16ColumnAssignmentVAA0C10Expression_p_AA14SQLExpressible_ptF">-=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1doiyAA13SQLExpressionVAA14SQLExpressible_p_AA22SQLSpecificExpressible_ptF">/(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1doiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA14SQLExpressible_ptF">/(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1doiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AaE_ptF">/(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1doiyAA20AssociationAggregateVyxGAA14SQLExpressible_p_AEtlF">/(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1doiyAA20AssociationAggregateVyxGAE_AA14SQLExpressible_ptlF">/(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1doiyAA20AssociationAggregateVyxGAE_AEtlF">/(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2deoiyAA16ColumnAssignmentVAA0C10Expression_p_AA14SQLExpressible_ptF">/=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1loiyAA13SQLExpressionVAA14SQLExpressible_p_AA22SQLSpecificExpressible_ptF">&lt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1loiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA14SQLExpressible_ptF">&lt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1loiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AaE_ptF">&lt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1loiyAA20AssociationAggregateVyxGAA14SQLExpressible_p_AEtlF">&lt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1loiyAA20AssociationAggregateVyxGAE_AA14SQLExpressible_ptlF">&lt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1loiyAA20AssociationAggregateVyxGAE_AEtlF">&lt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2leoiyAA13SQLExpressionVAA14SQLExpressible_p_AA22SQLSpecificExpressible_ptF">&lt;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2leoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA14SQLExpressible_ptF">&lt;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2leoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AaE_ptF">&lt;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2leoiyAA20AssociationAggregateVyxGAA14SQLExpressible_p_AEtlF">&lt;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2leoiyAA20AssociationAggregateVyxGAE_AA14SQLExpressible_ptlF">&lt;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2leoiyAA20AssociationAggregateVyxGAE_AEtlF">&lt;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2eeoiyAA13SQLExpressionVAA14SQLExpressible_pSg_AA22SQLSpecificExpressible_ptF">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2eeoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA14SQLExpressible_pSgtF">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2eeoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AaE_ptF">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2eeoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_SbtF">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2eeoiyAA13SQLExpressionVSb_AA22SQLSpecificExpressible_ptF">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2eeoiyAA20AssociationAggregateVyxGAA14SQLExpressible_p_AEtlF">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2eeoiyAA20AssociationAggregateVyxGAE_AA14SQLExpressible_ptlF">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2eeoiyAA20AssociationAggregateVyxGAE_AEtlF">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2eeoiyAA20AssociationAggregateVyxGAE_SbtlF">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2eeoiyAA20AssociationAggregateVyxGSb_AEtlF">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3eeeoiyAA13SQLExpressionVAA14SQLExpressible_pSg_AA22SQLSpecificExpressible_ptF">===(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3eeeoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA14SQLExpressible_pSgtF">===(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3eeeoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AaE_ptF">===(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3eeeoiyAA20AssociationAggregateVyxGAA14SQLExpressible_p_AEtlF">===(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3eeeoiyAA20AssociationAggregateVyxGAE_AA14SQLExpressible_ptlF">===(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3eeeoiyAA20AssociationAggregateVyxGAE_AEtlF">===(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1goiyAA13SQLExpressionVAA14SQLExpressible_p_AA22SQLSpecificExpressible_ptF">&gt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1goiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA14SQLExpressible_ptF">&gt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1goiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AaE_ptF">&gt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1goiyAA20AssociationAggregateVyxGAA14SQLExpressible_p_AEtlF">&gt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1goiyAA20AssociationAggregateVyxGAE_AA14SQLExpressible_ptlF">&gt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB1goiyAA20AssociationAggregateVyxGAE_AEtlF">&gt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2geoiyAA13SQLExpressionVAA14SQLExpressible_p_AA22SQLSpecificExpressible_ptF">&gt;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2geoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA14SQLExpressible_ptF">&gt;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2geoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AaE_ptF">&gt;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2geoiyAA20AssociationAggregateVyxGAA14SQLExpressible_p_AEtlF">&gt;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2geoiyAA20AssociationAggregateVyxGAE_AA14SQLExpressible_ptlF">&gt;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2geoiyAA20AssociationAggregateVyxGAE_AEtlF">&gt;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2qqoiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA14SQLExpressible_ptF">??(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2qqoiyAA20AssociationAggregateVyxGAE_AA14SQLExpressible_ptlF">??(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3absyAA13SQLExpressionVAA22SQLSpecificExpressible_pF">abs(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3absyAA20AssociationAggregateVyxGAElF">abs(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB7averageyAA13SQLExpressionVAA22SQLSpecificExpressible_pF">average(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB5countyAA13SQLExpressionVAA22SQLSpecificExpressible_pF">count(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB5count8distinctAA13SQLExpressionVAA22SQLSpecificExpressible_p_tF">count(distinct:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB21databaseQuestionMarks5countSSSi_tF">databaseQuestionMarks(count:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB8dateTimeyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA15SQLDateModifierOdtF">dateTime(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB9julianDayyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA15SQLDateModifierOdtF">julianDay(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB6lengthyAA13SQLExpressionVAA22SQLSpecificExpressible_pF">length(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB6lengthyAA20AssociationAggregateVyxGAElF">length(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3maxyAA13SQLExpressionVAA22SQLSpecificExpressible_pF">max(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3minyAA13SQLExpressionVAA22SQLSpecificExpressible_pF">min(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB20splittingRowAdapters12columnCountsSayAA0C7Adapter_pGSaySiG_tF">splittingRowAdapters(columnCounts:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB3sumyAA13SQLExpressionVAA22SQLSpecificExpressible_pF">sum(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB5totalyAA13SQLExpressionVAA22SQLSpecificExpressible_pF">total(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2oooiyAA13SQLExpressionVAA14SQLExpressible_p_AA22SQLSpecificExpressible_ptF">||(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2oooiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AA14SQLExpressible_ptF">||(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2oooiyAA13SQLExpressionVAA22SQLSpecificExpressible_p_AaE_ptF">||(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4GRDB2oooiyAA20AssociationAggregateVyxGAE_AEtlF">||(_:_:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/AggregatingRequest.html">AggregatingRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Association.html">Association</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/AssociationToMany.html">AssociationToMany</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/AssociationToOne.html">AssociationToOne</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ColumnExpression.html">ColumnExpression</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Cursor.html">Cursor</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DatabaseAggregate.html">DatabaseAggregate</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DatabaseCancellable.html">DatabaseCancellable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DatabaseCursor.html">DatabaseCursor</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DatabaseReader.html">DatabaseReader</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DatabaseRegionConvertible.html">DatabaseRegionConvertible</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DatabaseValueConvertible.html">DatabaseValueConvertible</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DatabaseWriter.html">DatabaseWriter</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DerivableRequest.html">DerivableRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/EncodableRecord.html">EncodableRecord</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/FTS5CustomTokenizer.html">FTS5CustomTokenizer</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/FTS5Tokenizer.html">FTS5Tokenizer</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/FTS5WrapperTokenizer.html">FTS5WrapperTokenizer</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/FetchRequest.html">FetchRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/FetchableRecord.html">FetchableRecord</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/FilteredRequest.html">FilteredRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/JoinableRequest.html">JoinableRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/MutablePersistableRecord.html">MutablePersistableRecord</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/OrderedRequest.html">OrderedRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/PersistableRecord.html">PersistableRecord</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/RowAdapter.html">RowAdapter</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SQLExpressible.html">SQLExpressible</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SQLOrderingTerm.html">SQLOrderingTerm</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SQLSelectable.html">SQLSelectable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SQLSpecificExpressible.html">SQLSpecificExpressible</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SQLSubqueryable.html">SQLSubqueryable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SelectionRequest.html">SelectionRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/StatementBinding.html">StatementBinding</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/StatementColumnConvertible.html">StatementColumnConvertible</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/TableRecord.html">TableRecord</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/TableRequest.html">TableRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/TransactionObserver.html">TransactionObserver</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/TypedRequest.html">TypedRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols.html#/s:4GRDB12ValueReducerP">ValueReducer</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/VirtualTableModule.html">VirtualTableModule</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/AdaptedFetchRequest.html">AdaptedFetchRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AllColumns.html">AllColumns</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AnyDatabaseRegionConvertible.html">AnyDatabaseRegionConvertible</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AnyFetchRequest.html">AnyFetchRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AssociationAggregate.html">AssociationAggregate</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AsyncValueObservation.html">AsyncValueObservation</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AsyncValueObservation/Iterator.html">– Iterator</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs.html#/s:4GRDB20BelongsToAssociationV">BelongsToAssociation</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Column.html">Column</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs.html#/s:4GRDB16ColumnAssignmentV">ColumnAssignment</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ColumnInfo.html">ColumnInfo</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ColumnMapping.html">ColumnMapping</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CommonTableExpression.html">CommonTableExpression</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Configuration.html">Configuration</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DatabaseBackupProgress.html">DatabaseBackupProgress</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DatabaseDateComponents.html">DatabaseDateComponents</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DatabaseDateComponents/Format.html">– Format</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DatabaseError.html">DatabaseError</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DatabaseEvent.html">DatabaseEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DatabaseEvent/Kind.html">– Kind</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DatabaseMigrator.html">DatabaseMigrator</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DatabaseMigrator/ForeignKeyChecks.html">– ForeignKeyChecks</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DatabasePreUpdateEvent.html">DatabasePreUpdateEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DatabasePreUpdateEvent/Kind.html">– Kind</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DatabaseRegion.html">DatabaseRegion</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DatabaseRegionObservation.html">DatabaseRegionObservation</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DatabaseValue.html">DatabaseValue</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DatabaseValue/Storage.html">– Storage</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/EmptyRowAdapter.html">EmptyRowAdapter</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FTS3.html">FTS3</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FTS3/Diacritics.html">– Diacritics</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FTS3Pattern.html">FTS3Pattern</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FTS3TokenizerDescriptor.html">FTS3TokenizerDescriptor</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FTS4.html">FTS4</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FTS5.html">FTS5</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FTS5/Diacritics.html">– Diacritics</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FTS5Pattern.html">FTS5Pattern</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FTS5TokenFlags.html">FTS5TokenFlags</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FTS5Tokenization.html">FTS5Tokenization</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FTS5TokenizerDescriptor.html">FTS5TokenizerDescriptor</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ForeignKey.html">ForeignKey</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ForeignKeyInfo.html">ForeignKeyInfo</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ForeignKeyViolation.html">ForeignKeyViolation</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs.html#/s:4GRDB18HasManyAssociationV">HasManyAssociation</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs.html#/s:4GRDB25HasManyThroughAssociationV">HasManyThroughAssociation</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs.html#/s:4GRDB17HasOneAssociationV">HasOneAssociation</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs.html#/s:4GRDB24HasOneThroughAssociationV">HasOneThroughAssociation</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/IndexInfo.html">IndexInfo</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/IndexOptions.html">IndexOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Inflections.html">Inflections</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs.html#/s:4GRDB15JoinAssociationV">JoinAssociation</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PersistenceConflictPolicy.html">PersistenceConflictPolicy</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PersistenceContainer.html">PersistenceContainer</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PreparedRequest.html">PreparedRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PrimaryKeyInfo.html">PrimaryKeyInfo</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/QueryInterfaceRequest.html">QueryInterfaceRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/RangeRowAdapter.html">RangeRowAdapter</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/RenameColumnAdapter.html">RenameColumnAdapter</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ResultCode.html">ResultCode</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs.html#/s:4GRDB8RowIndexV">RowIndex</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SQL.html">SQL</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SQLExpression.html">SQLExpression</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SQLExpression/AssociativeBinaryOperator.html">– AssociativeBinaryOperator</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SQLOrdering.html">SQLOrdering</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SQLRequest.html">SQLRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SQLSelection.html">SQLSelection</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SQLSubquery.html">SQLSubquery</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ScopeAdapter.html">ScopeAdapter</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/StatementArguments.html">StatementArguments</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SuffixRowAdapter.html">SuffixRowAdapter</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Table.html">Table</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/TableOptions.html">TableOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ValueObservation.html">ValueObservation</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs.html#/s:4GRDB25VirtualTableConfigurationV">VirtualTableConfiguration</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/FTS5TokenCallback">FTS5TokenCallback</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/FTS5WrapperTokenCallback">FTS5WrapperTokenCallback</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/GRDBSendable">GRDBSendable</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:4GRDB12GRDBSendablea">GRDBSendable</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:4GRDB28SQLAssociativeBinaryOperatora">SQLAssociativeBinaryOperator</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:4GRDB10SQLLiterala">SQLLiteral</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:4GRDB16SQLiteConnectiona">SQLiteConnection</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:4GRDB15SQLiteStatementa">SQLiteStatement</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:4GRDB9SQLiterala">SQLiteral</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:4GRDB15SelectStatementa">SelectStatement</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:4GRDB15UpdateStatementa">UpdateStatement</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <p><img src="https://raw.githubusercontent.com/groue/GRDB.swift/master/GRDB.png" alt="GRDB: A toolkit for SQLite databases, with a focus on application development"></p>

<p align="center"><strong>A toolkit for SQLite databases, with a focus on application development</strong></p>

<p align="center">
    <a href="https://developer.apple.com/swift/"><img alt="Swift 5.3" src="https://img.shields.io/badge/swift-5.3-orange.svg?style=flat"></a>
    <a href="https://developer.apple.com/swift/"><img alt="Platforms" src="https://img.shields.io/cocoapods/p/GRDB.swift.svg"></a>
    <a href="https://github.com/groue/GRDB.swift/blob/master/LICENSE"><img alt="License" src="https://img.shields.io/github/license/groue/GRDB.swift.svg?maxAge=2592000"></a>
    <a href="https://github.com/groue/GRDB.swift/actions/workflows/CI.yml"><img alt="CI Status" src="https://github.com/groue/GRDB.swift/actions/workflows/CI.yml/badge.svg?branch=master"></a>
</p>

<hr>

<p><strong>Latest release</strong>: February 6, 2022 • <a href="https://github.com/groue/GRDB.swift/tree/v5.21.0">version 5.21.0</a> • <a href="CHANGELOG.md">CHANGELOG</a> • <a href="Documentation/GRDB5MigrationGuide.md">Migrating From GRDB 4 to GRDB 5</a></p>

<p><strong>Requirements</strong>: iOS 11.0+ / macOS 10.10+ / tvOS 9.0+ / watchOS 2.0+ &bull; SQLite 3.8.5+ &bull; Swift 5.3+ / Xcode 12+</p>

<table><thead>
<tr>
<th>Swift version</th>
<th>GRDB version</th>
</tr>
</thead><tbody>
<tr>
<td><strong>Swift 5.3+</strong></td>
<td><strong>v5.21.0</strong></td>
</tr>
<tr>
<td>Swift 5.2</td>
<td><a href="https://github.com/groue/GRDB.swift/tree/v5.12.0">v5.12.0</a></td>
</tr>
<tr>
<td>Swift 5.1</td>
<td><a href="https://github.com/groue/GRDB.swift/tree/v4.14.0">v4.14.0</a></td>
</tr>
<tr>
<td>Swift 5</td>
<td><a href="https://github.com/groue/GRDB.swift/tree/v4.14.0">v4.14.0</a></td>
</tr>
<tr>
<td>Swift 4.2</td>
<td><a href="https://github.com/groue/GRDB.swift/tree/v4.14.0">v4.14.0</a></td>
</tr>
<tr>
<td>Swift 4.1</td>
<td><a href="https://github.com/groue/GRDB.swift/tree/v3.7.0">v3.7.0</a></td>
</tr>
<tr>
<td>Swift 4</td>
<td><a href="https://github.com/groue/GRDB.swift/tree/v2.10.0">v2.10.0</a></td>
</tr>
<tr>
<td>Swift 3.2</td>
<td><a href="https://github.com/groue/GRDB.swift/tree/v1.3.0">v1.3.0</a></td>
</tr>
<tr>
<td>Swift 3.1</td>
<td><a href="https://github.com/groue/GRDB.swift/tree/v1.3.0">v1.3.0</a></td>
</tr>
<tr>
<td>Swift 3</td>
<td><a href="https://github.com/groue/GRDB.swift/tree/v1.0">v1.0</a></td>
</tr>
<tr>
<td>Swift 2.3</td>
<td><a href="https://github.com/groue/GRDB.swift/tree/v0.81.2">v0.81.2</a></td>
</tr>
<tr>
<td>Swift 2.2</td>
<td><a href="https://github.com/groue/GRDB.swift/tree/v0.80.2">v0.80.2</a></td>
</tr>
</tbody></table>

<p><strong>Contact</strong>:</p>

<ul>
<li>Release announcements and usage tips: follow <a href="http://twitter.com/groue">@groue</a> on Twitter.</li>
<li>Report bugs in a <a href="https://github.com/groue/GRDB.swift/issues/new">Github issue</a>. Make sure you check the <a href="https://github.com/groue/GRDB.swift/issues?q=is%3Aopen">existing issues</a> first.</li>
<li>A question? Looking for advice? Do you wonder how to contribute? Fancy a chat? Go to the <a href="https://forums.swift.org/c/related-projects/grdb">GRDB forums</a>, or open a <a href="https://github.com/groue/GRDB.swift/issues/new">Github issue</a>.</li>
</ul>
<h2 id='what-is-this' class='heading'>What is this?</h2>

<p>GRDB provides raw access to SQL and advanced SQLite features, because one sometimes enjoys a sharp tool. It has robust concurrency primitives, so that multi-threaded applications can efficiently use their databases. It grants your application models with persistence and fetching methods, so that you don&rsquo;t have to deal with SQL and raw database rows when you don&rsquo;t want to.</p>

<p>Compared to <a href="http://github.com/stephencelis/SQLite.swift">SQLite.swift</a> or <a href="http://github.com/ccgus/fmdb">FMDB</a>, GRDB can spare you a lot of glue code. Compared to <a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CoreData/">Core Data</a> or <a href="http://realm.io">Realm</a>, it can simplify your multi-threaded applications.</p>

<p>It comes with <a href="#documentation">up-to-date documentation</a>, <a href="#general-guides--good-practices">general guides</a>, and it is <a href="https://github.com/groue/GRDB.swift/wiki/Performance">fast</a>.</p>

<p>See <a href="Documentation/WhyAdoptGRDB.md">Why Adopt GRDB?</a> if you are looking for your favorite database library.</p>

<hr>

<p align="center">
    <a href="#features">Features</a> &bull;
    <a href="#usage">Usage</a> &bull;
    <a href="#installation">Installation</a> &bull;
    <a href="#documentation">Documentation</a> &bull;
    <a href="#faq">FAQ</a>
</p>

<hr>
<h2 id='features' class='heading'>Features</h2>

<p>GRDB ships with:</p>

<ul>
<li><a href="#sqlite-api">Access to raw SQL and SQLite</a></li>
<li><a href="#records">Records</a>: Fetching and persistence methods for your custom structs and class hierarchies.</li>
<li><a href="#the-query-interface">Query Interface</a>: A swift way to avoid the SQL language.</li>
<li><a href="Documentation/AssociationsBasics.md">Associations</a>: Relations and joins between record types.</li>
<li><a href="#database-pools">WAL Mode Support</a>: Extra performance for multi-threaded applications.</li>
<li><a href="Documentation/Migrations.md">Migrations</a>: Transform your database as your application evolves.</li>
<li><a href="#database-changes-observation">Database Observation</a>: Observe database changes and transactions.</li>
<li><a href="Documentation/Concurrency.md">Swift Concurrency</a>: <code>try await</code> your database (Xcode 13.2+).</li>
<li><a href="Documentation/Combine.md">Combine Support</a>: Access and observe the database with Combine publishers.</li>
<li><a href="http://github.com/RxSwiftCommunity/RxGRDB">RxSwift Support</a>: Access and observe the database with RxSwift observables.</li>
<li><a href="Documentation/FullTextSearch.md">Full-Text Search</a></li>
<li><a href="#encryption">Encryption</a></li>
<li><a href="Documentation/CustomSQLiteBuilds.md">Support for Custom SQLite Builds</a></li>
</ul>
<h2 id='usage' class='heading'>Usage</h2>

<details open>
  <summary>Start using the database in four easy steps</summary>

&ldquo;`swift
import GRDB

// 1. Open a database connection
let dbQueue = try DatabaseQueue(path: &rdquo;/path/to/database.sqlite&quot;)

// 2. Define the database schema
try dbQueue.write { db in
    try db.create(table: &ldquo;player&rdquo;) { t in
        t.autoIncrementedPrimaryKey(&ldquo;id&rdquo;)
        t.column(&ldquo;name&rdquo;, .text).notNull()
        t.column(&ldquo;score&rdquo;, .integer).notNull()
    }
}

// 3. Define a record type
struct Player: Codable, FetchableRecord, PersistableRecord {
    var id: Int64
    var name: String
    var score: Int
}

// 4. Access the database
try dbQueue.write { db in
    try Player(id: 1, name: &ldquo;Arthur&rdquo;, score: 100).insert(db)
    try Player(id: 2, name: &ldquo;Barbara&rdquo;, score: 1000).insert(db)
}

let players: [Player] = try dbQueue.read { db in
    try Player.fetchAll(db)
}
&ldquo;`

</details>

<details>
  <summary>Activate the WAL mode</summary>

&rdquo;`swift
import GRDB

// Simple database connection
let dbQueue = try DatabaseQueue(path: &ldquo;/path/to/database.sqlite&rdquo;)

// Enhanced multithreading based on SQLite&rsquo;s WAL mode
let dbPool = try DatabasePool(path: &ldquo;/path/to/database.sqlite&rdquo;)
&ldquo;`
    
See [Database Connections](#database-connections)

</details>

<details>
    <summary>Access to raw SQL</summary>

&rdquo;`swift
try dbQueue.write { db in
    try db.execute(sql: &ldquo;&rdquo;&ldquo;
        CREATE TABLE place (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          title TEXT NOT NULL,
          favorite BOOLEAN NOT NULL DEFAULT 0,
          latitude DOUBLE NOT NULL,
          longitude DOUBLE NOT NULL)
        &rdquo;&ldquo;&rdquo;)
    
    try db.execute(sql: &ldquo;&rdquo;&ldquo;
        INSERT INTO place (title, favorite, latitude, longitude)
        VALUES (?, ?, ?, ?)
        &rdquo;&ldquo;&rdquo;, arguments: [&ldquo;Paris&rdquo;, true, 48.85341, 2.3488])
    
    let parisId = db.lastInsertedRowID
    
    // Avoid SQL injection with SQL interpolation
    try db.execute(literal: &ldquo;&rdquo;&ldquo;
        INSERT INTO place (title, favorite, latitude, longitude)
        VALUES (\(&quot;King&rsquo;s Cross&rdquo;), \(true), \(51.52151), \(-0.12763))
        &ldquo;&rdquo;&ldquo;)
}
&rdquo;`

See [Executing Updates](#executing-updates)

</details>

<details>
    <summary>Access to raw database rows and values</summary>

&ldquo;`swift
try dbQueue.read { db in
    // Fetch database rows
    let rows = try Row.fetchCursor(db, sql: &quot;SELECT * FROM place&rdquo;)
    while let row = try rows.next() {
        let title: String = row[&ldquo;title&rdquo;]
        let isFavorite: Bool = row[&ldquo;favorite&rdquo;]
        let coordinate = CLLocationCoordinate2D(
            latitude: row[&ldquo;latitude&rdquo;],
            longitude: row[&ldquo;longitude&rdquo;])
    }
    
    // Fetch values
    let placeCount = try Int.fetchOne(db, sql: &ldquo;SELECT COUNT(*) FROM place&rdquo;)! // Int
    let placeTitles = try String.fetchAll(db, sql: &ldquo;SELECT title FROM place&rdquo;) // [String]
}

let placeCount = try dbQueue.read { db in
    try Int.fetchOne(db, sql: &ldquo;SELECT COUNT(*) FROM place&rdquo;)!
}
&ldquo;`

See [Fetch Queries](#fetch-queries)

</details>

<details>
    <summary>Database model types aka &quot;records&rdquo;</summary>

&ldquo;`swift
struct Place {
    var id: Int64?
    var title: String
    var isFavorite: Bool
    var coordinate: CLLocationCoordinate2D
}

// snip: turn Place into a &quot;record&rdquo; by adopting the protocols that
// provide fetching and persistence methods.

try dbQueue.write { db in
    // Create database table
    try db.create(table: &ldquo;place&rdquo;) { t in
        t.autoIncrementedPrimaryKey(&ldquo;id&rdquo;)
        t.column(&ldquo;title&rdquo;, .text).notNull()
        t.column(&ldquo;favorite&rdquo;, .boolean).notNull().defaults(to: false)
        t.column(&ldquo;longitude&rdquo;, .double).notNull()
        t.column(&ldquo;latitude&rdquo;, .double).notNull()
    }
    
    var berlin = Place(
        id: nil,
        title: &ldquo;Berlin&rdquo;,
        isFavorite: false,
        coordinate: CLLocationCoordinate2D(latitude: 52.52437, longitude: 13.41053))
    
    try berlin.insert(db)
    berlin.id // some value
    
    berlin.isFavorite = true
    try berlin.update(db)
}
&ldquo;`

See [Records](#records)

</details>

<details>
    <summary>Query the database with the Swift query interface</summary>

&rdquo;`swift
try dbQueue.read { db in
    // Place?
    let paris = try Place.fetchOne(db, id: 1)
    
    // Place?
    let berlin = try Place.filter(Column(&ldquo;title&rdquo;) == &ldquo;Berlin&rdquo;).fetchOne(db)
    
    // [Place]
    let favoritePlaces = try Place
        .filter(Column(&ldquo;favorite&rdquo;) == true)
        .order(Column(&ldquo;title&rdquo;))
        .fetchAll(db)
    
    // Int
    let favoriteCount = try Place.filter(Column(&ldquo;favorite&rdquo;)).fetchCount(db)
    
    // SQL is always welcome
    let places = try Place.fetchAll(db, sql: &ldquo;SELECT * FROM place&rdquo;)
}
&ldquo;`

See the [Query Interface](#the-query-interface)

</details>

<details>
    <summary>Database changes notifications</summary>

&rdquo;`swift
// Define the observed value
let observation = ValueObservation.tracking { db in
    try Place.fetchAll(db)
}

// Start observation
let cancellable = observation.start(
    in: dbQueue,
    onError: { error in &hellip; }
    onChange: { (places: [Place]) in print(&ldquo;Fresh places: \(places)&rdquo;) })
&ldquo;`

Ready-made support for Combine and RxSwift:

&rdquo;`swift
// Combine
let cancellable = observation.publisher(in: dbQueue).sink(
    receiveCompletion: { completion in &hellip; },
    receiveValue: { (places: [Place]) in print(&ldquo;Fresh places: \(places)&rdquo;) })

// RxSwift
let disposable = observation.rx.observe(in: dbQueue).subscribe(
    onNext: { (places: [Place]) in print(&ldquo;Fresh places: \(places)&rdquo;) },
    onError: { error in &hellip; })
&ldquo;`

See [Database Observation], [Combine Support], [RxGRDB].

</details>
<h1 id='documentation' class='heading'>Documentation</h1>

<p><strong>GRDB runs on top of SQLite</strong>: you should get familiar with the <a href="http://www.sqlite.org/faq.html">SQLite FAQ</a>. For general and detailed information, jump to the <a href="http://www.sqlite.org/docs.html">SQLite Documentation</a>.</p>
<h4 id='demo-applications-amp-frequently-asked-questions' class='heading'>Demo Applications &amp; Frequently Asked Questions</h4>

<ul>
<li><a href="Documentation/DemoApps">Demo Applications</a>: Three flavors: vanilla UIKit, Combine + SwiftUI, and Async/Await + SwiftUI.</li>
<li><a href="#faq">FAQ</a>: <a href="#faq-opening-connections">Opening Connections</a>, <a href="#faq-associations">Associations</a>, etc.</li>
</ul>
<h4 id='reference' class='heading'>Reference</h4>

<ul>
<li><a href="http://groue.github.io/GRDB.swift/docs/5.21/index.html">GRDB Reference</a> (generated by <a href="https://github.com/realm/jazzy">Jazzy</a>)</li>
</ul>
<h4 id='getting-started' class='heading'>Getting Started</h4>

<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#database-connections">Database Connections</a>: Connect to SQLite databases</li>
</ul>
<h4 id='sqlite-and-sql' class='heading'>SQLite and SQL</h4>

<ul>
<li><a href="#sqlite-api">SQLite API</a>: The low-level SQLite API &bull; <a href="#executing-updates">executing updates</a> &bull; <a href="#fetch-queries">fetch queries</a> &bull; <a href="Documentation/SQLInterpolation.md">SQL Interpolation</a></li>
</ul>
<h4 id='records-and-the-query-interface' class='heading'>Records and the Query Interface</h4>

<ul>
<li><a href="#records">Records</a>: Fetching and persistence methods for your custom structs and class hierarchies</li>
<li><a href="#the-query-interface">Query Interface</a>: A swift way to generate SQL &bull; <a href="#database-schema">table creation</a> &bull; <a href="#requests">requests</a> • <a href="Documentation/AssociationsBasics.md">associations between record types</a></li>
</ul>
<h4 id='application-tools' class='heading'>Application Tools</h4>

<ul>
<li><a href="Documentation/Migrations.md">Migrations</a>: Transform your database as your application evolves.</li>
<li><a href="Documentation/FullTextSearch.md">Full-Text Search</a>: Perform efficient and customizable full-text searches.</li>
<li><a href="#joined-queries-support">Joined Queries Support</a>: Consume complex joined queries.</li>
<li><a href="#database-changes-observation">Database Observation</a>: Observe database changes and transactions.</li>
<li><a href="#encryption">Encryption</a>: Encrypt your database with SQLCipher.</li>
<li><a href="#backup">Backup</a>: Dump the content of a database to another.</li>
<li><a href="#interrupt-a-database">Interrupt a Database</a>: Abort any pending database operation.</li>
<li><a href="Documentation/SharingADatabase.md">Sharing a Database</a>: Recommendations for App Group Containers and sandboxed macOS apps.</li>
</ul>
<h4 id='good-to-know' class='heading'>Good to Know</h4>

<ul>
<li><a href="#avoiding-sql-injection">Avoiding SQL Injection</a></li>
<li><a href="#error-handling">Error Handling</a></li>
<li><a href="#unicode">Unicode</a></li>
<li><a href="#memory-management">Memory Management</a></li>
<li><a href="#data-protection">Data Protection</a></li>
<li><a href="Documentation/Concurrency.md">Concurrency</a></li>
</ul>
<h4 id='general-guides-amp-good-practices' class='heading'>General Guides &amp; Good Practices</h4>

<ul>
<li>:bulb: <a href="Documentation/GoodPracticesForDesigningRecordTypes.md">Good Practices for Designing Record Types</a></li>
<li>:bulb: <a href="Documentation/GRDB5MigrationGuide.md">Migrating From GRDB 4 to GRDB 5</a></li>
<li>:bulb: <a href="https://github.com/groue/GRDB.swift/issues?q=is%3Aissue+label%3A%22best+practices%22">Issues tagged &quot;best practices&rdquo;</a></li>
<li>:question: <a href="https://github.com/groue/GRDB.swift/issues?utf8=%E2%9C%93&q=is%3Aissue%20label%3Aquestion">Issues tagged &ldquo;question&rdquo;</a></li>
<li>:blue_book: <a href="Documentation/WhyAdoptGRDB.md">Why Adopt GRDB?</a></li>
<li>:blue_book: <a href="https://medium.com/@gwendal.roue/how-to-build-an-ios-application-with-sqlite-and-grdb-swift-d023a06c29b3">How to build an iOS application with SQLite and GRDB.swift</a></li>
<li>:blue_book: <a href="https://medium.com/@gwendal.roue/four-different-ways-to-handle-sqlite-concurrency-db3bcc74d00e">Four different ways to handle SQLite concurrency</a></li>
<li>:blue_book: <a href="https://hackernoon.com/unexpected-sqlite-with-swift-ddc6343bcbfc">Unexpected SQLite with Swift</a></li>
</ul>

<p><strong><a href="#faq">FAQ</a></strong></p>

<p><strong><a href="#sample-code">Sample Code</a></strong></p>
<h1 id='installation' class='heading'>Installation</h1>

<p><strong>The installation procedures below have GRDB use the version of SQLite that ships with the target operating system.</strong></p>

<p>See <a href="#encryption">Encryption</a> for the installation procedure of GRDB with SQLCipher.</p>

<p>See <a href="Documentation/CustomSQLiteBuilds.md">Custom SQLite builds</a> for the installation procedure of GRDB with a customized build of SQLite.</p>

<p>See <a href="Documentation/FullTextSearch.md#enabling-fts5-support">Enabling FTS5 Support</a> for the installation procedure of GRDB with support for the FTS5 full-text engine.</p>
<h2 id='cocoapods' class='heading'>CocoaPods</h2>

<p><a href="http://cocoapods.org/">CocoaPods</a> is a dependency manager for Xcode projects. To use GRDB with CocoaPods (version 1.2 or higher), specify in your <code>Podfile</code>:</p>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'GRDB.swift'</span>
</code></pre>

<p>GRDB can be installed as a framework, or a static library.</p>
<h2 id='swift-package-manager' class='heading'>Swift Package Manager</h2>

<p>The <a href="https://swift.org/package-manager/">Swift Package Manager</a> automates the distribution of Swift code. To use GRDB with SPM, add a dependency to <code>https://github.com/groue/GRDB.swift.git</code></p>

<p>GRDB offers two libraries, <code>GRDB</code> and <code>GRDB-dynamic</code>. Pick only one. When in doubt, prefer <code>GRDB</code>. The <code>GRDB-dynamic</code> library can reveal useful if you are going to link it with multiple targets within your app and only wish to link to a shared, dynamic framework once. See <a href="https://forums.swift.org/t/how-to-link-a-swift-package-as-dynamic/32062">How to link a Swift Package as dynamic</a> for more information.</p>

<blockquote>
<p>:point_up: <strong>Note</strong>: Linux is not currently supported.</p>

<p>:warning: <strong>Warning</strong>: Due to an Xcode bug, you will get &ldquo;No such module &lsquo;CSQLite&rsquo;&rdquo; errors when you want to embed the GRDB package in other targets than the main application (watch extensions, for example). UI and Unit testing targets are OK, though. See <a href="https://github.com/groue/GRDB.swift/issues/642#issuecomment-575994093">#642</a> for more information.</p>
</blockquote>
<h2 id='carthage' class='heading'>Carthage</h2>

<p><a href="https://github.com/Carthage/Carthage">Carthage</a> is <strong>unsupported</strong>. For some context about this decision, see <a href="https://github.com/groue/GRDB.swift/issues/433">#433</a>.</p>
<h2 id='manually' class='heading'>Manually</h2>

<ol>
<li><p><a href="https://github.com/groue/GRDB.swift/releases">Download</a> a copy of GRDB, or clone its repository and make sure you checkout the latest tagged version.</p></li>
<li><p>Embed the <code>GRDB.xcodeproj</code> project in your own project.</p></li>
<li><p>Add the <code>GRDBOSX</code>, <code>GRDBiOS</code>, <code>GRDBtvOS</code>, or <code>GRDBWatchOS</code> target in the <strong>Target Dependencies</strong> section of the <strong>Build Phases</strong> tab of your application target (extension target for WatchOS).</p></li>
<li><p>Add the <code>GRDB.framework</code> from the targeted platform to the <strong>Embedded Binaries</strong> section of the <strong>General</strong>  tab of your application target (extension target for WatchOS).</p></li>
</ol>

<blockquote>
<p>:bulb: <strong>Tip</strong>: see the <a href="Documentation/DemoApps">Demo Applications</a> for examples of such integration.</p>
</blockquote>
<h1 id='database-connections' class='heading'>Database Connections</h1>

<p>GRDB provides two classes for accessing SQLite databases: <code><a href="Classes/DatabaseQueue.html">DatabaseQueue</a></code> and <code><a href="Classes/DatabasePool.html">DatabasePool</a></code>:</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">GRDB</span>

<span class="c1">// Pick one:</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="s">"/path/to/database.sqlite"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">dbPool</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabasePool</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="s">"/path/to/database.sqlite"</span><span class="p">)</span>
</code></pre>

<p>The differences are:</p>

<ul>
<li>Database pools allow concurrent database accesses (this can improve the performance of multithreaded applications).</li>
<li>Database pools open your SQLite database in the <a href="https://www.sqlite.org/wal.html">WAL mode</a> (unless read-only).</li>
<li>Database queues support <a href="https://www.sqlite.org/inmemorydb.html">in-memory databases</a>.</li>
</ul>

<p><strong>If you are not sure, choose DatabaseQueue.</strong> You will always be able to switch to DatabasePool later.</p>

<ul>
<li><a href="#database-queues">Database Queues</a></li>
<li><a href="#database-pools">Database Pools</a></li>
</ul>
<h2 id='database-queues' class='heading'>Database Queues</h2>

<p><strong>Open a database queue</strong> with the path to a database file:</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">GRDB</span>

<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="s">"/path/to/database.sqlite"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">inMemoryDBQueue</span> <span class="o">=</span> <span class="kt">DatabaseQueue</span><span class="p">()</span>
</code></pre>

<p>SQLite creates the database file if it does not already exist. The connection is closed when the database queue gets deinitialized.</p>

<p><strong>A database queue can be used from any thread.</strong> The <code>write</code> and <code>read</code> methods are synchronous, and block the current thread until your database statements are executed in a protected dispatch queue:</p>
<pre class="highlight swift"><code><span class="c1">// Modify the database:</span>
<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"place"</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
    <span class="k">try</span> <span class="kt">Place</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Read values:</span>
<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">places</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">placeCount</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Database access methods can return values:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">placeCount</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">newPlaceCount</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Place</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p><strong>A database queue serializes accesses to the database</strong>, which means that there is never more than one thread that uses the database.</p>

<ul>
<li><p>When you don&rsquo;t need to modify the database, prefer the <code>read</code> method. It prevents any modification to the database.</p></li>
<li><p>The <code>write</code> method wraps your database statements in a transaction that commits if and only if no error occurs. On the first unhandled error, all changes are reverted, the whole transaction is rollbacked, and the error is rethrown.</p>

<p>When precise transaction handling is required, see <a href="#transactions-and-savepoints">Transactions and Savepoints</a>.</p></li>
</ul>

<p><strong>A database queue needs your application to follow rules in order to deliver its safety guarantees.</strong> Please refer to the <a href="Documentation/Concurrency.md">Concurrency</a> guide.</p>

<p>See <a href="#database-configuration">Database Configuration</a> for DatabaseQueue options.</p>

<blockquote>
<p>:bulb: <strong>Tip</strong>: see the <a href="Documentation/DemoApps">Demo Applications</a> for sample code.</p>
</blockquote>
<h2 id='database-pools' class='heading'>Database Pools</h2>

<p><strong>A database pool allows concurrent database accesses.</strong></p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">GRDB</span>
<span class="k">let</span> <span class="nv">dbPool</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabasePool</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="s">"/path/to/database.sqlite"</span><span class="p">)</span>
</code></pre>

<p>SQLite creates the database file if it does not already exist. The connection is closed when the database pool gets deinitialized.</p>

<blockquote>
<p>:point_up: <strong>Note</strong>: unless read-only, a database pool opens your database in the SQLite &ldquo;WAL mode&rdquo;. The WAL mode does not fit all situations. Please have a look at <a href="https://www.sqlite.org/wal.html">https://www.sqlite.org/wal.html</a>.</p>
</blockquote>

<p><strong>A database pool can be used from any thread.</strong> The <code>write</code> and <code>read</code> methods are synchronous, and block the current thread until your database statements are executed in a protected dispatch queue:</p>
<pre class="highlight swift"><code><span class="c1">// Modify the database:</span>
<span class="k">try</span> <span class="n">dbPool</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"place"</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
    <span class="k">try</span> <span class="kt">Place</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Read values:</span>
<span class="k">try</span> <span class="n">dbPool</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">places</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">placeCount</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Database access methods can return values:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">placeCount</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbPool</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">newPlaceCount</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbPool</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Place</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p><strong>Database pools allow several threads to access the database at the same time:</strong></p>

<ul>
<li><p>When you don&rsquo;t need to modify the database, prefer the <code>read</code> method, because several threads can perform reads in parallel.</p>

<p>Reads are generally non-blocking, unless the maximum number of concurrent reads has been reached. In this case, a read has to wait for another read to complete. That maximum number can be <a href="#database-configuration">configured</a>.</p></li>
<li><p>Reads are guaranteed an immutable view of the last committed state of the database, regardless of concurrent writes. This kind of isolation is called <a href="https://sqlite.org/isolation.html">snapshot isolation</a>.</p></li>
<li><p>Unlike reads, writes are serialized. There is never more than a single thread that is writing into the database.</p></li>
<li><p>The <code>write</code> method wraps your database statements in a transaction that commits if and only if no error occurs. On the first unhandled error, all changes are reverted, the whole transaction is rollbacked, and the error is rethrown.</p>

<p>When precise transaction handling is required, see <a href="#transactions-and-savepoints">Transactions and Savepoints</a>.</p></li>
<li><p>Database pools can take <a href="Documentation/Concurrency.md#database-snapshots">snapshots</a> of the database.</p></li>
</ul>

<p><strong>A database pool needs your application to follow rules in order to deliver its safety guarantees.</strong> See the <a href="Documentation/Concurrency.md">Concurrency</a> guide for more details about database pools, how they differ from database queues, and advanced use cases.</p>

<p>See <a href="#database-configuration">Database Configuration</a> for DatabasePool options.</p>

<blockquote>
<p>:bulb: <strong>Tip</strong>: see the <a href="Documentation/DemoApps">Demo Applications</a> for sample code.</p>
</blockquote>
<h2 id='database-configuration' class='heading'>Database Configuration</h2>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">readonly</span> <span class="o">=</span> <span class="kc">true</span>
<span class="n">config</span><span class="o">.</span><span class="n">foreignKeysEnabled</span> <span class="o">=</span> <span class="kc">true</span> <span class="c1">// Default is already true</span>
<span class="n">config</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s">"MyDatabase"</span>      <span class="c1">// Useful when your app opens multiple databases</span>
<span class="n">config</span><span class="o">.</span><span class="n">maximumReaderCount</span> <span class="o">=</span> <span class="mi">10</span>   <span class="c1">// (DatabasePool only) The default is 5</span>

<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span> <span class="c1">// or DatabasePool</span>
    <span class="nv">path</span><span class="p">:</span> <span class="s">"/path/to/database.sqlite"</span><span class="p">,</span>
    <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>
</code></pre>

<p>In debug builds, you can increase the verbosity of <a href="#databaseerror">error descriptions</a> and <a href="#how-do-i-print-a-request-as-sql">trace events</a> if you opt in for public statement arguments:</p>
<pre class="highlight swift"><code><span class="cp">#if DEBUG</span>
<span class="c1">// Protect sensitive information by enabling verbose debugging in DEBUG builds only</span>
<span class="n">config</span><span class="o">.</span><span class="n">publicStatementArguments</span> <span class="o">=</span> <span class="kc">true</span>
<span class="cp">#endif</span>

<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>

<span class="k">do</span> <span class="p">{</span>
    <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
        <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="o">...</span>
        <span class="n">user</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="o">...</span>
        <span class="n">user</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="o">...</span>
        <span class="n">user</span><span class="o">.</span><span class="n">phoneNumber</span> <span class="o">=</span> <span class="o">...</span>
        <span class="k">try</span> <span class="n">user</span><span class="o">.</span><span class="nf">save</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
    <span class="c1">// Prints sensitive information in debug builds only</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>:warning: <strong>Warning</strong>: It is your responsibility to prevent sensitive information from leaking in unexpected locations, so you should not set the <code>publicStatementArguments</code> flag in release builds (think about GDPR and other privacy-related rules).</p>

<p>:warning: <strong>Warning</strong>: The SQLite version that ships with old operating systems (prior to OSX 10.12, tvOS 10.0, and watchOS 3.0) outputs statement arguments in the <a href="#how-do-i-print-a-request-as-sql">trace events</a>, regardless of the <code>publicStatementArguments</code> flag.</p>
</blockquote>

<p>See <a href="http://groue.github.io/GRDB.swift/docs/5.21/Structs/Configuration.html">Configuration</a> for more details and configuration options.</p>
<h1 id='sqlite-api' class='heading'>SQLite API</h1>

<p><strong>In this section of the documentation, we will talk SQL.</strong> Jump to the <a href="#the-query-interface">query interface</a> if SQL is not your cup of tea.</p>

<ul>
<li><a href="#executing-updates">Executing Updates</a></li>
<li><a href="#fetch-queries">Fetch Queries</a>

<ul>
<li><a href="#fetching-methods">Fetching Methods</a></li>
<li><a href="#row-queries">Row Queries</a></li>
<li><a href="#value-queries">Value Queries</a></li>
</ul></li>
<li><a href="#values">Values</a>

<ul>
<li><a href="#data-and-memory-savings">Data</a></li>
<li><a href="#date-and-datecomponents">Date and DateComponents</a></li>
<li><a href="#nsnumber-nsdecimalnumber-and-decimal">NSNumber, NSDecimalNumber, and Decimal</a></li>
<li><a href="#swift-enums">Swift enums</a></li>
<li><a href="#custom-value-types">Custom Value Types</a></li>
</ul></li>
<li><a href="#transactions-and-savepoints">Transactions and Savepoints</a></li>
<li><a href="Documentation/SQLInterpolation.md">SQL Interpolation</a></li>
</ul>

<p>Advanced topics:</p>

<ul>
<li><a href="#prepared-statements">Prepared Statements</a></li>
<li><a href="#custom-sql-functions-and-aggregates">Custom SQL Functions and Aggregates</a></li>
<li><a href="#database-schema-introspection">Database Schema Introspection</a></li>
<li><a href="#row-adapters">Row Adapters</a></li>
<li><a href="#raw-sqlite-pointers">Raw SQLite Pointers</a></li>
</ul>
<h2 id='executing-updates' class='heading'>Executing Updates</h2>

<p>Once granted with a <a href="#database-connections">database connection</a>, the <code>execute</code> method executes the SQL statements that do not return any database row, such as <code>CREATE TABLE</code>, <code>INSERT</code>, <code>DELETE</code>, <code>ALTER</code>, etc.</p>

<p>For example:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"""
        CREATE TABLE player (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            name TEXT NOT NULL,
            score INT)
        """</span><span class="p">)</span>

    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span>
        <span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT INTO player (name, score) VALUES (?, ?)"</span><span class="p">,</span>
        <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"Barbara"</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>

    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span>
        <span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE player SET score = :score WHERE id = :id"</span><span class="p">,</span>
        <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"score"</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s">"id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The <code>?</code> and colon-prefixed keys like <code>:score</code> in the SQL query are the <strong>statements arguments</strong>. You pass arguments with arrays or dictionaries, as in the example above. See <a href="#values">Values</a> for more information on supported arguments types (Bool, Int, String, Date, Swift enums, etc.), and <a href="http://groue.github.io/GRDB.swift/docs/5.21/Structs/StatementArguments.html">StatementArguments</a> for a detailed documentation of SQLite arguments.</p>

<p>You can also embed query arguments right into your SQL queries, with the <code>literal</code> argument label, as in the example below. See <a href="Documentation/SQLInterpolation.md">SQL Interpolation</a> for more details.</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">literal</span><span class="p">:</span> <span class="s">"""
        INSERT INTO player (name, score) VALUES (</span><span class="se">\(</span><span class="s">"O'Brien"</span><span class="se">)</span><span class="s">, </span><span class="se">\(</span><span class="mi">550</span><span class="se">)</span><span class="s">)
        """</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p><strong>Never ever embed values directly in your raw SQL strings</strong>. See <a href="#avoiding-sql-injection">Avoiding SQL Injection</a> for more information:</p>
<pre class="highlight swift"><code><span class="c1">// WRONG: don't embed values in raw SQL strings</span>
<span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="mi">123</span>
<span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">textField</span><span class="o">.</span><span class="n">text</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span>
    <span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE player SET name = '</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">' WHERE id = </span><span class="se">\(</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>

<span class="c1">// CORRECT: use arguments dictionary</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span>
    <span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE player SET name = :name WHERE id = :id"</span><span class="p">,</span>
    <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"name"</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s">"id"</span><span class="p">:</span> <span class="n">id</span><span class="p">])</span>

<span class="c1">// CORRECT: use arguments array</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span>
    <span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE player SET name = ? WHERE id = ?"</span><span class="p">,</span>
    <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">id</span><span class="p">])</span>

<span class="c1">// CORRECT: use SQL Interpolation</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span>
    <span class="nv">literal</span><span class="p">:</span> <span class="s">"UPDATE player SET name = </span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s"> WHERE id = </span><span class="se">\(</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
</code></pre>

<p><strong>Join multiple statements with a semicolon</strong>:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"""
    INSERT INTO player (name, score) VALUES (?, ?);
    INSERT INTO player (name, score) VALUES (?, ?);
    """</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"Arthur"</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span> <span class="s">"Barbara"</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>

<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">literal</span><span class="p">:</span> <span class="s">"""
    INSERT INTO player (name, score) VALUES (</span><span class="se">\(</span><span class="s">"Arthur"</span><span class="se">)</span><span class="s">, </span><span class="se">\(</span><span class="mi">750</span><span class="se">)</span><span class="s">);
    INSERT INTO player (name, score) VALUES (</span><span class="se">\(</span><span class="s">"Barbara"</span><span class="se">)</span><span class="s">, </span><span class="se">\(</span><span class="mi">1000</span><span class="se">)</span><span class="s">);
    """</span><span class="p">)</span>
</code></pre>

<p>When you want to make sure that a single statement is executed, use <a href="#prepared-statements">Prepared Statements</a>.</p>

<p><strong>After an INSERT statement</strong>, you can get the row ID of the inserted row:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span>
    <span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT INTO player (name, score) VALUES (?, ?)"</span><span class="p">,</span>
    <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"Arthur"</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>
<span class="k">let</span> <span class="nv">playerId</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">lastInsertedRowID</span>
</code></pre>

<p>Don&rsquo;t miss <a href="#records">Records</a>, that provide classic <strong>persistence methods</strong>:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">player</span> <span class="o">=</span> <span class="kt">Player</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Arthur"</span><span class="p">,</span> <span class="nv">score</span><span class="p">:</span> <span class="mi">1000</span><span class="p">)</span>
<span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">playerId</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="n">id</span>
</code></pre>
<h2 id='fetch-queries' class='heading'>Fetch Queries</h2>

<p><a href="#database-connections">Database connections</a> let you fetch database rows, plain values, and custom models aka &ldquo;records&rdquo;.</p>

<p><strong>Rows</strong> are the raw results of SQL queries:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM wine WHERE id = ?"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span>
        <span class="k">let</span> <span class="nv">color</span><span class="p">:</span> <span class="kt">Color</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"color"</span><span class="p">]</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p><strong>Values</strong> are the Bool, Int, String, Date, Swift enums, etc. stored in row columns:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">urls</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">URL</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT url FROM wine"</span><span class="p">)</span>
    <span class="k">while</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="k">try</span> <span class="n">urls</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p><strong>Records</strong> are your application objects that can initialize themselves from rows:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">wines</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Wine</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM wine"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<ul>
<li><a href="#fetching-methods">Fetching Methods</a> and <a href="#cursors">Cursors</a></li>
<li><a href="#row-queries">Row Queries</a></li>
<li><a href="#value-queries">Value Queries</a></li>
<li><a href="#records">Records</a></li>
</ul>
<h3 id='fetching-methods' class='heading'>Fetching Methods</h3>

<p><strong>Throughout GRDB</strong>, you can always fetch <em>cursors</em>, <em>arrays</em>, <em>sets</em>, or <em>single values</em> of any fetchable type (database <a href="#row-queries">row</a>, simple <a href="#value-queries">value</a>, or custom <a href="#records">record</a>):</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="c1">// A Cursor of Row</span>
<span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>    <span class="c1">// [Row]</span>
<span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchSet</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>    <span class="c1">// Set&lt;Row&gt;</span>
<span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>    <span class="c1">// Row?</span>
</code></pre>

<ul>
<li><p><code>fetchCursor</code> returns a <strong><a href="#cursors">cursor</a></strong> over fetched values:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">rows</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">)</span> <span class="c1">// A Cursor of Row</span>
</code></pre></li>
<li><p><code>fetchAll</code> returns an <strong>array</strong>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">)</span> <span class="c1">// [Player]</span>
</code></pre></li>
<li><p><code>fetchSet</code> returns a <strong>set</strong>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">names</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">String</span><span class="o">.</span><span class="nf">fetchSet</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">)</span> <span class="c1">// Set&lt;String&gt;</span>
</code></pre></li>
<li><p><code>fetchOne</code> returns a <strong>single optional value</strong>, and consumes a single database row (if any).</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT COUNT(*) ..."</span><span class="p">)</span> <span class="c1">// Int?</span>
</code></pre></li>
</ul>

<p><strong>All those fetching methods require an SQL string that contains a single SQL statement.</strong> When you want to fetch from multiple statements joined with a semicolon, iterate the multiple <a href="#prepared-statements">prepared statements</a> found in the SQL string:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">statements</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">allStatements</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"""
    SELECT ...; 
    SELECT ...; 
    SELECT ...;
    """</span><span class="p">)</span>
<span class="k">while</span> <span class="k">let</span> <span class="nv">statement</span> <span class="o">=</span> <span class="k">try</span> <span class="n">statements</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>You can join the results of all statements yielded by the <code>allStatements</code> method, like the SQLite <a href="https://www.sqlite.org/c3ref/exec.html"><code>sqlite3_exec</code></a> function:</p>
<pre class="highlight swift"><code><span class="c1">// A single cursor of all rows from all statements</span>
<span class="k">let</span> <span class="nv">rows</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span>
    <span class="o">.</span><span class="nf">allStatements</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"..."</span><span class="p">)</span>
    <span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">statement</span> <span class="k">in</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span> <span class="p">}</span>
</code></pre>

<p>See <a href="#prepared-statements">prepared statements</a> for more information about <code>allStatements()</code>.</p>
<h3 id='cursors' class='heading'>Cursors</h3>

<p><strong>Whenever you consume several rows from the database, you can fetch an Array, a Set, or a Cursor</strong>.</p>

<p>The <code>fetchAll()</code> and <code>fetchSet()</code> methods return regular Swift array and sets, that you iterate like all other arrays and sets:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// [Player]</span>
    <span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">player</span> <span class="k">in</span> <span class="n">players</span> <span class="p">{</span>
        <span class="c1">// use player</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Unlike arrays and sets, cursors returned by <code>fetchCursor()</code> load their results step after step:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// Cursor of Player</span>
    <span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">)</span>
    <span class="k">while</span> <span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="k">try</span> <span class="n">players</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// use player</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<ul>
<li><p><strong>Cursors can not be used on any thread</strong>: you must consume a cursor on the dispatch queue it was created in. Particularly, don&rsquo;t extract a cursor out of a database access method:</p>
<pre class="highlight swift"><code><span class="c1">// Wrong</span>
<span class="k">let</span> <span class="nv">cursor</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">while</span> <span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="k">try</span> <span class="n">cursor</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre>

<p>Conversely, arrays and sets may be consumed on any thread:</p>
<pre class="highlight swift"><code><span class="c1">// OK</span>
<span class="k">let</span> <span class="nv">array</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">for</span> <span class="n">player</span> <span class="k">in</span> <span class="n">array</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></li>
<li><p><strong>Cursors can be iterated only one time.</strong> Arrays and sets can be iterated many times.</p></li>
<li><p><strong>Cursors iterate database results in a lazy fashion</strong>, and don&rsquo;t consume much memory. Arrays and sets contain copies of database values, and may take a lot of memory when there are many fetched results.</p></li>
<li><p><strong>Cursors are granted with direct access to SQLite,</strong> unlike arrays and sets that have to take the time to copy database values. If you look after extra performance, you may prefer cursors.</p></li>
<li><p><strong>Cursors can feed Swift collections.</strong></p>

<p>You will most of the time use <code>fetchAll</code> or <code>fetchSet</code> when you want an array or a set. For more specific needs, you may prefer one of the initializers below. All of them accept an extra optional <code>minimumCapacity</code> argument which helps optimizing your app when you have an idea of the number of elements in a cursor (the built-in <code>fetchAll</code> and <code>fetchSet</code> do not perform such an optimization).</p>

<p><strong>Arrays</strong> and all types conforming to <code>RangeReplaceableCollection</code>:</p>
<pre class="highlight swift"><code><span class="c1">// [String]</span>
<span class="k">let</span> <span class="nv">cursor</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">String</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">array</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Array</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
</code></pre>

<p><strong>Sets</strong>:</p>
<pre class="highlight swift"><code><span class="c1">// Set&lt;Int&gt;</span>
<span class="k">let</span> <span class="nv">cursor</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">set</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Set</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
</code></pre>

<p><strong>Dictionaries</strong>:</p>
<pre class="highlight swift"><code><span class="c1">// [Int64: [Player]]</span>
<span class="k">let</span> <span class="nv">cursor</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">dictionary</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Dictionary</span><span class="p">(</span><span class="nv">grouping</span><span class="p">:</span> <span class="n">cursor</span><span class="p">,</span> <span class="nv">by</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">teamID</span> <span class="p">})</span>

<span class="c1">// [Int64: Player]</span>
<span class="k">let</span> <span class="nv">cursor</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
<span class="k">let</span> <span class="nv">dictionary</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Dictionary</span><span class="p">(</span><span class="nv">uniqueKeysWithValues</span><span class="p">:</span> <span class="n">cursor</span><span class="p">)</span>
</code></pre></li>
<li><p><strong>Cursors adopt the <a href="http://groue.github.io/GRDB.swift/docs/5.21/Protocols/Cursor.html">Cursor</a> protocol, which looks a lot like standard <a href="https://developer.apple.com/reference/swift/lazysequenceprotocol">lazy sequences</a> of Swift.</strong> As such, cursors come with many convenience methods: <code>compactMap</code>, <code>contains</code>, <code>dropFirst</code>, <code>dropLast</code>, <code>drop(while:)</code>, <code>enumerated</code>, <code>filter</code>, <code>first</code>, <code>flatMap</code>, <code>forEach</code>, <code>joined</code>, <code>joined(separator:)</code>, <code>max</code>, <code>max(by:)</code>, <code>min</code>, <code>min(by:)</code>, <code>map</code>, <code>prefix</code>, <code>prefix(while:)</code>, <code>reduce</code>, <code>reduce(into:)</code>, <code>suffix</code>:</p>
<pre class="highlight swift"><code><span class="c1">// Prints all Github links</span>
<span class="k">try</span> <span class="kt">URL</span>
    <span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT url FROM link"</span><span class="p">)</span>
    <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="n">url</span> <span class="k">in</span> <span class="n">url</span><span class="o">.</span><span class="n">host</span> <span class="o">==</span> <span class="s">"github.com"</span> <span class="p">}</span>
    <span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">url</span> <span class="k">in</span> <span class="nf">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="p">}</span>

<span class="c1">// An efficient cursor of coordinates:</span>
<span class="k">let</span> <span class="nv">locations</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span>
    <span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT latitude, longitude FROM place"</span><span class="p">)</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">row</span> <span class="k">in</span>
        <span class="kt">CLLocationCoordinate2D</span><span class="p">(</span><span class="nv">latitude</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">longitude</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">}</span>
</code></pre></li>
<li><p><strong>Cursors are not Swift sequences.</strong> That&rsquo;s because Swift sequences can&rsquo;t handle iteration errors, when reading SQLite results may fail at any time.</p></li>
<li><p><strong>Cursors require a little care</strong>:</p>

<ul>
<li><p>Don&rsquo;t modify the results during a cursor iteration:</p>
<pre class="highlight swift"><code><span class="c1">// Undefined behavior</span>
<span class="k">while</span> <span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="k">try</span> <span class="n">players</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"DELETE ..."</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></li>
<li><p>Don&rsquo;t turn a cursor of <code><a href="Classes/Row.html">Row</a></code> into an array or a set. You would not get the distinct rows you expect. To get a array of rows, use <code><a href="Classes/Row.html#/s:4GRDB3RowC8fetchAll_9arguments7adapterSayACGAA9StatementC_AA0G9ArgumentsVSgAA0B7Adapter_pSgtKFZ">Row.fetchAll(...)</a></code>. To get a set of rows, use <code><a href="Classes/Row.html#/s:4GRDB3RowC8fetchSet_9arguments7adapterShyACGAA9StatementC_AA0G9ArgumentsVSgAA0B7Adapter_pSgtKFZ">Row.fetchSet(...)</a></code>. Generally speaking, make sure you copy a row whenever you extract it from a cursor for later use: <code>row.copy()</code>.</p></li>
</ul></li>
</ul>

<p>If you don&rsquo;t see, or don&rsquo;t care about the difference, use arrays. If you care about memory and performance, use cursors when appropriate.</p>
<h3 id='row-queries' class='heading'>Row Queries</h3>

<ul>
<li><a href="#fetching-rows">Fetching Rows</a></li>
<li><a href="#column-values">Column Values</a></li>
<li><a href="#databasevalue">DatabaseValue</a></li>
<li><a href="#rows-as-dictionaries">Rows as Dictionaries</a></li>
</ul>
<h4 id='fetching-rows' class='heading'>Fetching Rows</h4>

<p>Fetch <strong>cursors</strong> of rows, <strong>arrays</strong>, <strong>sets</strong>, or <strong>single</strong> rows (see <a href="#fetching-methods">fetching methods</a>):</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="o">...</span><span class="p">)</span> <span class="c1">// A Cursor of Row</span>
    <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="o">...</span><span class="p">)</span>    <span class="c1">// [Row]</span>
    <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchSet</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="o">...</span><span class="p">)</span>    <span class="c1">// Set&lt;Row&gt;</span>
    <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="o">...</span><span class="p">)</span>    <span class="c1">// Row?</span>

    <span class="k">let</span> <span class="nv">rows</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM wine"</span><span class="p">)</span>
    <span class="k">while</span> <span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rows</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span>
        <span class="k">let</span> <span class="nv">color</span><span class="p">:</span> <span class="kt">Color</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"color"</span><span class="p">]</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">rows</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM player"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Arguments are optional arrays or dictionaries that fill the positional <code>?</code> and colon-prefixed keys like <code>:name</code> in the query:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">rows</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span>
    <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM player WHERE name = ?"</span><span class="p">,</span>
    <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"Arthur"</span><span class="p">])</span>

<span class="k">let</span> <span class="nv">rows</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span>
    <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM player WHERE name = :name"</span><span class="p">,</span>
    <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"name"</span><span class="p">:</span> <span class="s">"Arthur"</span><span class="p">])</span>
</code></pre>

<p>See <a href="#values">Values</a> for more information on supported arguments types (Bool, Int, String, Date, Swift enums, etc.), and <a href="http://groue.github.io/GRDB.swift/docs/5.21/Structs/StatementArguments.html">StatementArguments</a> for a detailed documentation of SQLite arguments.</p>

<p>Unlike row arrays that contain copies of the database rows, row cursors are close to the SQLite metal, and require a little care:</p>

<blockquote>
<p>:point_up: <strong>Don&rsquo;t turn a cursor of <code><a href="Classes/Row.html">Row</a></code> into an array or a set</strong>. You would not get the distinct rows you expect. To get a array of rows, use <code><a href="Classes/Row.html#/s:4GRDB3RowC8fetchAll_9arguments7adapterSayACGAA9StatementC_AA0G9ArgumentsVSgAA0B7Adapter_pSgtKFZ">Row.fetchAll(...)</a></code>. To get a set of rows, use <code><a href="Classes/Row.html#/s:4GRDB3RowC8fetchSet_9arguments7adapterShyACGAA9StatementC_AA0G9ArgumentsVSgAA0B7Adapter_pSgtKFZ">Row.fetchSet(...)</a></code>. Generally speaking, make sure you copy a row whenever you extract it from a cursor for later use: <code>row.copy()</code>.</p>
</blockquote>
<h4 id='column-values' class='heading'>Column Values</h4>

<p><strong>Read column values</strong> by index or column name:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>      <span class="c1">// 0 is the leftmost column</span>
<span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="c1">// Leftmost matching column - lookup is case-insensitive</span>
<span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="kt">Column</span><span class="p">(</span><span class="s">"name"</span><span class="p">)]</span> <span class="c1">// Using query interface's Column</span>
</code></pre>

<p>Make sure to ask for an optional when the value may be NULL:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span>
</code></pre>

<p>The <code>row[]</code> subscript returns the type you ask for. See <a href="#values">Values</a> for more information on supported value types:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">bookCount</span><span class="p">:</span> <span class="kt">Int</span>     <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"bookCount"</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">bookCount64</span><span class="p">:</span> <span class="kt">Int64</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"bookCount"</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">hasBooks</span><span class="p">:</span> <span class="kt">Bool</span>     <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"bookCount"</span><span class="p">]</span> <span class="c1">// false when 0</span>

<span class="k">let</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">String</span>     <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"date"</span><span class="p">]</span>      <span class="c1">// "2015-09-11 18:14:15.123"</span>
<span class="k">let</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">Date</span>         <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"date"</span><span class="p">]</span>      <span class="c1">// Date</span>
<span class="k">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"date"</span><span class="p">]</span> <span class="c1">// Depends on the type of the property.</span>
</code></pre>

<p>You can also use the <code>as</code> type casting operator:</p>
<pre class="highlight swift"><code><span class="n">row</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Int</span>
<span class="n">row</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Int</span><span class="p">?</span>
</code></pre>

<blockquote>
<p>:warning: <strong>Warning</strong>: avoid the <code>as!</code> and <code>as?</code> operators:</p>
<pre class="highlight swift"><code><span class="k">if</span> <span class="k">let</span> <span class="nv">int</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Int</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="c1">// BAD - doesn't work</span>
<span class="k">if</span> <span class="k">let</span> <span class="nv">int</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Int</span><span class="p">?</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="c1">// GOOD</span>
</code></pre>
</blockquote>

<p>Generally speaking, you can extract the type you need, provided it can be converted from the underlying SQLite value:</p>

<ul>
<li><p><strong>Successful conversions include:</strong></p>

<ul>
<li>All numeric SQLite values to all numeric Swift types, and Bool (zero is the only false boolean).</li>
<li>Text SQLite values to Swift String.</li>
<li>Blob SQLite values to Foundation Data.</li>
</ul>

<p>See <a href="#values">Values</a> for more information on supported types (Bool, Int, String, Date, Swift enums, etc.)</p></li>
<li><p><strong>NULL returns nil.</strong></p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT NULL"</span><span class="p">)</span><span class="o">!</span>
<span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Int</span><span class="p">?</span> <span class="c1">// nil</span>
<span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Int</span>  <span class="c1">// fatal error: could not convert NULL to Int.</span>
</code></pre>

<p>There is one exception, though: the <a href="#databasevalue">DatabaseValue</a> type:</p>
<pre class="highlight swift"><code><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="kt">DatabaseValue</span> <span class="c1">// DatabaseValue.null</span>
</code></pre></li>
<li><p><strong>Missing columns return nil.</strong></p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 'foo' AS foo"</span><span class="p">)</span><span class="o">!</span>
<span class="n">row</span><span class="p">[</span><span class="s">"missing"</span><span class="p">]</span> <span class="k">as</span> <span class="kt">String</span><span class="p">?</span> <span class="c1">// nil</span>
<span class="n">row</span><span class="p">[</span><span class="s">"missing"</span><span class="p">]</span> <span class="k">as</span> <span class="kt">String</span>  <span class="c1">// fatal error: no such column: missing</span>
</code></pre>

<p>You can explicitly check for a column presence with the <code>hasColumn</code> method.</p></li>
<li><p><strong>Invalid conversions throw a fatal error.</strong></p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 'Mom’s birthday'"</span><span class="p">)</span><span class="o">!</span>
<span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="kt">String</span> <span class="c1">// "Mom’s birthday"</span>
<span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Date</span><span class="p">?</span>  <span class="c1">// fatal error: could not convert "Mom’s birthday" to Date.</span>
<span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Date</span>   <span class="c1">// fatal error: could not convert "Mom’s birthday" to Date.</span>

<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 256"</span><span class="p">)</span><span class="o">!</span>
<span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Int</span>    <span class="c1">// 256</span>
<span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="kt">UInt8</span><span class="p">?</span> <span class="c1">// fatal error: could not convert 256 to UInt8.</span>
<span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="kt">UInt8</span>  <span class="c1">// fatal error: could not convert 256 to UInt8.</span>
</code></pre>

<p>Those conversion fatal errors can be avoided with the <a href="#databasevalue">DatabaseValue</a> type:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 'Mom’s birthday'"</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">dbValue</span><span class="p">:</span> <span class="kt">DatabaseValue</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">if</span> <span class="n">dbValue</span><span class="o">.</span><span class="n">isNull</span> <span class="p">{</span>
    <span class="c1">// Handle NULL</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">date</span> <span class="o">=</span> <span class="kt">Date</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">dbValue</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handle valid date</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Handle invalid date</span>
<span class="p">}</span>
</code></pre>

<p>This extra verbosity is the consequence of having to deal with an untrusted database: you may consider fixing the content of your database instead. See <a href="#fatal-errors">Fatal Errors</a> for more information.</p></li>
<li><p><strong>SQLite has a weak type system, and provides <a href="https://www.sqlite.org/c3ref/column_blob.html">convenience conversions</a> that can turn String to Int, Double to Blob, etc.</strong></p>

<p>GRDB will sometimes let those conversions go through:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">rows</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT '20 small cigars'"</span><span class="p">)</span>
<span class="k">while</span> <span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rows</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Int</span>   <span class="c1">// 20</span>
<span class="p">}</span>
</code></pre>

<p>Don&rsquo;t freak out: those conversions did not prevent SQLite from becoming the immensely successful database engine you want to use. And GRDB adds safety checks described just above. You can also prevent those convenience conversions altogether by using the <a href="#databasevalue">DatabaseValue</a> type.</p></li>
</ul>
<h4 id='databasevalue' class='heading'>DatabaseValue</h4>

<p><strong>DatabaseValue is an intermediate type between SQLite and your values, which gives information about the raw value stored in the database.</strong></p>

<p>You get DatabaseValue just like other value types:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">dbValue</span><span class="p">:</span> <span class="kt">DatabaseValue</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">dbValue</span><span class="p">:</span> <span class="kt">DatabaseValue</span><span class="p">?</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="c1">// nil if and only if column does not exist</span>

<span class="c1">// Check for NULL:</span>
<span class="n">dbValue</span><span class="o">.</span><span class="n">isNull</span> <span class="c1">// Bool</span>

<span class="c1">// The stored value:</span>
<span class="n">dbValue</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">value</span> <span class="c1">// Int64, Double, String, Data, or nil</span>

<span class="c1">// All the five storage classes supported by SQLite:</span>
<span class="k">switch</span> <span class="n">dbValue</span><span class="o">.</span><span class="n">storage</span> <span class="p">{</span>
<span class="k">case</span> <span class="o">.</span><span class="nv">null</span><span class="p">:</span>                 <span class="nf">print</span><span class="p">(</span><span class="s">"NULL"</span><span class="p">)</span>
<span class="k">case</span> <span class="o">.</span><span class="nf">int64</span><span class="p">(</span><span class="k">let</span> <span class="nv">int64</span><span class="p">):</span>     <span class="nf">print</span><span class="p">(</span><span class="s">"Int64: </span><span class="se">\(</span><span class="n">int64</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="k">case</span> <span class="o">.</span><span class="nf">double</span><span class="p">(</span><span class="k">let</span> <span class="nv">double</span><span class="p">):</span>   <span class="nf">print</span><span class="p">(</span><span class="s">"Double: </span><span class="se">\(</span><span class="n">double</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="k">case</span> <span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="k">let</span> <span class="nv">string</span><span class="p">):</span>   <span class="nf">print</span><span class="p">(</span><span class="s">"String: </span><span class="se">\(</span><span class="n">string</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="k">case</span> <span class="o">.</span><span class="nf">blob</span><span class="p">(</span><span class="k">let</span> <span class="nv">data</span><span class="p">):</span>       <span class="nf">print</span><span class="p">(</span><span class="s">"Data: </span><span class="se">\(</span><span class="n">data</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>You can extract regular <a href="#values">values</a> (Bool, Int, String, Date, Swift enums, etc.) from DatabaseValue with the <a href="#custom-value-types">DatabaseValueConvertible.fromDatabaseValue()</a> method:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">dbValue</span><span class="p">:</span> <span class="kt">DatabaseValue</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"bookCount"</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">bookCount</span>   <span class="o">=</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">dbValue</span><span class="p">)</span>   <span class="c1">// Int?</span>
<span class="k">let</span> <span class="nv">bookCount64</span> <span class="o">=</span> <span class="kt">Int64</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">dbValue</span><span class="p">)</span> <span class="c1">// Int64?</span>
<span class="k">let</span> <span class="nv">hasBooks</span>    <span class="o">=</span> <span class="kt">Bool</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">dbValue</span><span class="p">)</span>  <span class="c1">// Bool?, false when 0</span>

<span class="k">let</span> <span class="nv">dbValue</span><span class="p">:</span> <span class="kt">DatabaseValue</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"date"</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="kt">String</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">dbValue</span><span class="p">)</span>     <span class="c1">// "2015-09-11 18:14:15.123"</span>
<span class="k">let</span> <span class="nv">date</span>   <span class="o">=</span> <span class="kt">Date</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">dbValue</span><span class="p">)</span>       <span class="c1">// Date?</span>
</code></pre>

<p><code>fromDatabaseValue</code> returns nil for invalid conversions:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 'Mom’s birthday'"</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">dbValue</span><span class="p">:</span> <span class="kt">DatabaseValue</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="kt">String</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">dbValue</span><span class="p">)</span> <span class="c1">// "Mom’s birthday"</span>
<span class="k">let</span> <span class="nv">int</span>    <span class="o">=</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">dbValue</span><span class="p">)</span>    <span class="c1">// nil</span>
<span class="k">let</span> <span class="nv">date</span>   <span class="o">=</span> <span class="kt">Date</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">dbValue</span><span class="p">)</span>   <span class="c1">// nil</span>
</code></pre>
<h4 id='rows-as-dictionaries' class='heading'>Rows as Dictionaries</h4>

<p>Row adopts the standard <a href="https://developer.apple.com/documentation/swift/randomaccesscollection">RandomAccessCollection</a> protocol, and can be seen as a dictionary of <a href="#databasevalue">DatabaseValue</a>:</p>
<pre class="highlight swift"><code><span class="c1">// All the (columnName, dbValue) tuples, from left to right:</span>
<span class="k">for</span> <span class="p">(</span><span class="n">columnName</span><span class="p">,</span> <span class="n">dbValue</span><span class="p">)</span> <span class="k">in</span> <span class="n">row</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre>

<p><strong>You can build rows from dictionaries</strong> (standard Swift dictionaries and NSDictionary). See <a href="#values">Values</a> for more information on supported types:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">row</span><span class="p">:</span> <span class="kt">Row</span> <span class="o">=</span> <span class="p">[</span><span class="s">"name"</span><span class="p">:</span> <span class="s">"foo"</span><span class="p">,</span> <span class="s">"date"</span><span class="p">:</span> <span class="kc">nil</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="kt">Row</span><span class="p">([</span><span class="s">"name"</span><span class="p">:</span> <span class="s">"foo"</span><span class="p">,</span> <span class="s">"date"</span><span class="p">:</span> <span class="kc">nil</span><span class="p">])</span>
<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="kt">Row</span><span class="p">(</span><span class="cm">/* [AnyHashable: Any] */</span><span class="p">)</span> <span class="c1">// nil if invalid dictionary</span>
</code></pre>

<p>Yet rows are not real dictionaries: they may contain duplicate columns:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 1 AS foo, 2 AS foo"</span><span class="p">)</span><span class="o">!</span>
<span class="n">row</span><span class="o">.</span><span class="n">columnNames</span>    <span class="c1">// ["foo", "foo"]</span>
<span class="n">row</span><span class="o">.</span><span class="n">databaseValues</span> <span class="c1">// [1, 2]</span>
<span class="n">row</span><span class="p">[</span><span class="s">"foo"</span><span class="p">]</span>         <span class="c1">// 1 (leftmost matching column)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">columnName</span><span class="p">,</span> <span class="n">dbValue</span><span class="p">)</span> <span class="k">in</span> <span class="n">row</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="c1">// ("foo", 1), ("foo", 2)</span>
</code></pre>

<p><strong>When you build a dictionary from a row</strong>, you have to disambiguate identical columns, and choose how to present database values. For example:</p>

<ul>
<li><p>A <code>[String: DatabaseValue]</code> dictionary that keeps leftmost value in case of duplicated column name:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">dict</span> <span class="o">=</span> <span class="kt">Dictionary</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="nv">uniquingKeysWith</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="k">in</span> <span class="n">left</span> <span class="p">})</span>
</code></pre></li>
<li><p>A <code>[String: AnyObject]</code> dictionary which keeps rightmost value in case of duplicated column name. This dictionary is identical to FMResultSet&rsquo;s resultDictionary from FMDB. It contains NSNull values for null columns, and can be shared with Objective-C:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">dict</span> <span class="o">=</span> <span class="kt">Dictionary</span><span class="p">(</span>
    <span class="n">row</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">dbValue</span><span class="p">)</span> <span class="nf">in</span>
        <span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">dbValue</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">value</span> <span class="k">as</span> <span class="kt">AnyObject</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="nv">uniquingKeysWith</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span> <span class="k">in</span> <span class="n">right</span> <span class="p">})</span>
</code></pre></li>
<li><p>A <code>[String: Any]</code> dictionary that can feed, for example, JSONSerialization:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">dict</span> <span class="o">=</span> <span class="kt">Dictionary</span><span class="p">(</span>
    <span class="n">row</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">dbValue</span><span class="p">)</span> <span class="nf">in</span>
        <span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">dbValue</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="nv">uniquingKeysWith</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="k">in</span> <span class="n">left</span> <span class="p">})</span>
</code></pre></li>
</ul>

<p>See the documentation of <a href="https://developer.apple.com/documentation/swift/dictionary/2892961-init"><code>Dictionary.init(_:uniquingKeysWith:)</code></a> for more information.</p>
<h3 id='value-queries' class='heading'>Value Queries</h3>

<p>Instead of rows, you can directly fetch <strong><a href="#values">values</a></strong>. Like rows, fetch them as <strong>cursors</strong>, <strong>arrays</strong>, <strong>sets</strong>, or <strong>single</strong> values (see <a href="#fetching-methods">fetching methods</a>). Values are extracted from the leftmost column of the SQL queries:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="o">...</span><span class="p">)</span> <span class="c1">// A Cursor of Int</span>
    <span class="k">try</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="o">...</span><span class="p">)</span>    <span class="c1">// [Int]</span>
    <span class="k">try</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">fetchSet</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="o">...</span><span class="p">)</span>    <span class="c1">// Set&lt;Int&gt;</span>
    <span class="k">try</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="o">...</span><span class="p">)</span>    <span class="c1">// Int?</span>

    <span class="c1">// When database may contain NULL:</span>
    <span class="k">try</span> <span class="kt">Optional</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="o">...</span><span class="p">)</span> <span class="c1">// A Cursor of Int?</span>
    <span class="k">try</span> <span class="kt">Optional</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="o">...</span><span class="p">)</span>    <span class="c1">// [Int?]</span>
    <span class="k">try</span> <span class="kt">Optional</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;.</span><span class="nf">fetchSet</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="o">...</span><span class="p">)</span>    <span class="c1">// Set&lt;Int?&gt;</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">playerCount</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT COUNT(*) FROM player"</span><span class="p">)</span><span class="o">!</span>
<span class="p">}</span>
</code></pre>

<p><code>fetchOne</code> returns an optional value which is nil in two cases: either the SELECT statement yielded no row, or one row with a NULL value.</p>

<p>There are many supported value types (Bool, Int, String, Date, Swift enums, etc.). See <a href="#values">Values</a> for more information:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT COUNT(*) FROM player"</span><span class="p">)</span><span class="o">!</span> <span class="c1">// Int</span>
<span class="k">let</span> <span class="nv">urls</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">URL</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT url FROM link"</span><span class="p">)</span>          <span class="c1">// [URL]</span>
</code></pre>
<h2 id='values' class='heading'>Values</h2>

<p>GRDB ships with built-in support for the following value types:</p>

<ul>
<li><p><strong>Swift Standard Library</strong>: Bool, Double, Float, all signed and unsigned integer types, String, <a href="#swift-enums">Swift enums</a>.</p></li>
<li><p><strong>Foundation</strong>: <a href="#data-and-memory-savings">Data</a>, <a href="#date-and-datecomponents">Date</a>, <a href="#date-and-datecomponents">DateComponents</a>, <a href="#nsnumber-nsdecimalnumber-and-decimal">Decimal</a>, NSNull, <a href="#nsnumber-nsdecimalnumber-and-decimal">NSNumber</a>, NSString, URL, <a href="#uuid">UUID</a>.</p></li>
<li><p><strong>CoreGraphics</strong>: CGFloat.</p></li>
<li><p><strong><a href="#databasevalue">DatabaseValue</a></strong>, the type which gives information about the raw value stored in the database.</p></li>
<li><p><strong>Full-Text Patterns</strong>: <a href="Documentation/FullTextSearch.md#fts3pattern">FTS3Pattern</a> and <a href="Documentation/FullTextSearch.md#fts5pattern">FTS5Pattern</a>.</p></li>
<li><p>Generally speaking, all types that adopt the <a href="#custom-value-types">DatabaseValueConvertible</a> protocol.</p></li>
</ul>

<p>Values can be used as <a href="http://groue.github.io/GRDB.swift/docs/5.21/Structs/StatementArguments.html">statement arguments</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">let</span> <span class="nv">verified</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span>
    <span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT INTO link (url, verified) VALUES (?, ?)"</span><span class="p">,</span>
    <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="n">url</span><span class="p">,</span> <span class="n">verified</span><span class="p">])</span>
</code></pre>

<p>Values can be <a href="#column-values">extracted from rows</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">rows</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM link"</span><span class="p">)</span>
<span class="k">while</span> <span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rows</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"url"</span><span class="p">]</span>
    <span class="k">let</span> <span class="nv">verified</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"verified"</span><span class="p">]</span>
<span class="p">}</span>
</code></pre>

<p>Values can be <a href="#value-queries">directly fetched</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">urls</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">URL</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT url FROM link"</span><span class="p">)</span>  <span class="c1">// [URL]</span>
</code></pre>

<p>Use values in <a href="#records">Records</a>:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Link</span><span class="p">:</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span>
    <span class="k">var</span> <span class="nv">isVerified</span><span class="p">:</span> <span class="kt">Bool</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">row</span><span class="p">:</span> <span class="kt">Row</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"url"</span><span class="p">]</span>
        <span class="n">isVerified</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"verified"</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Use values in the <a href="#the-query-interface">query interface</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">let</span> <span class="nv">link</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Link</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"url"</span><span class="p">)</span> <span class="o">==</span> <span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre>
<h3 id='data-and-memory-savings' class='heading'>Data (and Memory Savings)</h3>

<p><strong>Data</strong> suits the BLOB SQLite columns. It can be stored and fetched from the database just like other <a href="#values">values</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">rows</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT data, ..."</span><span class="p">)</span>
<span class="k">while</span> <span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rows</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"data"</span><span class="p">]</span>
<span class="p">}</span>
</code></pre>

<p>At each step of the request iteration, the <code>row[]</code> subscript creates <em>two copies</em> of the database bytes: one fetched by SQLite, and another, stored in the Swift Data value.</p>

<p><strong>You have the opportunity to save memory</strong> by not copying the data fetched by SQLite:</p>
<pre class="highlight swift"><code><span class="k">while</span> <span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rows</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="nf">dataNoCopy</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span> <span class="s">"data"</span><span class="p">)</span> <span class="c1">// Data?</span>
<span class="p">}</span>
</code></pre>

<p>The non-copied data does not live longer than the iteration step: make sure that you do not use it past this point.</p>
<h3 id='date-and-datecomponents' class='heading'>Date and DateComponents</h3>

<p><a href="#date"><strong>Date</strong></a> and <a href="#datecomponents"><strong>DateComponents</strong></a> can be stored and fetched from the database.</p>

<p>Here is how GRDB supports the various <a href="https://www.sqlite.org/lang_datefunc.html">date formats</a> supported by SQLite:</p>

<table><thead>
<tr>
<th style="text-align: left">SQLite format</th>
<th style="text-align: center">Date</th>
<th style="text-align: center">DateComponents</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">YYYY-MM-DD</td>
<td style="text-align: center">Read ¹</td>
<td style="text-align: center">Read / Write</td>
</tr>
<tr>
<td style="text-align: left">YYYY-MM-DD HH:MM</td>
<td style="text-align: center">Read ¹ ²</td>
<td style="text-align: center">Read ² / Write</td>
</tr>
<tr>
<td style="text-align: left">YYYY-MM-DD HH:MM:SS</td>
<td style="text-align: center">Read ¹ ²</td>
<td style="text-align: center">Read ² / Write</td>
</tr>
<tr>
<td style="text-align: left">YYYY-MM-DD HH:MM:SS.SSS</td>
<td style="text-align: center">Read ¹ ² / Write ¹</td>
<td style="text-align: center">Read ² / Write</td>
</tr>
<tr>
<td style="text-align: left">YYYY-MM-DD*<em>T</em>*HH:MM</td>
<td style="text-align: center">Read ¹ ²</td>
<td style="text-align: center">Read ²</td>
</tr>
<tr>
<td style="text-align: left">YYYY-MM-DD*<em>T</em>*HH:MM:SS</td>
<td style="text-align: center">Read ¹ ²</td>
<td style="text-align: center">Read ²</td>
</tr>
<tr>
<td style="text-align: left">YYYY-MM-DD*<em>T</em>*HH:MM:SS.SSS</td>
<td style="text-align: center">Read ¹ ²</td>
<td style="text-align: center">Read ²</td>
</tr>
<tr>
<td style="text-align: left">HH:MM</td>
<td style="text-align: center"></td>
<td style="text-align: center">Read ² / Write</td>
</tr>
<tr>
<td style="text-align: left">HH:MM:SS</td>
<td style="text-align: center"></td>
<td style="text-align: center">Read ² / Write</td>
</tr>
<tr>
<td style="text-align: left">HH:MM:SS.SSS</td>
<td style="text-align: center"></td>
<td style="text-align: center">Read ² / Write</td>
</tr>
<tr>
<td style="text-align: left">Timestamps since unix epoch</td>
<td style="text-align: center">Read ³</td>
<td style="text-align: center"></td>
</tr>
<tr>
<td style="text-align: left"><code>now</code></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
</tr>
</tbody></table>

<p>¹ Missing components are assumed to be zero. Dates are stored and read in the UTC time zone, unless the format is followed by a timezone indicator ⁽²⁾.</p>

<p>² This format may be optionally followed by a timezone indicator of the form <code>[+-]HH:MM</code> or just <code>Z</code>.</p>

<p>³ GRDB 2+ interprets numerical values as timestamps that fuel <code>Date(timeIntervalSince1970:)</code>. Previous GRDB versions used to interpret numbers as <a href="https://en.wikipedia.org/wiki/Julian_day">julian days</a>. Julian days are still supported, with the <code>Date(julianDay:)</code> initializer.</p>
<h4 id='date' class='heading'>Date</h4>

<p><strong>Date</strong> can be stored and fetched from the database just like other <a href="#values">values</a>:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span>
    <span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT INTO player (creationDate, ...) VALUES (?, ...)"</span><span class="p">,</span>
    <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="kt">Date</span><span class="p">(),</span> <span class="o">...</span><span class="p">])</span>

<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">creationDate</span><span class="p">:</span> <span class="kt">Date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"creationDate"</span><span class="p">]</span>
</code></pre>

<p>Dates are stored using the format &ldquo;YYYY-MM-DD HH:MM:SS.SSS&rdquo; in the UTC time zone. It is precise to the millisecond.</p>

<blockquote>
<p>:point_up: <strong>Note</strong>: this format was chosen because it is the only format that is:</p>

<ul>
<li>Comparable (<code>ORDER BY date</code> works)</li>
<li>Comparable with the SQLite keyword CURRENT_TIMESTAMP (<code>WHERE date &gt; CURRENT_TIMESTAMP</code> works)</li>
<li>Able to feed <a href="https://www.sqlite.org/lang_datefunc.html">SQLite date &amp; time functions</a></li>
<li>Precise enough</li>
</ul>
</blockquote>

<p>When the default format does not fit your needs, customize date conversions. For example:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span>
    <span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT INTO player (creationDate, ...) VALUES (?, ...)"</span><span class="p">,</span>
    <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="kt">Date</span><span class="p">()</span><span class="o">.</span><span class="n">timeIntervalSinceReferenceDate</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>

<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">creationDate</span> <span class="o">=</span> <span class="kt">Date</span><span class="p">(</span><span class="nv">timeIntervalSinceReferenceDate</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s">"creationDate"</span><span class="p">])</span>
</code></pre>

<p>See <a href="#codable-records">Codable Records</a> for more date customization options.</p>
<h4 id='datecomponents' class='heading'>DateComponents</h4>

<p>DateComponents is indirectly supported, through the <strong>DatabaseDateComponents</strong> helper type.</p>

<p>DatabaseDateComponents reads date components from all <a href="https://www.sqlite.org/lang_datefunc.html">date formats supported by SQLite</a>, and stores them in the format of your choice, from HH:MM to YYYY-MM-DD HH:MM:SS.SSS.</p>

<p>DatabaseDateComponents can be stored and fetched from the database just like other <a href="#values">values</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">components</span> <span class="o">=</span> <span class="kt">DateComponents</span><span class="p">()</span>
<span class="n">components</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="mi">1973</span>
<span class="n">components</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">components</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="mi">18</span>

<span class="c1">// Store "1973-09-18"</span>
<span class="k">let</span> <span class="nv">dbComponents</span> <span class="o">=</span> <span class="kt">DatabaseDateComponents</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="nv">format</span><span class="p">:</span> <span class="o">.</span><span class="kt">YMD</span><span class="p">)</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span>
    <span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT INTO player (birthDate, ...) VALUES (?, ...)"</span><span class="p">,</span>
    <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="n">dbComponents</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>

<span class="c1">// Read "1973-09-18"</span>
<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT birthDate ..."</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">dbComponents</span><span class="p">:</span> <span class="kt">DatabaseDateComponents</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"birthDate"</span><span class="p">]</span>
<span class="n">dbComponents</span><span class="o">.</span><span class="n">format</span>         <span class="c1">// .YMD (the actual format found in the database)</span>
<span class="n">dbComponents</span><span class="o">.</span><span class="n">dateComponents</span> <span class="c1">// DateComponents</span>
</code></pre>
<h3 id='nsnumber-nsdecimalnumber-and-decimal' class='heading'>NSNumber, NSDecimalNumber, and Decimal</h3>

<p><strong>NSNumber</strong> and <strong>Decimal</strong> can be stored and fetched from the database just like other <a href="#values">values</a>.</p>

<p>Here is how GRDB supports the various data types supported by SQLite:</p>

<table><thead>
<tr>
<th style="text-align: left"></th>
<th style="text-align: center">Integer</th>
<th style="text-align: center">Double</th>
<th style="text-align: center">String</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">NSNumber</td>
<td style="text-align: center">Read / Write</td>
<td style="text-align: center">Read / Write</td>
<td style="text-align: center">Read</td>
</tr>
<tr>
<td style="text-align: left">NSDecimalNumber</td>
<td style="text-align: center">Read / Write</td>
<td style="text-align: center">Read / Write</td>
<td style="text-align: center">Read</td>
</tr>
<tr>
<td style="text-align: left">Decimal</td>
<td style="text-align: center">Read</td>
<td style="text-align: center">Read</td>
<td style="text-align: center">Read / Write</td>
</tr>
</tbody></table>

<ul>
<li><p>All three types can decode database integers and doubles:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">number</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">NSNumber</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 10"</span><span class="p">)</span>            <span class="c1">// NSNumber</span>
<span class="k">let</span> <span class="nv">number</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">NSDecimalNumber</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 1.23"</span><span class="p">)</span>   <span class="c1">// NSDecimalNumber</span>
<span class="k">let</span> <span class="nv">number</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Decimal</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT -100"</span><span class="p">)</span>           <span class="c1">// Decimal</span>
</code></pre></li>
<li><p>All three types decode database strings as decimal numbers:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">number</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">NSNumber</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT '10'"</span><span class="p">)</span>          <span class="c1">// NSDecimalNumber (sic)</span>
<span class="k">let</span> <span class="nv">number</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">NSDecimalNumber</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT '1.23'"</span><span class="p">)</span> <span class="c1">// NSDecimalNumber</span>
<span class="k">let</span> <span class="nv">number</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Decimal</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT '-100'"</span><span class="p">)</span>         <span class="c1">// Decimal</span>
</code></pre></li>
<li><p><code>NSNumber</code> and <code>NSDecimalNumber</code> send 64-bit signed integers and doubles in the database:</p>
<pre class="highlight swift"><code><span class="c1">// INSERT INTO transfer VALUES (10)</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT INTO transfer VALUES (?)"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">10</span><span class="p">)])</span>

<span class="c1">// INSERT INTO transfer VALUES (10.0)</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT INTO transfer VALUES (?)"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">)])</span>

<span class="c1">// INSERT INTO transfer VALUES (10)</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT INTO transfer VALUES (?)"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSDecimalNumber</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"10.0"</span><span class="p">)])</span>

<span class="c1">// INSERT INTO transfer VALUES (10.5)</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT INTO transfer VALUES (?)"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSDecimalNumber</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"10.5"</span><span class="p">)])</span>
</code></pre>

<blockquote>
<p>:warning: <strong>Warning</strong>: since SQLite does not support decimal numbers, sending a non-integer <code>NSDecimalNumber</code> can result in a loss of precision during the conversion to double.</p>

<p>Instead of sending non-integer <code>NSDecimalNumber</code> to the database, you may prefer:</p>

<ul>
<li>Send <code>Decimal</code> instead (those store decimal strings in the database).</li>
<li>Send integers instead (for example, store amounts of cents instead of amounts of Euros).</li>
</ul>
</blockquote></li>
<li><p><code>Decimal</code> sends decimal strings in the database:</p>
<pre class="highlight swift"><code><span class="c1">// INSERT INTO transfer VALUES ('10')</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT INTO transfer VALUES (?)"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="kt">Decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>

<span class="c1">// INSERT INTO transfer VALUES ('10.5')</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT INTO transfer VALUES (?)"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="kt">Decimal</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"10.5"</span><span class="p">)</span><span class="o">!</span><span class="p">])</span>
</code></pre></li>
</ul>
<h3 id='uuid' class='heading'>UUID</h3>

<p><strong>UUID</strong> can be stored and fetched from the database just like other <a href="#values">values</a>.</p>

<p>GRDB stores uuids as 16-bytes data blobs, and decodes them from both 16-bytes data blobs and strings such as &ldquo;E621E1F8-C36C-495A-93FC-0C247A3E6E5F&rdquo;.</p>
<h3 id='swift-enums' class='heading'>Swift Enums</h3>

<p><strong>Swift enums</strong> and generally all types that adopt the <a href="https://developer.apple.com/library/tvos/documentation/Swift/Reference/Swift_RawRepresentable_Protocol/index.html">RawRepresentable</a> protocol can be stored and fetched from the database just like their raw <a href="#values">values</a>:</p>
<pre class="highlight swift"><code><span class="kd">enum</span> <span class="kt">Color</span> <span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">red</span><span class="p">,</span> <span class="n">white</span><span class="p">,</span> <span class="n">rose</span>
<span class="p">}</span>

<span class="kd">enum</span> <span class="kt">Grape</span> <span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">chardonnay</span><span class="p">,</span> <span class="n">merlot</span><span class="p">,</span> <span class="n">riesling</span>
<span class="p">}</span>

<span class="c1">// Declare empty DatabaseValueConvertible adoption</span>
<span class="kd">extension</span> <span class="kt">Color</span> <span class="p">:</span> <span class="kt">DatabaseValueConvertible</span> <span class="p">{</span> <span class="p">}</span>
<span class="kd">extension</span> <span class="kt">Grape</span> <span class="p">:</span> <span class="kt">DatabaseValueConvertible</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// Store</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span>
    <span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT INTO wine (grape, color) VALUES (?, ?)"</span><span class="p">,</span>
    <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="kt">Grape</span><span class="o">.</span><span class="n">merlot</span><span class="p">,</span> <span class="kt">Color</span><span class="o">.</span><span class="n">red</span><span class="p">])</span>

<span class="c1">// Read</span>
<span class="k">let</span> <span class="nv">rows</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM wine"</span><span class="p">)</span>
<span class="k">while</span> <span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rows</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">grape</span><span class="p">:</span> <span class="kt">Grape</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"grape"</span><span class="p">]</span>
    <span class="k">let</span> <span class="nv">color</span><span class="p">:</span> <span class="kt">Color</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"color"</span><span class="p">]</span>
<span class="p">}</span>
</code></pre>

<p><strong>When a database value does not match any enum case</strong>, you get a fatal error. This fatal error can be avoided with the <a href="#databasevalue">DatabaseValue</a> type:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 'syrah'"</span><span class="p">)</span><span class="o">!</span>

<span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="kt">String</span>  <span class="c1">// "syrah"</span>
<span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Grape</span><span class="p">?</span>  <span class="c1">// fatal error: could not convert "syrah" to Grape.</span>
<span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Grape</span>   <span class="c1">// fatal error: could not convert "syrah" to Grape.</span>

<span class="k">let</span> <span class="nv">dbValue</span><span class="p">:</span> <span class="kt">DatabaseValue</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">if</span> <span class="n">dbValue</span><span class="o">.</span><span class="n">isNull</span> <span class="p">{</span>
    <span class="c1">// Handle NULL</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">grape</span> <span class="o">=</span> <span class="kt">Grape</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">dbValue</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handle valid grape</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Handle unknown grape</span>
<span class="p">}</span>
</code></pre>
<h3 id='custom-value-types' class='heading'>Custom Value Types</h3>

<p>Conversion to and from the database is based on the <code><a href="Protocols/DatabaseValueConvertible.html">DatabaseValueConvertible</a></code> protocol:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">DatabaseValueConvertible</span> <span class="p">{</span>
    <span class="c1">/// Returns a value that can be stored in the database.</span>
    <span class="k">var</span> <span class="nv">databaseValue</span><span class="p">:</span> <span class="kt">DatabaseValue</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>

    <span class="c1">/// Returns a value initialized from dbValue, if possible.</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">_</span> <span class="nv">dbValue</span><span class="p">:</span> <span class="kt">DatabaseValue</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">Self</span><span class="p">?</span>
<span class="p">}</span>
</code></pre>

<p>All types that adopt this protocol can be used like all other <a href="#values">values</a> (Bool, Int, String, Date, Swift enums, etc.)</p>

<p>The <code>databaseValue</code> property returns <a href="#databasevalue">DatabaseValue</a>, a type that wraps the five values supported by SQLite: NULL, Int64, Double, String and Data. Since DatabaseValue has no public initializer, use <code><a href="Structs/DatabaseValue.html#/s:4GRDB13DatabaseValueV4nullACvpZ">DatabaseValue.null</a></code>, or another type that already adopts the protocol: <code>1.databaseValue</code>, <code>&quot;foo&quot;.databaseValue</code>, etc. Conversion to DatabaseValue <em>must not</em> fail.</p>

<p>The <code>fromDatabaseValue()</code> factory method returns an instance of your custom type if the database value contains a suitable value. If the database value does not contain a suitable value, such as &ldquo;foo&rdquo; for Date, <code>fromDatabaseValue</code> <em>must</em> return nil (GRDB will interpret this nil result as a conversion error, and react accordingly).</p>

<p>Value types that adopt both <code><a href="Protocols/DatabaseValueConvertible.html">DatabaseValueConvertible</a></code> and an archival protocol (<a href="https://developer.apple.com/documentation/foundation/archives_and_serialization/encoding_and_decoding_custom_types">Codable, Encodable or Decodable</a>) are automatically coded and decoded from JSON arrays and objects:</p>
<pre class="highlight swift"><code><span class="c1">// Encoded as a JSON object in the database:</span>
<span class="kd">struct</span> <span class="kt">Color</span><span class="p">:</span> <span class="kt">Codable</span><span class="p">,</span> <span class="kt">DatabaseValueConvertible</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">r</span><span class="p">:</span> <span class="kt">Double</span>
    <span class="k">var</span> <span class="nv">g</span><span class="p">:</span> <span class="kt">Double</span>
    <span class="k">var</span> <span class="nv">b</span><span class="p">:</span> <span class="kt">Double</span>
<span class="p">}</span>
</code></pre>

<p>For such codable value types, GRDB uses the standard <a href="https://developer.apple.com/documentation/foundation/jsondecoder">JSONDecoder</a> and <a href="https://developer.apple.com/documentation/foundation/jsonencoder">JSONEncoder</a> from Foundation. By default, Data values are handled with the <code>.base64</code> strategy, Date with the <code>.millisecondsSince1970</code> strategy, and non conforming floats with the <code>.throw</code> strategy.</p>

<p>In order to customize the JSON format, provide a custom implementation of the <code><a href="Protocols/DatabaseValueConvertible.html">DatabaseValueConvertible</a></code> requirements.</p>

<blockquote>
<p>:point_up: <strong>Note</strong>: standard sequences such as <code>Array</code>, <code>Set</code>, or <code>Dictionary</code> do not conform to <code><a href="Protocols/DatabaseValueConvertible.html">DatabaseValueConvertible</a></code>, even conditionally. You won&rsquo;t be able to directly fetch or store arrays, sets, or dictionaries as JSON database values. You can get free JSON support from these standard types when they are embedded as properties of <a href="#codable-records">Codable Records</a>, though.</p>
</blockquote>
<h2 id='transactions-and-savepoints' class='heading'>Transactions and Savepoints</h2>

<ul>
<li><a href="#transactions-and-safety">Transactions and Safety</a></li>
<li><a href="#explicit-transactions">Explicit Transactions</a></li>
<li><a href="#savepoints">Savepoints</a></li>
<li><a href="#transaction-kinds">Transaction Kinds</a></li>
</ul>
<h3 id='transactions-and-safety' class='heading'>Transactions and Safety</h3>

<p><strong>A transaction</strong> is a fundamental tool of SQLite that guarantees <a href="https://www.sqlite.org/transactional.html">data consistency</a> as well as <a href="https://sqlite.org/isolation.html">proper isolation</a> between application threads and database connections.</p>

<p>GRDB generally opens transactions for you, as a way to enforce its <a href="Documentation/Concurrency.md#safe-and-unsafe-database-accesses">concurrency guarantees</a>, and provide maximal security for both your application data and application logic:</p>
<pre class="highlight swift"><code><span class="c1">// BEGIN TRANSACTION</span>
<span class="c1">// INSERT INTO credit ...</span>
<span class="c1">// INSERT INTO debit ...</span>
<span class="c1">// COMMIT</span>
<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Credit</span><span class="p">(</span><span class="n">destinationAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">try</span> <span class="kt">Debit</span><span class="p">(</span><span class="n">sourceAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// BEGIN TRANSACTION</span>
<span class="c1">// INSERT INTO credit ...</span>
<span class="c1">// INSERT INTO debit ...</span>
<span class="c1">// COMMIT</span>
<span class="k">try</span> <span class="n">dbPool</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Credit</span><span class="p">(</span><span class="n">destinationAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">try</span> <span class="kt">Debit</span><span class="p">(</span><span class="n">sourceAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Yet you may need to exactly control when transactions take place:</p>
<h3 id='explicit-transactions' class='heading'>Explicit Transactions</h3>

<p><code>DatabaseQueue.inDatabase()</code> and <code>DatabasePool.writeWithoutTransaction()</code> execute your database statements outside of any transaction:</p>
<pre class="highlight swift"><code><span class="c1">// INSERT INTO credit ...</span>
<span class="c1">// INSERT INTO debit ...</span>
<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">inDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Credit</span><span class="p">(</span><span class="n">destinationAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">try</span> <span class="kt">Debit</span><span class="p">(</span><span class="n">sourceAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// INSERT INTO credit ...</span>
<span class="c1">// INSERT INTO debit ...</span>
<span class="k">try</span> <span class="n">dbPool</span><span class="o">.</span><span class="n">writeWithoutTransaction</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Credit</span><span class="p">(</span><span class="n">destinationAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">try</span> <span class="kt">Debit</span><span class="p">(</span><span class="n">sourceAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p><strong>Writing outside of any transaction is dangerous,</strong> for two reasons:</p>

<ul>
<li><p>In our credit/debit example, you may successfully insert a credit, but fail inserting the debit, and end up with unbalanced accounts (oops).</p>
<pre class="highlight swift"><code><span class="c1">// UNSAFE DATABASE INTEGRITY</span>
<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">inDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="c1">// or dbPool.writeWithoutTransaction</span>
    <span class="k">try</span> <span class="kt">Credit</span><span class="p">(</span><span class="n">destinationAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// may succeed</span>
    <span class="k">try</span> <span class="kt">Debit</span><span class="p">(</span><span class="n">sourceAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>      <span class="c1">// may fail</span>
<span class="p">}</span>
</code></pre>

<p>Transactions avoid this kind of bug.</p></li>
<li><p><a href="#database-pools">Database pool</a> concurrent reads can see an inconsistent state of the database:</p>
<pre class="highlight swift"><code><span class="c1">// UNSAFE CONCURRENCY</span>
<span class="k">try</span> <span class="n">dbPool</span><span class="o">.</span><span class="n">writeWithoutTransaction</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Credit</span><span class="p">(</span><span class="n">destinationAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="c1">// &lt;- Concurrent dbPool.read sees a partial db update here</span>
    <span class="k">try</span> <span class="kt">Debit</span><span class="p">(</span><span class="n">sourceAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Transactions avoid this kind of bug, too.</p></li>
</ul>

<p>To open explicit transactions, use one of the <code>Database.inTransaction</code>, <code>DatabaseQueue.inTransaction</code>, or <code>DatabasePool.writeInTransaction</code> methods:</p>
<pre class="highlight swift"><code><span class="c1">// BEGIN TRANSACTION</span>
<span class="c1">// INSERT INTO credit ...</span>
<span class="c1">// INSERT INTO debit ...</span>
<span class="c1">// COMMIT</span>
<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">inDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>  <span class="c1">// or dbPool.writeWithoutTransaction</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="n">inTransaction</span> <span class="p">{</span>
        <span class="k">try</span> <span class="kt">Credit</span><span class="p">(</span><span class="n">destinationAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="k">try</span> <span class="kt">Debit</span><span class="p">(</span><span class="n">sourceAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">.</span><span class="n">commit</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// BEGIN TRANSACTION</span>
<span class="c1">// INSERT INTO credit ...</span>
<span class="c1">// INSERT INTO debit ...</span>
<span class="c1">// COMMIT</span>
<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">inTransaction</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>  <span class="c1">// or dbPool.writeInTransaction</span>
    <span class="k">try</span> <span class="kt">Credit</span><span class="p">(</span><span class="n">destinationAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">try</span> <span class="kt">Debit</span><span class="p">(</span><span class="n">sourceAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">.</span><span class="n">commit</span>
<span class="p">}</span>
</code></pre>

<p>If an error is thrown from the transaction block, the transaction is rollbacked and the error is rethrown by the <code>inTransaction</code> method. If you return <code>.rollback</code> instead of <code>.commit</code>, the transaction is also rollbacked, but no error is thrown.</p>

<p>You can also perform manual transaction management:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">inDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>  <span class="c1">// or dbPool.writeWithoutTransaction</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">beginTransaction</span><span class="p">()</span>
    <span class="o">...</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">commit</span><span class="p">()</span>

    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"BEGIN TRANSACTION"</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"ROLLBACK"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Transactions can&rsquo;t be left opened unless you set the <a href="http://groue.github.io/GRDB.swift/docs/5.21/Structs/Configuration.html">allowsUnsafeTransactions</a> configuration flag:</p>
<pre class="highlight swift"><code><span class="c1">// fatal error: A transaction has been left opened at the end of a database access</span>
<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">inDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"BEGIN TRANSACTION"</span><span class="p">)</span>
    <span class="c1">// &lt;- no commit or rollback</span>
<span class="p">}</span>
</code></pre>

<p>You can ask if a transaction is currently opened:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">myCriticalMethod</span><span class="p">(</span><span class="n">_</span> <span class="nv">db</span><span class="p">:</span> <span class="kt">Database</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="nf">precondition</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">isInsideTransaction</span><span class="p">,</span> <span class="s">"This method requires a transaction"</span><span class="p">)</span>
    <span class="k">try</span> <span class="o">...</span>
<span class="p">}</span>
</code></pre>

<p>Yet, you have a better option than checking for transactions: critical database sections should use savepoints, described below:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">myCriticalMethod</span><span class="p">(</span><span class="n">_</span> <span class="nv">db</span><span class="p">:</span> <span class="kt">Database</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="n">inSavepoint</span> <span class="p">{</span>
        <span class="c1">// Here the database is guaranteed to be inside a transaction.</span>
        <span class="k">try</span> <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='savepoints' class='heading'>Savepoints</h3>

<p><strong>Statements grouped in a savepoint can be rollbacked without invalidating a whole transaction:</strong></p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// Makes sure both inserts succeed, or none:</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="n">inSavepoint</span> <span class="p">{</span>
        <span class="k">try</span> <span class="kt">Credit</span><span class="p">(</span><span class="n">destinationAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="k">try</span> <span class="kt">Debit</span><span class="p">(</span><span class="n">sourceAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">.</span><span class="n">commit</span>
    <span class="p">}</span>

    <span class="c1">// Other savepoints, etc...</span>
<span class="p">}</span>
</code></pre>

<p>If an error is thrown from the savepoint block, the savepoint is rollbacked and the error is rethrown by the <code>inSavepoint</code> method. If you return <code>.rollback</code> instead of <code>.commit</code>, the savepoint is also rollbacked, but no error is thrown.</p>

<p><strong>Unlike transactions, savepoints can be nested.</strong> They implicitly open a transaction if no one was opened when the savepoint begins. As such, they behave just like nested transactions. Yet the database changes are only written to disk when the outermost transaction is committed:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">inDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="n">inSavepoint</span> <span class="p">{</span>
        <span class="o">...</span>
        <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="n">inSavepoint</span> <span class="p">{</span>
            <span class="o">...</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">commit</span>
        <span class="p">}</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="o">.</span><span class="n">commit</span>  <span class="c1">// writes changes to disk</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>SQLite savepoints are more than nested transactions, though. For advanced uses, use <a href="https://www.sqlite.org/lang_savepoint.html">SQLite savepoint documentation</a>.</p>
<h3 id='transaction-kinds' class='heading'>Transaction Kinds</h3>

<p>SQLite supports <a href="https://www.sqlite.org/lang_transaction.html">three kinds of transactions</a>: deferred (the default), immediate, and exclusive.</p>

<p>The transaction kind can be changed in the database configuration, or for each transaction:</p>
<pre class="highlight swift"><code><span class="c1">// 1) Default configuration:</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="s">"..."</span><span class="p">)</span>

<span class="c1">// BEGIN DEFERRED TRANSACTION ...</span>
<span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>

<span class="c1">// BEGIN EXCLUSIVE TRANSACTION ...</span>
<span class="n">dbQueue</span><span class="o">.</span><span class="nf">inTransaction</span><span class="p">(</span><span class="o">.</span><span class="n">exclusive</span><span class="p">)</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>

<span class="c1">// 2) Customized default transaction kind:</span>
<span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">defaultTransactionKind</span> <span class="o">=</span> <span class="o">.</span><span class="n">immediate</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="s">"..."</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>

<span class="c1">// BEGIN IMMEDIATE TRANSACTION ...</span>
<span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>

<span class="c1">// BEGIN EXCLUSIVE TRANSACTION ...</span>
<span class="n">dbQueue</span><span class="o">.</span><span class="nf">inTransaction</span><span class="p">(</span><span class="o">.</span><span class="n">exclusive</span><span class="p">)</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>
</code></pre>
<h2 id='prepared-statements' class='heading'>Prepared Statements</h2>

<p><strong>Prepared Statements</strong> let you prepare an SQL query and execute it later, several times if you need, with different arguments.</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">insertSQL</span> <span class="o">=</span> <span class="s">"INSERT INTO player (name, score) VALUES (:name, :score)"</span>
    <span class="k">let</span> <span class="nv">insertStatement</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">makeStatement</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="n">insertSQL</span><span class="p">)</span>

    <span class="k">let</span> <span class="nv">selectSQL</span> <span class="o">=</span> <span class="s">"SELECT * FROM player WHERE name = ?"</span>
    <span class="k">let</span> <span class="nv">selectStatement</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">makeStatement</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="n">selectSQL</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>The <code>?</code> and colon-prefixed keys like <code>:name</code> in the SQL query are the statement arguments. You set them with arrays or dictionaries (arguments are actually of type <a href="http://groue.github.io/GRDB.swift/docs/5.21/Structs/StatementArguments.html">StatementArguments</a>, which happens to adopt the ExpressibleByArrayLiteral and ExpressibleByDictionaryLiteral protocols).</p>
<pre class="highlight swift"><code><span class="n">insertStatement</span><span class="o">.</span><span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span><span class="s">"name"</span><span class="p">:</span> <span class="s">"Arthur"</span><span class="p">,</span> <span class="s">"score"</span><span class="p">:</span> <span class="mi">1000</span><span class="p">]</span>
<span class="n">selectStatement</span><span class="o">.</span><span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span><span class="s">"Arthur"</span><span class="p">]</span>
</code></pre>

<p>Alternatively, you can create a prepared statement with <a href="Documentation/SQLInterpolation.md">SQL Interpolation</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">insertStatement</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">makeStatement</span><span class="p">(</span><span class="nv">literal</span><span class="p">:</span> <span class="s">"INSERT ..."</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">selectStatement</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">makeStatement</span><span class="p">(</span><span class="nv">literal</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">)</span>
<span class="c1">//                                         ~~~~~~~</span>
</code></pre>

<p>Statements can be executed:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">insertStatement</span><span class="o">.</span><span class="nf">execute</span><span class="p">()</span>
</code></pre>

<p>Statements can be used wherever a raw SQL query string would fit (see <a href="#fetch-queries">fetch queries</a>):</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">rows</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">selectStatement</span><span class="p">)</span>    <span class="c1">// A Cursor of Row</span>
<span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">selectStatement</span><span class="p">)</span> <span class="c1">// [Player]</span>
<span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchSet</span><span class="p">(</span><span class="n">selectStatement</span><span class="p">)</span> <span class="c1">// Set&lt;Player&gt;</span>
<span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">selectStatement</span><span class="p">)</span>  <span class="c1">// Player?</span>
</code></pre>

<p>You can set the arguments at the moment of the statement execution:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">insertStatement</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"name"</span><span class="p">:</span> <span class="s">"Arthur"</span><span class="p">,</span> <span class="s">"score"</span><span class="p">:</span> <span class="mi">1000</span><span class="p">])</span>
<span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">selectStatement</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"Arthur"</span><span class="p">])</span>
</code></pre>

<p><strong>When you want to build multiple statements joined with a semicolon</strong>, use the <code>allStatements</code> method:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">statements</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">allStatements</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"""
    INSERT INTO player (name, score) VALUES (?, ?);
    INSERT INTO player (name, score) VALUES (?, ?);
    """</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"Arthur"</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s">"O'Brien"</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>
<span class="k">while</span> <span class="k">let</span> <span class="nv">statement</span> <span class="o">=</span> <span class="k">try</span> <span class="n">statements</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="n">statement</span><span class="o">.</span><span class="nf">execute</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<p><code>allStatements</code> also supports <a href="Documentation/SQLInterpolation.md">SQL Interpolation</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">statements</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">allStatements</span><span class="p">(</span><span class="nv">literal</span><span class="p">:</span> <span class="s">"""
    INSERT INTO player (name, score) VALUES (</span><span class="se">\(</span><span class="s">"Arthur"</span><span class="se">)</span><span class="s">, </span><span class="se">\(</span><span class="mi">100</span><span class="se">)</span><span class="s">);
    INSERT INTO player (name, score) VALUES (</span><span class="se">\(</span><span class="s">"O'Brien"</span><span class="se">)</span><span class="s">, </span><span class="se">\(</span><span class="mi">1000</span><span class="se">)</span><span class="s">);
    """</span><span class="p">)</span>
<span class="k">while</span> <span class="k">let</span> <span class="nv">statement</span> <span class="o">=</span> <span class="k">try</span> <span class="n">statements</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="n">statement</span><span class="o">.</span><span class="nf">execute</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<p>You can turn the <a href="#cursors">cursor</a> returned from <code>allStatements</code> into a regular Swift array, but in this case make sure all individual statements can compile even if the previous ones were not run:</p>
<pre class="highlight swift"><code><span class="c1">// OK: Array of statements</span>
<span class="k">let</span> <span class="nv">statements</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Array</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="nf">allStatements</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"""
    INSERT ...; 
    UPDATE ...; 
    SELECT ...;
    """</span><span class="p">))</span>

<span class="c1">// FAILURE: Can't build an array of statements since </span>
<span class="c1">// the INSERT won't compile until CREATE TABLE is run.</span>
<span class="k">let</span> <span class="nv">statements</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Array</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="nf">allStatements</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"""
    CREATE TABLE player ...; 
    INSERT INTO player ...;
    """</span><span class="p">))</span>
</code></pre>

<p>See also <code>Database.execute(sql:)</code> in the <a href="#executing-updates">Executing Updates</a> chapter.</p>

<blockquote>
<p>:point_up: <strong>Note</strong>: it is a programmer error to reuse a prepared statement that has failed: GRDB may crash if you do so.</p>
</blockquote>

<p>For more information about prepared statements, see the <a href="http://groue.github.io/GRDB.swift/docs/5.21/Classes/Statement.html">Statement reference</a>.</p>
<h3 id='prepared-statements-cache' class='heading'>Prepared Statements Cache</h3>

<p>When the same query will be used several times in the lifetime of your application, you may feel a natural desire to cache prepared statements.</p>

<p><strong>Don&rsquo;t cache statements yourself.</strong></p>

<blockquote>
<p>:point_up: <strong>Note</strong>: This is because you don&rsquo;t have the necessary tools. Statements are tied to specific SQLite connections and dispatch queues which you don&rsquo;t manage yourself, especially when you use <a href="#database-pools">database pools</a>. A change in the database schema <a href="https://www.sqlite.org/compile.html#max_schema_retry">may, or may not</a> invalidate a statement.</p>
</blockquote>

<p>Instead, use the <code>cachedStatement</code> method. GRDB does all the hard caching and <a href="#memory-management">memory management</a> stuff for you:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">statement</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">cachedStatement</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="n">sql</span><span class="p">)</span>
</code></pre>

<p>Cached statements also support <a href="Documentation/SQLInterpolation.md">SQL Interpolation</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">statement</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">cachedStatement</span><span class="p">(</span><span class="nv">literal</span><span class="p">:</span> <span class="s">"INSERT ..."</span><span class="p">)</span>
<span class="c1">//                                     ~~~~~~~</span>
</code></pre>

<blockquote>
<p>:warning: <strong>Warning</strong>: Should a cached prepared statement throw an error, don&rsquo;t reuse it (it is a programmer error). Instead, reload one from the cache.</p>
</blockquote>
<h2 id='custom-sql-functions-and-aggregates' class='heading'>Custom SQL Functions and Aggregates</h2>

<p><strong>SQLite lets you define SQL functions and aggregates.</strong></p>

<p>A custom SQL function or aggregate extends SQLite:</p>
<pre class="highlight sql"><code><span class="k">SELECT</span> <span class="n">reverse</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">player</span><span class="p">;</span>   <span class="c1">-- custom function</span>
<span class="k">SELECT</span> <span class="n">maxLength</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">player</span><span class="p">;</span> <span class="c1">-- custom aggregate</span>
</code></pre>

<ul>
<li><a href="#custom-sql-functions">Custom SQL Functions</a></li>
<li><a href="#custom-aggregates">Custom Aggregates</a></li>
</ul>
<h3 id='custom-sql-functions' class='heading'>Custom SQL Functions</h3>

<p>A <em>function</em> argument takes an array of <a href="#databasevalue">DatabaseValue</a>, and returns any valid <a href="#values">value</a> (Bool, Int, String, Date, Swift enums, etc.) The number of database values is guaranteed to be <em>argumentCount</em>.</p>

<p>SQLite has the opportunity to perform additional optimizations when functions are &ldquo;pure&rdquo;, which means that their result only depends on their arguments. So make sure to set the <em>pure</em> argument to true when possible.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">reverse</span> <span class="o">=</span> <span class="kt">DatabaseFunction</span><span class="p">(</span><span class="s">"reverse"</span><span class="p">,</span> <span class="nv">argumentCount</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">pure</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="nv">values</span><span class="p">:</span> <span class="p">[</span><span class="kt">DatabaseValue</span><span class="p">])</span> <span class="k">in</span>
    <span class="c1">// Extract string value, if any...</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="kt">String</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="c1">// ... and return reversed string:</span>
    <span class="k">return</span> <span class="kt">String</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="nf">reversed</span><span class="p">())</span>
<span class="p">}</span>
</code></pre>

<p>You make a function available to a database connection through its configuration:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="n">db</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">function</span><span class="p">:</span> <span class="n">reverse</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>

<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// "oof"</span>
    <span class="k">try</span> <span class="kt">String</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT reverse('foo')"</span><span class="p">)</span><span class="o">!</span>
<span class="p">}</span>
</code></pre>

<p><strong>Functions can take a variable number of arguments:</strong></p>

<p>When you don&rsquo;t provide any explicit <em>argumentCount</em>, the function can take any number of arguments:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">averageOf</span> <span class="o">=</span> <span class="kt">DatabaseFunction</span><span class="p">(</span><span class="s">"averageOf"</span><span class="p">,</span> <span class="nv">pure</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="nv">values</span><span class="p">:</span> <span class="p">[</span><span class="kt">DatabaseValue</span><span class="p">])</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">doubles</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">compactMap</span> <span class="p">{</span> <span class="kt">Double</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">doubles</span><span class="o">.</span><span class="nf">reduce</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">+</span><span class="p">)</span> <span class="o">/</span> <span class="kt">Double</span><span class="p">(</span><span class="n">doubles</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">db</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">function</span><span class="p">:</span> <span class="n">averageOf</span><span class="p">)</span>

<span class="c1">// 2.0</span>
<span class="k">try</span> <span class="kt">Double</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT averageOf(1, 2, 3)"</span><span class="p">)</span><span class="o">!</span>
</code></pre>

<p><strong>Functions can throw:</strong></p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">sqrt</span> <span class="o">=</span> <span class="kt">DatabaseFunction</span><span class="p">(</span><span class="s">"sqrt"</span><span class="p">,</span> <span class="nv">argumentCount</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">pure</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="nv">values</span><span class="p">:</span> <span class="p">[</span><span class="kt">DatabaseValue</span><span class="p">])</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">double</span> <span class="o">=</span> <span class="kt">Double</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="k">guard</span> <span class="n">double</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">DatabaseError</span><span class="p">(</span><span class="nv">message</span><span class="p">:</span> <span class="s">"invalid negative number"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">db</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">function</span><span class="p">:</span> <span class="n">sqrt</span><span class="p">)</span>

<span class="c1">// SQLite error 1 with statement `SELECT sqrt(-1)`: invalid negative number</span>
<span class="k">try</span> <span class="kt">Double</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT sqrt(-1)"</span><span class="p">)</span><span class="o">!</span>
</code></pre>

<p><strong>Use custom functions in the <a href="#the-query-interface">query interface</a>:</strong></p>
<pre class="highlight swift"><code><span class="c1">// SELECT reverseString("name") FROM player</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">reverseString</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">))</span>
</code></pre>

<p><strong>GRDB ships with built-in SQL functions that perform unicode-aware string transformations.</strong> See <a href="#unicode">Unicode</a>.</p>
<h3 id='custom-aggregates' class='heading'>Custom Aggregates</h3>

<p>Before registering a custom aggregate, you need to define a type that adopts the <code><a href="Protocols/DatabaseAggregate.html">DatabaseAggregate</a></code> protocol:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">DatabaseAggregate</span> <span class="p">{</span>
    <span class="c1">// Initializes an aggregate</span>
    <span class="nf">init</span><span class="p">()</span>

    <span class="c1">// Called at each step of the aggregation</span>
    <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">step</span><span class="p">(</span><span class="n">_</span> <span class="nv">dbValues</span><span class="p">:</span> <span class="p">[</span><span class="kt">DatabaseValue</span><span class="p">])</span> <span class="k">throws</span>

    <span class="c1">// Returns the final result</span>
    <span class="kd">func</span> <span class="nf">finalize</span><span class="p">()</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">DatabaseValueConvertible</span><span class="p">?</span>
<span class="p">}</span>
</code></pre>

<p>For example:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">MaxLength</span> <span class="p">:</span> <span class="kt">DatabaseAggregate</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">maxLength</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">step</span><span class="p">(</span><span class="n">_</span> <span class="nv">dbValues</span><span class="p">:</span> <span class="p">[</span><span class="kt">DatabaseValue</span><span class="p">])</span> <span class="p">{</span>
        <span class="c1">// At each step, extract string value, if any...</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="kt">String</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">dbValues</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="c1">// ... and update the result</span>
        <span class="k">let</span> <span class="nv">length</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">count</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="n">maxLength</span> <span class="p">{</span>
            <span class="n">maxLength</span> <span class="o">=</span> <span class="n">length</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">finalize</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">DatabaseValueConvertible</span><span class="p">?</span> <span class="p">{</span>
        <span class="n">maxLength</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">maxLength</span> <span class="o">=</span> <span class="kt">DatabaseFunction</span><span class="p">(</span>
    <span class="s">"maxLength"</span><span class="p">,</span>
    <span class="nv">argumentCount</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nv">pure</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nv">aggregate</span><span class="p">:</span> <span class="kt">MaxLength</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
</code></pre>

<p>Like <a href="#custom-sql-functions">custom SQL Functions</a>, you make an aggregate function available to a database connection through its configuration:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="n">db</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">function</span><span class="p">:</span> <span class="n">maxLength</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>

<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// Some Int</span>
    <span class="k">try</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT maxLength(name) FROM player"</span><span class="p">)</span><span class="o">!</span>
<span class="p">}</span>
</code></pre>

<p>The <code>step</code> method of the aggregate takes an array of <a href="#databasevalue">DatabaseValue</a>. This array contains as many values as the <em>argumentCount</em> parameter (or any number of values, when <em>argumentCount</em> is omitted).</p>

<p>The <code>finalize</code> method of the aggregate returns the final aggregated <a href="#values">value</a> (Bool, Int, String, Date, Swift enums, etc.).</p>

<p>SQLite has the opportunity to perform additional optimizations when aggregates are &ldquo;pure&rdquo;, which means that their result only depends on their inputs. So make sure to set the <em>pure</em> argument to true when possible.</p>

<p><strong>Use custom aggregates in the <a href="#the-query-interface">query interface</a>:</strong></p>
<pre class="highlight swift"><code><span class="c1">// SELECT maxLength("name") FROM player</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">maxLength</span><span class="o">.</span><span class="nf">apply</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">))</span>
<span class="k">try</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span> <span class="c1">// Int?</span>
</code></pre>
<h2 id='database-schema-introspection' class='heading'>Database Schema Introspection</h2>

<p>GRDB comes with a set of schema introspection methods:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// Bool, true if the table exists</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">tableExists</span><span class="p">(</span><span class="s">"player"</span><span class="p">)</span>

    <span class="c1">// [ColumnInfo], the columns in the table</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">columns</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="s">"player"</span><span class="p">)</span>

    <span class="c1">// PrimaryKeyInfo</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">primaryKey</span><span class="p">(</span><span class="s">"player"</span><span class="p">)</span>

    <span class="c1">// [ForeignKeyInfo], the foreign keys defined on the table</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">foreignKeys</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="s">"player"</span><span class="p">)</span>

    <span class="c1">// [IndexInfo], the indexes defined on the table</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">indexes</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="s">"player"</span><span class="p">)</span>

    <span class="c1">// Bool, true if column(s) is a unique key (primary key or unique index)</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">table</span><span class="p">(</span><span class="s">"player"</span><span class="p">,</span> <span class="nv">hasUniqueKey</span><span class="p">:</span> <span class="p">[</span><span class="s">"email"</span><span class="p">])</span>
<span class="p">}</span>

<span class="c1">// Bool, true if argument is the name of an internal SQLite table</span>
<span class="kt">Database</span><span class="o">.</span><span class="nf">isSQLiteInternalTable</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1">// Bool, true if argument is the name of an internal GRDB table</span>
<span class="kt">Database</span><span class="o">.</span><span class="nf">isGRDBInternalTable</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre>
<h2 id='row-adapters' class='heading'>Row Adapters</h2>

<p><strong>Row adapters let you present database rows in the way expected by the row consumers.</strong></p>

<p>They basically help two incompatible row interfaces to work together. For example, a row consumer expects a column named &ldquo;consumed&rdquo;, but the produced row has a column named &ldquo;produced&rdquo;.</p>

<p>In this case, the <code><a href="Structs/ColumnMapping.html">ColumnMapping</a></code> row adapter comes in handy:</p>
<pre class="highlight swift"><code><span class="c1">// Turn the 'produced' column into 'consumed':</span>
<span class="k">let</span> <span class="nv">adapter</span> <span class="o">=</span> <span class="kt">ColumnMapping</span><span class="p">([</span><span class="s">"consumed"</span><span class="p">:</span> <span class="s">"produced"</span><span class="p">])</span>
<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 'Hello' AS produced"</span><span class="p">,</span> <span class="nv">adapter</span><span class="p">:</span> <span class="n">adapter</span><span class="p">)</span><span class="o">!</span>

<span class="c1">// [consumed:"Hello"]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

<span class="c1">// "Hello"</span>
<span class="nf">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">"consumed"</span><span class="p">])</span>

<span class="c1">// ▿ [consumed:"Hello"]</span>
<span class="c1">//   unadapted: [produced:"Hello"]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">debugDescription</span><span class="p">)</span>

<span class="c1">// [produced:"Hello"]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">unadapted</span><span class="p">)</span>
</code></pre>

<p><a href="#records">Record types</a> are typical row consumers that expect database rows to have a specific layout so that they can decode them:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">MyRecord</span><span class="p">:</span> <span class="kt">Decodable</span><span class="p">,</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">consumed</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">record</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">MyRecord</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 'Hello' AS produced"</span><span class="p">,</span> <span class="nv">adapter</span><span class="p">:</span> <span class="n">adapter</span><span class="p">)</span><span class="o">!</span>
<span class="nf">print</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">consumed</span><span class="p">)</span> <span class="c1">// "Hello"</span>
</code></pre>

<p>There are several situations where row adapters are useful:</p>

<ul>
<li><p>They help disambiguate columns with identical names, which may happen when you select columns from several tables. See <a href="#joined-queries-support">Joined Queries Support</a> for an example.</p></li>
<li><p>They help when SQLite outputs unexpected column names, which may happen with some subqueries. See <a href="#renamecolumnadapter">RenameColumnAdapter</a> for an example.</p></li>
</ul>

<p>Available row adapters are described below.</p>

<ul>
<li><a href="#columnmapping">ColumnMapping</a></li>
<li><a href="#emptyrowadapter">EmptyRowAdapter</a></li>
<li><a href="#rangerowadapter">RangeRowAdapter</a></li>
<li><a href="#renamecolumnadapter">RenameColumnAdapter</a></li>
<li><a href="#scopeadapter">ScopeAdapter</a></li>
<li><a href="#suffixrowadapter">SuffixRowAdapter</a></li>
</ul>
<h3 id='columnmapping' class='heading'>ColumnMapping</h3>

<p><code><a href="Structs/ColumnMapping.html">ColumnMapping</a></code> renames columns. Build one with a dictionary whose keys are adapted column names, and values the column names in the raw row:</p>
<pre class="highlight swift"><code><span class="c1">// [newA:0, newB:1]</span>
<span class="k">let</span> <span class="nv">adapter</span> <span class="o">=</span> <span class="kt">ColumnMapping</span><span class="p">([</span><span class="s">"newA"</span><span class="p">:</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"newB"</span><span class="p">:</span> <span class="s">"b"</span><span class="p">])</span>
<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 0 AS a, 1 AS b, 2 AS c"</span><span class="p">,</span> <span class="nv">adapter</span><span class="p">:</span> <span class="n">adapter</span><span class="p">)</span><span class="o">!</span>
</code></pre>

<p>Note that columns that are not present in the dictionary are not present in the resulting adapted row.</p>
<h3 id='emptyrowadapter' class='heading'>EmptyRowAdapter</h3>

<p><code><a href="Structs/EmptyRowAdapter.html">EmptyRowAdapter</a></code> hides all columns.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">adapter</span> <span class="o">=</span> <span class="kt">EmptyRowAdapter</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 0 AS a, 1 AS b, 2 AS c"</span><span class="p">,</span> <span class="nv">adapter</span><span class="p">:</span> <span class="n">adapter</span><span class="p">)</span><span class="o">!</span>
<span class="n">row</span><span class="o">.</span><span class="n">isEmpty</span> <span class="c1">// true</span>
</code></pre>

<p>This limit adapter may turn out useful in some narrow use cases. You&rsquo;ll be happy to find it when you need it.</p>
<h3 id='rangerowadapter' class='heading'>RangeRowAdapter</h3>

<p><code><a href="Structs/RangeRowAdapter.html">RangeRowAdapter</a></code> only exposes a range of columns.</p>
<pre class="highlight swift"><code><span class="c1">// [b:1]</span>
<span class="k">let</span> <span class="nv">adapter</span> <span class="o">=</span> <span class="kt">RangeRowAdapter</span><span class="p">(</span><span class="mi">1</span><span class="o">..&lt;</span><span class="mi">2</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 0 AS a, 1 AS b, 2 AS c"</span><span class="p">,</span> <span class="nv">adapter</span><span class="p">:</span> <span class="n">adapter</span><span class="p">)</span><span class="o">!</span>
</code></pre>
<h3 id='renamecolumnadapter' class='heading'>RenameColumnAdapter</h3>

<p><code><a href="Structs/RenameColumnAdapter.html">RenameColumnAdapter</a></code> lets you transform column names with a function:</p>
<pre class="highlight swift"><code><span class="c1">// [arrr:0, brrr:1, crrr:2]</span>
<span class="k">let</span> <span class="nv">adapter</span> <span class="o">=</span> <span class="kt">RenameColumnAdapter</span> <span class="p">{</span> <span class="n">column</span> <span class="k">in</span> <span class="n">column</span> <span class="o">+</span> <span class="s">"rrr"</span> <span class="p">}</span>
<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 0 AS a, 1 AS b, 2 AS c"</span><span class="p">,</span> <span class="nv">adapter</span><span class="p">:</span> <span class="n">adapter</span><span class="p">)</span><span class="o">!</span>
</code></pre>

<p>This adapter may turn out useful, for example, when subqueries contain duplicated column names:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">sql</span> <span class="o">=</span> <span class="s">"SELECT * FROM (SELECT 1 AS id, 2 AS id)"</span>

<span class="c1">// Prints ["id", "id:1"]</span>
<span class="c1">// Note the "id:1" column, generated by SQLite.</span>
<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="n">sql</span><span class="p">)</span><span class="o">!</span>
<span class="nf">print</span><span class="p">(</span><span class="kt">Array</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">columnNames</span><span class="p">))</span>

<span class="c1">// Drop the `:...` suffix, and prints ["id", "id"]</span>
<span class="k">let</span> <span class="nv">adapter</span> <span class="o">=</span> <span class="kt">RenameColumnAdapter</span> <span class="p">{</span> <span class="kt">String</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="nf">prefix</span><span class="p">(</span><span class="nv">while</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">!=</span> <span class="s">":"</span> <span class="p">}))</span> <span class="p">}</span>
<span class="k">let</span> <span class="nv">adaptedRow</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="n">sql</span><span class="p">,</span> <span class="nv">adapter</span><span class="p">:</span> <span class="n">adapter</span><span class="p">)</span><span class="o">!</span>
<span class="nf">print</span><span class="p">(</span><span class="kt">Array</span><span class="p">(</span><span class="n">adaptedRow</span><span class="o">.</span><span class="n">columnNames</span><span class="p">))</span>
</code></pre>
<h3 id='scopeadapter' class='heading'>ScopeAdapter</h3>

<p><code><a href="Structs/ScopeAdapter.html">ScopeAdapter</a></code> defines <em>row scopes</em>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">adapter</span> <span class="o">=</span> <span class="kt">ScopeAdapter</span><span class="p">([</span>
    <span class="s">"left"</span><span class="p">:</span> <span class="kt">RangeRowAdapter</span><span class="p">(</span><span class="mi">0</span><span class="o">..&lt;</span><span class="mi">2</span><span class="p">),</span>
    <span class="s">"right"</span><span class="p">:</span> <span class="kt">RangeRowAdapter</span><span class="p">(</span><span class="mi">2</span><span class="o">..&lt;</span><span class="mi">4</span><span class="p">)])</span>
<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 0 AS a, 1 AS b, 2 AS c, 3 AS d"</span><span class="p">,</span> <span class="nv">adapter</span><span class="p">:</span> <span class="n">adapter</span><span class="p">)</span><span class="o">!</span>
</code></pre>

<p>ScopeAdapter does not change the columns and values of the fetched row. Instead, it defines <em>scopes</em>, which you access through the <code><a href="Classes/Row.html#/s:4GRDB3RowC6scopesAC10ScopesViewVvp">Row.scopes</a></code> property:</p>
<pre class="highlight swift"><code><span class="n">row</span>                   <span class="c1">// [a:0 b:1 c:2 d:3]</span>
<span class="n">row</span><span class="o">.</span><span class="n">scopes</span><span class="p">[</span><span class="s">"left"</span><span class="p">]</span>    <span class="c1">// [a:0 b:1]</span>
<span class="n">row</span><span class="o">.</span><span class="n">scopes</span><span class="p">[</span><span class="s">"right"</span><span class="p">]</span>   <span class="c1">// [c:2 d:3]</span>
<span class="n">row</span><span class="o">.</span><span class="n">scopes</span><span class="p">[</span><span class="s">"missing"</span><span class="p">]</span> <span class="c1">// nil</span>
</code></pre>

<p>Scopes can be nested:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">adapter</span> <span class="o">=</span> <span class="kt">ScopeAdapter</span><span class="p">([</span>
    <span class="s">"left"</span><span class="p">:</span> <span class="kt">ScopeAdapter</span><span class="p">([</span>
        <span class="s">"left"</span><span class="p">:</span> <span class="kt">RangeRowAdapter</span><span class="p">(</span><span class="mi">0</span><span class="o">..&lt;</span><span class="mi">1</span><span class="p">),</span>
        <span class="s">"right"</span><span class="p">:</span> <span class="kt">RangeRowAdapter</span><span class="p">(</span><span class="mi">1</span><span class="o">..&lt;</span><span class="mi">2</span><span class="p">)]),</span>
    <span class="s">"right"</span><span class="p">:</span> <span class="kt">ScopeAdapter</span><span class="p">([</span>
        <span class="s">"left"</span><span class="p">:</span> <span class="kt">RangeRowAdapter</span><span class="p">(</span><span class="mi">2</span><span class="o">..&lt;</span><span class="mi">3</span><span class="p">),</span>
        <span class="s">"right"</span><span class="p">:</span> <span class="kt">RangeRowAdapter</span><span class="p">(</span><span class="mi">3</span><span class="o">..&lt;</span><span class="mi">4</span><span class="p">)])</span>
    <span class="p">])</span>
<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 0 AS a, 1 AS b, 2 AS c, 3 AS d"</span><span class="p">,</span> <span class="nv">adapter</span><span class="p">:</span> <span class="n">adapter</span><span class="p">)</span><span class="o">!</span>

<span class="k">let</span> <span class="nv">leftRow</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">scopes</span><span class="p">[</span><span class="s">"left"</span><span class="p">]</span><span class="o">!</span>
<span class="n">leftRow</span><span class="o">.</span><span class="n">scopes</span><span class="p">[</span><span class="s">"left"</span><span class="p">]</span>  <span class="c1">// [a:0]</span>
<span class="n">leftRow</span><span class="o">.</span><span class="n">scopes</span><span class="p">[</span><span class="s">"right"</span><span class="p">]</span> <span class="c1">// [b:1]</span>

<span class="k">let</span> <span class="nv">rightRow</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">scopes</span><span class="p">[</span><span class="s">"right"</span><span class="p">]</span><span class="o">!</span>
<span class="n">rightRow</span><span class="o">.</span><span class="n">scopes</span><span class="p">[</span><span class="s">"left"</span><span class="p">]</span>  <span class="c1">// [c:2]</span>
<span class="n">rightRow</span><span class="o">.</span><span class="n">scopes</span><span class="p">[</span><span class="s">"right"</span><span class="p">]</span> <span class="c1">// [d:3]</span>
</code></pre>

<p>Any adapter can be extended with scopes:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">baseAdapter</span> <span class="o">=</span> <span class="kt">RangeRowAdapter</span><span class="p">(</span><span class="mi">0</span><span class="o">..&lt;</span><span class="mi">2</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">adapter</span> <span class="o">=</span> <span class="kt">ScopeAdapter</span><span class="p">(</span><span class="nv">base</span><span class="p">:</span> <span class="n">baseAdapter</span><span class="p">,</span> <span class="nv">scopes</span><span class="p">:</span> <span class="p">[</span>
    <span class="s">"remainder"</span><span class="p">:</span> <span class="kt">SuffixRowAdapter</span><span class="p">(</span><span class="nv">fromIndex</span><span class="p">:</span> <span class="mi">2</span><span class="p">)])</span>
<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 0 AS a, 1 AS b, 2 AS c, 3 AS d"</span><span class="p">,</span> <span class="nv">adapter</span><span class="p">:</span> <span class="n">adapter</span><span class="p">)</span><span class="o">!</span>

<span class="n">row</span> <span class="c1">// [a:0 b:1]</span>
<span class="n">row</span><span class="o">.</span><span class="n">scopes</span><span class="p">[</span><span class="s">"remainder"</span><span class="p">]</span> <span class="c1">// [c:2 d:3]</span>
</code></pre>

<p>To see how <code><a href="Structs/ScopeAdapter.html">ScopeAdapter</a></code> can be used, see <a href="#joined-queries-support">Joined Queries Support</a>.</p>
<h3 id='suffixrowadapter' class='heading'>SuffixRowAdapter</h3>

<p><code><a href="Structs/SuffixRowAdapter.html">SuffixRowAdapter</a></code> hides the first columns in a row:</p>
<pre class="highlight swift"><code><span class="c1">// [b:1 c:2]</span>
<span class="k">let</span> <span class="nv">adapter</span> <span class="o">=</span> <span class="kt">SuffixRowAdapter</span><span class="p">(</span><span class="nv">fromIndex</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT 0 AS a, 1 AS b, 2 AS c"</span><span class="p">,</span> <span class="nv">adapter</span><span class="p">:</span> <span class="n">adapter</span><span class="p">)</span><span class="o">!</span>
</code></pre>
<h2 id='raw-sqlite-pointers' class='heading'>Raw SQLite Pointers</h2>

<p><strong>If not all SQLite APIs are exposed in GRDB, you can still use the <a href="https://www.sqlite.org/c3ref/intro.html">SQLite C Interface</a> and call <a href="https://www.sqlite.org/c3ref/funclist.html">SQLite C functions</a>.</strong></p>

<p>Those functions are embedded right into the GRDB module, regardless of the underlying SQLite implementation (system SQLite, <a href="#encryption">SQLCipher</a>, or <a href="Documentation/CustomSQLiteBuilds.md">custom SQLite build</a>):</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">GRDB</span>

<span class="k">let</span> <span class="nv">sqliteVersion</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">cString</span><span class="p">:</span> <span class="nf">sqlite3_libversion</span><span class="p">())</span>
</code></pre>

<p>Raw pointers to database connections and statements are available through the <code><a href="Classes/Database.html#/s:4GRDB8DatabaseC16sqliteConnections13OpaquePointerVSgvp">Database.sqliteConnection</a></code> and <code><a href="Classes/Statement.html#/s:4GRDB9StatementC06sqliteB0s13OpaquePointerVvp">Statement.sqliteStatement</a></code> properties:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// The raw pointer to a database connection:</span>
    <span class="k">let</span> <span class="nv">sqliteConnection</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">sqliteConnection</span>

    <span class="c1">// The raw pointer to a statement:</span>
    <span class="k">let</span> <span class="nv">statement</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">makeStatement</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">sqliteStatement</span> <span class="o">=</span> <span class="n">statement</span><span class="o">.</span><span class="n">sqliteStatement</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Notes</strong></p>

<ul>
<li>Those pointers are owned by GRDB: don&rsquo;t close connections or finalize statements created by GRDB.</li>
<li>GRDB opens SQLite connections in the &ldquo;<a href="https://www.sqlite.org/threadsafe.html">multi-thread mode</a>&rdquo;, which (oddly) means that <strong>they are not thread-safe</strong>. Make sure you touch raw databases and statements inside their dedicated dispatch queues.</li>
<li>Use the raw SQLite C Interface at your own risk. GRDB won&rsquo;t prevent you from shooting yourself in the foot.</li>
</ul>
</blockquote>
<h1 id='records' class='heading'>Records</h1>

<p><strong>On top of the <a href="#sqlite-api">SQLite API</a>, GRDB provides protocols and a class</strong> that help manipulating database rows as regular objects named &ldquo;records&rdquo;:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">var</span> <span class="nv">place</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">place</span><span class="o">.</span><span class="n">isFavorite</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="k">try</span> <span class="n">place</span><span class="o">.</span><span class="nf">update</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Of course, you need to open a <a href="#database-connections">database connection</a>, and <a href="#database-schema">create database tables</a> first.</p>

<p>To define your custom records, you subclass the ready-made <code><a href="Classes/Record.html">Record</a></code> class, or you extend your structs and classes with protocols that come with focused sets of features: fetching methods, persistence methods, record comparison&hellip;</p>

<p>Extending structs with record protocols is more &ldquo;swifty&rdquo;. Subclassing the Record class is more &ldquo;classic&rdquo;. You can choose either way. See some <a href="#examples-of-record-definitions">examples of record definitions</a>, and the <a href="#list-of-record-methods">list of record methods</a> for an overview.</p>

<blockquote>
<p>:point_up: <strong>Note</strong>: if you are familiar with Core Data&rsquo;s NSManagedObject or Realm&rsquo;s Object, you may experience a cultural shock: GRDB records are not uniqued, do not auto-update, and do not lazy-load. This is both a purpose, and a consequence of protocol-oriented programming. You should read <a href="https://medium.com/@gwendal.roue/how-to-build-an-ios-application-with-sqlite-and-grdb-swift-d023a06c29b3">How to build an iOS application with SQLite and GRDB.swift</a> for a general introduction.</p>

<p>:bulb: <strong>Tip</strong>: after you have read this chapter, check the <a href="Documentation/GoodPracticesForDesigningRecordTypes.md">Good Practices for Designing Record Types</a> Guide.</p>

<p>:bulb: <strong>Tip</strong>: see the <a href="Documentation/DemoApps">Demo Applications</a> for sample apps that uses records.</p>
</blockquote>

<p><strong>Overview</strong></p>

<ul>
<li><a href="#inserting-records">Inserting Records</a></li>
<li><a href="#fetching-records">Fetching Records</a></li>
<li><a href="#updating-records">Updating Records</a></li>
<li><a href="#deleting-records">Deleting Records</a></li>
<li><a href="#counting-records">Counting Records</a></li>
</ul>

<p><strong>Protocols and the Record Class</strong></p>

<ul>
<li><a href="#record-protocols-overview">Record Protocols Overview</a></li>
<li><a href="#fetchablerecord-protocol">FetchableRecord Protocol</a></li>
<li><a href="#tablerecord-protocol">TableRecord Protocol</a></li>
<li><a href="#persistablerecord-protocol">PersistableRecord Protocol</a>

<ul>
<li><a href="#persistence-methods">Persistence Methods</a></li>
<li><a href="#customizing-the-persistence-methods">Customizing the Persistence Methods</a></li>
</ul></li>
<li><a href="#identifiable-records">Identifiable Records</a></li>
<li><a href="#codable-records">Codable Records</a></li>
<li><a href="#record-class">Record Class</a></li>
<li><a href="#record-comparison">Record Comparison</a></li>
<li><a href="#record-customization-options">Record Customization Options</a></li>
</ul>

<p><strong>Records in a Glance</strong></p>

<ul>
<li><a href="#examples-of-record-definitions">Examples of Record Definitions</a></li>
<li><a href="#list-of-record-methods">List of Record Methods</a></li>
</ul>
<h3 id='inserting-records' class='heading'>Inserting Records</h3>

<p>To insert a record in the database, call the <code>insert</code> method:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="kt">Player</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Arthur"</span><span class="p">,</span> <span class="nv">email</span><span class="p">:</span> <span class="s">"arthur@example.com"</span><span class="p">)</span>
<span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre>

<p>:point_right: <code>insert</code> is available for subclasses of the <a href="#record-class">Record</a> class, and types that adopt the <a href="#persistablerecord-protocol">PersistableRecord</a> protocol.</p>
<h3 id='fetching-records' class='heading'>Fetching Records</h3>

<p>To fetch records from the database, call a <a href="#fetching-methods">fetching method</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">arthur</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span>            <span class="c1">// Player?</span>
    <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM players WHERE name = ?"</span><span class="p">,</span>
    <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"Arthur"</span><span class="p">])</span>

<span class="k">let</span> <span class="nv">bestPlayers</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span>                    <span class="c1">// [Player]</span>
    <span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">)</span><span class="o">.</span><span class="n">desc</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">spain</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Country</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="s">"ES"</span><span class="p">)</span>  <span class="c1">// Country?</span>
</code></pre>

<p>:point_right: Fetching from raw SQL is available for subclasses of the <a href="#record-class">Record</a> class, and types that adopt the <a href="#fetchablerecord-protocol">FetchableRecord</a> protocol.</p>

<p>:point_right: Fetching without SQL, using the <a href="#the-query-interface">query interface</a>, is available for subclasses of the <a href="#record-class">Record</a> class, and types that adopt both <a href="#fetchablerecord-protocol">FetchableRecord</a> and <a href="#tablerecord-protocol">TableRecord</a> protocol.</p>
<h3 id='updating-records' class='heading'>Updating Records</h3>

<p>To update a record in the database, call the <code>update</code> method:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">player</span><span class="p">:</span> <span class="kt">Player</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">player</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">update</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre>

<p>It is possible to <a href="#record-comparison">avoid useless updates</a>:</p>
<pre class="highlight swift"><code><span class="c1">// does not hit the database if score has not changed</span>
<span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">updateChanges</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$0</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="p">}</span>
</code></pre>

<p>See the <a href="#the-query-interface">query interface</a> for batch updates:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">Player</span>
    <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"team"</span><span class="p">)</span> <span class="o">==</span> <span class="s">"red"</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">updateAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">)</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span>
</code></pre>

<p>:point_right: update methods are available for subclasses of the <a href="#record-class">Record</a> class, and types that adopt the <a href="#persistablerecord-protocol">PersistableRecord</a> protocol. Batch updates are available on the <a href="#tablerecord-protocol">TableRecord</a> protocol.</p>
<h3 id='deleting-records' class='heading'>Deleting Records</h3>

<p>To delete a record in the database, call the <code>delete</code> method:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">player</span><span class="p">:</span> <span class="kt">Player</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">delete</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre>

<p>You can also delete by primary key, unique key, or perform batch deletes (see <a href="#delete-requests">Delete Requests</a>):</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">deleteOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">deleteOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="p">[</span><span class="s">"email"</span><span class="p">:</span> <span class="s">"arthur@example.com"</span><span class="p">])</span>
<span class="k">try</span> <span class="kt">Country</span><span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">ids</span><span class="p">:</span> <span class="p">[</span><span class="s">"FR"</span><span class="p">,</span> <span class="s">"US"</span><span class="p">])</span>
<span class="k">try</span> <span class="kt">Player</span>
    <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"email"</span><span class="p">)</span> <span class="o">==</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre>

<p>:point_right: delete methods are available for subclasses of the <a href="#record-class">Record</a> class, and types that adopt the <a href="#persistablerecord-protocol">PersistableRecord</a> protocol. Batch deletes are available on the <a href="#tablerecord-protocol">TableRecord</a> protocol.</p>
<h3 id='counting-records' class='heading'>Counting Records</h3>

<p>To count records, call the <code>fetchCount</code> method:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">playerCount</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">playerWithEmailCount</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span>
    <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"email"</span><span class="p">)</span> <span class="o">==</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre>

<p>:point_right: <code>fetchCount</code> is available for subclasses of the <a href="#record-class">Record</a> class, and types that adopt the <a href="#tablerecord-protocol">TableRecord</a> protocol.</p>

<p>Details follow:</p>

<ul>
<li><a href="#record-protocols-overview">Record Protocols Overview</a></li>
<li><a href="#fetchablerecord-protocol">FetchableRecord Protocol</a></li>
<li><a href="#tablerecord-protocol">TableRecord Protocol</a></li>
<li><a href="#persistablerecord-protocol">PersistableRecord Protocol</a></li>
<li><a href="#identifiable-records">Identifiable Records</a></li>
<li><a href="#codable-records">Codable Records</a></li>
<li><a href="#record-class">Record Class</a></li>
<li><a href="#record-comparison">Record Comparison</a></li>
<li><a href="#record-customization-options">Record Customization Options</a></li>
<li><a href="#examples-of-record-definitions">Examples of Record Definitions</a></li>
<li><a href="#list-of-record-methods">List of Record Methods</a></li>
</ul>
<h2 id='record-protocols-overview' class='heading'>Record Protocols Overview</h2>

<p><strong>GRDB ships with three record protocols</strong>. Your own types will adopt one or several of them, according to the abilities you want to extend your types with.</p>

<ul>
<li><p><a href="#fetchablerecord-protocol">FetchableRecord</a> is able to <strong>decode database rows</strong>.</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Place</span><span class="p">:</span> <span class="kt">FetchableRecord</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">let</span> <span class="nv">places</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM place"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>:bulb: <strong>Tip</strong>: <code><a href="Protocols/FetchableRecord.html">FetchableRecord</a></code> can derive its implementation from the standard <code>Decodable</code> protocol. See <a href="#codable-records">Codable Records</a> for more information.</p>
</blockquote>

<p><code><a href="Protocols/FetchableRecord.html">FetchableRecord</a></code> can decode database rows, but it is not able to build SQL requests for you. For that, you also need <code><a href="Protocols/TableRecord.html">TableRecord</a></code>:</p></li>
<li><p><a href="#tablerecord-protocol">TableRecord</a> is able to <strong>generate SQL queries</strong>:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Place</span><span class="p">:</span> <span class="kt">TableRecord</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">let</span> <span class="nv">placeCount</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// Generates and runs `SELECT COUNT(*) FROM place`</span>
    <span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>When a type adopts both <code><a href="Protocols/TableRecord.html">TableRecord</a></code> and <code><a href="Protocols/FetchableRecord.html">FetchableRecord</a></code>, it can load from those requests:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Place</span><span class="p">:</span> <span class="kt">TableRecord</span><span class="p">,</span> <span class="kt">FetchableRecord</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">places</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"title"</span><span class="p">))</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">paris</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></li>
<li><p><a href="#persistablerecord-protocol">PersistableRecord</a> is able to <strong>write</strong>: it can create, update, and delete rows in the database:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Place</span> <span class="p">:</span> <span class="kt">PersistableRecord</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">delete</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">try</span> <span class="kt">Place</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>A persistable record can also <a href="#record-comparison">compare</a> itself against other records, and avoid useless database updates.</p>

<blockquote>
<p>:bulb: <strong>Tip</strong>: <code><a href="Protocols/PersistableRecord.html">PersistableRecord</a></code> can derive its implementation from the standard <code>Encodable</code> protocol. See <a href="#codable-records">Codable Records</a> for more information.</p>
</blockquote></li>
</ul>
<h2 id='fetchablerecord-protocol' class='heading'>FetchableRecord Protocol</h2>

<p><strong>The FetchableRecord protocol grants fetching methods to any type</strong> that can be built from a database row:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="c1">/// Row initializer</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">row</span><span class="p">:</span> <span class="kt">Row</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p><strong>To use FetchableRecord</strong>, subclass the <a href="#record-class">Record</a> class, or adopt it explicitly. For example:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Place</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">coordinate</span><span class="p">:</span> <span class="kt">CLLocationCoordinate2D</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Place</span> <span class="p">:</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">row</span><span class="p">:</span> <span class="kt">Row</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"title"</span><span class="p">]</span>
        <span class="n">coordinate</span> <span class="o">=</span> <span class="kt">CLLocationCoordinate2D</span><span class="p">(</span>
            <span class="nv">latitude</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s">"latitude"</span><span class="p">],</span>
            <span class="nv">longitude</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s">"longitude"</span><span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Rows also accept column enums:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">Place</span> <span class="p">:</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">Columns</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">ColumnExpression</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span>
    <span class="p">}</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">row</span><span class="p">:</span> <span class="kt">Row</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">title</span><span class="p">]</span>
        <span class="n">coordinate</span> <span class="o">=</span> <span class="kt">CLLocationCoordinate2D</span><span class="p">(</span>
            <span class="nv">latitude</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">latitude</span><span class="p">],</span>
            <span class="nv">longitude</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">longitude</span><span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>See <a href="#column-values">column values</a> for more information about the <code>row[]</code> subscript.</p>

<p>When your record type adopts the standard Decodable protocol, you don&rsquo;t have to provide the implementation for <code>init(row:)</code>. See <a href="#codable-records">Codable Records</a> for more information:</p>
<pre class="highlight swift"><code><span class="c1">// That's all</span>
<span class="kd">struct</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">Decodable</span><span class="p">,</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int64</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">score</span><span class="p">:</span> <span class="kt">Int</span>
<span class="p">}</span>
</code></pre>

<p>FetchableRecord allows adopting types to be fetched from SQL queries:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span><span class="o">...</span><span class="p">)</span> <span class="c1">// A Cursor of Place</span>
<span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span><span class="o">...</span><span class="p">)</span>    <span class="c1">// [Place]</span>
<span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchSet</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span><span class="o">...</span><span class="p">)</span>    <span class="c1">// Set&lt;Place&gt;</span>
<span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span><span class="o">...</span><span class="p">)</span>    <span class="c1">// Place?</span>
</code></pre>

<p>See <a href="#fetching-methods">fetching methods</a> for information about the <code>fetchCursor</code>, <code>fetchAll</code>, <code>fetchSet</code> and <code>fetchOne</code> methods. See <a href="http://groue.github.io/GRDB.swift/docs/5.21/Structs/StatementArguments.html">StatementArguments</a> for more information about the query arguments.</p>

<blockquote>
<p>:point_up: <strong>Note</strong>: for performance reasons, the same row argument to <code>init(row:)</code> is reused during the iteration of a fetch query. If you want to keep the row for later use, make sure to store a copy: <code>self.row = row.copy()</code>.</p>

<p>:point_up: <strong>Note</strong>: The <code><a href="Protocols/FetchableRecord.html#/s:4GRDB15FetchableRecordP3rowxAA3RowC_tcfc">FetchableRecord.init(row:)</a></code> initializer fits the needs of most applications. But some application are more demanding than others. When FetchableRecord does not exactly provide the support you need, have a look at the <a href="#beyond-fetchablerecord">Beyond FetchableRecord</a> chapter.</p>
</blockquote>
<h2 id='tablerecord-protocol' class='heading'>TableRecord Protocol</h2>

<p><strong>The TableRecord protocol</strong> generates SQL for you. To use TableRecord, subclass the <a href="#record-class">Record</a> class, or adopt it explicitly:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">TableRecord</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">databaseTableName</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">databaseSelection</span><span class="p">:</span> <span class="p">[</span><span class="kt">SQLSelectable</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The <code>databaseSelection</code> type property is optional, and documented in the <a href="#columns-selected-by-a-request">Columns Selected by a Request</a> chapter.</p>

<p>The <code>databaseTableName</code> type property is the name of a database table. By default, it is derived from the type name:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Place</span><span class="p">:</span> <span class="kt">TableRecord</span> <span class="p">{</span> <span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="kt">Place</span><span class="o">.</span><span class="n">databaseTableName</span><span class="p">)</span> <span class="c1">// prints "place"</span>
</code></pre>

<p>For example:</p>

<ul>
<li>Place: <code>place</code></li>
<li>Country: <code>country</code></li>
<li>PostalAddress: <code>postalAddress</code></li>
<li>HTTPRequest: <code>httpRequest</code></li>
<li>TOEFL: <code>toefl</code></li>
</ul>

<p>You can still provide a custom table name:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Place</span><span class="p">:</span> <span class="kt">TableRecord</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">databaseTableName</span> <span class="o">=</span> <span class="s">"location"</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="kt">Place</span><span class="o">.</span><span class="n">databaseTableName</span><span class="p">)</span> <span class="c1">// prints "location"</span>
</code></pre>

<p>Subclasses of the <a href="#record-class">Record</a> class must always override their superclass&rsquo;s <code>databaseTableName</code> property:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">Place</span><span class="p">:</span> <span class="kt">Record</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">class</span> <span class="k">var</span> <span class="nv">databaseTableName</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span> <span class="s">"place"</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="kt">Place</span><span class="o">.</span><span class="n">databaseTableName</span><span class="p">)</span> <span class="c1">// prints "place"</span>
</code></pre>

<p>When a type adopts both TableRecord and <a href="#fetchablerecord-protocol">FetchableRecord</a>, it can be fetched using the <a href="#the-query-interface">query interface</a>:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM place WHERE name = 'Paris'</span>
<span class="k">let</span> <span class="nv">paris</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">nameColumn</span> <span class="o">==</span> <span class="s">"Paris"</span><span class="p">)</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre>

<p>TableRecord can also fetch deal with primary and unique keys: see <a href="#fetching-by-key">Fetching by Key</a> and <a href="#testing-for-record-existence">Testing for Record Existence</a>.</p>
<h2 id='persistablerecord-protocol' class='heading'>PersistableRecord Protocol</h2>

<p><strong>GRDB record types can create, update, and delete rows in the database.</strong></p>

<p>Those abilities are granted by three protocols:</p>
<pre class="highlight swift"><code><span class="c1">// Defines how a record encodes itself into the database</span>
<span class="kd">protocol</span> <span class="kt">EncodableRecord</span> <span class="p">{</span>
    <span class="c1">/// Defines the values persisted in the database</span>
    <span class="kd">func</span> <span class="nf">encode</span><span class="p">(</span><span class="n">to</span> <span class="nv">container</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">PersistenceContainer</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Adds persistence methods</span>
<span class="kd">protocol</span> <span class="kt">MutablePersistableRecord</span><span class="p">:</span> <span class="kt">TableRecord</span><span class="p">,</span> <span class="kt">EncodableRecord</span> <span class="p">{</span>
    <span class="c1">/// Optional method that lets your adopting type store its rowID upon</span>
    <span class="c1">/// successful insertion. Don't call it directly: it is called for you.</span>
    <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">didInsert</span><span class="p">(</span><span class="n">with</span> <span class="nv">rowID</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">,</span> <span class="k">for</span> <span class="nv">column</span><span class="p">:</span> <span class="kt">String</span><span class="p">?)</span>
<span class="p">}</span>

<span class="c1">// Adds immutability</span>
<span class="kd">protocol</span> <span class="kt">PersistableRecord</span><span class="p">:</span> <span class="kt">MutablePersistableRecord</span> <span class="p">{</span>
    <span class="c1">/// Non-mutating version of the optional didInsert(with:for:)</span>
    <span class="kd">func</span> <span class="nf">didInsert</span><span class="p">(</span><span class="n">with</span> <span class="nv">rowID</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">,</span> <span class="k">for</span> <span class="nv">column</span><span class="p">:</span> <span class="kt">String</span><span class="p">?)</span>
<span class="p">}</span>
</code></pre>

<p>Yes, three protocols instead of one. Here is how you pick one or the other:</p>

<ul>
<li><p><strong>If your type is a class</strong>, choose <code><a href="Protocols/PersistableRecord.html">PersistableRecord</a></code>. On top of that, implement <code>didInsert(with:for:)</code> if the database table has an auto-incremented primary key.</p></li>
<li><p><strong>If your type is a struct, and the database table has an auto-incremented primary key</strong>, choose <code><a href="Protocols/MutablePersistableRecord.html">MutablePersistableRecord</a></code>, and implement <code>didInsert(with:for:)</code>.</p></li>
<li><p><strong>Otherwise</strong>, choose <code><a href="Protocols/PersistableRecord.html">PersistableRecord</a></code>, and ignore <code>didInsert(with:for:)</code>.</p></li>
</ul>

<p>The <code>encode(to:)</code> method defines which <a href="#values">values</a> (Bool, Int, String, Date, Swift enums, etc.) are assigned to database columns.</p>

<p>The optional <code>didInsert</code> method lets the adopting type store its rowID after successful insertion, and is only useful for tables that have an auto-incremented primary key. It is called from a protected dispatch queue, and serialized with all database updates.</p>

<p><strong>To use the persistable protocols</strong>, subclass the <a href="#record-class">Record</a> class, or adopt one of them explicitly. For example:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">Place</span> <span class="p">:</span> <span class="kt">MutablePersistableRecord</span> <span class="p">{</span>
    <span class="c1">/// The values persisted in the database</span>
    <span class="kd">func</span> <span class="nf">encode</span><span class="p">(</span><span class="n">to</span> <span class="nv">container</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">PersistenceContainer</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">container</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">id</span>
        <span class="n">container</span><span class="p">[</span><span class="s">"title"</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>
        <span class="n">container</span><span class="p">[</span><span class="s">"latitude"</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordinate</span><span class="o">.</span><span class="n">latitude</span>
        <span class="n">container</span><span class="p">[</span><span class="s">"longitude"</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordinate</span><span class="o">.</span><span class="n">longitude</span>
    <span class="p">}</span>

    <span class="c1">// Update auto-incremented id upon successful insertion</span>
    <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">didInsert</span><span class="p">(</span><span class="n">with</span> <span class="nv">rowID</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">,</span> <span class="k">for</span> <span class="nv">column</span><span class="p">:</span> <span class="kt">String</span><span class="p">?)</span> <span class="p">{</span>
        <span class="n">id</span> <span class="o">=</span> <span class="n">rowID</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nv">paris</span> <span class="o">=</span> <span class="kt">Place</span><span class="p">(</span>
    <span class="nv">id</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>
    <span class="nv">title</span><span class="p">:</span> <span class="s">"Paris"</span><span class="p">,</span>
    <span class="nv">coordinate</span><span class="p">:</span> <span class="kt">CLLocationCoordinate2D</span><span class="p">(</span><span class="nv">latitude</span><span class="p">:</span> <span class="mf">48.8534100</span><span class="p">,</span> <span class="nv">longitude</span><span class="p">:</span> <span class="mf">2.3488000</span><span class="p">))</span>

<span class="k">try</span> <span class="n">paris</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">paris</span><span class="o">.</span><span class="n">id</span>   <span class="c1">// some value</span>
</code></pre>

<p>Persistence containers also accept column enums:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">Place</span> <span class="p">:</span> <span class="kt">MutablePersistableRecord</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">Columns</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">ColumnExpression</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">encode</span><span class="p">(</span><span class="n">to</span> <span class="nv">container</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">PersistenceContainer</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">container</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">id</span>
        <span class="n">container</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">title</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>
        <span class="n">container</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">latitude</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordinate</span><span class="o">.</span><span class="n">latitude</span>
        <span class="n">container</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">longitude</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordinate</span><span class="o">.</span><span class="n">longitude</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>When your record type adopts the standard Encodable protocol, you don&rsquo;t have to provide the implementation for <code>encode(to:)</code>. See <a href="#codable-records">Codable Records</a> for more information:</p>
<pre class="highlight swift"><code><span class="c1">// That's all</span>
<span class="kd">struct</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">Encodable</span><span class="p">,</span> <span class="kt">MutablePersistableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">score</span><span class="p">:</span> <span class="kt">Int</span>

    <span class="c1">// Update auto-incremented id upon successful insertion</span>
    <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">didInsert</span><span class="p">(</span><span class="n">with</span> <span class="nv">rowID</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">,</span> <span class="k">for</span> <span class="nv">column</span><span class="p">:</span> <span class="kt">String</span><span class="p">?)</span> <span class="p">{</span>
        <span class="n">id</span> <span class="o">=</span> <span class="n">rowID</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='persistence-methods' class='heading'>Persistence Methods</h3>

<p><a href="#record-class">Record</a> subclasses and types that adopt <a href="#persistablerecord-protocol">PersistableRecord</a> are given default implementations for methods that insert, update, and delete:</p>
<pre class="highlight swift"><code><span class="c1">// INSERT</span>
<span class="k">try</span> <span class="n">place</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">insertedPlace</span> <span class="o">=</span> <span class="k">try</span> <span class="n">place</span><span class="o">.</span><span class="nf">inserted</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// non-mutating</span>

<span class="c1">// UPDATE</span>
<span class="k">try</span> <span class="n">place</span><span class="o">.</span><span class="nf">update</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="k">try</span> <span class="n">place</span><span class="o">.</span><span class="nf">update</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">columns</span><span class="p">:</span> <span class="p">[</span><span class="s">"title"</span><span class="p">])</span>

<span class="c1">// Maybe UPDATE</span>
<span class="k">try</span> <span class="n">place</span><span class="o">.</span><span class="nf">updateChanges</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">otherPlace</span><span class="p">)</span>
<span class="k">try</span> <span class="n">place</span><span class="o">.</span><span class="nf">updateChanges</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">isFavorite</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">}</span>
<span class="k">try</span> <span class="n">place</span><span class="o">.</span><span class="nf">updateChanges</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// Record class only</span>

<span class="c1">// INSERT or UPDATE</span>
<span class="k">try</span> <span class="n">place</span><span class="o">.</span><span class="nf">save</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">savedPlace</span> <span class="o">=</span> <span class="n">place</span><span class="o">.</span><span class="nf">saved</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// non-mutating</span>

<span class="c1">// DELETE</span>
<span class="k">try</span> <span class="n">place</span><span class="o">.</span><span class="nf">delete</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

<span class="c1">// EXISTENCE CHECK</span>
<span class="k">let</span> <span class="nv">exists</span> <span class="o">=</span> <span class="k">try</span> <span class="n">place</span><span class="o">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre>

<p>The <a href="#tablerecord-protocol">TableRecord</a> protocol comes with batch operations:</p>
<pre class="highlight swift"><code><span class="c1">// UPDATE</span>
<span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">updateAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

<span class="c1">// DELETE</span>
<span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">ids</span><span class="p">:</span><span class="o">...</span><span class="p">)</span>
<span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">keys</span><span class="p">:</span><span class="o">...</span><span class="p">)</span>
<span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">deleteOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span><span class="o">...</span><span class="p">)</span>
<span class="k">try</span> <span class="kt">Place</span><span class="o">.</span><span class="nf">deleteOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span><span class="o">...</span><span class="p">)</span>
</code></pre>

<ul>
<li><p>All those methods can throw a <a href="#error-handling">DatabaseError</a>.</p></li>
<li><p><code>update</code> and <code>updateChanges</code> throw <a href="#persistenceerror">PersistenceError</a> if the database does not contain any row for the primary key of the record.</p></li>
<li><p><code>save</code> makes sure your values are stored in the database. It performs an UPDATE if the record has a non-null primary key, and then, if no row was modified, an INSERT. It directly performs an INSERT if the record has no primary key, or a null primary key.</p></li>
<li><p><code>delete</code> and <code>deleteOne</code> returns whether a database row was deleted or not. <code>deleteAll</code> returns the number of deleted rows. <code>updateAll</code> returns the number of updated rows. <code>updateChanges</code> returns whether a database row was updated or not.</p></li>
</ul>

<p><strong>All primary keys are supported</strong>, including composite primary keys that span several columns, and the <a href="#the-implicit-rowid-primary-key">implicit rowid primary key</a>.</p>
<h3 id='customizing-the-persistence-methods' class='heading'>Customizing the Persistence Methods</h3>

<p>Your custom type may want to perform extra work when the persistence methods are invoked.</p>

<p>For example, it may want to have its UUID automatically set before inserting. Or it may want to validate its values before saving.</p>

<p>When you subclass <a href="#record-class">Record</a>, you simply have to override the customized method, and call <code>super</code>:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">Player</span> <span class="p">:</span> <span class="kt">Record</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">uuid</span><span class="p">:</span> <span class="kt">UUID</span><span class="p">?</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">insert</span><span class="p">(</span><span class="n">_</span> <span class="nv">db</span><span class="p">:</span> <span class="kt">Database</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">uuid</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="n">uuid</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">try</span> <span class="k">super</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>If you use the raw <a href="#persistablerecord-protocol">PersistableRecord</a> protocol, use one of the <em>special methods</em> <code>performInsert</code>, <code>performUpdate</code>, <code>performSave</code>, <code>performDelete</code>, or <code>performExists</code>:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Link</span> <span class="p">:</span> <span class="kt">PersistableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span>

    <span class="kd">func</span> <span class="nf">insert</span><span class="p">(</span><span class="n">_</span> <span class="nv">db</span><span class="p">:</span> <span class="kt">Database</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">try</span> <span class="nf">validate</span><span class="p">()</span>
        <span class="k">try</span> <span class="nf">performInsert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">update</span><span class="p">(</span><span class="n">_</span> <span class="nv">db</span><span class="p">:</span> <span class="kt">Database</span><span class="p">,</span> <span class="nv">columns</span><span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">try</span> <span class="nf">validate</span><span class="p">()</span>
        <span class="k">try</span> <span class="nf">performUpdate</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">columns</span><span class="p">:</span> <span class="n">columns</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">validate</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">host</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="kt">ValidationError</span><span class="p">(</span><span class="s">"url must be absolute."</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: the special methods <code>performInsert</code>, <code>performUpdate</code>, etc. are reserved for your custom implementations. Do not use them elsewhere. Do not provide another implementation for those methods.</p>

<p>:point_up: <strong>Note</strong>: it is recommended that you do not implement your own version of the <code>save</code> method. Its default implementation forwards the job to <code>update</code> or <code>insert</code>: these are the methods that may need customization, not <code>save</code>.</p>
</blockquote>
<h2 id='identifiable-records' class='heading'>Identifiable Records</h2>

<p><strong>When a record type maps a table with a single-column primary key, it is recommended to have it adopt the standard <a href="https://developer.apple.com/documentation/swift/identifiable">Identifiable</a> protocol.</strong></p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">Identifiable</span><span class="p">,</span> <span class="kt">FetchableRecord</span><span class="p">,</span> <span class="kt">PersistableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int64</span> <span class="c1">// fulfills the Identifiable requirement</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">score</span><span class="p">:</span> <span class="kt">Int</span>
<span class="p">}</span>
</code></pre>

<p>When <code>id</code> has a <a href="#values">database-compatible type</a> (Int64, Int, String, UUID, &hellip;), the <code>Identifiable</code> conformance unlocks type-safe record and request methods:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">ids</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchSet</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">ids</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">ids</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="k">let</span> <span class="nv">ids</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">selectID</span><span class="p">()</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">ids</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="nf">selectID</span><span class="p">()</span><span class="o">.</span><span class="nf">fetchSet</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">deleteOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">ids</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: <code>Identifiable</code> is not available on all application targets, and not all tables have a single-column primary key. GRDB provides other methods that deal with primary and unique keys, but they won&rsquo;t check the type of their arguments:</p>
<pre class="highlight swift"><code><span class="c1">// Those methods are not type-checked</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="p">[</span><span class="s">"email"</span><span class="p">:</span> <span class="s">"arthur@example.com"</span><span class="p">])</span>
<span class="k">try</span> <span class="kt">Country</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">keys</span><span class="p">:</span> <span class="p">[</span><span class="s">"FR"</span><span class="p">,</span> <span class="s">"US"</span><span class="p">])</span>
<span class="k">try</span> <span class="kt">Citizenship</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="p">[</span><span class="s">"citizenId"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"countryCode"</span><span class="p">:</span> <span class="s">"FR"</span><span class="p">])</span>

<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">keys</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">deleteOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">keys</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</code></pre>
</blockquote>

<p>Some database tables have a single-column primary key which is not called &ldquo;id&rdquo;:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"country"</span><span class="p">)</span> <span class="p">{</span> <span class="n">t</span> <span class="k">in</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"isoCode"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="nf">notNull</span><span class="p">()</span><span class="o">.</span><span class="nf">primaryKey</span><span class="p">()</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="nf">notNull</span><span class="p">()</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"population"</span><span class="p">,</span> <span class="o">.</span><span class="n">integer</span><span class="p">)</span><span class="o">.</span><span class="nf">notNull</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<p>In this case, <code>Identifiable</code> conformance can be achieved, for example, by returning the primary key column from the <code>id</code> property:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Country</span><span class="p">:</span> <span class="kt">Identifiable</span><span class="p">,</span> <span class="kt">FetchableRecord</span><span class="p">,</span> <span class="kt">PersistableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">isoCode</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">population</span><span class="p">:</span> <span class="kt">Int</span>

    <span class="c1">// Fulfill the Identifiable requirement</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span> <span class="n">isoCode</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">france</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Country</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="s">"FR"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<h2 id='codable-records' class='heading'>Codable Records</h2>

<p>Record types that adopt an archival protocol (<a href="https://developer.apple.com/documentation/foundation/archives_and_serialization/encoding_and_decoding_custom_types">Codable, Encodable or Decodable</a>) get free database support just by declaring conformance to the desired <a href="#record-protocols-overview">record protocols</a>:</p>
<pre class="highlight swift"><code><span class="c1">// Declare a record...</span>
<span class="kd">struct</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">Codable</span><span class="p">,</span> <span class="kt">FetchableRecord</span><span class="p">,</span> <span class="kt">PersistableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">score</span><span class="p">:</span> <span class="kt">Int</span>
<span class="p">}</span>

<span class="c1">// ...and there you go:</span>
<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Player</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Arthur"</span><span class="p">,</span> <span class="nv">score</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Codable records encode and decode their properties according to their own implementation of the Encodable and Decodable protocols. Yet databases have specific requirements:</p>

<ul>
<li>Properties are always coded according to their preferred database representation, when they have one (all <a href="#values">values</a> that adopt the <a href="#custom-value-types">DatabaseValueConvertible</a> protocol).</li>
<li>You can customize the encoding and decoding of dates and uuids.</li>
<li>Complex properties (arrays, dictionaries, nested structs, etc.) are stored as JSON.</li>
</ul>

<p>For more information about Codable records, see:</p>

<ul>
<li><a href="#json-columns">JSON Columns</a></li>
<li><a href="#column-names-coding-strategies">Column Names Coding Strategies</a></li>
<li><a href="#date-and-uuid-coding-strategies">Date and UUID Coding Strategies</a></li>
<li><a href="#the-userinfo-dictionary">The userInfo Dictionary</a></li>
<li><a href="#tip-derive-columns-from-coding-keys">Tip: Derive Columns from Coding Keys</a></li>
</ul>

<blockquote>
<p>:bulb: <strong>Tip</strong>: see the <a href="Documentation/DemoApps">Demo Applications</a> for sample code that uses Codable records.</p>
</blockquote>
<h3 id='json-columns' class='heading'>JSON Columns</h3>

<p>When a <a href="#codable-records">Codable record</a> contains a property that is not a simple <a href="#values">value</a> (Bool, Int, String, Date, Swift enums, etc.), that value is encoded and decoded as a <strong>JSON string</strong>. For example:</p>
<pre class="highlight swift"><code><span class="kd">enum</span> <span class="kt">AchievementColor</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">bronze</span><span class="p">,</span> <span class="n">silver</span><span class="p">,</span> <span class="n">gold</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Achievement</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">color</span><span class="p">:</span> <span class="kt">AchievementColor</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">Codable</span><span class="p">,</span> <span class="kt">FetchableRecord</span><span class="p">,</span> <span class="kt">PersistableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">score</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">var</span> <span class="nv">achievements</span><span class="p">:</span> <span class="p">[</span><span class="kt">Achievement</span><span class="p">]</span> <span class="c1">// stored in a JSON column</span>
<span class="p">}</span>

<span class="k">try!</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// INSERT INTO player (name, score, achievements)</span>
    <span class="c1">// VALUES (</span>
    <span class="c1">//   'Arthur',</span>
    <span class="c1">//   100,</span>
    <span class="c1">//   '[{"color":"gold","name":"Use Codable Records"}]')</span>
    <span class="k">let</span> <span class="nv">achievement</span> <span class="o">=</span> <span class="kt">Achievement</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Use Codable Records"</span><span class="p">,</span> <span class="nv">color</span><span class="p">:</span> <span class="o">.</span><span class="n">gold</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="kt">Player</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Arthur"</span><span class="p">,</span> <span class="nv">score</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nv">achievements</span><span class="p">:</span> <span class="p">[</span><span class="n">achievement</span><span class="p">])</span>
    <span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>GRDB uses the standard <a href="https://developer.apple.com/documentation/foundation/jsondecoder">JSONDecoder</a> and <a href="https://developer.apple.com/documentation/foundation/jsonencoder">JSONEncoder</a> from Foundation. By default, Data values are handled with the <code>.base64</code> strategy, Date with the <code>.millisecondsSince1970</code> strategy, and non conforming floats with the <code>.throw</code> strategy.</p>

<p>You can customize the JSON format by implementing those methods:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">databaseJSONDecoder</span><span class="p">(</span><span class="k">for</span> <span class="nv">column</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">JSONDecoder</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">EncodableRecord</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">databaseJSONEncoder</span><span class="p">(</span><span class="k">for</span> <span class="nv">column</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">JSONEncoder</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>:bulb: <strong>Tip</strong>: Make sure you set the JSONEncoder <code>sortedKeys</code> option, available from iOS 11.0+, macOS 10.13+, tvOS 9.0+ and watchOS 4.0+. This option makes sure that the JSON output is stable. This stability is required for <a href="#record-comparison">Record Comparison</a> to work as expected, and database observation tools such as <a href="#valueobservation">ValueObservation</a> to accurately recognize changed records.</p>
</blockquote>
<h3 id='column-names-coding-strategies' class='heading'>Column Names Coding Strategies</h3>

<p>By default, <a href="#codable-records">Codable Records</a> store their values into database columns that match their coding keys: the <code>teamID</code> property is stored into the <code>teamID</code> column.</p>

<p>This behavior can be overridden, so that you can, for example, store the <code>teamID</code> property into the <code>team_id</code> column:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">databaseColumnDecodingStrategy</span><span class="p">:</span> <span class="kt">DatabaseColumnDecodingStrategy</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">EncodableRecord</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">databaseColumnEncodingStrategy</span><span class="p">:</span> <span class="kt">DatabaseColumnEncodingStrategy</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>See <a href="https://groue.github.io/GRDB.swift/docs/5.21/Enums/DatabaseColumnDecodingStrategy.html">DatabaseColumnDecodingStrategy</a> and <a href="https://groue.github.io/GRDB.swift/docs/5.21/Enums/DatabaseColumnEncodingStrategy.html">DatabaseColumnEncodingStrategy</a> to learn about all available strategies.</p>
<h3 id='date-and-uuid-coding-strategies' class='heading'>Date and UUID Coding Strategies</h3>

<p>By default, <a href="#codable-records">Codable Records</a> encode and decode their Date and UUID properties as described in the general <a href="#date-and-datecomponents">Date and DateComponents</a> and <a href="#uuid">UUID</a> chapters.</p>

<p>To sum up: dates encode themselves in the &ldquo;YYYY-MM-DD HH:MM:SS.SSS&rdquo; format, in the UTC time zone, and decode a variety of date formats and timestamps. UUIDs encode themselves as 16-bytes data blobs, and decode both 16-bytes data blobs and strings such as &ldquo;E621E1F8-C36C-495A-93FC-0C247A3E6E5F&rdquo;.</p>

<p>Those behaviors can be overridden:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">databaseDateDecodingStrategy</span><span class="p">:</span> <span class="kt">DatabaseDateDecodingStrategy</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">EncodableRecord</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">databaseDateEncodingStrategy</span><span class="p">:</span> <span class="kt">DatabaseDateEncodingStrategy</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">databaseUUIDEncodingStrategy</span><span class="p">:</span> <span class="kt">DatabaseUUIDEncodingStrategy</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>See <a href="https://groue.github.io/GRDB.swift/docs/5.21/Enums/DatabaseDateDecodingStrategy.html">DatabaseDateDecodingStrategy</a>, <a href="https://groue.github.io/GRDB.swift/docs/5.21/Enums/DatabaseDateEncodingStrategy.html">DatabaseDateEncodingStrategy</a>, and <a href="https://groue.github.io/GRDB.swift/docs/5.21/Enums/DatabaseUUIDEncodingStrategy.html">DatabaseUUIDEncodingStrategy</a> to learn about all available strategies.</p>

<p>There is no customization of uuid decoding, because UUID can already decode all its encoded variants (16-bytes blobs and uuid strings, both uppercase and lowercase).</p>

<p>Customized date and uuid handling apply:</p>

<ul>
<li>When encoding and decoding database rows to and from records (fetching and persistence methods).</li>
<li>In requests by single-column primary key: <code>fetchOne(_:id:)</code>, <code>filter(id:)</code>, <code>deleteAll(_:keys:)</code>, etc.</li>
</ul>

<p><em>They do not apply</em> in other requests based on date or uuid values.</p>

<p>So make sure that dates and uuids are properly encoded in your requests. For example:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">Codable</span><span class="p">,</span> <span class="kt">FetchableRecord</span><span class="p">,</span> <span class="kt">PersistableRecord</span><span class="p">,</span> <span class="kt">Identifiable</span> <span class="p">{</span>
    <span class="c1">// UUIDs are stored as strings</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">databaseUUIDEncodingStrategy</span> <span class="o">=</span> <span class="kt">DatabaseUUIDEncodingStrategy</span><span class="o">.</span><span class="n">uppercaseString</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span>
    <span class="o">...</span>
<span class="p">}</span>

<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">uuid</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="kt">Player</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="n">uuid</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

    <span class="c1">// OK: inserts a player in the database, with a string uuid</span>
    <span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

    <span class="c1">// OK: performs a string-based query, finds the inserted player</span>
    <span class="n">_</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="n">uuid</span><span class="p">)</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

    <span class="c1">// NOT OK: performs a blob-based query, fails to find the inserted player</span>
    <span class="n">_</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span> <span class="o">==</span> <span class="n">uuid</span><span class="p">)</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

    <span class="c1">// OK: performs a string-based query, finds the inserted player</span>
    <span class="n">_</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span> <span class="o">==</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuidString</span><span class="p">)</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<h3 id='the-userinfo-dictionary' class='heading'>The userInfo Dictionary</h3>

<p>Your <a href="#codable-records">Codable Records</a> can be stored in the database, but they may also have other purposes. In this case, you may need to customize their implementations of <code>Decodable.init(from:)</code> and <code>Encodable.encode(to:)</code>, depending on the context.</p>

<p>The standard way to provide such context is the <code>userInfo</code> dictionary. Implement those properties:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">databaseDecodingUserInfo</span><span class="p">:</span> <span class="p">[</span><span class="kt">CodingUserInfoKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">EncodableRecord</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">databaseEncodingUserInfo</span><span class="p">:</span> <span class="p">[</span><span class="kt">CodingUserInfoKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>For example, here is a Player type that customizes its decoding:</p>
<pre class="highlight swift"><code><span class="c1">// A key that holds a decoder's name</span>
<span class="k">let</span> <span class="nv">decoderName</span> <span class="o">=</span> <span class="kt">CodingUserInfoKey</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="s">"decoderName"</span><span class="p">)</span><span class="o">!</span>

<span class="kd">struct</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">FetchableRecord</span><span class="p">,</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="c1">// Print the decoder name</span>
        <span class="k">let</span> <span class="nv">decoderName</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">userInfo</span><span class="p">[</span><span class="n">decoderName</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Decoded from </span><span class="se">\(</span><span class="n">decoderName</span> <span class="p">??</span> <span class="s">"unknown decoder"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>You can have a specific decoding from JSON&hellip;</p>
<pre class="highlight swift"><code><span class="c1">// prints "Decoded from JSON"</span>
<span class="k">let</span> <span class="nv">decoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="n">decoder</span><span class="o">.</span><span class="n">userInfo</span> <span class="o">=</span> <span class="p">[</span><span class="nv">decoderName</span><span class="p">:</span> <span class="s">"JSON"</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Player</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonData</span><span class="p">)</span>
</code></pre>

<p>&hellip; and another one from database rows:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">databaseDecodingUserInfo</span><span class="p">:</span> <span class="p">[</span><span class="kt">CodingUserInfoKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nv">decoderName</span><span class="p">:</span> <span class="s">"database row"</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1">// prints "Decoded from database row"</span>
<span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: make sure the <code>databaseDecodingUserInfo</code> and <code>databaseEncodingUserInfo</code> properties are explicitly declared as <code>[CodingUserInfoKey: Any]</code>. If they are not, the Swift compiler may silently miss the protocol requirement, resulting in sticky empty userInfo.</p>
</blockquote>
<h3 id='tip-derive-columns-from-coding-keys' class='heading'>Tip: Derive Columns from Coding Keys</h3>

<p>Codable types are granted with a <a href="https://developer.apple.com/documentation/foundation/archives_and_serialization/encoding_and_decoding_custom_types">CodingKeys</a> enum. You can use them to safely define database columns:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int64</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">score</span><span class="p">:</span> <span class="kt">Int</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">FetchableRecord</span><span class="p">,</span> <span class="kt">PersistableRecord</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">Columns</span> <span class="p">{</span>
        <span class="kd">static</span> <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="kt">Column</span><span class="p">(</span><span class="kt">CodingKeys</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="kd">static</span> <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="kt">Column</span><span class="p">(</span><span class="kt">CodingKeys</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="kd">static</span> <span class="k">let</span> <span class="nv">score</span> <span class="o">=</span> <span class="kt">Column</span><span class="p">(</span><span class="kt">CodingKeys</span><span class="o">.</span><span class="n">score</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>See the <a href="#the-query-interface">query interface</a> and <a href="Documentation/GoodPracticesForDesigningRecordTypes.md">Good Practices for Designing Record Types</a> for further information.</p>
<h2 id='record-class' class='heading'>Record Class</h2>

<p><strong>Record</strong> is a class that is designed to be subclassed. It inherits its features from the <a href="#record-protocols-overview">FetchableRecord, TableRecord, and PersistableRecord</a> protocols. On top of that, Record instances can compare against previous versions of themselves in order to <a href="#record-comparison">avoid useless updates</a>.</p>

<p>Record subclasses define their custom database relationship by overriding database methods. For example:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">Place</span><span class="p">:</span> <span class="kt">Record</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">isFavorite</span><span class="p">:</span> <span class="kt">Bool</span>
    <span class="k">var</span> <span class="nv">coordinate</span><span class="p">:</span> <span class="kt">CLLocationCoordinate2D</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">?,</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">isFavorite</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">,</span> <span class="nv">coordinate</span><span class="p">:</span> <span class="kt">CLLocationCoordinate2D</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">id</span>
        <span class="k">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="k">self</span><span class="o">.</span><span class="n">isFavorite</span> <span class="o">=</span> <span class="n">isFavorite</span>
        <span class="k">self</span><span class="o">.</span><span class="n">coordinate</span> <span class="o">=</span> <span class="n">coordinate</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1">/// The table name</span>
    <span class="k">override</span> <span class="kd">class</span> <span class="k">var</span> <span class="nv">databaseTableName</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span> <span class="s">"place"</span> <span class="p">}</span>

    <span class="c1">/// The table columns</span>
    <span class="kd">enum</span> <span class="kt">Columns</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">ColumnExpression</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">favorite</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span>
    <span class="p">}</span>

    <span class="c1">/// Creates a record from a database row</span>
    <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">row</span><span class="p">:</span> <span class="kt">Row</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">title</span><span class="p">]</span>
        <span class="n">isFavorite</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">favorite</span><span class="p">]</span>
        <span class="n">coordinate</span> <span class="o">=</span> <span class="kt">CLLocationCoordinate2D</span><span class="p">(</span>
            <span class="nv">latitude</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">latitude</span><span class="p">],</span>
            <span class="nv">longitude</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">longitude</span><span class="p">])</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">row</span><span class="p">:</span> <span class="n">row</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">/// The values persisted in the database</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">encode</span><span class="p">(</span><span class="n">to</span> <span class="nv">container</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">PersistenceContainer</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">container</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">id</span>
        <span class="n">container</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">title</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>
        <span class="n">container</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">favorite</span><span class="p">]</span> <span class="o">=</span> <span class="n">isFavorite</span>
        <span class="n">container</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">latitude</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordinate</span><span class="o">.</span><span class="n">latitude</span>
        <span class="n">container</span><span class="p">[</span><span class="kt">Columns</span><span class="o">.</span><span class="n">longitude</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordinate</span><span class="o">.</span><span class="n">longitude</span>
    <span class="p">}</span>

    <span class="c1">/// Update record ID after a successful insertion</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">didInsert</span><span class="p">(</span><span class="n">with</span> <span class="nv">rowID</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">,</span> <span class="k">for</span> <span class="nv">column</span><span class="p">:</span> <span class="kt">String</span><span class="p">?)</span> <span class="p">{</span>
        <span class="n">id</span> <span class="o">=</span> <span class="n">rowID</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h2 id='record-comparison' class='heading'>Record Comparison</h2>

<p><strong>Records that adopt the <a href="#persistablerecord-protocol">EncodableRecord</a> protocol can compare against other records, or against previous versions of themselves.</strong></p>

<p>This helps avoiding costly UPDATE statements when a record has not been edited.</p>

<ul>
<li><a href="#the-updatechanges-methods">The <code>updateChanges</code> Methods</a></li>
<li><a href="#the-databaseequals-method">The <code>databaseEquals</code> Method</a></li>
<li><a href="#the-databasechanges-and-hasdatabasechanges-methods">The <code>databaseChanges</code> and <code>hasDatabaseChanges</code> Methods</a></li>
</ul>
<h3 id='the-code-updatechanges-code-methods' class='heading'>The <code>updateChanges</code> Methods</h3>

<p>The <code>updateChanges</code> methods perform a database update of the changed columns only (and does nothing if record has no change).</p>

<ul>
<li><p><code>updateChanges(_:from:)</code></p>

<p>This method lets you compare two records:</p>
<pre class="highlight swift"><code><span class="k">if</span> <span class="k">let</span> <span class="nv">oldPlayer</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">42</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">newPlayer</span> <span class="o">=</span> <span class="n">oldPlayer</span>
    <span class="n">newPlayer</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">if</span> <span class="k">try</span> <span class="n">newPlayer</span><span class="o">.</span><span class="nf">updateChanges</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">oldPlayer</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"player was modified, and updated in the database"</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"player was not modified, and database was not hit"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></li>
<li><p><code>updateChanges(_:with:)</code></p>

<p>This method lets you update a record in place:</p>
<pre class="highlight swift"><code><span class="k">if</span> <span class="k">var</span> <span class="nv">player</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">42</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">modified</span> <span class="o">=</span> <span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">updateChanges</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$0</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">modified</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"player was modified, and updated in the database"</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"player was not modified, and database was not hit"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></li>
<li><p><code>updateChanges(_:)</code> (Record class only)</p>

<p>Instances of the <a href="#record-class">Record</a> class are able to compare against themselves, and know if they have changes that have not been saved since the last fetch or saving:</p>
<pre class="highlight swift"><code><span class="c1">// Record class only</span>
<span class="k">if</span> <span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">42</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">player</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">if</span> <span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">updateChanges</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"player was modified, and updated in the database"</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"player was not modified, and database was not hit"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></li>
</ul>
<h3 id='the-code-databaseequals-code-method' class='heading'>The <code>databaseEquals</code> Method</h3>

<p>This method returns whether two records have the same database representation:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">oldPlayer</span><span class="p">:</span> <span class="kt">Player</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">var</span> <span class="nv">newPlayer</span><span class="p">:</span> <span class="kt">Player</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">if</span> <span class="n">newPlayer</span><span class="o">.</span><span class="nf">databaseEquals</span><span class="p">(</span><span class="n">oldPlayer</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span> <span class="p">{</span>
    <span class="k">try</span> <span class="n">newPlayer</span><span class="o">.</span><span class="nf">save</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: The comparison is performed on the database representation of records. As long as your record type adopts the EncodableRecord protocol, you don&rsquo;t need to care about Equatable.</p>
</blockquote>
<h3 id='the-code-databasechanges-code-and-code-hasdatabasechanges-code-methods' class='heading'>The <code>databaseChanges</code> and <code>hasDatabaseChanges</code> Methods</h3>

<p><code>databaseChanges(from:)</code> returns a dictionary of differences between two records:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">oldPlayer</span> <span class="o">=</span> <span class="kt">Player</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Arthur"</span><span class="p">,</span> <span class="nv">score</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">newPlayer</span> <span class="o">=</span> <span class="kt">Player</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Arthur"</span><span class="p">,</span> <span class="nv">score</span><span class="p">:</span> <span class="mi">1000</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">oldValue</span><span class="p">)</span> <span class="k">in</span> <span class="n">newPlayer</span><span class="o">.</span><span class="nf">databaseChanges</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">oldPlayer</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">column</span><span class="se">)</span><span class="s"> was </span><span class="se">\(</span><span class="n">oldValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// prints "score was 100"</span>
</code></pre>

<p>The <a href="#record-class">Record</a> class is able to compare against itself:</p>
<pre class="highlight swift"><code><span class="c1">// Record class only</span>
<span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="kt">Player</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Arthur"</span><span class="p">,</span> <span class="nv">score</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">player</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">for</span> <span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">oldValue</span><span class="p">)</span> <span class="k">in</span> <span class="n">player</span><span class="o">.</span><span class="n">databaseChanges</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">column</span><span class="se">)</span><span class="s"> was </span><span class="se">\(</span><span class="n">oldValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// prints "score was 100"</span>
</code></pre>

<p><a href="#record-class">Record</a> instances also have a <code>hasDatabaseChanges</code> property:</p>
<pre class="highlight swift"><code><span class="c1">// Record class only</span>
<span class="n">player</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">hasDatabaseChanges</span> <span class="p">{</span>
    <span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">save</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p><code><a href="Classes/Record.html#/s:4GRDB6RecordC18hasDatabaseChangesSbvp">Record.hasDatabaseChanges</a></code> is false after a Record instance has been fetched or saved into the database. Subsequent modifications may set it, or not: <code>hasDatabaseChanges</code> is based on value comparison. <strong>Setting a property to the same value does not set the changed flag</strong>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="kt">Player</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Barbara"</span><span class="p">,</span> <span class="nv">score</span><span class="p">:</span> <span class="mi">750</span><span class="p">)</span>
<span class="n">player</span><span class="o">.</span><span class="n">hasDatabaseChanges</span> <span class="c1">// true</span>

<span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">player</span><span class="o">.</span><span class="n">hasDatabaseChanges</span> <span class="c1">// false</span>

<span class="n">player</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Barbara"</span>
<span class="n">player</span><span class="o">.</span><span class="n">hasDatabaseChanges</span> <span class="c1">// false</span>

<span class="n">player</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">player</span><span class="o">.</span><span class="n">hasDatabaseChanges</span> <span class="c1">// true</span>
<span class="n">player</span><span class="o">.</span><span class="n">databaseChanges</span>    <span class="c1">// ["score": 750]</span>
</code></pre>

<p>For an efficient algorithm which synchronizes the content of a database table with a JSON payload, check <a href="https://github.com/groue/SortedDifference">groue/SortedDifference</a>.</p>
<h2 id='record-customization-options' class='heading'>Record Customization Options</h2>

<p>GRDB records come with many default behaviors, that are designed to fit most situations. Many of those defaults can be customized for your specific needs:</p>

<ul>
<li><a href="#customizing-the-persistence-methods">Customizing the Persistence Methods</a>: define what happens when you call a persistence method such as <code>player.insert(db)</code></li>
<li><a href="#conflict-resolution">Conflict Resolution</a>: Run <code>INSERT OR REPLACE</code> queries, and generally define what happens when a persistence method violates a unique index.</li>
<li><a href="#the-implicit-rowid-primary-key">The Implicit RowID Primary Key</a>: all about the special <code>rowid</code> column.</li>
<li><a href="#columns-selected-by-a-request">Columns Selected by a Request</a>: define which columns are selected by requests such as <code>Player.fetchAll(db)</code>.</li>
<li><a href="#beyond-fetchablerecord">Beyond FetchableRecord</a>: the FetchableRecord protocol is not the end of the story.</li>
</ul>

<p><a href="#codable-records">Codable Records</a> have a few extra options:</p>

<ul>
<li><a href="#json-columns">JSON Columns</a>: control the format of JSON columns.</li>
<li><a href="#column-names-coding-strategies">Column Names Coding Strategies</a>: control how coding keys are turned into column names</li>
<li><a href="#date-and-uuid-coding-strategies">Date and UUID Coding Strategies</a>: control the format of Date and UUID properties in your Codable records.</li>
<li><a href="#the-userinfo-dictionary">The userInfo Dictionary</a>: adapt your Codable implementation for the database.</li>
</ul>
<h3 id='conflict-resolution' class='heading'>Conflict Resolution</h3>

<p><strong>Insertions and updates can create conflicts</strong>: for example, a query may attempt to insert a duplicate row that violates a unique index.</p>

<p>Those conflicts normally end with an error. Yet SQLite let you alter the default behavior, and handle conflicts with specific policies. For example, the <code>INSERT OR REPLACE</code> statement handles conflicts with the &ldquo;replace&rdquo; policy which replaces the conflicting row instead of throwing an error.</p>

<p>The <a href="https://www.sqlite.org/lang_conflict.html">five different policies</a> are: abort (the default), replace, rollback, fail, and ignore.</p>

<p><strong>SQLite let you specify conflict policies at two different places:</strong></p>

<ul>
<li><p>In the definition of the database table:</p>
<pre class="highlight swift"><code><span class="c1">// CREATE TABLE player (</span>
<span class="c1">//     id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="c1">//     email TEXT UNIQUE ON CONFLICT REPLACE</span>
<span class="c1">// )</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"player"</span><span class="p">)</span> <span class="p">{</span> <span class="n">t</span> <span class="k">in</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">autoIncrementedPrimaryKey</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"email"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="nf">unique</span><span class="p">(</span><span class="nv">onConflict</span><span class="p">:</span> <span class="o">.</span><span class="n">replace</span><span class="p">)</span> <span class="c1">// &lt;--</span>
<span class="p">}</span>

<span class="c1">// Despite the unique index on email, both inserts succeed.</span>
<span class="c1">// The second insert replaces the first row:</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT INTO player (email) VALUES (?)"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"arthur@example.com"</span><span class="p">])</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT INTO player (email) VALUES (?)"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"arthur@example.com"</span><span class="p">])</span>
</code></pre></li>
<li><p>In each modification query:</p>
<pre class="highlight swift"><code><span class="c1">// CREATE TABLE player (</span>
<span class="c1">//     id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="c1">//     email TEXT UNIQUE</span>
<span class="c1">// )</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"player"</span><span class="p">)</span> <span class="p">{</span> <span class="n">t</span> <span class="k">in</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">autoIncrementedPrimaryKey</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"email"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="nf">unique</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// Again, despite the unique index on email, both inserts succeed.</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT OR REPLACE INTO player (email) VALUES (?)"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"arthur@example.com"</span><span class="p">])</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT OR REPLACE INTO player (email) VALUES (?)"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"arthur@example.com"</span><span class="p">])</span>
</code></pre></li>
</ul>

<p>When you want to handle conflicts at the query level, specify a custom <code>persistenceConflictPolicy</code> in your type that adopts the PersistableRecord protocol. It will alter the INSERT and UPDATE queries run by the <code>insert</code>, <code>update</code> and <code>save</code> <a href="#persistence-methods">persistence methods</a>:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">MutablePersistableRecord</span> <span class="p">{</span>
    <span class="c1">/// The policy that handles SQLite conflicts when records are</span>
    <span class="c1">/// inserted or updated.</span>
    <span class="c1">///</span>
    <span class="c1">/// This property is optional: its default value uses the ABORT</span>
    <span class="c1">/// policy for both insertions and updates, so that GRDB generate</span>
    <span class="c1">/// regular INSERT and UPDATE queries.</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">persistenceConflictPolicy</span><span class="p">:</span> <span class="kt">PersistenceConflictPolicy</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Player</span> <span class="p">:</span> <span class="kt">MutablePersistableRecord</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">persistenceConflictPolicy</span> <span class="o">=</span> <span class="kt">PersistenceConflictPolicy</span><span class="p">(</span>
        <span class="nv">insert</span><span class="p">:</span> <span class="o">.</span><span class="n">replace</span><span class="p">,</span>
        <span class="nv">update</span><span class="p">:</span> <span class="o">.</span><span class="n">replace</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// INSERT OR REPLACE INTO player (...) VALUES (...)</span>
<span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: the <code>ignore</code> policy does not play well at all with the <code>didInsert</code> method which notifies the rowID of inserted records. Choose your poison:</p>

<ul>
<li>if you specify the <code>ignore</code> policy in the database table definition, don&rsquo;t implement the <code>didInsert</code> method: it will be called with some random id in case of failed insert.</li>
<li>if you specify the <code>ignore</code> policy at the query level, the <code>didInsert</code> method is never called.</li>
</ul>

<p>:point_up: <strong>Note</strong>: The <code>replace</code> policy may have to delete rows so that inserts and updates can succeed. Those deletions are not reported to <a href="#transactionobserver-protocol">transaction observers</a> (this might change in a future release of SQLite).</p>
</blockquote>
<h3 id='the-implicit-rowid-primary-key' class='heading'>The Implicit RowID Primary Key</h3>

<p><strong>All SQLite tables have a primary key.</strong> Even when the primary key is not explicit:</p>
<pre class="highlight swift"><code><span class="c1">// No explicit primary key</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"event"</span><span class="p">)</span> <span class="p">{</span> <span class="n">t</span> <span class="k">in</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"message"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"date"</span><span class="p">,</span> <span class="o">.</span><span class="n">datetime</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// No way to define an explicit primary key</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">virtualTable</span><span class="p">:</span> <span class="s">"book"</span><span class="p">,</span> <span class="nv">using</span><span class="p">:</span> <span class="kt">FTS4</span><span class="p">())</span> <span class="p">{</span> <span class="n">t</span> <span class="k">in</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"title"</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"author"</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"body"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>The implicit primary key is stored in the hidden column <code>rowid</code>. Hidden means that <code>SELECT *</code> does not select it, and yet it can be selected and queried: <code>SELECT *, rowid ... WHERE rowid = 1</code>.</p>

<p>Some GRDB methods will automatically use this hidden column when a table has no explicit primary key:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM event WHERE rowid = 1</span>
<span class="k">let</span> <span class="nv">event</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Event</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">// DELETE FROM book WHERE rowid = 1</span>
<span class="k">try</span> <span class="kt">Book</span><span class="o">.</span><span class="nf">deleteOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
</code></pre>
<h4 id='exposing-the-rowid-column' class='heading'>Exposing the RowID Column</h4>

<p><strong>By default, a record type that wraps a table without any explicit primary key doesn&rsquo;t know about the hidden rowid column.</strong></p>

<p>Without primary key, records don&rsquo;t have any identity, and the <a href="#persistence-methods">persistence method</a> can behave in undesired fashion: <code>update()</code> throws errors, <code>save()</code> always performs insertions and may break constraints, <code>exists()</code> is always false.</p>

<p>When SQLite won&rsquo;t let you provide an explicit primary key (as in <a href="Documentation/FullTextSearch.md">full-text</a> tables, for example), you may want to make your record type fully aware of the hidden rowid column:</p>

<ol>
<li><p>Have the <code>databaseSelection</code> static property (from the <a href="#tablerecord-protocol">TableRecord</a> protocol) return the hidden rowid column:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Event</span> <span class="p">:</span> <span class="kt">TableRecord</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">databaseSelection</span><span class="p">:</span> <span class="p">[</span><span class="kt">SQLSelectable</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kt">AllColumns</span><span class="p">(),</span> <span class="kt">Column</span><span class="o">.</span><span class="n">rowID</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1">// When you subclass Record, you need an override:</span>
<span class="kd">class</span> <span class="kt">Book</span> <span class="p">:</span> <span class="kt">Record</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">class</span> <span class="k">var</span> <span class="nv">databaseSelection</span><span class="p">:</span> <span class="p">[</span><span class="kt">SQLSelectable</span><span class="p">]</span> <span class="p">{</span>
        <span class="p">[</span><span class="kt">AllColums</span><span class="p">(),</span> <span class="kt">Column</span><span class="o">.</span><span class="n">rowID</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>GRDB will then select the <code>rowid</code> column by default:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT *, rowid FROM event</span>
<span class="k">let</span> <span class="nv">events</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Event</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre></li>
<li><p>Have <code>init(row:)</code> from the <a href="#fetchablerecord-protocol">FetchableRecord</a> protocol consume the &ldquo;rowid&rdquo; column:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Event</span> <span class="p">:</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">?</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">row</span><span class="p">:</span> <span class="kt">Row</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="kt">Column</span><span class="o">.</span><span class="n">rowID</span><span class="p">]</span> <span class="c1">// or `row[.rowID]` with Swift 5.5+</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Your fetched records will then know their ids:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">event</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Event</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="o">!</span>
<span class="n">event</span><span class="o">.</span><span class="n">id</span> <span class="c1">// some value</span>
</code></pre></li>
<li><p>Encode the rowid in <code>encode(to:)</code>, and keep it in the <code>didInsert(with:for:)</code> method (both from the <a href="#persistablerecord-protocol">PersistableRecord and MutablePersistableRecord</a> protocols):</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Event</span> <span class="p">:</span> <span class="kt">MutablePersistableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">?</span>

    <span class="kd">func</span> <span class="nf">encode</span><span class="p">(</span><span class="n">to</span> <span class="nv">container</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">PersistenceContainer</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">container</span><span class="p">[</span><span class="kt">Column</span><span class="o">.</span><span class="n">rowID</span><span class="p">]</span> <span class="o">=</span> <span class="n">id</span> <span class="c1">// or `container[.rowID]` with Swift 5.5+</span>
        <span class="n">container</span><span class="p">[</span><span class="s">"message"</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>
        <span class="n">container</span><span class="p">[</span><span class="s">"date"</span><span class="p">]</span> <span class="o">=</span> <span class="n">date</span>
    <span class="p">}</span>

    <span class="c1">// Update auto-incremented id upon successful insertion</span>
    <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">didInsert</span><span class="p">(</span><span class="n">with</span> <span class="nv">rowID</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">,</span> <span class="k">for</span> <span class="nv">column</span><span class="p">:</span> <span class="kt">String</span><span class="p">?)</span> <span class="p">{</span>
        <span class="n">id</span> <span class="o">=</span> <span class="n">rowID</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>You will then be able to track your record ids, update them, or check for their existence:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">event</span> <span class="o">=</span> <span class="kt">Event</span><span class="p">(</span><span class="nv">message</span><span class="p">:</span> <span class="s">"foo"</span><span class="p">,</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">Date</span><span class="p">())</span>

<span class="c1">// Insertion sets the record id:</span>
<span class="k">try</span> <span class="n">event</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">event</span><span class="o">.</span><span class="n">id</span> <span class="c1">// some value</span>

<span class="c1">// Record can be updated:</span>
<span class="n">event</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="s">"bar"</span>
<span class="k">try</span> <span class="n">event</span><span class="o">.</span><span class="nf">update</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

<span class="c1">// Record knows if it exists:</span>
<span class="n">event</span><span class="o">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// true</span>
</code></pre></li>
</ol>
<h3 id='beyond-fetchablerecord' class='heading'>Beyond FetchableRecord</h3>

<p><strong>Some GRDB users eventually discover that the <a href="#fetchablerecord-protocol">FetchableRecord</a> protocol does not fit all situations.</strong> Use cases that are not well handled by FetchableRecord include:</p>

<ul>
<li><p>Your application needs polymorphic row decoding: it decodes some type or another, depending on the values contained in a database row.</p></li>
<li><p>Your application needs to decode rows with a context: each decoded value should be initialized with some extra value that does not come from the database.</p></li>
<li><p>Your application needs a record type that supports untrusted databases, and may fail at decoding database rows (throw an error when a row contains invalid values).</p></li>
</ul>

<p>Since those use cases are not well handled by FetchableRecord, don&rsquo;t try to implement them on top of this protocol: you&rsquo;ll just fight the framework.</p>

<p>Instead, please have a look at the <a href="Documentation/Playgrounds/CustomizedDecodingOfDatabaseRows.playground/Contents.swift">CustomizedDecodingOfDatabaseRows</a> playground. You&rsquo;ll run some sample code, and learn how to escape FetchableRecord when you need. And remember that leaving FetchableRecord will not deprive you of <a href="#requests">query interface requests</a> and generally all SQL generation features of the <a href="#tablerecord-protocol">TableRecord</a> and <a href="#persistablerecord-protocol">PersistableRecord</a> protocols.</p>
<h2 id='examples-of-record-definitions' class='heading'>Examples of Record Definitions</h2>

<p>We will show below how to declare a record type for the following database table:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"place"</span><span class="p">)</span> <span class="p">{</span> <span class="n">t</span> <span class="k">in</span>
        <span class="n">t</span><span class="o">.</span><span class="nf">autoIncrementedPrimaryKey</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"title"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="nf">notNull</span><span class="p">()</span>
        <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"isFavorite"</span><span class="p">,</span> <span class="o">.</span><span class="n">boolean</span><span class="p">)</span><span class="o">.</span><span class="nf">notNull</span><span class="p">()</span><span class="o">.</span><span class="nf">defaults</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="nf">notNull</span><span class="p">()</span>
        <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="nf">notNull</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Each one of the three examples below is correct. You will pick one or the other depending on your personal preferences and the requirements of your application:</p>

<details>
  <summary>Define a Codable struct, and adopt the record protocols you need</summary>

This is the shortest way to define a record type.

See the [Record Protocols Overview](#record-protocols-overview), and [Codable Records] for more information.

&ldquo;`swift
struct Place: Codable {
    var id: Int64?
    var title: String
    var isFavorite: Bool
    private var latitude: CLLocationDegrees
    private var longitude: CLLocationDegrees
    
    var coordinate: CLLocationCoordinate2D {
        get {
            CLLocationCoordinate2D(
                latitude: latitude,
                longitude: longitude)
        }
        set {
            latitude = newValue.latitude
            longitude = newValue.longitude
        }
    }
}

// SQL generation
extension Place: TableRecord {
    /// The table columns
    enum Columns {
        static let id = Column(CodingKeys.id)
        static let title = Column(CodingKeys.title)
        static let isFavorite = Column(CodingKeys.isFavorite)
        static let latitude = Column(CodingKeys.latitude)
        static let longitude = Column(CodingKeys.longitude)
    }
}

// Fetching methods
extension Place: FetchableRecord { }

// Persistence methods
extension Place: MutablePersistableRecord {
    // Update auto-incremented id upon successful insertion
    mutating func didInsert(with rowID: Int64, for column: String?) {
        id = rowID
    }
}
&rdquo;`

</details>

<details>
  <summary>Define a plain struct, and adopt the record protocols you need</summary>

See the [Record Protocols Overview](#record-protocols-overview) for more information.
    
&ldquo;`swift
struct Place {
    var id: Int64?
    var title: String
    var isFavorite: Bool
    var coordinate: CLLocationCoordinate2D
}

// SQL generation
extension Place: TableRecord {
    /// The table columns
    enum Columns: String, ColumnExpression {
        case id, title, isFavorite, latitude, longitude
    }
}

// Fetching methods
extension Place: FetchableRecord {
    /// Creates a record from a database row
    init(row: Row) {
        id = row[Columns.id]
        title = row[Columns.title]
        isFavorite = row[Columns.isFavorite]
        coordinate = CLLocationCoordinate2D(
            latitude: row[Columns.latitude],
            longitude: row[Columns.longitude])
    }
}

// Persistence methods
extension Place: MutablePersistableRecord {
    /// The values persisted in the database
    func encode(to container: inout PersistenceContainer) {
        container[Columns.id] = id
        container[Columns.title] = title
        container[Columns.isFavorite] = isFavorite
        container[Columns.latitude] = coordinate.latitude
        container[Columns.longitude] = coordinate.longitude
    }
    
    // Update auto-incremented id upon successful insertion
    mutating func didInsert(with rowID: Int64, for column: String?) {
        id = rowID
    }
}
&rdquo;`

</details>

<details>
  <summary>Define a plain struct optimized for fetching performance</summary>

This struct derives its persistence methods from the standard Encodable protocol (see [Codable Records]), but performs optimized row decoding by accessing database columns with numeric indexes.

See the [Record Protocols Overview](#record-protocols-overview) for more information.
    
&ldquo;`swift
struct Place: Encodable {
    var id: Int64?
    var title: String
    var isFavorite: Bool
    private var latitude: CLLocationDegrees
    private var longitude: CLLocationDegrees
    
    var coordinate: CLLocationCoordinate2D {
        get {
            CLLocationCoordinate2D(
                latitude: latitude,
                longitude: longitude)
        }
        set {
            latitude = newValue.latitude
            longitude = newValue.longitude
        }
    }
}

// SQL generation
extension Place: TableRecord {
    /// The table columns
    enum Columns {
        static let id = Column(CodingKeys.id)
        static let title = Column(CodingKeys.title)
        static let isFavorite = Column(CodingKeys.isFavorite)
        static let latitude = Column(CodingKeys.latitude)
        static let longitude = Column(CodingKeys.longitude)
    }
    
    /// Arrange the selected columns and lock their order
    static let databaseSelection: [SQLSelectable] = [
        Columns.id,
        Columns.title,
        Columns.favorite,
        Columns.latitude,
        Columns.longitude]
}

// Fetching methods
extension Place: FetchableRecord {
    /// Creates a record from a database row
    init(row: Row) {
        // For high performance, use numeric indexes that match the
        // order of Place.databaseSelection
        id = row[0]
        title = row[1]
        isFavorite = row[2]
        coordinate = CLLocationCoordinate2D(
            latitude: row[3],
            longitude: row[4])
    }
}

// Persistence methods
extension Place: MutablePersistableRecord {
    // Update auto-incremented id upon successful insertion
    mutating func didInsert(with rowID: Int64, for column: String?) {
        id = rowID
    }
}
&rdquo;`

</details>

<details>
  <summary>Subclass the <code><a href="Classes/Record.html">Record</a></code> class</summary>

See the [Record class](#record-class) for more information.
    
&ldquo;`swift
class Place: Record {
    var id: Int64?
    var title: String
    var isFavorite: Bool
    var coordinate: CLLocationCoordinate2D
    
    init(id: Int64?, title: String, isFavorite: Bool, coordinate: CLLocationCoordinate2D) {
        self.id = id
        self.title = title
        self.isFavorite = isFavorite
        self.coordinate = coordinate
        super.init()
    }
    
    /// The table name
    override class var databaseTableName: String { &quot;place&rdquo; }
    
    /// The table columns
    enum Columns: String, ColumnExpression {
        case id, title, isFavorite, latitude, longitude
    }
    
    /// Creates a record from a database row
    required init(row: Row) {
        id = row[Columns.id]
        title = row[Columns.title]
        isFavorite = row[Columns.isFavorite]
        coordinate = CLLocationCoordinate2D(
            latitude: row[Columns.latitude],
            longitude: row[Columns.longitude])
        super.init(row: row)
    }
    
    /// The values persisted in the database
    override func encode(to container: inout PersistenceContainer) {
        container[Columns.id] = id
        container[Columns.title] = title
        container[Columns.isFavorite] = isFavorite
        container[Columns.latitude] = coordinate.latitude
        container[Columns.longitude] = coordinate.longitude
    }
    
    // Update auto-incremented id upon successful insertion
    override func didInsert(with rowID: Int64, for column: String?) {
        id = rowID
    }
}
&ldquo;`

</details>
<h2 id='list-of-record-methods' class='heading'>List of Record Methods</h2>

<p>This is the list of record methods, along with their required protocols. The <a href="#record-class">Record</a> class adopts all these protocols, and adds a few extra methods.</p>

<table><thead>
<tr>
<th>Method</th>
<th>Protocols</th>
<th style="text-align: center">Notes</th>
</tr>
</thead><tbody>
<tr>
<td><strong>Core Methods</strong></td>
<td></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>init(row:)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.databaseTableName</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.databaseSelection</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#columns-selected-by-a-request">*</a></td>
</tr>
<tr>
<td><code>Type.persistenceConflictPolicy</code></td>
<td><a href="#persistablerecord-protocol">PersistableRecord</a></td>
<td style="text-align: center"><a href="#conflict-resolution">*</a></td>
</tr>
<tr>
<td><code>record.encode(to:)</code></td>
<td><a href="#persistablerecord-protocol">EncodableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.didInsert(with:for:)</code></td>
<td><a href="#persistablerecord-protocol">PersistableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><strong>Insert and Update Records</strong></td>
<td></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.insert(db)</code></td>
<td><a href="#persistablerecord-protocol">PersistableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.inserted(db)</code></td>
<td><a href="#persistablerecord-protocol">PersistableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.save(db)</code></td>
<td><a href="#persistablerecord-protocol">PersistableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.saved(db)</code></td>
<td><a href="#persistablerecord-protocol">PersistableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.update(db)</code></td>
<td><a href="#persistablerecord-protocol">PersistableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.update(db, columns:...)</code></td>
<td><a href="#persistablerecord-protocol">PersistableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.updateChanges(db, from:...)</code></td>
<td><a href="#persistablerecord-protocol">PersistableRecord</a></td>
<td style="text-align: center"><a href="#record-comparison">*</a></td>
</tr>
<tr>
<td><code>record.updateChanges(db) { ... }</code></td>
<td><a href="#persistablerecord-protocol">PersistableRecord</a></td>
<td style="text-align: center"><a href="#record-comparison">*</a></td>
</tr>
<tr>
<td><code>record.updateChanges(db)</code></td>
<td><a href="#record-class">Record</a></td>
<td style="text-align: center"><a href="#record-comparison">*</a></td>
</tr>
<tr>
<td><code>Type.updateAll(db, ...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.filter(...).updateAll(db, ...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><strong>Delete Records</strong></td>
<td></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.delete(db)</code></td>
<td><a href="#persistablerecord-protocol">PersistableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.deleteOne(db, key:...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-1">¹</a></td>
</tr>
<tr>
<td><code>Type.deleteOne(db, id:...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a> &amp; <a href="https://developer.apple.com/documentation/swift/identifiable">Identifiable</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-1">¹</a></td>
</tr>
<tr>
<td><code>Type.deleteAll(db)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.deleteAll(db, keys:...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-1">¹</a></td>
</tr>
<tr>
<td><code>Type.deleteAll(db, ids:...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a> &amp; <a href="https://developer.apple.com/documentation/swift/identifiable">Identifiable</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-1">¹</a></td>
</tr>
<tr>
<td><code>Type.filter(...).deleteAll(db)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><strong>Check Record Existence</strong></td>
<td></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.exists(db)</code></td>
<td><a href="#persistablerecord-protocol">PersistableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.exists(db, key: ...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-1">¹</a></td>
</tr>
<tr>
<td><code>Type.exists(db, id: ...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a> &amp; <a href="https://developer.apple.com/documentation/swift/identifiable">Identifiable</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-1">¹</a></td>
</tr>
<tr>
<td><code>Type.filter(...).isEmpty(db)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><strong>Convert Record to Dictionary</strong></td>
<td></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.databaseDictionary</code></td>
<td><a href="#persistablerecord-protocol">EncodableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><strong>Count Records</strong></td>
<td></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.fetchCount(db)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.filter(...).fetchCount(db)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><strong>Fetch Record <a href="#cursors">Cursors</a></strong></td>
<td></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.fetchCursor(db)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.fetchCursor(db, keys:...)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-1">¹</a></td>
</tr>
<tr>
<td><code>Type.fetchCursor(db, ids:...)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a> &amp; <a href="https://developer.apple.com/documentation/swift/identifiable">Identifiable</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-1">¹</a></td>
</tr>
<tr>
<td><code>Type.fetchCursor(db, sql: sql)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-3">³</a></td>
</tr>
<tr>
<td><code>Type.fetchCursor(statement)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-4">⁴</a></td>
</tr>
<tr>
<td><code>Type.filter(...).fetchCursor(db)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><strong>Fetch Record Arrays</strong></td>
<td></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.fetchAll(db)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.fetchAll(db, keys:...)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-1">¹</a></td>
</tr>
<tr>
<td><code>Type.fetchAll(db, ids:...)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a> &amp; <a href="https://developer.apple.com/documentation/swift/identifiable">Identifiable</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-1">¹</a></td>
</tr>
<tr>
<td><code>Type.fetchAll(db, sql: sql)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-3">³</a></td>
</tr>
<tr>
<td><code>Type.fetchAll(statement)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-4">⁴</a></td>
</tr>
<tr>
<td><code>Type.filter(...).fetchAll(db)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><strong>Fetch Record Sets</strong></td>
<td></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.fetchSet(db)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.fetchSet(db, keys:...)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-1">¹</a></td>
</tr>
<tr>
<td><code>Type.fetchSet(db, ids:...)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a> &amp; <a href="https://developer.apple.com/documentation/swift/identifiable">Identifiable</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-1">¹</a></td>
</tr>
<tr>
<td><code>Type.fetchSet(db, sql: sql)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-3">³</a></td>
</tr>
<tr>
<td><code>Type.fetchSet(statement)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-4">⁴</a></td>
</tr>
<tr>
<td><code>Type.filter(...).fetchSet(db)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><strong>Fetch Individual Records</strong></td>
<td></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.fetchOne(db)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.fetchOne(db, key:...)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-1">¹</a></td>
</tr>
<tr>
<td><code>Type.fetchOne(db, id:...)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a> &amp; <a href="https://developer.apple.com/documentation/swift/identifiable">Identifiable</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-1">¹</a></td>
</tr>
<tr>
<td><code>Type.fetchOne(db, sql: sql)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-3">³</a></td>
</tr>
<tr>
<td><code>Type.fetchOne(statement)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-4">⁴</a></td>
</tr>
<tr>
<td><code>Type.filter(...).fetchOne(db)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a> &amp; <a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><strong><a href="#codable-records">Codable Records</a></strong></td>
<td></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.databaseDecodingUserInfo</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a></td>
<td style="text-align: center"><a href="#the-userinfo-dictionary">*</a></td>
</tr>
<tr>
<td><code>Type.databaseJSONDecoder(for:)</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a></td>
<td style="text-align: center"><a href="#json-columns">*</a></td>
</tr>
<tr>
<td><code>Type.databaseDateDecodingStrategy</code></td>
<td><a href="#fetchablerecord-protocol">FetchableRecord</a></td>
<td style="text-align: center"><a href="#date-and-uuid-coding-strategies">*</a></td>
</tr>
<tr>
<td><code>Type.databaseEncodingUserInfo</code></td>
<td><a href="#persistablerecord-protocol">EncodableRecord</a></td>
<td style="text-align: center"><a href="#the-userinfo-dictionary">*</a></td>
</tr>
<tr>
<td><code>Type.databaseJSONEncoder(for:)</code></td>
<td><a href="#persistablerecord-protocol">EncodableRecord</a></td>
<td style="text-align: center"><a href="#json-columns">*</a></td>
</tr>
<tr>
<td><code>Type.databaseDateEncodingStrategy</code></td>
<td><a href="#persistablerecord-protocol">EncodableRecord</a></td>
<td style="text-align: center"><a href="#date-and-uuid-coding-strategies">*</a></td>
</tr>
<tr>
<td><code>Type.databaseUUIDEncodingStrategy</code></td>
<td><a href="#persistablerecord-protocol">EncodableRecord</a></td>
<td style="text-align: center"><a href="#date-and-uuid-coding-strategies">*</a></td>
</tr>
<tr>
<td><strong>Define <a href="Documentation/AssociationsBasics.md">Associations</a></strong></td>
<td></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>Type.belongsTo(...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="Documentation/AssociationsBasics.md">*</a></td>
</tr>
<tr>
<td><code>Type.hasMany(...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="Documentation/AssociationsBasics.md">*</a></td>
</tr>
<tr>
<td><code>Type.hasOne(...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="Documentation/AssociationsBasics.md">*</a></td>
</tr>
<tr>
<td><code>Type.hasManyThrough(...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="Documentation/AssociationsBasics.md">*</a></td>
</tr>
<tr>
<td><code>Type.hasOneThrough(...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="Documentation/AssociationsBasics.md">*</a></td>
</tr>
<tr>
<td><strong>Building Query Interface <a href="#requests">Requests</a></strong></td>
<td></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.request(for:...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a> &amp; <a href="#persistablerecord-protocol">EncodableRecord</a></td>
<td style="text-align: center"><a href="Documentation/AssociationsBasics.md">*</a></td>
</tr>
<tr>
<td><code>Type.all()</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.none()</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.select(...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.select(..., as:...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.selectID()</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a> &amp; Identifiable</td>
<td style="text-align: center"><a href="#identifiable-records">*</a></td>
</tr>
<tr>
<td><code>Type.annotated(with:...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.filter(...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.filter(id:)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a> &amp; Identifiable</td>
<td style="text-align: center"><a href="#identifiable-records">*</a></td>
</tr>
<tr>
<td><code>Type.filter(ids:)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a> &amp; Identifiable</td>
<td style="text-align: center"><a href="#identifiable-records">*</a></td>
</tr>
<tr>
<td><code>Type.matching(...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.including(all:)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.including(optional:)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.including(required:)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.joining(optional:)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.joining(required:)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.group(...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.groupByPrimaryKey()</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.having(...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.order(...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.orderByPrimaryKey()</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.limit(...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><code>Type.with(...)</code></td>
<td><a href="#tablerecord-protocol">TableRecord</a></td>
<td style="text-align: center"><a href="#list-of-record-methods-2">²</a></td>
</tr>
<tr>
<td><strong><a href="#record-comparison">Record Comparison</a></strong></td>
<td></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.databaseEquals(...)</code></td>
<td><a href="#persistablerecord-protocol">EncodableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.databaseChanges(from:...)</code></td>
<td><a href="#persistablerecord-protocol">EncodableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.updateChanges(db, from:...)</code></td>
<td><a href="#persistablerecord-protocol">PersistableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.updateChanges(db) { ... }</code></td>
<td><a href="#persistablerecord-protocol">PersistableRecord</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.hasDatabaseChanges</code></td>
<td><a href="#record-class">Record</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.databaseChanges</code></td>
<td><a href="#record-class">Record</a></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td><code>record.updateChanges(db)</code></td>
<td><a href="#record-class">Record</a></td>
<td style="text-align: center"></td>
</tr>
</tbody></table>

<p><a name="list-of-record-methods-1">¹</a> All unique keys are supported: primary keys (single-column, composite, <a href="#the-implicit-rowid-primary-key">implicit RowID</a>) and unique indexes:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>                                <span class="c1">// Player?</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="p">[</span><span class="s">"email"</span><span class="p">:</span> <span class="s">"arthur@example.com"</span><span class="p">])</span> <span class="c1">// Player?</span>
<span class="k">try</span> <span class="kt">Country</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">keys</span><span class="p">:</span> <span class="p">[</span><span class="s">"FR"</span><span class="p">,</span> <span class="s">"US"</span><span class="p">])</span>                  <span class="c1">// [Country]</span>
</code></pre>

<p><a name="list-of-record-methods-2">²</a> See <a href="#requests">Fetch Requests</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">emailColumn</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">)</span><span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>  <span class="c1">// [Player]</span>
<span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>  <span class="c1">// Int</span>
</code></pre>

<p><a name="list-of-record-methods-3">³</a> See <a href="#fetch-queries">SQL queries</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM player WHERE id = ?"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">// Player?</span>
</code></pre>

<p><a name="list-of-record-methods-4">⁴</a> See <a href="#prepared-statements">Prepared Statements</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">statement</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">makeStatement</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM player WHERE id = ?"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1">// Player?</span>
</code></pre>
<h1 id='the-query-interface' class='heading'>The Query Interface</h1>

<p><strong>The query interface lets you write pure Swift instead of SQL:</strong></p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// Update database schema</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"wine"</span><span class="p">)</span> <span class="p">{</span> <span class="n">t</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>

    <span class="c1">// Fetch records</span>
    <span class="k">let</span> <span class="nv">wines</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Wine</span>
        <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">originColumn</span> <span class="o">==</span> <span class="s">"Burgundy"</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">priceColumn</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

    <span class="c1">// Count</span>
    <span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Wine</span>
        <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">colorColumn</span> <span class="o">==</span> <span class="kt">Color</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

    <span class="c1">// Update</span>
    <span class="k">try</span> <span class="kt">Wine</span>
        <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">originColumn</span> <span class="o">==</span> <span class="s">"Burgundy"</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">updateAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">priceColumn</span> <span class="o">*=</span> <span class="mf">0.75</span><span class="p">)</span>

    <span class="c1">// Delete</span>
    <span class="k">try</span> <span class="kt">Wine</span>
        <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">corkedColumn</span> <span class="o">==</span> <span class="kc">true</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>You need to open a <a href="#database-connections">database connection</a> before you can query the database.</p>

<p>Please bear in mind that the query interface can not generate all possible SQL queries. You may also <em>prefer</em> writing SQL, and this is just OK. From little snippets to full queries, your SQL skills are welcome:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// Update database schema (with SQL)</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"CREATE TABLE wine (...)"</span><span class="p">)</span>

    <span class="c1">// Fetch records (with SQL)</span>
    <span class="k">let</span> <span class="nv">wines</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Wine</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span>
        <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM wine WHERE origin = ? ORDER BY price"</span><span class="p">,</span>
        <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"Burgundy"</span><span class="p">])</span>

    <span class="c1">// Count (with an SQL snippet)</span>
    <span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Wine</span>
        <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"color = ?"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="kt">Color</span><span class="o">.</span><span class="n">red</span><span class="p">])</span>
        <span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

    <span class="c1">// Update (with SQL)</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE wine SET price = price * 0.75 WHERE origin = 'Burgundy'"</span><span class="p">)</span>

    <span class="c1">// Delete (with SQL)</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"DELETE FROM wine WHERE corked"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>So don&rsquo;t miss the <a href="#sqlite-api">SQL API</a>.</p>

<blockquote>
<p>:point_up: <strong>Note</strong>: the generated SQL may change between GRDB releases, without notice: don&rsquo;t have your application rely on any specific SQL output.</p>
</blockquote>

<ul>
<li><a href="#database-schema">Database Schema</a></li>
<li><a href="#requests">Requests</a></li>
<li><a href="#expressions">Expressions</a>

<ul>
<li><a href="#sql-operators">SQL Operators</a></li>
<li><a href="#sql-functions">SQL Functions</a></li>
</ul></li>
<li><a href="#embedding-sql-in-query-interface-requests">Embedding SQL in Query Interface Requests</a></li>
<li><a href="#fetching-from-requests">Fetching from Requests</a></li>
<li><a href="#fetching-by-key">Fetching by Key</a></li>
<li><a href="#testing-for-record-existence">Testing for Record Existence</a></li>
<li><a href="#fetching-aggregated-values">Fetching Aggregated Values</a></li>
<li><a href="#delete-requests">Delete Requests</a></li>
<li><a href="#update-requests">Update Requests</a></li>
<li><a href="#custom-requests">Custom Requests</a></li>
<li>:blue_book: <a href="Documentation/AssociationsBasics.md">Associations and Joins</a></li>
<li>:blue_book: <a href="Documentation/CommonTableExpressions.md">Common Table Expressions</a></li>
<li>:blue_book: <a href="Documentation/QueryInterfaceOrganization.md">Query Interface Organization</a></li>
</ul>
<h2 id='database-schema' class='heading'>Database Schema</h2>

<p>Once granted with a <a href="#database-connections">database connection</a>, you can setup your database schema without writing SQL:</p>

<ul>
<li><a href="#create-tables">Create Tables</a></li>
<li><a href="#modify-tables">Modify Tables</a></li>
<li><a href="#drop-tables">Drop Tables</a></li>
<li><a href="#create-indexes">Create Indexes</a></li>
</ul>
<h3 id='create-tables' class='heading'>Create Tables</h3>
<pre class="highlight swift"><code><span class="c1">// CREATE TABLE place (</span>
<span class="c1">//   id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="c1">//   title TEXT,</span>
<span class="c1">//   favorite BOOLEAN NOT NULL DEFAULT 0,</span>
<span class="c1">//   latitude DOUBLE NOT NULL,</span>
<span class="c1">//   longitude DOUBLE NOT NULL</span>
<span class="c1">// )</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"place"</span><span class="p">)</span> <span class="p">{</span> <span class="n">t</span> <span class="k">in</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">autoIncrementedPrimaryKey</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"title"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"favorite"</span><span class="p">,</span> <span class="o">.</span><span class="n">boolean</span><span class="p">)</span><span class="o">.</span><span class="nf">notNull</span><span class="p">()</span><span class="o">.</span><span class="nf">defaults</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="nf">notNull</span><span class="p">()</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="nf">notNull</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<p>The <code>create(table:)</code> method covers nearly all SQLite table creation features. For virtual tables, see <a href="Documentation/FullTextSearch.md">Full-Text Search</a>, or use raw SQL.</p>

<p>SQLite itself has many reference documents about table creation: <a href="https://www.sqlite.org/lang_createtable.html">CREATE TABLE</a>, <a href="https://www.sqlite.org/datatype3.html">Datatypes In SQLite Version 3</a>, <a href="https://www.sqlite.org/foreignkeys.html">SQLite Foreign Key Support</a>, <a href="https://www.sqlite.org/lang_conflict.html">ON CONFLICT</a>, <a href="https://www.sqlite.org/withoutrowid.html">The WITHOUT ROWID Optimization</a>.</p>

<p><strong>Configure table creation</strong>:</p>
<pre class="highlight swift"><code><span class="c1">// CREATE TABLE example ( ... )</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"example"</span><span class="p">)</span> <span class="p">{</span> <span class="n">t</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>

<span class="c1">// CREATE TEMPORARY TABLE example IF NOT EXISTS (</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"example"</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">temporary</span><span class="p">,</span> <span class="o">.</span><span class="n">ifNotExists</span><span class="p">])</span> <span class="p">{</span> <span class="n">t</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>
</code></pre>

<blockquote>
<p>:bulb: <strong>Tip</strong>: database table names should be singular, and camelCased. Make them look like Swift identifiers: <code>place</code>, <code>country</code>, <code>postalAddress</code>, <code>httpRequest</code>.</p>

<p>This will help you using <a href="Documentation/AssociationsBasics.md">Associations</a> when you need them. Database table names that follow another naming convention are totally OK, but you will need to perform extra configuration.</p>

<p>:point_up: <strong>Note</strong>: <a href="https://www.sqlite.org/withoutrowid.html"><code>WITHOUT ROWID</code></a> tables can not be tracked with <a href="#database-changes-observation">Database Observation</a> tools.</p>
</blockquote>

<p><strong>Add regular columns</strong> with their name and eventual type (<code>text</code>, <code>integer</code>, <code>double</code>, <code>real</code>, <code>numeric</code>, <code>boolean</code>, <code>blob</code>, <code>date</code>, <code>datetime</code> and <code>any</code>) - see <a href="https://www.sqlite.org/datatype3.html">SQLite data types</a>:</p>
<pre class="highlight swift"><code><span class="c1">// CREATE TABLE example (</span>
<span class="c1">//   a,</span>
<span class="c1">//   name TEXT,</span>
<span class="c1">//   creationDate DATETIME,</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"example"</span><span class="p">)</span> <span class="p">{</span> <span class="n">t</span> <span class="k">in</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"creationDate"</span><span class="p">,</span> <span class="o">.</span><span class="n">datetime</span><span class="p">)</span>
</code></pre>

<p>Define <strong>not null</strong> columns, and set <strong>default</strong> values:</p>
<pre class="highlight swift"><code>    <span class="c1">// email TEXT NOT NULL,</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"email"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="nf">notNull</span><span class="p">()</span>

    <span class="c1">// name TEXT NOT NULL DEFAULT 'Anonymous',</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="nf">notNull</span><span class="p">()</span><span class="o">.</span><span class="nf">defaults</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="s">"Anonymous"</span><span class="p">)</span>
</code></pre>

<p>Use an individual column as <strong>primary</strong>, <strong>unique</strong>, or <strong>foreign key</strong>. When defining a foreign key, the referenced column is the primary key of the referenced table (unless you specify otherwise):</p>
<pre class="highlight swift"><code>    <span class="c1">// id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">autoIncrementedPrimaryKey</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span>

    <span class="c1">// uuid TEXT PRIMARY KEY,</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"uuid"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="nf">primaryKey</span><span class="p">()</span>

    <span class="c1">// email TEXT UNIQUE,</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"email"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="nf">unique</span><span class="p">()</span>

    <span class="c1">// countryCode TEXT REFERENCES country(code) ON DELETE CASCADE,</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"countryCode"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="nf">references</span><span class="p">(</span><span class="s">"country"</span><span class="p">,</span> <span class="nv">onDelete</span><span class="p">:</span> <span class="o">.</span><span class="n">cascade</span><span class="p">)</span>
</code></pre>

<blockquote>
<p>:bulb: <strong>Tip</strong>: when you need an integer primary key that automatically generates unique values, it is highly recommended that you use the <code>autoIncrementedPrimaryKey</code> method:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"example"</span><span class="p">)</span> <span class="p">{</span> <span class="n">t</span> <span class="k">in</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">autoIncrementedPrimaryKey</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre>

<p>The reason for this recommendation is that auto-incremented primary keys prevent the reuse of ids. This prevents your app or <a href="#database-changes-observation">database observation tools</a> to think that a row was updated, when it was actually deleted, then replaced. Depending on your application needs, this may be acceptable. But usually it is not.</p>
</blockquote>

<p><strong>Create an index</strong> on the column:</p>
<pre class="highlight swift"><code>    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"score"</span><span class="p">,</span> <span class="o">.</span><span class="n">integer</span><span class="p">)</span><span class="o">.</span><span class="nf">indexed</span><span class="p">()</span>
</code></pre>

<p>For extra index options, see <a href="#create-indexes">Create Indexes</a> below.</p>

<p><strong>Perform integrity checks</strong> on individual columns, and SQLite will only let conforming rows in. In the example below, the <code>$0</code> closure variable is a column which lets you build any SQL <a href="#expressions">expression</a>.</p>
<pre class="highlight swift"><code>    <span class="c1">// name TEXT CHECK (LENGTH(name) &gt; 0)</span>
    <span class="c1">// score INTEGER CHECK (score &gt; 0)</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">check</span> <span class="p">{</span> <span class="nf">length</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">}</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"score"</span><span class="p">,</span> <span class="o">.</span><span class="n">integer</span><span class="p">)</span><span class="o">.</span><span class="nf">check</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"score &gt; 0"</span><span class="p">)</span>
</code></pre>

<p>Columns can also be defined with a raw sql String, or an <a href="Documentation/SQLInterpolation.md#sql-literal">SQL literal</a> in which you can safely embed raw values without any risk of syntax errors or SQL injection:</p>
<pre class="highlight swift"><code>    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"name TEXT"</span><span class="p">)</span>

    <span class="k">let</span> <span class="nv">defaultName</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="nv">literal</span><span class="p">:</span> <span class="s">"name TEXT DEFAULT </span><span class="se">\(</span><span class="n">defaultName</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
</code></pre>

<p>Other <strong>table constraints</strong> can involve several columns:</p>
<pre class="highlight swift"><code>    <span class="c1">// PRIMARY KEY (a, b),</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">primaryKey</span><span class="p">([</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">])</span>

    <span class="c1">// UNIQUE (a, b) ON CONFLICT REPLACE,</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">uniqueKey</span><span class="p">([</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">],</span> <span class="nv">onConflict</span><span class="p">:</span> <span class="o">.</span><span class="n">replace</span><span class="p">)</span>

    <span class="c1">// FOREIGN KEY (a, b) REFERENCES parents(c, d),</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">foreignKey</span><span class="p">([</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">],</span> <span class="nv">references</span><span class="p">:</span> <span class="s">"parents"</span><span class="p">)</span>

    <span class="c1">// CHECK (a + b &lt; 10),</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">check</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span> <span class="o">+</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"b"</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span>

    <span class="c1">// CHECK (a + b &lt; 10)</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">check</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"a + b &lt; 10"</span><span class="p">)</span>

    <span class="c1">// Raw SQL constraints</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">constraint</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"CHECK (a + b &lt; 10)"</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">constraint</span><span class="p">(</span><span class="nv">literal</span><span class="p">:</span> <span class="s">"CHECK (a + b &lt; </span><span class="se">\(</span><span class="mi">10</span><span class="se">)</span><span class="s">)"</span><span class="p">)</span>
</code></pre>

<p><a href="https://sqlite.org/gencol.html">Generated columns</a> are available with a <a href="Documentation/CustomSQLiteBuilds.md">custom SQLite build</a>:</p>
<pre class="highlight swift"><code>    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"totalScore"</span><span class="p">,</span> <span class="o">.</span><span class="n">integer</span><span class="p">)</span><span class="o">.</span><span class="nf">generatedAs</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"score + bonus"</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"totalScore"</span><span class="p">,</span> <span class="o">.</span><span class="n">integer</span><span class="p">)</span><span class="o">.</span><span class="nf">generatedAs</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">)</span> <span class="o">+</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"bonus"</span><span class="p">))</span>
<span class="p">}</span>
</code></pre>
<h3 id='modify-tables' class='heading'>Modify Tables</h3>

<p>SQLite lets you modify existing tables:</p>
<pre class="highlight swift"><code><span class="c1">// ALTER TABLE referer RENAME TO referrer</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">rename</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"referer"</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="s">"referrer"</span><span class="p">)</span>

<span class="c1">// ALTER TABLE player ADD COLUMN hasBonus BOOLEAN</span>
<span class="c1">// ALTER TABLE player RENAME COLUMN url TO homeURL</span>
<span class="c1">// ALTER TABLE player DROP COLUMN score</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">alter</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"player"</span><span class="p">)</span> <span class="p">{</span> <span class="n">t</span> <span class="k">in</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">column</span><span class="p">:</span> <span class="s">"hasBonus"</span><span class="p">,</span> <span class="o">.</span><span class="n">boolean</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">rename</span><span class="p">(</span><span class="nv">column</span><span class="p">:</span> <span class="s">"url"</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="s">"homeURL"</span><span class="p">)</span> <span class="c1">// SQLite 3.25+</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">drop</span><span class="p">(</span><span class="nv">column</span><span class="p">:</span> <span class="s">"score"</span><span class="p">)</span> <span class="c1">// SQLite 3.35+</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: SQLite restricts the possible table alterations, and may require you to recreate dependent triggers or views. See the documentation of the <a href="https://www.sqlite.org/lang_altertable.html">ALTER TABLE</a> for details. See <a href="Documentation/Migrations.md#advanced-database-schema-changes">Advanced Database Schema Changes</a> for a way to lift restrictions.</p>
</blockquote>
<h3 id='drop-tables' class='heading'>Drop Tables</h3>

<p>Drop tables with the <code>drop(table:)</code> method:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">drop</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"obsolete"</span><span class="p">)</span>
</code></pre>
<h3 id='create-indexes' class='heading'>Create Indexes</h3>

<p>Create indexes with the <code>create(index:)</code> method:</p>
<pre class="highlight swift"><code><span class="c1">// CREATE INDEX byName ON users(lastName, firstName)</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">index</span><span class="p">:</span> <span class="s">"byName"</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="s">"users"</span><span class="p">,</span> <span class="nv">columns</span><span class="p">:</span> <span class="p">[</span><span class="s">"lastName, "</span><span class="n">firstName</span><span class="s">"])

// CREATE UNIQUE INDEX byEmail IF NOT EXISTS ON users(email)
try db.create(index: "</span><span class="n">byEmail</span><span class="s">", on: "</span><span class="n">users</span><span class="s">", columns: ["</span><span class="n">email</span><span class="s">"], options: [.unique, .ifNotExists])
</span></code></pre>

<p>Relevant SQLite documentation:</p>

<ul>
<li><a href="https://www.sqlite.org/lang_createindex.html">CREATE INDEX</a></li>
<li><a href="https://www.sqlite.org/expridx.html">Indexes On Expressions</a></li>
<li><a href="https://www.sqlite.org/partialindex.html">Partial Indexes</a></li>
</ul>
<h2 id='requests' class='heading'>Requests</h2>

<p><strong>The query interface requests</strong> let you fetch values from the database:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">emailColumn</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">)</span><span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>  <span class="c1">// [Player]</span>
<span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>  <span class="c1">// Int</span>
</code></pre>

<p>Query interface requests usually start from <strong>a type</strong> that adopts the <code><a href="Protocols/TableRecord.html">TableRecord</a></code> protocol, such as a <code><a href="Classes/Record.html">Record</a></code> subclass (see <a href="#records">Records</a>):</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">Record</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="c1">// The request for all players:</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">all</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// [Player]</span>
</code></pre>

<p>When you can not use a record type, use <code><a href="Structs/Table.html">Table</a></code>:</p>
<pre class="highlight swift"><code><span class="c1">// The request for all rows from the player table:</span>
<span class="k">let</span> <span class="nv">table</span> <span class="o">=</span> <span class="kt">Table</span><span class="p">(</span><span class="s">"player"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="nf">all</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">rows</span> <span class="o">=</span> <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>    <span class="c1">// [Row]</span>

<span class="c1">// The request for all players from the player table:</span>
<span class="k">let</span> <span class="nv">table</span> <span class="o">=</span> <span class="kt">Table</span><span class="o">&lt;</span><span class="kt">Player</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"player"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="nf">all</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// [Player]</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: all examples in the documentation below use a record type, but you can always substitute a <code><a href="Structs/Table.html">Table</a></code> instead.</p>
</blockquote>

<p>Next, declare the table <strong>columns</strong> that you want to use for filtering, or sorting:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">idColumn</span> <span class="o">=</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">nameColumn</span> <span class="o">=</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span>
</code></pre>

<p>You can also declare column enums, if you prefer:</p>
<pre class="highlight swift"><code><span class="c1">// Columns.id and Columns.name can be used just as</span>
<span class="c1">// idColumn and nameColumn declared above.</span>
<span class="kd">enum</span> <span class="kt">Columns</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">ColumnExpression</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">id</span>
    <span class="k">case</span> <span class="n">name</span>
<span class="p">}</span>
</code></pre>

<p>You can now build requests with the following methods: <code>all</code>, <code>none</code>, <code>select</code>, <code>distinct</code>, <code>filter</code>, <code>matching</code>, <code>group</code>, <code>having</code>, <code>order</code>, <code>reversed</code>, <code>limit</code>, <code>joining</code>, <code>including</code>, <code>with</code>. All those methods return another request, which you can further refine by applying another method: <code>Player.select(...).filter(...).order(...)</code>.</p>

<ul>
<li><p><code>all()</code>, <code>none()</code>: the requests for all rows, or no row.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">all</span><span class="p">()</span>
</code></pre>

<p>By default, all columns are selected. See <a href="#columns-selected-by-a-request">Columns Selected by a Request</a>.</p></li>
<li><p><code>select(...)</code> and <code>select(..., as:)</code> define the selected columns. See <a href="#columns-selected-by-a-request">Columns Selected by a Request</a>.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT name FROM player</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">,</span> <span class="nv">as</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
</code></pre></li>
<li><p><code>selectID()</code> is available on <a href="#identifiable-records">Identifiable Records</a>. It supports all tables that have a single-column primary key:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT id FROM player</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">selectID</span><span class="p">()</span>

<span class="c1">// SELECT id FROM player WHERE name IS NOT NULL</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">nameColumn</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">)</span><span class="o">.</span><span class="nf">selectID</span><span class="p">()</span>
</code></pre></li>
<li><p><code>annotated(with: expression...)</code> extends the selection.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT *, (score + bonus) AS total FROM player</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">annotated</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="p">(</span><span class="n">scoreColumn</span> <span class="o">+</span> <span class="n">bonusColumn</span><span class="p">)</span><span class="o">.</span><span class="nf">forKey</span><span class="p">(</span><span class="s">"total"</span><span class="p">))</span>
</code></pre></li>
<li><p><code>annotated(with: aggregate)</code> extends the selection with <a href="Documentation/AssociationsBasics.md#association-aggregates">association aggregates</a>.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT team.*, COUNT(DISTINCT player.id) AS playerCount</span>
<span class="c1">// FROM team</span>
<span class="c1">// LEFT JOIN player ON player.teamId = team.id</span>
<span class="c1">// GROUP BY team.id</span>
<span class="kt">Team</span><span class="o">.</span><span class="nf">annotated</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="kt">Team</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
</code></pre></li>
<li><p><code>annotated(withRequired: association)</code> and <code>annotated(withOptional: association)</code> extends the selection with <a href="Documentation/AssociationsBasics.md">Associations</a>.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT player.*, team.color</span>
<span class="c1">// FROM player</span>
<span class="c1">// JOIN team ON team.id = player.teamId</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">annotated</span><span class="p">(</span><span class="nv">withRequired</span><span class="p">:</span> <span class="kt">Player</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">colorColumn</span><span class="p">))</span>
</code></pre></li>
<li><p><code>distinct()</code> performs uniquing.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT DISTINCT name FROM player</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">,</span> <span class="nv">as</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">)</span><span class="o">.</span><span class="nf">distinct</span><span class="p">()</span>
</code></pre></li>
<li><p><code>filter(expression)</code> applies conditions.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player WHERE id IN (1, 2, 3)</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">idColumn</span><span class="p">))</span>

<span class="c1">// SELECT * FROM player WHERE (name IS NOT NULL) AND (height &gt; 1.75)</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">nameColumn</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="n">heightColumn</span> <span class="o">&gt;</span> <span class="mf">1.75</span><span class="p">)</span>
</code></pre></li>
<li><p><code>filter(id:)</code> and <code>filter(ids:)</code> are type-safe methods available on <a href="#identifiable-records">Identifiable Records</a>:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player WHERE id = 1</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">// SELECT * FROM country WHERE isoCode IN ('FR', 'US')</span>
<span class="kt">Country</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">ids</span><span class="p">:</span> <span class="p">[</span><span class="s">"FR"</span><span class="p">,</span> <span class="s">"US"</span><span class="p">])</span>
</code></pre></li>
<li><p><code>filter(key:)</code> and <code>filter(keys:)</code> apply conditions on primary and unique keys:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player WHERE id = 1</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">// SELECT * FROM country WHERE isoCode IN ('FR', 'US')</span>
<span class="kt">Country</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">keys</span><span class="p">:</span> <span class="p">[</span><span class="s">"FR"</span><span class="p">,</span> <span class="s">"US"</span><span class="p">])</span>

<span class="c1">// SELECT * FROM citizenship WHERE citizenId = 1 AND countryCode = 'FR'</span>
<span class="kt">Citizenship</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="p">[</span><span class="s">"citizenId"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"countryCode"</span><span class="p">:</span> <span class="s">"FR"</span><span class="p">])</span>

<span class="c1">// SELECT * FROM player WHERE email = 'arthur@example.com'</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="p">[</span><span class="s">"email"</span><span class="p">:</span> <span class="s">"arthur@example.com"</span><span class="p">])</span>
</code></pre></li>
<li><p><code>matching(pattern)</code> performs <a href="Documentation/FullTextSearch.md">full-text search</a>.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM document WHERE document MATCH 'sqlite database'</span>
<span class="k">let</span> <span class="nv">pattern</span> <span class="o">=</span> <span class="kt">FTS3Pattern</span><span class="p">(</span><span class="nv">matchingAllTokensIn</span><span class="p">:</span> <span class="s">"SQLite database"</span><span class="p">)</span>
<span class="kt">Document</span><span class="o">.</span><span class="nf">matching</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
</code></pre>

<p>When the pattern is nil, no row will match.</p></li>
<li><p><code>group(expression, ...)</code> groups rows.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT name, MAX(score) FROM player GROUP BY name</span>
<span class="kt">Player</span>
    <span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">,</span> <span class="nf">max</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">))</span>
    <span class="o">.</span><span class="nf">group</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">)</span>
</code></pre></li>
<li><p><code>having(expression)</code> applies conditions on grouped rows.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT team, MAX(score) FROM player GROUP BY team HAVING MIN(score) &gt;= 1000</span>
<span class="kt">Player</span>
    <span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">teamColumn</span><span class="p">,</span> <span class="nf">max</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">))</span>
    <span class="o">.</span><span class="nf">group</span><span class="p">(</span><span class="n">teamColumn</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">having</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></li>
<li><p><code>having(aggregate)</code> applies conditions on grouped rows, according to an <a href="Documentation/AssociationsBasics.md#association-aggregates">association aggregate</a>.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT team.*</span>
<span class="c1">// FROM team</span>
<span class="c1">// LEFT JOIN player ON player.teamId = team.id</span>
<span class="c1">// GROUP BY team.id</span>
<span class="c1">// HAVING COUNT(DISTINCT player.id) &gt;= 5</span>
<span class="kt">Team</span><span class="o">.</span><span class="nf">having</span><span class="p">(</span><span class="kt">Team</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">)</span>
</code></pre></li>
<li><p><code>order(ordering, ...)</code> sorts.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player ORDER BY name</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">)</span>

<span class="c1">// SELECT * FROM player ORDER BY score DESC, name</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">scoreColumn</span><span class="o">.</span><span class="n">desc</span><span class="p">,</span> <span class="n">nameColumn</span><span class="p">)</span>
</code></pre>

<p>SQLite considers NULL values to be smaller than any other values for sorting purposes. Hence, NULLs naturally appear at the beginning of an ascending ordering and at the end of a descending ordering. With a <a href="Documentation/CustomSQLiteBuilds.md">custom SQLite build</a>, this can be changed using <code>.ascNullsLast</code> and <code>.descNullsFirst</code>:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player ORDER BY score ASC NULLS LAST</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">nameColumn</span><span class="o">.</span><span class="n">ascNullsLast</span><span class="p">)</span>
</code></pre>

<p>Each <code>order</code> call clears any previous ordering:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player ORDER BY name</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">)</span><span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">)</span>
</code></pre></li>
<li><p><code>reversed()</code> reverses the eventual orderings.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player ORDER BY score ASC, name DESC</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">scoreColumn</span><span class="o">.</span><span class="n">desc</span><span class="p">,</span> <span class="n">nameColumn</span><span class="p">)</span><span class="o">.</span><span class="nf">reversed</span><span class="p">()</span>
</code></pre>

<p>If no ordering was already specified, this method has no effect:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">all</span><span class="p">()</span><span class="o">.</span><span class="nf">reversed</span><span class="p">()</span>
</code></pre></li>
<li><p><code>limit(limit, offset: offset)</code> limits and pages results.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player LIMIT 5</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1">// SELECT * FROM player LIMIT 5 OFFSET 10</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nv">offset</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></li>
<li><p><code>joining(...)</code> and <code>including(...)</code> fetch and join records through <a href="Documentation/AssociationsBasics.md">Associations</a>.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT player.*, team.*</span>
<span class="c1">// FROM player</span>
<span class="c1">// JOIN team ON team.id = player.teamId</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">including</span><span class="p">(</span><span class="nv">required</span><span class="p">:</span> <span class="kt">Player</span><span class="o">.</span><span class="n">team</span><span class="p">)</span>
</code></pre></li>
<li><p><code>with(cte)</code> embeds a <a href="Documentation/CommonTableExpressions.md">common table expression</a>:</p>
<pre class="highlight swift"><code><span class="c1">// WITH ... SELECT * FROM player</span>
<span class="k">let</span> <span class="nv">cte</span> <span class="o">=</span> <span class="kt">CommonTableExpression</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">with</span><span class="p">(</span><span class="n">cte</span><span class="p">)</span>
</code></pre></li>
<li><p>Other requests that involve the primary key:</p>

<ul>
<li><p><code>orderByPrimaryKey()</code> sorts by primary key.</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player ORDER BY id</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">orderByPrimaryKey</span><span class="p">()</span>

<span class="c1">// SELECT * FROM country ORDER BY code</span>
<span class="kt">Country</span><span class="o">.</span><span class="nf">orderByPrimaryKey</span><span class="p">()</span>

<span class="c1">// SELECT * FROM citizenship ORDER BY citizenId, countryCode</span>
<span class="kt">Citizenship</span><span class="o">.</span><span class="nf">orderByPrimaryKey</span><span class="p">()</span>
</code></pre></li>
<li><p><code>groupByPrimaryKey()</code> groups rows by primary key.</p></li>
</ul></li>
</ul>

<p>You can refine requests by chaining those methods:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player WHERE (email IS NOT NULL) ORDER BY name</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">)</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">emailColumn</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">)</span>
</code></pre>

<p>The <code>select</code>, <code>order</code>, <code>group</code>, and <code>limit</code> methods ignore and replace previously applied selection, orderings, grouping, and limits. On the opposite, <code>filter</code>, <code>matching</code>, and <code>having</code> methods extend the query:</p>
<pre class="highlight swift"><code><span class="kt">Player</span>                          <span class="c1">// SELECT * FROM player</span>
    <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">nameColumn</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">)</span>  <span class="c1">// WHERE (name IS NOT NULL)</span>
    <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">emailColumn</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">)</span> <span class="c1">//        AND (email IS NOT NULL)</span>
    <span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">)</span>          <span class="c1">// - ignored -</span>
    <span class="o">.</span><span class="nf">reversed</span><span class="p">()</span>                 <span class="c1">// - ignored -</span>
    <span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">)</span>         <span class="c1">// ORDER BY score</span>
    <span class="o">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="nv">offset</span><span class="p">:</span> <span class="mi">40</span><span class="p">)</span>      <span class="c1">// - ignored -</span>
    <span class="o">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>                  <span class="c1">// LIMIT 10</span>
</code></pre>

<p>Raw SQL snippets are also accepted, with eventual <a href="http://groue.github.io/GRDB.swift/docs/5.21/Structs/StatementArguments.html">arguments</a>:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT DATE(creationDate), COUNT(*) FROM player WHERE name = 'Arthur' GROUP BY date(creationDate)</span>
<span class="kt">Player</span>
    <span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"DATE(creationDate), COUNT(*)"</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"name = ?"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"Arthur"</span><span class="p">])</span>
    <span class="o">.</span><span class="nf">group</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"DATE(creationDate)"</span><span class="p">)</span>
</code></pre>
<h3 id='columns-selected-by-a-request' class='heading'>Columns Selected by a Request</h3>

<p>By default, query interface requests select all columns:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player</span>
<span class="kd">struct</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">TableRecord</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">all</span><span class="p">()</span>

<span class="c1">// SELECT * FROM player</span>
<span class="k">let</span> <span class="nv">table</span> <span class="o">=</span> <span class="kt">Table</span><span class="p">(</span><span class="s">"player"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="nf">all</span><span class="p">()</span>
</code></pre>

<p><strong>The selection can be changed for each individual requests, or in the case of record-based requests, for all requests built from this record type.</strong></p>

<p>The <code>select(...)</code> and <code>select(..., as:)</code> methods change the selection of a single request (see <a href="#fetching-from-requests">Fetching from Requests</a> for detailed information):</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">)))</span>
<span class="k">let</span> <span class="nv">maxScore</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span> <span class="c1">// Int?</span>

<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">)),</span> <span class="nv">as</span><span class="p">:</span> <span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">maxScore</span> <span class="o">=</span> <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>      <span class="c1">// Int?</span>
</code></pre>

<p>The default selection for a record type is controlled by the <code>databaseSelection</code> property:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">RestrictedPlayer</span> <span class="p">:</span> <span class="kt">TableRecord</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">databaseTableName</span> <span class="o">=</span> <span class="s">"player"</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">databaseSelection</span><span class="p">:</span> <span class="p">[</span><span class="kt">SQLSelectable</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kt">Column</span><span class="p">(</span><span class="s">"id"</span><span class="p">),</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"name"</span><span class="p">)]</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">ExtendedPlayer</span> <span class="p">:</span> <span class="kt">TableRecord</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">databaseTableName</span> <span class="o">=</span> <span class="s">"player"</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">databaseSelection</span><span class="p">:</span> <span class="p">[</span><span class="kt">SQLSelectable</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kt">AllColumns</span><span class="p">(),</span> <span class="kt">Column</span><span class="o">.</span><span class="n">rowID</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1">// SELECT id, name FROM player</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">RestrictedPlayer</span><span class="o">.</span><span class="nf">all</span><span class="p">()</span>

<span class="c1">// SELECT *, rowid FROM player</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">ExtendedPlayer</span><span class="o">.</span><span class="nf">all</span><span class="p">()</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: make sure the <code>databaseSelection</code> property is explicitly declared as <code>[SQLSelectable]</code>. If it is not, the Swift compiler may silently miss the protocol requirement, resulting in sticky <code>SELECT *</code> requests. To verify your setup, see the <a href="#how-do-i-print-a-request-as-sql">How do I print a request as SQL?</a> FAQ.</p>
</blockquote>
<h2 id='expressions' class='heading'>Expressions</h2>

<p>Feed <a href="#requests">requests</a> with SQL expressions built from your Swift code:</p>
<h3 id='sql-operators' class='heading'>SQL Operators</h3>

<p>GRDB comes with a Swift version of many SQLite <a href="https://sqlite.org/lang_expr.html#operators">built-in operators</a>, listed below. But not all: see <a href="#embedding-sql-in-query-interface-requests">Embedding SQL in Query Interface Requests</a> for a way to add support for missing SQL operators.</p>

<ul>
<li><p><code>=</code>, <code>&lt;&gt;</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>IS</code>, <code>IS NOT</code></p>

<p>Comparison operators are based on the Swift operators <code>==</code>, <code>!=</code>, <code>===</code>, <code>!==</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player WHERE (name = 'Arthur')</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">nameColumn</span> <span class="o">==</span> <span class="s">"Arthur"</span><span class="p">)</span>

<span class="c1">// SELECT * FROM player WHERE (name IS NULL)</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">nameColumn</span> <span class="o">==</span> <span class="kc">nil</span><span class="p">)</span>

<span class="c1">// SELECT * FROM player WHERE (score IS 1000)</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">scoreColumn</span> <span class="o">===</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1">// SELECT * FROM rectangle WHERE width &lt; height</span>
<span class="kt">Rectangle</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">widthColumn</span> <span class="o">&lt;</span> <span class="n">heightColumn</span><span class="p">)</span>
</code></pre>

<p>Subqueries are supported:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player WHERE score = (SELECT max(score) FROM player)</span>
<span class="k">let</span> <span class="nv">maximumScore</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">))</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">scoreColumn</span> <span class="o">==</span> <span class="n">maximumScore</span><span class="p">)</span>

<span class="c1">// SELECT * FROM player WHERE score = (SELECT max(score) FROM player)</span>
<span class="k">let</span> <span class="nv">maximumScore</span> <span class="o">=</span> <span class="kt">SQLRequest</span><span class="p">(</span><span class="s">"SELECT max(score) FROM player"</span><span class="p">)</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">scoreColumn</span> <span class="o">==</span> <span class="n">maximumScore</span><span class="p">)</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: SQLite string comparison, by default, is case-sensitive and not Unicode-aware. See <a href="#string-comparison">string comparison</a> if you need more control.</p>
</blockquote></li>
<li><p><code>*</code>, <code>/</code>, <code>+</code>, <code>-</code></p>

<p>SQLite arithmetic operators are derived from their Swift equivalent:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT ((temperature * 1.8) + 32) AS fahrenheit FROM planet</span>
<span class="kt">Planet</span><span class="o">.</span><span class="nf">select</span><span class="p">((</span><span class="n">temperatureColumn</span> <span class="o">*</span> <span class="mf">1.8</span> <span class="o">+</span> <span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="nf">forKey</span><span class="p">(</span><span class="s">"fahrenheit"</span><span class="p">))</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: an expression like <code>nameColumn + &quot;rrr&quot;</code> will be interpreted by SQLite as a numerical addition (with funny results), not as a string concatenation. See the <code>concat</code> operator below.</p>
</blockquote>

<p>When you want to join a sequence of expressions with the <code>+</code> or <code>*</code> operator, use <code>joined(operator:)</code>:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT score + bonus + 1000 FROM player</span>
<span class="k">let</span> <span class="nv">values</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">scoreColumn</span><span class="p">,</span>
    <span class="n">bonusColumn</span><span class="p">,</span>
    <span class="mi">1000</span><span class="o">.</span><span class="n">databaseValue</span><span class="p">]</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="nf">joined</span><span class="p">(</span><span class="nv">operator</span><span class="p">:</span> <span class="o">.</span><span class="n">add</span><span class="p">))</span>
</code></pre>

<p>Note in the example above how you concatenate raw values: <code>1000.databaseValue</code>. A plain <code>1000</code> would not compile.</p>

<p>When the sequence is empty, <code>joined(operator: .add)</code> returns 0, and <code>joined(operator: .multiply)</code> returns 1.</p></li>
<li><p><code>||</code></p>

<p>Concatenate several strings:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT firstName || ' ' || lastName FROM player</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">([</span><span class="n">firstNameColumn</span><span class="p">,</span> <span class="s">" "</span><span class="o">.</span><span class="n">databaseValue</span><span class="p">,</span> <span class="n">lastNameColumn</span><span class="p">]</span><span class="o">.</span><span class="nf">joined</span><span class="p">(</span><span class="nv">operator</span><span class="p">:</span> <span class="o">.</span><span class="n">concat</span><span class="p">))</span>
</code></pre>

<p>Note in the example above how you concatenate raw strings: <code>&quot; &quot;.databaseValue</code>. A plain <code>&quot; &quot;</code> would not compile.</p>

<p>When the sequence is empty, <code>joined(operator: .concat)</code> returns the empty string.</p></li>
<li><p><code>AND</code>, <code>OR</code>, <code>NOT</code></p>

<p>The SQL logical operators are derived from the Swift <code>&amp;&amp;</code>, <code>||</code> and <code>!</code>:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player WHERE ((NOT verified) OR (score &lt; 1000))</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="n">verifiedColumn</span> <span class="o">||</span> <span class="n">scoreColumn</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre>

<p>When you want to join a sequence of expressions with the <code>AND</code> or <code>OR</code> operator, use <code>joined(operator:)</code>:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player WHERE (verified AND (score &gt;= 1000) AND (name IS NOT NULL))</span>
<span class="k">let</span> <span class="nv">conditions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">verifiedColumn</span><span class="p">,</span>
    <span class="n">scoreColumn</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">nameColumn</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">]</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">conditions</span><span class="o">.</span><span class="nf">joined</span><span class="p">(</span><span class="nv">operator</span><span class="p">:</span> <span class="o">.</span><span class="n">and</span><span class="p">))</span>
</code></pre>

<p>When the sequence is empty, <code>joined(operator: .and)</code> returns true, and <code>joined(operator: .or)</code> returns false:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player WHERE 1</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">([]</span><span class="o">.</span><span class="nf">joined</span><span class="p">(</span><span class="nv">operator</span><span class="p">:</span> <span class="o">.</span><span class="n">and</span><span class="p">))</span>

<span class="c1">// SELECT * FROM player WHERE 0</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">([]</span><span class="o">.</span><span class="nf">joined</span><span class="p">(</span><span class="nv">operator</span><span class="p">:</span> <span class="o">.</span><span class="n">or</span><span class="p">))</span>
</code></pre></li>
<li><p><code>BETWEEN</code>, <code>IN</code>, <code>NOT IN</code></p>

<p>To check inclusion in a Swift sequence (array, set, range…), call the <code>contains</code> method:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player WHERE id IN (1, 2, 3)</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">idColumn</span><span class="p">))</span>

<span class="c1">// SELECT * FROM player WHERE id NOT IN (1, 2, 3)</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">idColumn</span><span class="p">))</span>

<span class="c1">// SELECT * FROM player WHERE score BETWEEN 0 AND 1000</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">((</span><span class="mi">0</span><span class="o">...</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">))</span>

<span class="c1">// SELECT * FROM player WHERE (score &gt;= 0) AND (score &lt; 1000)</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">((</span><span class="mi">0</span><span class="o">..&lt;</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">))</span>

<span class="c1">// SELECT * FROM player WHERE initial BETWEEN 'A' AND 'N'</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">((</span><span class="s">"A"</span><span class="o">...</span><span class="s">"N"</span><span class="p">)</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">initialColumn</span><span class="p">))</span>

<span class="c1">// SELECT * FROM player WHERE (initial &gt;= 'A') AND (initial &lt; 'N')</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">((</span><span class="s">"A"</span><span class="o">..&lt;</span><span class="s">"N"</span><span class="p">)</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">initialColumn</span><span class="p">))</span>
</code></pre>

<p>To check inclusion inside a subquery, call the <code>contains</code> method as well:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player WHERE id IN (SELECT playerId FROM playerSelection)</span>
<span class="k">let</span> <span class="nv">selectedPlayerIds</span> <span class="o">=</span> <span class="kt">PlayerSelection</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">playerIdColumn</span><span class="p">)</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">selectedPlayerIds</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">idColumn</span><span class="p">))</span>

<span class="c1">// SELECT * FROM player WHERE id IN (SELECT playerId FROM playerSelection)</span>
<span class="k">let</span> <span class="nv">selectedPlayerIds</span> <span class="o">=</span> <span class="kt">SQLRequest</span><span class="p">(</span><span class="s">"SELECT playerId FROM playerSelection"</span><span class="p">)</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">selectedPlayerIds</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">idColumn</span><span class="p">))</span>
</code></pre>

<p>To check inclusion inside a <a href="Documentation/CommonTableExpressions.md">common table expression</a>, call the <code>contains</code> method as well:</p>
<pre class="highlight swift"><code><span class="c1">// WITH selectedName AS (...)</span>
<span class="c1">// SELECT * FROM player WHERE name IN selectedName</span>
<span class="k">let</span> <span class="nv">cte</span> <span class="o">=</span> <span class="kt">CommonTableExpression</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span> <span class="s">"selectedName"</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="kt">Player</span>
    <span class="o">.</span><span class="nf">with</span><span class="p">(</span><span class="n">cte</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">cte</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">))</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: SQLite string comparison, by default, is case-sensitive and not Unicode-aware. See <a href="#string-comparison">string comparison</a> if you need more control.</p>
</blockquote></li>
<li><p><code>EXISTS</code>, <code>NOT EXISTS</code></p>

<p>To check if a subquery would return rows, call the <code>exists</code> method:</p>
<pre class="highlight swift"><code><span class="c1">// Teams that have at least one other player</span>
<span class="c1">//</span>
<span class="c1">//  SELECT * FROM team</span>
<span class="c1">//  WHERE EXISTS (SELECT * FROM player WHERE teamID = team.id)</span>
<span class="k">let</span> <span class="nv">teamAlias</span> <span class="o">=</span> <span class="kt">TableAlias</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"teamID"</span><span class="p">)</span> <span class="o">==</span> <span class="n">teamAlias</span><span class="p">[</span><span class="kt">Column</span><span class="p">(</span><span class="s">"id"</span><span class="p">)])</span>
<span class="k">let</span> <span class="nv">teams</span> <span class="o">=</span> <span class="kt">Team</span><span class="o">.</span><span class="nf">aliased</span><span class="p">(</span><span class="n">teamAlias</span><span class="p">)</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="nf">exists</span><span class="p">())</span>

<span class="c1">// Teams that have no player</span>
<span class="c1">//</span>
<span class="c1">//  SELECT * FROM team</span>
<span class="c1">//  WHERE NOT EXISTS (SELECT * FROM player WHERE teamID = team.id)</span>
<span class="k">let</span> <span class="nv">teams</span> <span class="o">=</span> <span class="kt">Team</span><span class="o">.</span><span class="nf">aliased</span><span class="p">(</span><span class="n">teamAlias</span><span class="p">)</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="n">player</span><span class="o">.</span><span class="nf">exists</span><span class="p">())</span>
</code></pre>

<p>In the above example, you use a <code><a href="Classes/TableAlias.html">TableAlias</a></code> in order to let a subquery refer to a column from another table.</p>

<p>In the next example, which involves the same table twice, the table alias requires an explicit disambiguation with <code>TableAlias(name:)</code>:</p>
<pre class="highlight swift"><code><span class="c1">// Players who coach at least one other player</span>
<span class="c1">//</span>
<span class="c1">//  SELECT coach.* FROM player coach</span>
<span class="c1">//  WHERE EXISTS (SELECT * FROM player WHERE coachId = coach.id)</span>
<span class="k">let</span> <span class="nv">coachAlias</span> <span class="o">=</span> <span class="kt">TableAlias</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"coach"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">coachedPlayer</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"coachId"</span><span class="p">)</span> <span class="o">==</span> <span class="n">coachAlias</span><span class="p">[</span><span class="kt">Column</span><span class="p">(</span><span class="s">"id"</span><span class="p">)])</span>
<span class="k">let</span> <span class="nv">coaches</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">aliased</span><span class="p">(</span><span class="n">coachAlias</span><span class="p">)</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">coachedPlayer</span><span class="o">.</span><span class="nf">exists</span><span class="p">())</span>
</code></pre>

<p>Finally, subqueries can also be expressed as SQL, with <a href="Documentation/SQLInterpolation.md">SQL Interpolation</a>:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT coach.* FROM player coach</span>
<span class="c1">// WHERE EXISTS (SELECT * FROM player WHERE coachId = coach.id)</span>
<span class="k">let</span> <span class="nv">coachedPlayer</span> <span class="o">=</span> <span class="kt">SQLRequest</span><span class="p">(</span><span class="s">"SELECT * FROM player WHERE coachId = </span><span class="se">\(</span><span class="n">coachAlias</span><span class="p">[</span><span class="kt">Column</span><span class="p">(</span><span class="s">"id"</span><span class="p">)]</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">coaches</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">aliased</span><span class="p">(</span><span class="n">coachAlias</span><span class="p">)</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">coachedPlayer</span><span class="o">.</span><span class="nf">exists</span><span class="p">())</span>
</code></pre></li>
<li><p><code>LIKE</code></p>

<p>The SQLite LIKE operator is available as the <code>like</code> method:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player WHERE (email LIKE '%@example.com')</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">emailColumn</span><span class="o">.</span><span class="nf">like</span><span class="p">(</span><span class="s">"%@example.com"</span><span class="p">))</span>

<span class="c1">// SELECT * FROM book WHERE (title LIKE '%10\%%' ESCAPE '\')</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">emailColumn</span><span class="o">.</span><span class="nf">like</span><span class="p">(</span><span class="s">"%10</span><span class="se">\\</span><span class="s">%%"</span><span class="p">,</span> <span class="nv">escape</span><span class="p">:</span> <span class="s">"</span><span class="se">\\</span><span class="s">"</span><span class="p">))</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: the SQLite LIKE operator is case-insensitive but not Unicode-aware. For example, the expression <code>&#39;a&#39; LIKE &#39;A&#39;</code> is true but <code>&#39;æ&#39; LIKE &#39;Æ&#39;</code> is false.</p>
</blockquote></li>
<li><p><code>MATCH</code></p>

<p>The full-text MATCH operator is available through <a href="Documentation/FullTextSearch.md#fts3pattern">FTS3Pattern</a> (for FTS3 and FTS4 tables) and <a href="Documentation/FullTextSearch.md#fts5pattern">FTS5Pattern</a> (for FTS5):</p>

<p>FTS3 and FTS4:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">pattern</span> <span class="o">=</span> <span class="kt">FTS3Pattern</span><span class="p">(</span><span class="nv">matchingAllTokensIn</span><span class="p">:</span> <span class="s">"SQLite database"</span><span class="p">)</span>

<span class="c1">// SELECT * FROM document WHERE document MATCH 'sqlite database'</span>
<span class="kt">Document</span><span class="o">.</span><span class="nf">matching</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>

<span class="c1">// SELECT * FROM document WHERE content MATCH 'sqlite database'</span>
<span class="kt">Document</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">contentColumn</span><span class="o">.</span><span class="nf">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
</code></pre>

<p>FTS5:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">pattern</span> <span class="o">=</span> <span class="kt">FTS5Pattern</span><span class="p">(</span><span class="nv">matchingAllTokensIn</span><span class="p">:</span> <span class="s">"SQLite database"</span><span class="p">)</span>

<span class="c1">// SELECT * FROM document WHERE document MATCH 'sqlite database'</span>
<span class="kt">Document</span><span class="o">.</span><span class="nf">matching</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
</code></pre></li>
<li><p><code>AS</code></p>

<p>To give an alias to an expression, use the <code>forKey</code> method:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT (score + bonus) AS total</span>
<span class="c1">// FROM player</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">((</span><span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">)</span> <span class="o">+</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"bonus"</span><span class="p">))</span><span class="o">.</span><span class="nf">forKey</span><span class="p">(</span><span class="s">"total"</span><span class="p">))</span>
</code></pre>

<p>If you need to refer to this aliased column in another place of the request, use a detached column:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT (score + bonus) AS total</span>
<span class="c1">// FROM player </span>
<span class="c1">// ORDER BY total</span>
<span class="kt">Player</span>
    <span class="o">.</span><span class="nf">select</span><span class="p">((</span><span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">)</span> <span class="o">+</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"bonus"</span><span class="p">))</span><span class="o">.</span><span class="nf">forKey</span><span class="p">(</span><span class="s">"total"</span><span class="p">))</span>
    <span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"total"</span><span class="p">)</span><span class="o">.</span><span class="n">detached</span><span class="p">)</span>
</code></pre>

<p>Unlike <code>Column(&quot;total&quot;)</code>, the detached column <code>Column(&quot;total&quot;).detached</code> is never associated to the &quot;player&rdquo; table, so it is always rendered as <code>total</code> in the generated SQL, even when the request involves other tables via an <a href="Documentation/AssociationsBasics.md">association</a> or a <a href="Documentation/CommonTableExpressions.md">common table expression</a>.</p></li>
</ul>
<h3 id='sql-functions' class='heading'>SQL Functions</h3>

<p>GRDB comes with a Swift version of many SQLite <a href="https://sqlite.org/lang_corefunc.html">built-in functions</a>, listed below. But not all: see <a href="#embedding-sql-in-query-interface-requests">Embedding SQL in Query Interface Requests</a> for a way to add support for missing SQL functions.</p>

<ul>
<li><p><code>ABS</code>, <code>AVG</code>, <code>COUNT</code>, <code>DATETIME</code>, <code>JULIANDAY</code>, <code>LENGTH</code>, <code>MAX</code>, <code>MIN</code>, <code>SUM</code>, <code>TOTAL</code>:</p>

<p>Those are based on the <code>abs</code>, <code>average</code>, <code>count</code>, <code>dateTime</code>, <code>julianDay</code>, <code>length</code>, <code>max</code>, <code>min</code>, <code>sum</code> and <code>total</code> Swift functions:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT MIN(score), MAX(score) FROM player</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">),</span> <span class="nf">max</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">))</span>

<span class="c1">// SELECT COUNT(name) FROM player</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">count</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">))</span>

<span class="c1">// SELECT COUNT(DISTINCT name) FROM player</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">count</span><span class="p">(</span><span class="nv">distinct</span><span class="p">:</span> <span class="n">nameColumn</span><span class="p">))</span>

<span class="c1">// SELECT JULIANDAY(date, 'start of year') FROM game</span>
<span class="kt">Game</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">julianDay</span><span class="p">(</span><span class="n">dateColumn</span><span class="p">,</span> <span class="o">.</span><span class="n">startOfYear</span><span class="p">))</span>
</code></pre>

<p>For more information about the functions <code>dateTime</code> and <code>julianDay</code>, see <a href="https://www.sqlite.org/lang_datefunc.html">Date And Time Functions</a>.</p></li>
<li><p><code>IFNULL</code></p>

<p>Use the Swift <code>??</code> operator:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT IFNULL(name, 'Anonymous') FROM player</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">nameColumn</span> <span class="p">??</span> <span class="s">"Anonymous"</span><span class="p">)</span>

<span class="c1">// SELECT IFNULL(name, email) FROM player</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">nameColumn</span> <span class="p">??</span> <span class="n">emailColumn</span><span class="p">)</span>
</code></pre></li>
<li><p><code>LOWER</code>, <code>UPPER</code></p>

<p>The query interface does not give access to those SQLite functions. Nothing against them, but they are not unicode aware.</p>

<p>Instead, GRDB extends SQLite with SQL functions that call the Swift built-in string functions <code>capitalized</code>, <code>lowercased</code>, <code>uppercased</code>, <code>localizedCapitalized</code>, <code>localizedLowercased</code> and <code>localizedUppercased</code>:</p>
<pre class="highlight swift"><code><span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">nameColumn</span><span class="o">.</span><span class="nf">uppercased</span><span class="p">())</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: When <em>comparing</em> strings, you&rsquo;d rather use a <a href="#string-comparison">collation</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// Not recommended</span>
<span class="n">nameColumn</span><span class="o">.</span><span class="nf">uppercased</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span><span class="o">.</span><span class="nf">uppercased</span><span class="p">()</span>

<span class="c1">// Better</span>
<span class="n">nameColumn</span><span class="o">.</span><span class="nf">collating</span><span class="p">(</span><span class="o">.</span><span class="n">caseInsensitiveCompare</span><span class="p">)</span> <span class="o">==</span> <span class="n">name</span>
</code></pre>
</blockquote></li>
<li><p>Custom SQL functions and aggregates</p>

<p>You can apply your own <a href="#custom-functions-">custom SQL functions and aggregates</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">f</span> <span class="o">=</span> <span class="kt">DatabaseFunction</span><span class="p">(</span><span class="s">"f"</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

<span class="c1">// SELECT f(name) FROM player</span>
<span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="nf">apply</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">))</span>
</code></pre></li>
</ul>
<h2 id='embedding-sql-in-query-interface-requests' class='heading'>Embedding SQL in Query Interface Requests</h2>

<p>You will sometimes want to extend your query interface requests with SQL snippets. This can happen because GRDB does not provide a Swift interface for some SQL function or operator, or because you want to use an SQLite construct that GRDB does not support.</p>

<p>Support for extensibility is large, but not unlimited. All the SQL queries built by the query interface request have the shape below. <em>If you need something else, you&rsquo;ll have to use <a href="#sqlite-api">raw SQL requests</a>.</em></p>
<pre class="highlight sql"><code><span class="k">WITH</span> <span class="p">...</span>     <span class="c1">-- 1</span>
<span class="k">SELECT</span> <span class="p">...</span>   <span class="c1">-- 2</span>
<span class="k">FROM</span> <span class="p">...</span>     <span class="c1">-- 3</span>
<span class="k">JOIN</span> <span class="p">...</span>     <span class="c1">-- 4</span>
<span class="k">WHERE</span> <span class="p">...</span>    <span class="c1">-- 5</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="p">...</span> <span class="c1">-- 6</span>
<span class="k">HAVING</span> <span class="p">...</span>   <span class="c1">-- 7</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="p">...</span> <span class="c1">-- 8</span>
<span class="k">LIMIT</span> <span class="p">...</span>    <span class="c1">-- 9</span>
</code></pre>

<ol>
<li><p><code>WITH ...</code>: see <a href="Documentation/CommonTableExpressions.md">Common Table Expressions</a>.</p></li>
<li><p><code>SELECT ...</code></p>

<p>The selection can be provided as raw SQL:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT IFNULL(name, 'O''Brien'), score FROM player</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"IFNULL(name, 'O''Brien'), score"</span><span class="p">)</span>

<span class="c1">// SELECT IFNULL(name, 'O''Brien'), score FROM player</span>
<span class="k">let</span> <span class="nv">defaultName</span> <span class="o">=</span> <span class="s">"O'Brien"</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"IFNULL(name, ?), score"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="n">suffix</span><span class="p">])</span>
</code></pre>

<p>The selection can be provided with <a href="Documentation/SQLInterpolation.md">SQL Interpolation</a>:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT IFNULL(name, 'O''Brien'), score FROM player</span>
<span class="k">let</span> <span class="nv">defaultName</span> <span class="o">=</span> <span class="s">"O'Brien"</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nv">literal</span><span class="p">:</span> <span class="s">"IFNULL(name, </span><span class="se">\(</span><span class="n">defaultName</span><span class="se">)</span><span class="s">), score"</span><span class="p">)</span>
</code></pre>

<p>The selection can be provided with a mix of Swift and <a href="Documentation/SQLInterpolation.md">SQL Interpolation</a>:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT IFNULL(name, 'O''Brien') AS displayName, score FROM player</span>
<span class="k">let</span> <span class="nv">defaultName</span> <span class="o">=</span> <span class="s">"O'Brien"</span>
<span class="k">let</span> <span class="nv">displayName</span><span class="p">:</span> <span class="kt">SQL</span> <span class="o">=</span> <span class="s">"IFNULL(</span><span class="se">\(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span><span class="se">)</span><span class="s">, </span><span class="se">\(</span><span class="n">defaultName</span><span class="se">)</span><span class="s">) AS displayName"</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">displayName</span><span class="p">,</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">))</span>
</code></pre>

<p>When the custom SQL snippet should behave as a full-fledged expression, with support for the <code>+</code> Swift operator, the <code>forKey</code> aliasing method, and all other <a href="#sql-operators">SQL Operators</a>, build an <em>expression literal</em> with the <code><a href="Structs/SQL.html#/s:4GRDB3SQLV13sqlExpressionAA13SQLExpressionVvp">SQL.sqlExpression</a></code> method:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT IFNULL(name, 'O''Brien') AS displayName, score FROM player</span>
<span class="k">let</span> <span class="nv">defaultName</span> <span class="o">=</span> <span class="s">"O'Brien"</span>
<span class="k">let</span> <span class="nv">displayName</span> <span class="o">=</span> <span class="kt">SQL</span><span class="p">(</span><span class="s">"IFNULL(</span><span class="se">\(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span><span class="se">)</span><span class="s">, </span><span class="se">\(</span><span class="n">defaultName</span><span class="se">)</span><span class="s">)"</span><span class="p">)</span><span class="o">.</span><span class="n">sqlExpression</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">displayName</span><span class="o">.</span><span class="nf">forKey</span><span class="p">(</span><span class="s">"displayName"</span><span class="p">),</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">))</span>
</code></pre>

<p>Such expression literals allow you to build a reusable support library of SQL functions or operators that are missing from the query interface. For example, you can define a Swift <code>date</code> function:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">date</span><span class="p">(</span><span class="n">_</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">SQLSpecificExpressible</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">SQLExpression</span> <span class="p">{</span>
    <span class="kt">SQL</span><span class="p">(</span><span class="s">"DATE(</span><span class="se">\(</span><span class="n">value</span><span class="se">)</span><span class="s">)"</span><span class="p">)</span><span class="o">.</span><span class="n">sqlExpression</span>
<span class="p">}</span>

<span class="c1">// SELECT * FROM "player" WHERE DATE("createdAt") = '2020-01-23'</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nf">date</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"createdAt"</span><span class="p">))</span> <span class="o">==</span> <span class="s">"2020-01-23"</span><span class="p">)</span>
</code></pre>

<p>See the <a href="Documentation/QueryInterfaceOrganization.md">Query Interface Organization</a> for more information about <code><a href="Protocols/SQLSpecificExpressible.html">SQLSpecificExpressible</a></code> and <code><a href="Structs/SQLExpression.html">SQLExpression</a></code>.</p></li>
<li><p><code>FROM ...</code>: only one table is supported here. You can not customize this SQL part.</p></li>
<li><p><code>JOIN ...</code>: joins are fully controlled by <a href="Documentation/AssociationsBasics.md">Associations</a>. You can not customize this SQL part.</p></li>
<li><p><code>WHERE ...</code></p>

<p>The WHERE clause can be provided as raw SQL:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player WHERE score &gt;= 1000</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"score &gt;= 1000"</span><span class="p">)</span>

<span class="c1">// SELECT * FROM player WHERE score &gt;= 1000</span>
<span class="k">let</span> <span class="nv">minScore</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"score &gt;= ?"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="n">minScore</span><span class="p">])</span>
</code></pre>

<p>The WHERE clause can be provided with <a href="Documentation/SQLInterpolation.md">SQL Interpolation</a>:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player WHERE score &gt;= 1000</span>
<span class="k">let</span> <span class="nv">minScore</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">literal</span><span class="p">:</span> <span class="s">"score &gt;= </span><span class="se">\(</span><span class="n">minScore</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
</code></pre>

<p>The WHERE clause can be provided with a mix of Swift and <a href="Documentation/SQLInterpolation.md">SQL Interpolation</a>:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM player WHERE (score &gt;= 1000) AND (team = 'red')</span>
<span class="k">let</span> <span class="nv">minScore</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">let</span> <span class="nv">scoreCondition</span><span class="p">:</span> <span class="kt">SQL</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">)</span><span class="se">)</span><span class="s"> &gt;= </span><span class="se">\(</span><span class="n">minScore</span><span class="se">)</span><span class="s">"</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">scoreCondition</span> <span class="o">&amp;&amp;</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"team"</span><span class="p">)</span> <span class="o">==</span> <span class="s">"red"</span><span class="p">)</span>
</code></pre>

<p>See <code>SELECT ...</code> above for more SQL Interpolation examples.</p></li>
<li><p><code>GROUP BY ...</code></p>

<p>The GROUP BY clause can be provided as raw SQL, SQL Interpolation, or a mix of Swift and SQL Interpolation, just as the selection and the WHERE clause (see above).</p></li>
<li><p><code>HAVING ...</code></p>

<p>The HAVING clause can be provided as raw SQL, SQL Interpolation, or a mix of Swift and SQL Interpolation, just as the selection and the WHERE clause (see above).</p></li>
<li><p><code>ORDER BY ...</code></p>

<p>The ORDER BY clause can be provided as raw SQL, SQL Interpolation, or a mix of Swift and SQL Interpolation, just as the selection and the WHERE clause (see above).</p>

<p>In order to support the <code>desc</code> and <code>asc</code> query interface operators, and the <code>reversed()</code> query interface method, you must provide your orderings as <em>expression literals</em> with the <code><a href="Structs/SQL.html#/s:4GRDB3SQLV13sqlExpressionAA13SQLExpressionVvp">SQL.sqlExpression</a></code> method:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM "player" </span>
<span class="c1">// ORDER BY (score + bonus) ASC, name DESC</span>
<span class="k">let</span> <span class="nv">total</span> <span class="o">=</span> <span class="kt">SQL</span><span class="p">(</span><span class="s">"(score + bonus)"</span><span class="p">)</span><span class="o">.</span><span class="n">sqlExpression</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span>
    <span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">total</span><span class="o">.</span><span class="n">desc</span><span class="p">,</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"name"</span><span class="p">))</span>
    <span class="o">.</span><span class="nf">reversed</span><span class="p">()</span>
</code></pre></li>
<li><p><code>LIMIT ...</code>: use the <code>limit(_:offset:)</code> method. You can not customize this SQL part.</p></li>
</ol>
<h2 id='fetching-from-requests' class='heading'>Fetching from Requests</h2>

<p>Once you have a request, you can fetch the records at the origin of the request:</p>
<pre class="highlight swift"><code><span class="c1">// Some request based on `Player`</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">...</span> <span class="c1">// QueryInterfaceRequest&lt;Player&gt;</span>

<span class="c1">// Fetch players:</span>
<span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// A Cursor of Player</span>
<span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>    <span class="c1">// [Player]</span>
<span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchSet</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>    <span class="c1">// Set&lt;Player&gt;</span>
<span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>    <span class="c1">// Player?</span>
</code></pre>

<p>For example:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">allPlayers</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>                            <span class="c1">// [Player]</span>
<span class="k">let</span> <span class="nv">arthur</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">nameColumn</span> <span class="o">==</span> <span class="s">"Arthur"</span><span class="p">)</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// Player?</span>
</code></pre>

<p>See <a href="#fetching-methods">fetching methods</a> for information about the <code>fetchCursor</code>, <code>fetchAll</code>, <code>fetchSet</code> and <code>fetchOne</code> methods.</p>

<p><strong>You sometimes want to fetch other values</strong>.</p>

<p>The simplest way is to use the request as an argument to a fetching method of the desired type:</p>
<pre class="highlight swift"><code><span class="c1">// Fetch an Int</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">))</span>
<span class="k">let</span> <span class="nv">maxScore</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span> <span class="c1">// Int?</span>

<span class="c1">// Fetch a Row</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">),</span> <span class="nf">max</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">))</span>
<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span><span class="o">!</span>     <span class="c1">// Row</span>
<span class="k">let</span> <span class="nv">minScore</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Int</span><span class="p">?</span>
<span class="k">let</span> <span class="nv">maxScore</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Int</span><span class="p">?</span>
</code></pre>

<p>You can also change the request so that it knows the type it has to fetch:</p>

<ul>
<li><p>With <code>asRequest(of:)</code>, useful when you use <a href="Documentation/AssociationsBasics.md">Associations</a>:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">BookInfo</span><span class="p">:</span> <span class="kt">FetchableRecord</span><span class="p">,</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">book</span><span class="p">:</span> <span class="kt">Book</span>
    <span class="k">var</span> <span class="nv">author</span><span class="p">:</span> <span class="kt">Author</span>
<span class="p">}</span>

<span class="c1">// A request of BookInfo</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Book</span>
    <span class="o">.</span><span class="nf">including</span><span class="p">(</span><span class="nv">required</span><span class="p">:</span> <span class="kt">Book</span><span class="o">.</span><span class="n">author</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">asRequest</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="kt">BookInfo</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">bookInfos</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// [BookInfo]</span>
<span class="p">}</span>
</code></pre></li>
<li><p>With <code>select(..., as:)</code>, which is handy when you change the selection:</p>
<pre class="highlight swift"><code><span class="c1">// A request of Int</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">),</span> <span class="nv">as</span><span class="p">:</span> <span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">maxScore</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// Int?</span>
<span class="p">}</span>
</code></pre></li>
</ul>
<h2 id='fetching-by-key' class='heading'>Fetching by Key</h2>

<p><strong>Fetching records according to their primary key</strong> is a common task.</p>

<p><a href="#identifiable-records">Identifiable Records</a> can use the type-safe methods <code>fetchOne(_:id:)</code>, <code>fetchAll(_:ids:)</code> and <code>fetchSet(_:ids:)</code>:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>               <span class="c1">// Player?</span>
<span class="k">try</span> <span class="kt">Country</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">ids</span><span class="p">:</span> <span class="p">[</span><span class="s">"FR"</span><span class="p">,</span> <span class="s">"US"</span><span class="p">])</span>  <span class="c1">// [Countries]</span>
</code></pre>

<p>All record types can use <code>fetchOne(_:key:)</code>, <code>fetchAll(_:keys:)</code> and <code>fetchSet(_:keys:)</code> that apply conditions on primary and unique keys:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>              <span class="c1">// Player?</span>
<span class="k">try</span> <span class="kt">Country</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">keys</span><span class="p">:</span> <span class="p">[</span><span class="s">"FR"</span><span class="p">,</span> <span class="s">"US"</span><span class="p">])</span> <span class="c1">// [Country]</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="p">[</span><span class="s">"email"</span><span class="p">:</span> <span class="s">"arthur@example.com"</span><span class="p">])</span>            <span class="c1">// Player?</span>
<span class="k">try</span> <span class="kt">Citizenship</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="p">[</span><span class="s">"citizenId"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"countryCode"</span><span class="p">:</span> <span class="s">"FR"</span><span class="p">])</span> <span class="c1">// Citizenship?</span>
</code></pre>

<p>When the table has no explicit primary key, GRDB uses the <a href="#the-implicit-rowid-primary-key">hidden &ldquo;rowid&rdquo; column</a>:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT * FROM document WHERE rowid = 1</span>
<span class="k">try</span> <span class="kt">Document</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>            <span class="c1">// Document?</span>
</code></pre>

<p><strong>When you want to build a request and plan to fetch from it later</strong>, use a <code>filter</code> method:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Country</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">ids</span><span class="p">:</span> <span class="p">[</span><span class="s">"FR"</span><span class="p">,</span> <span class="s">"US"</span><span class="p">])</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="p">[</span><span class="s">"email"</span><span class="p">:</span> <span class="s">"arthur@example.com"</span><span class="p">])</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Citizenship</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="p">[</span><span class="s">"citizenId"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"countryCode"</span><span class="p">:</span> <span class="s">"FR"</span><span class="p">])</span>
</code></pre>
<h2 id='testing-for-record-existence' class='heading'>Testing for Record Existence</h2>

<p><strong>You can check if a request has matching rows in the database.</strong></p>
<pre class="highlight swift"><code><span class="c1">// Some request based on `Player`</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">...</span>

<span class="c1">// Check for player existence:</span>
<span class="k">let</span> <span class="nv">noSuchPlayer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">isEmpty</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// Bool</span>
</code></pre>

<p>You should check for emptiness instead of counting:</p>
<pre class="highlight swift"><code><span class="c1">// Correct</span>
<span class="k">let</span> <span class="nv">noSuchPlayer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
<span class="c1">// Even better</span>
<span class="k">let</span> <span class="nv">noSuchPlayer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">isEmpty</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre>

<p><strong>You can also check if a given primary or unique key exists in the database.</strong></p>

<p><a href="#identifiable-records">Identifiable Records</a> can use the type-safe method <code>exists(_:id:)</code>:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">try</span> <span class="kt">Country</span><span class="o">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="s">"FR"</span><span class="p">)</span>
</code></pre>

<p>All record types can use <code>exists(_:key:)</code> that can check primary and unique keys:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">try</span> <span class="kt">Country</span><span class="o">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="s">"FR"</span><span class="p">)</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="p">[</span><span class="s">"email"</span><span class="p">:</span> <span class="s">"arthur@example.com"</span><span class="p">])</span>
<span class="k">try</span> <span class="kt">Citizenship</span><span class="o">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="p">[</span><span class="s">"citizenId"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"countryCode"</span><span class="p">:</span> <span class="s">"FR"</span><span class="p">])</span>
</code></pre>

<p>You should check for key existence instead of fetching a record and checking for nil:</p>
<pre class="highlight swift"><code><span class="c1">// Correct</span>
<span class="k">let</span> <span class="nv">playerExists</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">nil</span>
<span class="c1">// Even better</span>
<span class="k">let</span> <span class="nv">playerExists</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
</code></pre>
<h2 id='fetching-aggregated-values' class='heading'>Fetching Aggregated Values</h2>

<p><strong>Requests can count.</strong> The <code>fetchCount()</code> method returns the number of rows that would be returned by a fetch request:</p>
<pre class="highlight swift"><code><span class="c1">// SELECT COUNT(*) FROM player</span>
<span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// Int</span>

<span class="c1">// SELECT COUNT(*) FROM player WHERE email IS NOT NULL</span>
<span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">emailColumn</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">)</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

<span class="c1">// SELECT COUNT(DISTINCT name) FROM player</span>
<span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">)</span><span class="o">.</span><span class="nf">distinct</span><span class="p">()</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

<span class="c1">// SELECT COUNT(*) FROM (SELECT DISTINCT name, score FROM player)</span>
<span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">,</span> <span class="n">scoreColumn</span><span class="p">)</span><span class="o">.</span><span class="nf">distinct</span><span class="p">()</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre>

<p><strong>Other aggregated values</strong> can also be selected and fetched (see <a href="#sql-functions">SQL Functions</a>):</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">))</span>
<span class="k">let</span> <span class="nv">maxScore</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span> <span class="c1">// Int?</span>

<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">),</span> <span class="nf">max</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">))</span>
<span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span><span class="o">!</span>     <span class="c1">// Row</span>
<span class="k">let</span> <span class="nv">minScore</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Int</span><span class="p">?</span>
<span class="k">let</span> <span class="nv">maxScore</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Int</span><span class="p">?</span>
</code></pre>
<h2 id='delete-requests' class='heading'>Delete Requests</h2>

<p><strong>Requests can delete records</strong>, with the <code>deleteAll()</code> method:</p>
<pre class="highlight swift"><code><span class="c1">// DELETE FROM player</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

<span class="c1">// DELETE FROM player WHERE team = 'red'</span>
<span class="k">try</span> <span class="kt">Player</span>
    <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">teamColumn</span> <span class="o">==</span> <span class="s">"red"</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

<span class="c1">// DELETE FROM player ORDER BY score LIMIT 10</span>
<span class="k">try</span> <span class="kt">Player</span>
    <span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">scoreColumn</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong> Deletion methods are available on types that adopt the <a href="#tablerecord-protocol">TableRecord</a> protocol, and <code><a href="Structs/Table.html">Table</a></code>:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">TableRecord</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>          <span class="c1">// Fine</span>
<span class="k">try</span> <span class="kt">Table</span><span class="p">(</span><span class="s">"player"</span><span class="p">)</span><span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// Just as fine</span>
</code></pre>
</blockquote>

<p><strong>Deleting records according to their primary key</strong> is a common task.</p>

<p><a href="#identifiable-records">Identifiable Records</a> can use the type-safe methods <code>deleteOne(_:id:)</code> and <code>deleteAll(_:ids:)</code>:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">deleteOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">try</span> <span class="kt">Country</span><span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">ids</span><span class="p">:</span> <span class="p">[</span><span class="s">"FR"</span><span class="p">,</span> <span class="s">"US"</span><span class="p">])</span>
</code></pre>

<p>All record types can use <code>deleteOne(_:key:)</code> and <code>deleteAll(_:keys:)</code> that apply conditions on primary and unique keys:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">deleteOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">try</span> <span class="kt">Country</span><span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">keys</span><span class="p">:</span> <span class="p">[</span><span class="s">"FR"</span><span class="p">,</span> <span class="s">"US"</span><span class="p">])</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">deleteOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="p">[</span><span class="s">"email"</span><span class="p">:</span> <span class="s">"arthur@example.com"</span><span class="p">])</span>
<span class="k">try</span> <span class="kt">Citizenship</span><span class="o">.</span><span class="nf">deleteOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="p">[</span><span class="s">"citizenId"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"countryCode"</span><span class="p">:</span> <span class="s">"FR"</span><span class="p">])</span>
</code></pre>

<p>When the table has no explicit primary key, GRDB uses the <a href="#the-implicit-rowid-primary-key">hidden &ldquo;rowid&rdquo; column</a>:</p>
<pre class="highlight swift"><code><span class="c1">// DELETE FROM document WHERE rowid = 1</span>
<span class="k">try</span> <span class="kt">Document</span><span class="o">.</span><span class="nf">deleteOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>             <span class="c1">// Document?</span>
</code></pre>
<h2 id='update-requests' class='heading'>Update Requests</h2>

<p><strong>Requests can batch update records</strong>. The <code>updateAll()</code> method accepts <em>column assignments</em> defined with the <code>set(to:)</code> method:</p>
<pre class="highlight swift"><code><span class="c1">// UPDATE player SET score = 0, isHealthy = 1, bonus = NULL</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">updateAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> 
    <span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">)</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="mi">0</span><span class="p">),</span> 
    <span class="kt">Column</span><span class="p">(</span><span class="s">"isHealthy"</span><span class="p">)</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kc">true</span><span class="p">),</span> 
    <span class="kt">Column</span><span class="p">(</span><span class="s">"bonus"</span><span class="p">)</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kc">nil</span><span class="p">))</span>

<span class="c1">// UPDATE player SET score = 0 WHERE team = 'red'</span>
<span class="k">try</span> <span class="kt">Player</span>
    <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"team"</span><span class="p">)</span> <span class="o">==</span> <span class="s">"red"</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">updateAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">)</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1">// UPDATE player SET top = 1 ORDER BY score DESC LIMIT 10</span>
<span class="k">try</span> <span class="kt">Player</span>
    <span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">)</span><span class="o">.</span><span class="n">desc</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">updateAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"top"</span><span class="p">)</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kc">true</span><span class="p">))</span>

<span class="c1">// UPDATE country SET population = 67848156 WHERE id = 'FR'</span>
<span class="k">try</span> <span class="kt">Country</span>
    <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"FR"</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">updateAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"population"</span><span class="p">)</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="mi">67_848_156</span><span class="p">))</span>
</code></pre>

<p>Column assignments accept any expression:</p>
<pre class="highlight swift"><code><span class="c1">// UPDATE player SET score = score + (bonus * 2)</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">updateAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">)</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">)</span> <span class="o">+</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"bonus"</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
</code></pre>

<p>As a convenience, you can also use the <code>+=</code>, <code>-=</code>, <code>*=</code>, or <code>/=</code> operators:</p>
<pre class="highlight swift"><code><span class="c1">// UPDATE player SET score = score + (bonus * 2)</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">updateAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">)</span> <span class="o">+=</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"bonus"</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</code></pre>

<p>Default <a href="#conflict-resolution">Conflict Resolution</a> rules apply, and you may also provide a specific one:</p>
<pre class="highlight swift"><code><span class="c1">// UPDATE OR IGNORE player SET ...</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">updateAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">onConflict</span><span class="p">:</span> <span class="o">.</span><span class="n">ignore</span><span class="p">,</span> <span class="cm">/* assignments... */</span><span class="p">)</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong> The <code>updateAll</code> method is available on types that adopt the <a href="#tablerecord-protocol">TableRecord</a> protocol, and <code><a href="Structs/Table.html">Table</a></code>:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">TableRecord</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">updateAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>          <span class="c1">// Fine</span>
<span class="k">try</span> <span class="kt">Table</span><span class="p">(</span><span class="s">"player"</span><span class="p">)</span><span class="o">.</span><span class="nf">updateAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span> <span class="c1">// Just as fine</span>
</code></pre>
</blockquote>
<h2 id='custom-requests' class='heading'>Custom Requests</h2>

<p>Until now, we have seen <a href="#requests">requests</a> created from any type that adopts the <a href="#tablerecord-protocol">TableRecord</a> protocol:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">all</span><span class="p">()</span>  <span class="c1">// QueryInterfaceRequest&lt;Player&gt;</span>
</code></pre>

<p>Those requests of type <code><a href="Structs/QueryInterfaceRequest.html">QueryInterfaceRequest</a></code> can fetch and count:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// A Cursor of Player</span>
<span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>    <span class="c1">// [Player]</span>
<span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchSet</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>    <span class="c1">// Set&lt;Player&gt;</span>
<span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>    <span class="c1">// Player?</span>
<span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>  <span class="c1">// Int</span>
</code></pre>

<p><strong>When the query interface can not generate the SQL you need</strong>, you can still fallback to <a href="#fetch-queries">raw SQL</a>:</p>
<pre class="highlight swift"><code><span class="c1">// Custom SQL is always welcome</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT ..."</span><span class="p">)</span>   <span class="c1">// [Player]</span>
</code></pre>

<p>But you may prefer to bring some elegance back in, and build custom requests:</p>
<pre class="highlight swift"><code><span class="c1">// No custom SQL in sight</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">customRequest</span><span class="p">()</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// [Player]</span>
</code></pre>

<p><strong>To build custom requests</strong>, you can use one of the built-in requests or derive requests from other requests.</p>

<ul>
<li><p><a href="http://groue.github.io/GRDB.swift/docs/5.21/Structs/SQLRequest.html">SQLRequest</a> is a fetch request built from raw SQL. For example:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">Player</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">color</span><span class="p">:</span> <span class="kt">Color</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">SQLRequest</span><span class="o">&lt;</span><span class="kt">Player</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kt">SQLRequest</span><span class="o">&lt;</span><span class="kt">Player</span><span class="o">&gt;</span><span class="p">(</span>
            <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM player WHERE color = ?"</span>
            <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="n">color</span><span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// [Player]</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">color</span><span class="p">:</span> <span class="o">.</span><span class="n">red</span><span class="p">)</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre>

<p>SQLRequest supports <a href="Documentation/SQLInterpolation.md">SQL Interpolation</a>:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">Player</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">color</span><span class="p">:</span> <span class="kt">Color</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">SQLRequest</span><span class="o">&lt;</span><span class="kt">Player</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="s">"SELECT * FROM player WHERE color = </span><span class="se">\(</span><span class="n">color</span><span class="se">)</span><span class="s">"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></li>
<li><p>The <code>asRequest(of:)</code> method changes the type fetched by the request. It is useful, for example, when you use <a href="Documentation/AssociationsBasics.md">Associations</a>:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">BookInfo</span><span class="p">:</span> <span class="kt">FetchableRecord</span><span class="p">,</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">book</span><span class="p">:</span> <span class="kt">Book</span>
    <span class="k">var</span> <span class="nv">author</span><span class="p">:</span> <span class="kt">Author</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Book</span>
    <span class="o">.</span><span class="nf">including</span><span class="p">(</span><span class="nv">required</span><span class="p">:</span> <span class="kt">Book</span><span class="o">.</span><span class="n">author</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">asRequest</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="kt">BookInfo</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>

<span class="c1">// [BookInfo]</span>
<span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre></li>
<li><p>The <code>adapted(_:)</code> method eases the consumption of complex rows with <a href="#row-adapters">row adapters</a>. See <a href="#joined-queries-support">Joined Queries Support</a> for some sample code that uses this method.</p></li>
<li><p><a href="http://groue.github.io/GRDB.swift/docs/5.21/Structs/AnyFetchRequest.html">AnyFetchRequest</a>: a type-erased request.</p></li>
</ul>
<h2 id='joined-queries-support' class='heading'>Joined Queries Support</h2>

<p><strong>GRDB helps consuming joined queries with complex selection.</strong></p>

<p>In this chapter, we will focus on the extraction of information from complex rows, such as the ones fetched by the query below:</p>
<pre class="highlight sql"><code><span class="c1">-- How to consume the left, middle, and right parts of those rows?</span>
<span class="k">SELECT</span> <span class="n">player</span><span class="p">.</span><span class="o">*</span><span class="p">,</span> <span class="n">team</span><span class="p">.</span><span class="o">*</span><span class="p">,</span> <span class="k">MAX</span><span class="p">(</span><span class="n">round</span><span class="p">.</span><span class="n">score</span><span class="p">)</span> <span class="k">AS</span> <span class="n">maxScore</span>
<span class="k">FROM</span> <span class="n">player</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">team</span> <span class="k">ON</span> <span class="p">...</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">round</span> <span class="k">ON</span> <span class="p">...</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="p">...</span>
</code></pre>

<p>We will not talk about the <em>generation</em> of joined queries, which is covered in <a href="Documentation/AssociationsBasics.md">Associations</a>.</p>

<p><strong>So what are we talking about?</strong></p>

<p>It is difficult to consume rows fetched from complex joined queries, because they often contain several columns with the same name: <code>id</code> from table <code>player</code>, <code>id</code> from table <code>team</code>, etc.</p>

<p>When such ambiguity happens, GRDB row accessors always favor the leftmost matching column. This means that <code>row[&quot;id&quot;]</code> would give a player id, without any obvious way to access the team id.</p>

<p>A classical technique to avoid this ambiguity is to give each column a unique name. For example:</p>
<pre class="highlight sql"><code><span class="c1">-- A classical technique</span>
<span class="k">SELECT</span> <span class="n">player</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">player_id</span><span class="p">,</span> <span class="n">player</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="n">player_name</span><span class="p">,</span> <span class="n">team</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">team_id</span><span class="p">,</span> <span class="n">team</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="n">team_name</span><span class="p">,</span> <span class="n">team</span><span class="p">.</span><span class="n">color</span> <span class="k">AS</span> <span class="n">team_color</span><span class="p">,</span> <span class="k">MAX</span><span class="p">(</span><span class="n">round</span><span class="p">.</span><span class="n">score</span><span class="p">)</span> <span class="k">AS</span> <span class="n">maxScore</span>
<span class="k">FROM</span> <span class="n">player</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">team</span> <span class="k">ON</span> <span class="p">...</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">round</span> <span class="k">ON</span> <span class="p">...</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="p">...</span>
</code></pre>

<p>This technique works pretty well, but it has three drawbacks:</p>

<ol>
<li>The selection becomes hard to read and understand.</li>
<li>Such queries are difficult to write by hand.</li>
<li>The mangled names are a <em>very</em> bad fit for <a href="#fetchablerecord-protocol">FetchableRecord</a> types that expect specific column names. After all, if the <code>Team</code> record type can read <code>SELECT * FROM team ...</code>, it should be able to read <code>SELECT ..., team.*, ...</code> as well.</li>
</ol>

<p>We thus need another technique. <strong>Below we&rsquo;ll see how to split rows into slices, and preserve column names.</strong></p>

<p><code>SELECT player.*, team.*, MAX(round.score) AS maxScore FROM ...</code> will be split into three slices: one that contains player&rsquo;s columns, one that contains team&rsquo;s columns, and a remaining slice that contains remaining column(s). The Player record type will be able to read the first slice, which contains the columns expected by the <code>Player.init(row:)</code> initializer. In the same way, the Team record type could read the second slice.</p>

<p>Unlike the name-mangling technique, splitting rows keeps SQL legible, accepts your hand-crafted SQL queries, and plays as nicely as possible with your existing <a href="#records">record types</a>.</p>

<ul>
<li><a href="#splitting-rows-an-introduction">Splitting Rows, an Introduction</a></li>
<li><a href="#splitting-rows-the-record-way">Splitting Rows, the Record Way</a></li>
<li><a href="#splitting-rows-the-codable-way">Splitting Rows, the Codable Way</a></li>
</ul>
<h3 id='splitting-rows-an-introduction' class='heading'>Splitting Rows, an Introduction</h3>

<p>Let&rsquo;s first write some introductory code, hoping that this chapter will make you understand how pieces fall together. We&rsquo;ll see <a href="#splitting-rows-the-record-way">later</a> how records will help us streamline the initial approach, how to track changes in joined requests, and how we can use the standard Decodable protocol.</p>

<p>To split rows, we will use <a href="#row-adapters">row adapters</a>. Row adapters adapt rows so that row consumers see exactly the columns they want. Among other things, row adapters can define several <em>row scopes</em> that give access to as many <em>row slices</em>. Sounds like a perfect match.</p>

<p>At the very beginning, there is an SQL query:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">sql</span> <span class="o">=</span> <span class="s">"""
        SELECT player.*, team.*, MAX(round.score) AS maxScore
        FROM player
        LEFT JOIN team ON ...
        LEFT JOIN round ON ...
        GROUP BY ...
        """</span>
</code></pre>

<p>We need an adapter that extracts player columns, in a slice that has as many columns as there are columns in the player table. That&rsquo;s <a href="#rangerowadapter">RangeRowAdapter</a>:</p>
<pre class="highlight swift"><code>    <span class="c1">// SELECT player.*, team.*, ...</span>
    <span class="c1">//        &lt;------&gt;</span>
    <span class="k">let</span> <span class="nv">playerWidth</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">columns</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="s">"player"</span><span class="p">)</span><span class="o">.</span><span class="n">count</span>
    <span class="k">let</span> <span class="nv">playerAdapter</span> <span class="o">=</span> <span class="kt">RangeRowAdapter</span><span class="p">(</span><span class="mi">0</span> <span class="o">..&lt;</span> <span class="n">playerWidth</span><span class="p">)</span>
</code></pre>

<p>We also need an adapter that extracts team columns:</p>
<pre class="highlight swift"><code>    <span class="c1">// SELECT player.*, team.*, ...</span>
    <span class="c1">//                  &lt;----&gt;</span>
    <span class="k">let</span> <span class="nv">teamWidth</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">columns</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="s">"team"</span><span class="p">)</span><span class="o">.</span><span class="n">count</span>
    <span class="k">let</span> <span class="nv">teamAdapter</span> <span class="o">=</span> <span class="kt">RangeRowAdapter</span><span class="p">(</span><span class="n">playerWidth</span> <span class="o">..&lt;</span> <span class="p">(</span><span class="n">playerWidth</span> <span class="o">+</span> <span class="n">teamWidth</span><span class="p">))</span>
</code></pre>

<p>We merge those two adapters in a single <a href="#scopeadapter">ScopeAdapter</a> that will allow us to access both sliced rows:</p>
<pre class="highlight swift"><code>    <span class="k">let</span> <span class="nv">playerScope</span> <span class="o">=</span> <span class="s">"player"</span>
    <span class="k">let</span> <span class="nv">teamScope</span> <span class="o">=</span> <span class="s">"team"</span>
    <span class="k">let</span> <span class="nv">adapter</span> <span class="o">=</span> <span class="kt">ScopeAdapter</span><span class="p">([</span>
        <span class="nv">playerScope</span><span class="p">:</span> <span class="n">playerAdapter</span><span class="p">,</span>
        <span class="nv">teamScope</span><span class="p">:</span> <span class="n">teamAdapter</span><span class="p">])</span>
</code></pre>

<p>And now we can fetch, and start consuming our rows. You already know <a href="#fetching-rows">row cursors</a>:</p>
<pre class="highlight swift"><code>    <span class="k">let</span> <span class="nv">rows</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="n">sql</span><span class="p">,</span> <span class="nv">adapter</span><span class="p">:</span> <span class="n">adapter</span><span class="p">)</span>
    <span class="k">while</span> <span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rows</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
</code></pre>

<p>From a fetched row, we can build a player:</p>
<pre class="highlight swift"><code>        <span class="k">let</span> <span class="nv">player</span><span class="p">:</span> <span class="kt">Player</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">playerScope</span><span class="p">]</span>
</code></pre>

<p>In the SQL query, the team is joined with the <code>LEFT JOIN</code> operator. This means that the team may be missing: its slice may contain team values, or it may only contain NULLs. When this happens, we don&rsquo;t want to build a Team record, and we thus load an <em>optional</em> Team:</p>
<pre class="highlight swift"><code>        <span class="k">let</span> <span class="nv">team</span><span class="p">:</span> <span class="kt">Team</span><span class="p">?</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">teamScope</span><span class="p">]</span>
</code></pre>

<p>And finally, we can load the maximum score, assuming that the &ldquo;maxScore&rdquo; column is not ambiguous:</p>
<pre class="highlight swift"><code>        <span class="k">let</span> <span class="nv">maxScore</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"maxScore"</span><span class="p">]</span>

        <span class="nf">print</span><span class="p">(</span><span class="s">"player: </span><span class="se">\(</span><span class="n">player</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"team: </span><span class="se">\(</span><span class="n">team</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"maxScore: </span><span class="se">\(</span><span class="n">maxScore</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>:bulb: In this chapter, we have learned:</p>

<ul>
<li>how to use <code><a href="Structs/RangeRowAdapter.html">RangeRowAdapter</a></code> to extract a specific table&rsquo;s columns into a <em>row slice</em>.</li>
<li>how to use <code><a href="Structs/ScopeAdapter.html">ScopeAdapter</a></code> to gives access to several row slices through named scopes.</li>
<li>how to use Row subscripting to extract records from rows, or optional records in order to deal with left joins.</li>
</ul>
</blockquote>
<h3 id='splitting-rows-the-record-way' class='heading'>Splitting Rows, the Record Way</h3>

<p>Our introduction above has introduced important techniques. It uses <a href="#row-adapters">row adapters</a> in order to split rows. It uses Row subscripting in order to extract records from row slices.</p>

<p>But we may want to make it more usable and robust:</p>

<ol>
<li>It&rsquo;s generally easier to consume records than raw rows.</li>
<li>Joined records not always need all columns from a table (see <code><a href="Protocols/TableRecord.html#/s:4GRDB11TableRecordP17databaseSelectionSayAA13SQLSelectable_pGvpZ">TableRecord.databaseSelection</a></code> in <a href="#columns-selected-by-a-request">Columns Selected by a Request</a>).</li>
<li>Building row adapters is long and error prone.</li>
</ol>

<p>To address the first bullet, let&rsquo;s define a record that holds our player, optional team, and maximum score. Since it can decode database rows, it adopts the <a href="#fetchablerecord-protocol">FetchableRecord</a> protocol:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">PlayerInfo</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">player</span><span class="p">:</span> <span class="kt">Player</span>
    <span class="k">var</span> <span class="nv">team</span><span class="p">:</span> <span class="kt">Team</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">maxScore</span><span class="p">:</span> <span class="kt">Int</span>
<span class="p">}</span>

<span class="c1">/// PlayerInfo can decode rows:</span>
<span class="kd">extension</span> <span class="kt">PlayerInfo</span><span class="p">:</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">enum</span> <span class="kt">Scopes</span> <span class="p">{</span>
        <span class="kd">static</span> <span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="s">"player"</span>
        <span class="kd">static</span> <span class="k">let</span> <span class="nv">team</span> <span class="o">=</span> <span class="s">"team"</span>
    <span class="p">}</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">row</span><span class="p">:</span> <span class="kt">Row</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">player</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="kt">Scopes</span><span class="o">.</span><span class="n">player</span><span class="p">]</span>
        <span class="n">team</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="kt">Scopes</span><span class="o">.</span><span class="n">team</span><span class="p">]</span>
        <span class="n">maxScore</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"maxScore"</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Now we write a method that returns a <a href="#custom-requests">custom request</a>, and then build the fetching method on top of that request:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">PlayerInfo</span> <span class="p">{</span>
    <span class="c1">/// The request for all player infos</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">all</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">AdaptedFetchRequest</span><span class="o">&lt;</span><span class="kt">SQLRequest</span><span class="o">&lt;</span><span class="kt">PlayerInfo</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
</code></pre>

<p>To acknowledge that both Player and Team records may customize their selection of the &ldquo;player&rdquo; and &ldquo;team&rdquo; columns, we&rsquo;ll write our SQL in a slightly different way:</p>
<pre class="highlight swift"><code>        <span class="c1">// Let Player and Team customize their selection:</span>
        <span class="k">let</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">SQLRequest</span><span class="o">&lt;</span><span class="kt">PlayerInfo</span><span class="o">&gt;</span> <span class="o">=</span> <span class="s">"""
            SELECT
                </span><span class="se">\(</span><span class="nv">columnsOf</span><span class="p">:</span> <span class="kt">Player</span><span class="o">.</span><span class="k">self</span><span class="se">)</span><span class="s">, -- instead of player.*
                </span><span class="se">\(</span><span class="nv">columnsOf</span><span class="p">:</span> <span class="kt">Team</span><span class="o">.</span><span class="k">self</span><span class="se">)</span><span class="s">,   -- instead of team.*
                MAX(round.score) AS maxScore
            FROM player
            LEFT JOIN team ON ...
            LEFT JOIN round ON ...
            GROUP BY ...
            """</span>
</code></pre>

<p>Our SQL is no longer a regular String, but an <code><a href="Structs/SQLRequest.html">SQLRequest&lt;PlayerInfo&gt;</a></code> which profits from <a href="Documentation/SQLInterpolation.md">SQL Interpolation</a>. Inside this request, <code>\(columnsOf: Player.self)</code> outputs <code>player.*</code>, unless Player defines a <a href="#columns-selected-by-a-request">customized selection</a>.</p>

<p>Now we need to build adapters.</p>

<p>We use the <code>splittingRowAdapters</code> global function, whose job is precisely to build row adapters of desired widths:</p>

<p>And since counting table columns require a database connection, we use the <code>adapted(_:)</code> request method. It allows requests to adapt themselves right before execution, when a database connection is available.</p>
<pre class="highlight swift"><code>        <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">adapted</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">adapters</span> <span class="o">=</span> <span class="k">try</span> <span class="nf">splittingRowAdapters</span><span class="p">(</span><span class="nv">columnCounts</span><span class="p">:</span> <span class="p">[</span>
                <span class="kt">Player</span><span class="o">.</span><span class="nf">numberOfSelectedColumns</span><span class="p">(</span><span class="n">db</span><span class="p">),</span>
                <span class="kt">Team</span><span class="o">.</span><span class="nf">numberOfSelectedColumns</span><span class="p">(</span><span class="n">db</span><span class="p">)])</span>
            <span class="k">return</span> <span class="kt">ScopeAdapter</span><span class="p">([</span>
                <span class="kt">Scopes</span><span class="o">.</span><span class="nv">player</span><span class="p">:</span> <span class="n">adapters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="kt">Scopes</span><span class="o">.</span><span class="nv">team</span><span class="p">:</span> <span class="n">adapters</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: <code>splittingRowAdapters</code> returns as many adapters as necessary to fully split a row. In the example above, it returns <em>three</em> adapters: one for player, one for team, and one for the remaining columns.</p>
</blockquote>

<p>And finally, we can define the fetching method:</p>
<pre class="highlight swift"><code>    <span class="c1">/// Fetches all player infos</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">fetchAll</span><span class="p">(</span><span class="n">_</span> <span class="nv">db</span><span class="p">:</span> <span class="kt">Database</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">PlayerInfo</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">try</span> <span class="nf">all</span><span class="p">()</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>And when your app needs to fetch player infos, it now reads:</p>
<pre class="highlight swift"><code><span class="c1">// Fetch player infos</span>
<span class="k">let</span> <span class="nv">playerInfos</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">PlayerInfo</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>:bulb: In this chapter, we have learned:</p>

<ul>
<li>how to define a <code><a href="Protocols/FetchableRecord.html">FetchableRecord</a></code> record that consumes rows fetched from a joined query.</li>
<li>how to use <a href="Documentation/SQLInterpolation.md">SQL Interpolation</a> and <code>numberOfSelectedColumns</code> in order to deal with nested record types that define custom selection.</li>
<li>how to use <code>splittingRowAdapters</code> in order to streamline the definition of row slices.</li>
<li>how to gather all relevant methods and constants in a record type, fully responsible of its relationship with the database.</li>
</ul>
</blockquote>
<h3 id='splitting-rows-the-codable-way' class='heading'>Splitting Rows, the Codable Way</h3>

<p><a href="#codable-records">Codable Records</a> build on top of the standard Decodable protocol in order to decode database rows.</p>

<p>You can consume complex joined queries with Codable records as well. As a demonstration, we&rsquo;ll rewrite the <a href="#splitting-rows-the-record-way">above</a> sample code:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">Decodable</span><span class="p">,</span> <span class="kt">FetchableRecord</span><span class="p">,</span> <span class="kt">TableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int64</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
<span class="kd">struct</span> <span class="kt">Team</span><span class="p">:</span> <span class="kt">Decodable</span><span class="p">,</span> <span class="kt">FetchableRecord</span><span class="p">,</span> <span class="kt">TableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int64</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">color</span><span class="p">:</span> <span class="kt">Color</span>
<span class="p">}</span>
<span class="kd">struct</span> <span class="kt">PlayerInfo</span><span class="p">:</span> <span class="kt">Decodable</span><span class="p">,</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">player</span><span class="p">:</span> <span class="kt">Player</span>
    <span class="k">var</span> <span class="nv">team</span><span class="p">:</span> <span class="kt">Team</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">maxScore</span><span class="p">:</span> <span class="kt">Int</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">PlayerInfo</span> <span class="p">{</span>
    <span class="c1">/// The request for all player infos</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">all</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">AdaptedFetchRequest</span><span class="o">&lt;</span><span class="kt">SQLRequest</span><span class="o">&lt;</span><span class="kt">PlayerInfo</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">SQLRequest</span><span class="o">&lt;</span><span class="kt">PlayerInfo</span><span class="o">&gt;</span> <span class="o">=</span> <span class="s">"""
            SELECT
                </span><span class="se">\(</span><span class="nv">columnsOf</span><span class="p">:</span> <span class="kt">Player</span><span class="o">.</span><span class="k">self</span><span class="se">)</span><span class="s">,
                </span><span class="se">\(</span><span class="nv">columnsOf</span><span class="p">:</span> <span class="kt">Team</span><span class="o">.</span><span class="k">self</span><span class="se">)</span><span class="s">,
                MAX(round.score) AS maxScore
            FROM player
            LEFT JOIN team ON ...
            LEFT JOIN round ON ...
            GROUP BY ...
            """</span>
        <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">adapted</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">adapters</span> <span class="o">=</span> <span class="k">try</span> <span class="nf">splittingRowAdapters</span><span class="p">(</span><span class="nv">columnCounts</span><span class="p">:</span> <span class="p">[</span>
                <span class="kt">Player</span><span class="o">.</span><span class="nf">numberOfSelectedColumns</span><span class="p">(</span><span class="n">db</span><span class="p">),</span>
                <span class="kt">Team</span><span class="o">.</span><span class="nf">numberOfSelectedColumns</span><span class="p">(</span><span class="n">db</span><span class="p">)])</span>
            <span class="k">return</span> <span class="kt">ScopeAdapter</span><span class="p">([</span>
                <span class="kt">CodingKeys</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="nv">stringValue</span><span class="p">:</span> <span class="n">adapters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="kt">CodingKeys</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="nv">stringValue</span><span class="p">:</span> <span class="n">adapters</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// Fetches all player infos</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">fetchAll</span><span class="p">(</span><span class="n">_</span> <span class="nv">db</span><span class="p">:</span> <span class="kt">Database</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">PlayerInfo</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">try</span> <span class="nf">all</span><span class="p">()</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Fetch player infos</span>
<span class="k">let</span> <span class="nv">playerInfos</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">PlayerInfo</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>:bulb: In this chapter, we have learned how to use the <code>Decodable</code> protocol and its associated <code>CodingKeys</code> enum in order to dry up our code.</p>
</blockquote>
<h1 id='database-changes-observation' class='heading'>Database Changes Observation</h1>

<p><strong>SQLite notifies its host application of changes performed to the database, as well of transaction commits and rollbacks.</strong></p>

<p>GRDB puts this SQLite feature to some good use, and lets you observe the database in various ways:</p>

<ul>
<li><a href="#after-commit-hook">After Commit Hook</a>: Handle successful transactions one by one.</li>
<li><a href="#valueobservation">ValueObservation</a>: Track changes of database values.</li>
<li><a href="#databaseregionobservation">DatabaseRegionObservation</a>: Tracking transactions that impact a database region.</li>
<li><a href="#transactionobserver-protocol">TransactionObserver Protocol</a>: Low-level database observation.</li>
<li>:blue_book: <a href="Documentation/Combine.md">Combine Support</a>: Automated tracking of database changes, with <a href="https://developer.apple.com/documentation/combine">Combine</a>.</li>
<li>:blue_book: <a href="http://github.com/RxSwiftCommunity/RxGRDB">RxGRDB</a>: Automated tracking of database changes, with <a href="https://github.com/ReactiveX/RxSwift">RxSwift</a>.</li>
</ul>

<p>Database observation requires that a single <a href="#database-queues">database queue</a> or <a href="#database-pools">pool</a> is kept open for all the duration of the database usage.</p>
<h2 id='after-commit-hook' class='heading'>After Commit Hook</h2>

<p>When your application needs to make sure a specific database transaction has been successfully committed before it executes some work, use the <code><a href="Classes/Database.html#/s:4GRDB8DatabaseC26afterNextTransactionCommityyyACcF">Database.afterNextTransactionCommit(_:)</a></code> method.</p>

<p>Its closure argument is called right after database changes have been successfully written to disk:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="n">db</span><span class="o">.</span><span class="n">afterNextTransactionCommit</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"success"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="o">...</span>
<span class="p">}</span> <span class="c1">// prints "success"</span>
</code></pre>

<p>The closure runs in a protected dispatch queue, serialized with all database updates.</p>

<p><strong>This &ldquo;after commit hook&rdquo; helps synchronizing the database with other resources, such as files, or system sensors.</strong></p>

<p>In the example below, a <a href="https://developer.apple.com/documentation/corelocation/cllocationmanager">location manager</a> starts monitoring a CLRegion if and only if it has successfully been stored in the database:</p>
<pre class="highlight swift"><code><span class="c1">/// Inserts a region in the database, and start monitoring upon</span>
<span class="c1">/// successful insertion.</span>
<span class="kd">func</span> <span class="nf">startMonitoring</span><span class="p">(</span><span class="n">_</span> <span class="nv">db</span><span class="p">:</span> <span class="kt">Database</span><span class="p">,</span> <span class="nv">region</span><span class="p">:</span> <span class="kt">CLRegion</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="c1">// Make sure database is inside a transaction</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="n">inSavepoint</span> <span class="p">{</span>

        <span class="c1">// Save the region in the database</span>
        <span class="k">try</span> <span class="nf">insert</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

        <span class="c1">// Start monitoring if and only if the insertion is</span>
        <span class="c1">// eventually committed</span>
        <span class="n">db</span><span class="o">.</span><span class="n">afterNextTransactionCommit</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
            <span class="c1">// locationManager prefers the main queue:</span>
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
                <span class="n">locationManager</span><span class="o">.</span><span class="nf">startMonitoring</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">region</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="o">.</span><span class="n">commit</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The method above won&rsquo;t trigger the location manager if the transaction is eventually rollbacked (explicitly, or because of an error), as in the sample code below:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// success</span>
    <span class="k">try</span> <span class="nf">startMonitoring</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>

    <span class="c1">// On error, the transaction is rollbacked, the region is not inserted, and</span>
    <span class="c1">// the location manager is not invoked.</span>
    <span class="k">try</span> <span class="nf">failableMethod</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<h2 id='valueobservation' class='heading'>ValueObservation</h2>

<p><strong>ValueObservation tracks changes in database values</strong>. It automatically notifies your application with fresh values whenever changes are committed in the database.</p>

<p>Tracked changes are insertions, updates, and deletions that impact the tracked value, performed with the <a href="#the-query-interface">query interface</a>, or <a href="#sqlite-api">raw SQL</a>. This includes indirect changes triggered by <a href="https://www.sqlite.org/foreignkeys.html#fk_actions">foreign keys actions</a> or <a href="https://www.sqlite.org/lang_createtrigger.html">SQL triggers</a>.</p>

<blockquote>
<p>:point_up: <strong>Note</strong>: Some changes are not notified: changes to internal system tables (such as <code>sqlite\_master</code>), and changes to <a href="https://www.sqlite.org/withoutrowid.html"><code>WITHOUT ROWID</code></a> tables.</p>
</blockquote>

<p><strong>ValueObservation is the preferred GRDB tool for keeping your user interface synchronized with the database.</strong> See the <a href="Documentation/DemoApps">Demo Applications</a> for sample code.</p>

<ul>
<li><a href="#valueobservation-usage">ValueObservation Usage</a></li>
<li><a href="#valueobservation-scheduling">ValueObservation Scheduling</a></li>
<li><a href="#valueobservation-operators">ValueObservation Operators</a>: <a href="#valueobservationmap">map</a>, <a href="#valueobservationremoveduplicates">removeDuplicates</a>, &hellip;</li>
<li><a href="#valueobservation-sharing">ValueObservation Sharing</a></li>
<li><a href="#specifying-the-region-tracked-by-valueobservation">Specifying the Region Tracked by ValueObservation</a></li>
<li><a href="#valueobservation-performance">ValueObservation Performance</a></li>
<li>:blue_book: <a href="Documentation/Combine.md#database-observation">Combine Publisher</a></li>
</ul>
<h3 id='valueobservation-usage' class='heading'>ValueObservation Usage</h3>

<ol>
<li><p>Make sure that a unique <a href="#database-connections">database connection</a> is kept open during the whole duration of the observation.</p>

<p>ValueObservation does not notify changes performed by external connections.</p></li>
<li><p>Define a ValueObservation by providing a function that fetches the observed value.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="cm">/* fetch and return the observed value */</span>
<span class="p">}</span>

<span class="c1">// For example, an observation of [Player], which tracks all players:</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// The same observation, using shorthand notation:</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="nf">tracking</span><span class="p">(</span><span class="kt">Player</span><span class="o">.</span><span class="n">fetchAll</span><span class="p">)</span>
</code></pre>

<p>The observation can perform multiple requests, from multiple database tables, and even use raw SQL.</p>

<details>
    <summary>Example of a more complex ValueObservation</summary>

&ldquo;`swift
struct HallOfFame {
    var totalPlayerCount: Int
    var bestPlayers: [Player]
}

// An observation of HallOfFame
let observation = ValueObservation.tracking { db -> HallOfFame in
    let totalPlayerCount = try Player.fetchCount(db)

    let bestPlayers = try Player
        .order(Column(&quot;score&rdquo;).desc)
        .limit(10)
        .fetchAll(db)

    return HallOfFame(
        totalPlayerCount: totalPlayerCount,
        bestPlayers: bestPlayers)
}
&ldquo;`

</details>

<details>
    <summary>Example of a SQL ValueObservation</summary>

&rdquo;`swift
// An observation of the maximum score
let observation = ValueObservation.tracking { db in
    try Int.fetchOne(db, sql: &ldquo;SELECT MAX(score) FROM player&rdquo;)
}
&ldquo;`

</details></li>
<li><p>Start the observation in order to be notified of changes:</p>
<pre class="highlight swift"><code><span class="c1">// Start observing the database</span>
<span class="k">let</span> <span class="nv">cancellable</span><span class="p">:</span> <span class="kt">DatabaseCancellable</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span>
    <span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">,</span> <span class="c1">// or dbPool</span>
    <span class="nv">onError</span><span class="p">:</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span> <span class="nf">print</span><span class="p">(</span><span class="s">"players could not be fetched"</span><span class="p">)</span> <span class="p">},</span>
    <span class="nv">onChange</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">players</span><span class="p">:</span> <span class="p">[</span><span class="kt">Player</span><span class="p">])</span> <span class="k">in</span> <span class="nf">print</span><span class="p">(</span><span class="s">"fresh players"</span><span class="p">,</span> <span class="n">players</span><span class="p">)</span> <span class="p">})</span>
</code></pre></li>
<li><p>Stop the observation by calling the <code>cancel()</code> method on the object returned by the <code>start</code> method. Cancellation is automatic when the cancellable is deinitialized:</p>
<pre class="highlight swift"><code><span class="n">cancellable</span><span class="o">.</span><span class="nf">cancel</span><span class="p">()</span>
</code></pre></li>
</ol>

<p><strong>As a convenience</strong>, ValueObservation can be turned into an async sequence, a Combine publisher, or an RxSwift observable:</p>

<details open>
    <summary>Async sequence example</summary>
    
[**:fire: EXPERIMENTAL**](#what-are-experimental-features)

&rdquo;`swift
let observation = ValueObservation.tracking(Player.fetchAll)
for try await players in observation.values(in: dbQueue) {
    print(&ldquo;fresh players&rdquo;, players)
}
&ldquo;`

</details>

<details>
    <summary>Combine example</summary>
    
&rdquo;`swift
import Combine
import GRDB

let observation = ValueObservation.tracking(Player.fetchAll)

let cancellable = observation.publisher(in: dbQueue).sink(
    receiveCompletion: { completion in &hellip; },
    receiveValue: { (players: [Player]) in
        print(&ldquo;fresh players&rdquo;, players)
    })
&ldquo;`

See [Combine Support] for more information.

</details>

<details>
    <summary>RxSwift example</summary>
    
&rdquo;`swift
import GRDB
import RxGRDB
import RxSwift

let observation = ValueObservation.tracking(Player.fetchAll)

let disposable = observation.rx.observe(in: dbQueue).subscribe(
    onNext: { (players: [Player]) in
        print(&ldquo;fresh players&rdquo;, players)
    },
    onError: { error in &hellip; })
&ldquo;`

See the companion library [RxGRDB] for more information.

</details>

<p><strong>Generally speaking</strong>:</p>

<ul>
<li>ValueObservation notifies an initial value before the eventual changes.</li>
<li>ValueObservation only notifies changes committed to disk.</li>
<li>By default, ValueObservation notifies a fresh value whenever any of its component is modified (any fetched column, row, etc.). This can be <a href="#specifying-the-region-tracked-by-valueobservation">configured</a>.</li>
<li>By default, ValueObservation notifies the initial value, as well as eventual changes and errors, on the main thread, asynchronously. This can be <a href="#valueobservation-scheduling">configured</a>.</li>
<li>ValueObservation may coalesce subsequent changes into a single notification.</li>
<li>ValueObservation may notify consecutive identical values. You can filter out the undesired duplicates with the <a href="#valueobservationremoveduplicates">removeDuplicates</a> method.</li>
<li>The database observation stops when any of those conditions is met:

<ul>
<li>The cancellable returned by the <code>start</code> method is cancelled or deinitialized.</li>
<li>An error occurs.</li>
<li>The database connection is closed.</li>
</ul></li>
</ul>

<p>Take care that there are use cases that ValueObservation is unfit for. For example, your application may need to process absolutely all changes, and avoid any coalescing. It may also need to process changes before any further modifications are performed in the database file. In those cases, you need to track <em>individual transactions</em>, not values. See <a href="#databaseregionobservation">DatabaseRegionObservation</a>. If you need to process uncommitted changes, see <a href="#transactionobserver-protocol">TransactionObserver</a>.</p>
<h3 id='valueobservation-scheduling' class='heading'>ValueObservation Scheduling</h3>

<p>By default, ValueObservation notifies the initial value, as well as eventual changes and errors, on the main thread, asynchronously:</p>
<pre class="highlight swift"><code><span class="c1">// The default scheduling</span>
<span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span>
    <span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">,</span>
    <span class="nv">onError</span><span class="p">:</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span> <span class="o">...</span> <span class="p">},</span>                   <span class="c1">// called asynchronously on the main thread</span>
    <span class="nv">onChange</span><span class="p">:</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span> <span class="nf">print</span><span class="p">(</span><span class="s">"fresh value"</span><span class="p">)</span> <span class="p">})</span> <span class="c1">// called asynchronously on the main thread</span>
</code></pre>

<p>You can change this behavior by adding a <code>scheduling</code> argument to the <code>start()</code> method.</p>

<p>For example, <code>scheduling: .immediate</code> makes sure the initial value is notified immediately when the observation starts. It helps your application update the user interface without having to wait for any asynchronous notifications:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">PlayersViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">cancellable</span><span class="p">:</span> <span class="kt">DatabaseCancellable</span><span class="p">?</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewWillAppear</span><span class="p">(</span><span class="n">_</span> <span class="nv">animated</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewWillAppear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>

        <span class="c1">// Start observing the database</span>
        <span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="nf">tracking</span><span class="p">(</span><span class="kt">Player</span><span class="o">.</span><span class="n">fetchAll</span><span class="p">)</span>
        <span class="n">cancellable</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span>
            <span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">,</span>
            <span class="nv">scheduling</span><span class="p">:</span> <span class="o">.</span><span class="n">immediate</span><span class="p">,</span> <span class="c1">// &lt;- immediate scheduler</span>
            <span class="nv">onError</span><span class="p">:</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span> <span class="o">...</span> <span class="p">},</span>
            <span class="nv">onChange</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="p">(</span><span class="nv">players</span><span class="p">:</span> <span class="p">[</span><span class="kt">Player</span><span class="p">])</span> <span class="k">in</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">self</span> <span class="o">=</span> <span class="k">self</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
                <span class="k">self</span><span class="o">.</span><span class="nf">updateView</span><span class="p">(</span><span class="n">players</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="c1">// &lt;- Here the view has already been updated.</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewWillDisappear</span><span class="p">(</span><span class="n">_</span> <span class="nv">animated</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewWillDisappear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>

        <span class="c1">// Stop observing the database</span>
        <span class="n">cancellable</span><span class="p">?</span><span class="o">.</span><span class="nf">cancel</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">updateView</span><span class="p">(</span><span class="n">_</span> <span class="nv">players</span><span class="p">:</span> <span class="p">[</span><span class="kt">Player</span><span class="p">])</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Note that the <code>.immediate</code> scheduling requires that the observation starts from the main thread. A fatal error is raised otherwise.</p>

<p>The other built-in scheduler <code>.async(onQueue:)</code> asynchronously schedules values and errors on the dispatch queue of your choice:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">queue</span><span class="p">:</span> <span class="kt">DispatchQueue</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span>
    <span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">,</span>
    <span class="nv">scheduling</span><span class="p">:</span> <span class="o">.</span><span class="k">async</span><span class="p">(</span><span class="nv">onQueue</span><span class="p">:</span> <span class="n">queue</span><span class="p">)</span>
    <span class="nv">onError</span><span class="p">:</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span> <span class="o">...</span> <span class="p">},</span>                   <span class="c1">// called asynchronously on queue</span>
    <span class="nv">onChange</span><span class="p">:</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span> <span class="nf">print</span><span class="p">(</span><span class="s">"fresh value"</span><span class="p">)</span> <span class="p">})</span> <span class="c1">// called asynchronously on queue</span>
</code></pre>
<h3 id='valueobservation-operators' class='heading'>ValueObservation Operators</h3>

<p><strong>Operators</strong> are methods that transform and configure value observations so that they better fit the needs of your application.</p>

<ul>
<li><a href="#valueobservationmap">ValueObservation.map</a></li>
<li><a href="#valueobservationremoveduplicates">ValueObservation.removeDuplicates</a></li>
<li><a href="#valueobservationrequireswriteaccess">ValueObservation.requiresWriteAccess</a></li>
</ul>

<p><strong>Debugging Operators</strong></p>

<ul>
<li><a href="#valueobservationhandleevents">ValueObservation.handleEvents</a></li>
<li><a href="#valueobservationprint">ValueObservation.print</a></li>
</ul>
<h4 id='valueobservation-map' class='heading'>ValueObservation.map</h4>

<p>The <code>map</code> operator transforms the values notified by a ValueObservation.</p>

<p>For example:</p>
<pre class="highlight swift"><code><span class="c1">// Turn an observation of Player? into an observation of UIImage?</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span>
    <span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">42</span><span class="p">)</span> <span class="p">}</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">player</span> <span class="k">in</span> <span class="n">player</span><span class="p">?</span><span class="o">.</span><span class="n">image</span> <span class="p">}</span>
</code></pre>

<p>The transformation function does not block any database access. This makes the <code>map</code> operator a tool which helps reducing <a href="#valueobservation-performance">database contention</a>.</p>
<h4 id='valueobservation-removeduplicates' class='heading'>ValueObservation.removeDuplicates</h4>

<p>The <code>removeDuplicates()</code> and <code>removeDuplicates(by:)</code> operators filter out consecutive equal values:</p>

<p>For example:</p>
<pre class="highlight swift"><code><span class="c1">// An observation of distinct Player?</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span>
    <span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">42</span><span class="p">)</span> <span class="p">}</span>
    <span class="o">.</span><span class="nf">removeDuplicates</span><span class="p">()</span>
</code></pre>

<p>:bulb: <strong>Tip</strong>: When the observed value does not adopt Equatable, and it is impractical to provide a custom comparison function, you can observe distinct raw database values such as <a href="#row-queries">Row</a> or <a href="#databasevalue">DatabaseValue</a>, before converting them to the desired type. For example, the previous observation can be rewritten as below:</p>
<pre class="highlight swift"><code><span class="c1">// An observation of distinct Player?</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">42</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span>
    <span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span> <span class="p">}</span>
    <span class="o">.</span><span class="nf">removeDuplicates</span><span class="p">()</span> <span class="c1">// Row adopts Equatable</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">row</span> <span class="k">in</span> <span class="n">row</span><span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="kt">Player</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">row</span><span class="p">:)</span> <span class="p">}</span>
</code></pre>

<p>This technique is also available for requests that involve <a href="Documentation/AssociationsBasics.md">Associations</a>:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">TeamInfo</span><span class="p">:</span> <span class="kt">Decodable</span><span class="p">,</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">team</span><span class="p">:</span> <span class="kt">Team</span>
    <span class="k">var</span> <span class="nv">players</span><span class="p">:</span> <span class="p">[</span><span class="kt">Player</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1">// An observation of distinct [TeamInfo]</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Team</span><span class="o">.</span><span class="nf">including</span><span class="p">(</span><span class="nv">all</span><span class="p">:</span> <span class="kt">Team</span><span class="o">.</span><span class="n">players</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span>
    <span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span> <span class="p">}</span>
    <span class="o">.</span><span class="nf">removeDuplicates</span><span class="p">()</span> <span class="c1">// Row adopts Equatable</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">rows</span> <span class="k">in</span> <span class="n">rows</span><span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="kt">TeamInfo</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">row</span><span class="p">:)</span> <span class="p">}</span>
</code></pre>
<h4 id='valueobservation-requireswriteaccess' class='heading'>ValueObservation.requiresWriteAccess</h4>

<p>The <code>requiresWriteAccess</code> property is false by default. When true, a ValueObservation has a write access to the database, and its fetches are automatically wrapped in a <a href="#transactions-and-savepoints">savepoint</a>:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// write access allowed</span>
    <span class="o">...</span>
<span class="p">}</span>
<span class="n">observation</span><span class="o">.</span><span class="n">requiresWriteAccess</span> <span class="o">=</span> <span class="kc">true</span>
</code></pre>

<p>When you use a <a href="#database-pools">database pool</a>, this flag has a performance hit.</p>
<h4 id='valueobservation-handleevents' class='heading'>ValueObservation.handleEvents</h4>

<p>The <code>handleEvents</code> operator lets your application observe the lifetime of a ValueObservation:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span>
    <span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>
    <span class="o">.</span><span class="nf">handleEvents</span><span class="p">(</span>
        <span class="nv">willStart</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1">// The observation starts.</span>
        <span class="p">},</span>
        <span class="nv">willFetch</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1">// The observation will perform a database fetch.</span>
        <span class="p">},</span>
        <span class="nv">willTrackRegion</span><span class="p">:</span> <span class="p">{</span> <span class="n">databaseRegion</span> <span class="k">in</span>
            <span class="c1">// The observation starts tracking a database region.</span>
        <span class="p">},</span>
        <span class="nv">databaseDidChange</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1">// The observation was impacted by a database change.</span>
        <span class="p">},</span>
        <span class="nv">didReceiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
            <span class="c1">// A fresh value was observed.</span>
            <span class="c1">// NOTE: This closure runs on an unspecified DispatchQueue.</span>
        <span class="p">},</span>
        <span class="nv">didFail</span><span class="p">:</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
            <span class="c1">// The observation completes with an error.</span>
        <span class="p">},</span>
        <span class="nv">didCancel</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1">// The observation was cancelled.</span>
        <span class="p">})</span>
</code></pre>

<p>See also <a href="#valueobservationprint">ValueObservation.print</a>.</p>
<h4 id='valueobservation-print' class='heading'>ValueObservation.print</h4>

<p>The <code>print</code> operator logs messages for all ValueObservation events.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span>
    <span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>
    <span class="o">.</span><span class="nf">print</span><span class="p">()</span>
</code></pre>

<p>See also <a href="#valueobservationhandleevents">ValueObservation.handleEvents</a>.</p>
<h3 id='valueobservation-sharing' class='heading'>ValueObservation Sharing</h3>

<p><a href="#what-are-experimental-features"><strong>:fire: EXPERIMENTAL</strong></a></p>

<p><strong>Sharing a ValueObservation allows several components of your app to be notified of database changes, in an efficient way.</strong></p>

<p>A shared observation spares database resources. For example, when a database change happens, a fresh value is fetched only once, and then notified to all subscriptions.</p>

<p>Usage:</p>
<pre class="highlight swift"><code><span class="c1">// SharedValueObservation&lt;[Player]&gt;</span>
<span class="k">let</span> <span class="nv">sharedObservation</span> <span class="o">=</span> <span class="kt">ValueObservation</span>
    <span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="p">}</span>
    <span class="o">.</span><span class="nf">shared</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">)</span>
<span class="c1">//  ~~~~~~~~~~~~~~~~~~~~</span>

<span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="k">try</span> <span class="n">sharedObservation</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span>
    <span class="nv">onError</span><span class="p">:</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span> <span class="o">...</span> <span class="p">},</span>
    <span class="nv">onChange</span><span class="p">:</span> <span class="p">{</span> <span class="nv">players</span><span class="p">:</span> <span class="p">[</span><span class="kt">Player</span><span class="p">]</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"fresh players: </span><span class="se">\(</span><span class="n">players</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">})</span>
</code></pre>

<p>The sharing only applies if you start observing the database from the same <code><a href="Classes/SharedValueObservation.html">SharedValueObservation</a></code> instance:</p>
<pre class="highlight swift"><code><span class="c1">// NOT shared</span>
<span class="k">let</span> <span class="nv">cancellable1</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span><span class="o">.</span><span class="nf">shared</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">)</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">cancellable2</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span><span class="o">.</span><span class="nf">shared</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">)</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1">// Shared</span>
<span class="k">let</span> <span class="nv">sharedObservation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span><span class="o">.</span><span class="nf">shared</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">cancellable1</span> <span class="o">=</span> <span class="n">sharedObservation</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">cancellable2</span> <span class="o">=</span> <span class="n">sharedObservation</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre>

<p>By default, fresh values are dispatched asynchronously on the main queue. You can change this behavior (see <a href="#valueobservation-scheduling">ValueObservation Scheduling</a> for more information):</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">sharedObservation</span> <span class="o">=</span> <span class="kt">ValueObservation</span>
    <span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="p">}</span>
    <span class="o">.</span><span class="nf">shared</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">,</span> <span class="nv">scheduling</span><span class="p">:</span> <span class="o">.</span><span class="n">immediate</span><span class="p">)</span>
<span class="c1">//                       ~~~~~~~~~~~~~~~~~~~~~~</span>
</code></pre>

<p>A shared observation starts observing the database as soon as it is subscribed. You can choose if database observation should stop, or not, when its number of subscriptions drops down to zero, with the <code>extent</code> parameter:</p>
<pre class="highlight swift"><code><span class="c1">// The default: stops observing the database when the number of subscriptions </span>
<span class="c1">// drops down to zero, and restart database observation on the next subscription.</span>
<span class="c1">//</span>
<span class="c1">// Database errors can be recovered by resubscribing to the shared observation.</span>
<span class="k">let</span> <span class="nv">sharedObservation</span> <span class="o">=</span> <span class="kt">ValueObservation</span>
    <span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="p">}</span>
    <span class="o">.</span><span class="nf">shared</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">,</span> <span class="nv">extent</span><span class="p">:</span> <span class="o">.</span><span class="n">whileObserved</span><span class="p">)</span>
<span class="c1">//                       ~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="c1">// Only stops observing the database when the shared observation is deinitialized,</span>
<span class="c1">// and all subscriptions are cancelled.</span>
<span class="c1">//</span>
<span class="c1">// This extent prevents the shared observation from recovering from database</span>
<span class="c1">// errors. To recover from database errors, create a new shared</span>
<span class="c1">// SharedValueObservation instance.</span>
<span class="k">let</span> <span class="nv">sharedObservation</span> <span class="o">=</span> <span class="kt">ValueObservation</span>
    <span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="p">}</span>
    <span class="o">.</span><span class="nf">shared</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">,</span> <span class="nv">extent</span><span class="p">:</span> <span class="o">.</span><span class="n">observationLifetime</span><span class="p">)</span>
<span class="c1">//                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: <code><a href="Structs/ValueObservation.html">ValueObservation</a></code> and <code><a href="Classes/SharedValueObservation.html">SharedValueObservation</a></code> are nearly identical, but there are a few differences you should be aware of:</p>

<ul>
<li><p><code><a href="Classes/SharedValueObservation.html">SharedValueObservation</a></code> has no <a href="#valueobservation-operators">operator</a> such as <code>map</code>. As a replacement, you may use Combine apis:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">sharedObservation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span><span class="o">.</span><span class="nf">shared</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="k">try</span> <span class="n">sharedObservation</span>
    <span class="o">.</span><span class="nf">publisher</span><span class="p">()</span> <span class="c1">// Turn shared observation into a Combine Publisher</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="c1">// The map operator from Combine</span>
    <span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></li>
<li><p>Unlike <code><a href="Structs/ValueObservation.html">ValueObservation</a></code>, <code><a href="Classes/SharedValueObservation.html">SharedValueObservation</a></code> retains the database connection. As long as there exists a <code><a href="Classes/SharedValueObservation.html">SharedValueObservation</a></code> instance, or an active suscription to a shared observation, the database connection won&rsquo;t be deinitialized. </p></li>
</ul>
</blockquote>
<h3 id='specifying-the-region-tracked-by-valueobservation' class='heading'>Specifying the Region Tracked by ValueObservation</h3>

<p>While the standard <code>ValueObservation.tracking { db in ... }</code> method lets you track changes to a fetched value and receive any changes to it, sometimes your use case might require more granular control. </p>

<p>Consider a scenario where you&rsquo;d like to get a specific Player&rsquo;s row, but only when their <code>score</code> column changes. You can use <code>tracking(region:fetch:)</code> to do just that:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="nf">tracking</span><span class="p">(</span>
    <span class="c1">// Define what database region constitutes a "change"</span>
    <span class="nv">region</span><span class="p">:</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">))</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">),</span>
    <span class="c1">// Define what to fetch upon such change</span>
    <span class="nv">fetch</span><span class="p">:</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre>

<p>This overload of <code><a href="Structs/ValueObservation.html">ValueObservation</a></code> lets you entirely separate the <strong>observed region</strong> from the <strong>fetched value</strong> itself, providing utmost flexibility. See <a href="#the-databaseregionconvertible-protocol">DatabaseRegionConvertible</a> for more information.</p>
<h3 id='valueobservation-performance' class='heading'>ValueObservation Performance</h3>

<p>This chapter further describes runtime aspects of ValueObservation, and provides some optimization tips for demanding applications.</p>

<p><strong>ValueObservation is triggered by database transactions that may modify the tracked value.</strong></p>

<p>For example, if you track the maximum score of players, all transactions that impact the <code>score</code> column of the <code>player</code> database table (any update, insertion, or deletion) trigger the observation, even if the maximum score itself is not changed.</p>

<p>You can filter out undesired duplicate notifications with the <a href="#valueobservationremoveduplicates">removeDuplicates</a> method.</p>

<p><strong>ValueObservation can create database contention.</strong> In other words, active observations take a toll on the constrained database resources. When triggered by impactful transactions, observations fetch fresh values, and can delay read and write database accesses of other application components.</p>

<p>When needed, you can help GRDB optimize observations and reduce database contention:</p>

<ol>
<li><p>:bulb: <strong>Tip</strong>: Stop observations when possible.</p>

<p>For example, if a UIViewController needs to display database values, it can start the observation in <code>viewWillAppear</code>, and stop it in <code>viewWillDisappear</code>. Check the sample code <a href="#valueobservation-scheduling">above</a>.</p></li>
<li><p>:bulb: <strong>Tip</strong>: Share observations when possible.</p>

<p>Each call to <code>ValueObservation.start</code> method triggers independent values refreshes. When several components of your app are interested in the same value, consider <a href="#valueobservation-sharing">sharing the observation</a>.</p></li>
<li><p>:bulb: <strong>Tip</strong>: Use a <a href="#database-pools">database pool</a>, because it can perform multi-threaded database accesses.</p></li>
<li><p>:bulb: <strong>Tip</strong>: When the observation processes some raw fetched values, use the <a href="#valueobservationmap"><code>map</code></a> operator:</p>
<pre class="highlight swift"><code><span class="c1">// Plain observation</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="o">-&gt;</span> <span class="kt">MyValue</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">computeMyValue</span><span class="p">(</span><span class="n">players</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Optimized observation</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span>
    <span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="p">}</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">players</span> <span class="k">in</span> <span class="nf">computeMyValue</span><span class="p">(</span><span class="n">players</span><span class="p">)</span> <span class="p">}</span>
</code></pre>

<p>The <code>map</code> operator helps reducing database contention because it performs its job without blocking concurrent database reads.</p></li>
<li><p>:bulb: <strong>Tip</strong>: When the observation tracks a constant database region, create an optimized observation with the <code><a href="Structs/ValueObservation.html#/s:4GRDB16ValueObservationVA2A0B8ReducersO4AutoORszrlE22trackingConstantRegionyACyAE5FetchVy_qd__GGqd__AA8DatabaseCKclFZ">ValueObservation.trackingConstantRegion(_:)</a></code> method.</p>

<p>The optimization only kicks in when the observation is started from a <a href="#database-pools">database pool</a>: fresh values are fetched concurrently, and do not block database writes.</p>

<p>The <code><a href="Structs/ValueObservation.html#/s:4GRDB16ValueObservationVA2A0B8ReducersO4AutoORszrlE22trackingConstantRegionyACyAE5FetchVy_qd__GGqd__AA8DatabaseCKclFZ">ValueObservation.trackingConstantRegion(_:)</a></code> has a precondition: the observed requests must fetch from a single and constant database region. The tracked region is made of tables, columns, and, when possible, rowids of individual rows. All changes that happen outside of this region do not impact the observation.</p>

<p>For example:</p>
<pre class="highlight swift"><code><span class="c1">// Tracks the full 'player' table (only)</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="n">trackingConstantRegion</span> <span class="p">{</span> <span class="n">db</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">Player</span><span class="p">]</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Tracks the row with id 42 in the 'player' table (only)</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="n">trackingConstantRegion</span> <span class="p">{</span> <span class="n">db</span> <span class="o">-&gt;</span> <span class="kt">Player</span><span class="p">?</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">42</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Tracks the 'score' column in the 'player' table (only)</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="n">trackingConstantRegion</span> <span class="p">{</span> <span class="n">db</span> <span class="o">-&gt;</span> <span class="kt">Int</span><span class="p">?</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"score"</span><span class="p">)))</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Tracks both the 'player' and 'team' tables (only)</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="n">trackingConstantRegion</span> <span class="p">{</span> <span class="n">db</span> <span class="o">-&gt;</span> <span class="p">([</span><span class="kt">Team</span><span class="p">],</span> <span class="p">[</span><span class="kt">Player</span><span class="p">])</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">teams</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Team</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="nf">return</span> <span class="p">(</span><span class="n">teams</span><span class="p">,</span> <span class="n">players</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>When you want to observe a varying database region, make sure you use the plain <code><a href="Structs/ValueObservation.html#/s:4GRDB16ValueObservationVA2A0B8ReducersO4AutoORszrlE8trackingyACyAE5FetchVy_qd__GGqd__AA8DatabaseCKclFZ">ValueObservation.tracking(_:)</a></code> method instead, or else some changes will not be notified.</p>

<p>For example, consider those three observations below that depend on some user preference. They all track a varying region, and must use <code><a href="Structs/ValueObservation.html#/s:4GRDB16ValueObservationVA2A0B8ReducersO4AutoORszrlE8trackingyACyAE5FetchVy_qd__GGqd__AA8DatabaseCKclFZ">ValueObservation.tracking(_:)</a></code>:</p>
<pre class="highlight swift"><code><span class="c1">// Does not always track the same row in the player table.</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="o">-&gt;</span> <span class="kt">Player</span><span class="p">?</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">pref</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Preference</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="p">??</span> <span class="o">.</span><span class="k">default</span>
    <span class="k">return</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="n">pref</span><span class="o">.</span><span class="n">favoritePlayerId</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Only tracks the 'user' table if there are some blocked emails.</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">User</span><span class="p">]</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">pref</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Preference</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="p">??</span> <span class="o">.</span><span class="k">default</span>
    <span class="k">let</span> <span class="nv">blockedEmails</span> <span class="o">=</span> <span class="n">pref</span><span class="o">.</span><span class="n">blockedEmails</span>
    <span class="k">return</span> <span class="k">try</span> <span class="kt">User</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">blockedEmails</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"email"</span><span class="p">)))</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Sometimes tracks the 'food' table, and sometimes the 'beverage' table.</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span><span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">pref</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Preference</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="p">??</span> <span class="o">.</span><span class="k">default</span>
    <span class="k">switch</span> <span class="n">pref</span><span class="o">.</span><span class="n">selection</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nv">food</span><span class="p">:</span> <span class="k">return</span> <span class="k">try</span> <span class="kt">Food</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nv">beverage</span><span class="p">:</span> <span class="k">return</span> <span class="k">try</span> <span class="kt">Beverage</span><span class="o">.</span><span class="nf">fetchCount</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>When you are in doubt, add the <a href="#valueobservationprint"><code>print()</code> method</a> to your observation before starting it, and look in your application logs for lines that start with <code>tracked region</code>. Make sure the printed database region covers the changes you expect to be tracked.</p>

<p><details>
    <summary>Examples of tracked regions</summary></p></li>
</ol>
<pre class="highlight plaintext"><code>- `empty`: The empty region, which tracks nothing and never triggers the observation.
- `player(*)`: The full `player` table
- `player(id,name)`: The `id` and `name` columns of the `player` table
- `player(id,name)[1]`: The `id` and `name` columns of the row with id 1 in the `player` table
- `player(*),preference(*)`: Both the full `player` and `preference` tables

&lt;/details&gt;
</code></pre>
<h2 id='databaseregionobservation' class='heading'>DatabaseRegionObservation</h2>

<p><strong>DatabaseRegionObservation tracks changes in database <a href="#requests">requests</a>, and notifies each impactful <a href="#transactions-and-savepoints">transaction</a>.</strong></p>

<p>Tracked changes are insertions, updates, and deletions that impact the tracked requests, performed with the <a href="#the-query-interface">query interface</a>, or <a href="#sqlite-api">raw SQL</a>. This includes indirect changes triggered by <a href="https://www.sqlite.org/foreignkeys.html#fk_actions">foreign keys actions</a> or <a href="https://www.sqlite.org/lang_createtrigger.html">SQL triggers</a>.</p>

<blockquote>
<p>:point_up: <strong>Note</strong>: Some changes are not notified: changes to internal system tables (such as <code>sqlite_master</code>), and changes to <a href="https://www.sqlite.org/withoutrowid.html"><code>WITHOUT ROWID</code></a> tables.</p>
</blockquote>

<p>DatabaseRegionObservation calls your application right after changes have been committed in the database, and before any other thread had any opportunity to perform further changes. <em>This is a pretty strong guarantee, that most applications do not really need.</em> Instead, most applications prefer to be notified with fresh values: make sure you check <a href="#valueobservation">ValueObservation</a> before using DatabaseRegionObservation.</p>
<h3 id='databaseregionobservation-usage' class='heading'>DatabaseRegionObservation Usage</h3>

<p>Define an observation by providing one or several requests to track:</p>
<pre class="highlight swift"><code><span class="c1">// Track all players</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">DatabaseRegionObservation</span><span class="p">(</span><span class="nv">tracking</span><span class="p">:</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">all</span><span class="p">())</span>
</code></pre>

<p>Then start the observation from a <a href="#database-queues">database queue</a> or <a href="#database-pools">pool</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">observer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">observation</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="nv">db</span><span class="p">:</span> <span class="kt">Database</span><span class="p">)</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Players were changed"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>And enjoy the changes notifications:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Player</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Arthur"</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// Prints "Players were changed"</span>
</code></pre>

<p>By default, the observation lasts until the observer returned by the <code>start</code> method is deinitialized. See <a href="#databaseregionobservationextent">DatabaseRegionObservation.extent</a> for more details.</p>

<p>You can also feed DatabaseRegionObservation with <a href="#databaseregion">DatabaseRegion</a>, or any type which conforms to the <a href="#the-databaseregionconvertible-protocol">DatabaseRegionConvertible</a> protocol. For example:</p>
<pre class="highlight swift"><code><span class="c1">// Observe the full database</span>
<span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">DatabaseRegionObservation</span><span class="p">(</span><span class="nv">tracking</span><span class="p">:</span> <span class="kt">DatabaseRegion</span><span class="o">.</span><span class="n">fullDatabase</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">observer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">observation</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="nv">db</span><span class="p">:</span> <span class="kt">Database</span><span class="p">)</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Database was changed"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<h3 id='databaseregionobservation-extent' class='heading'>DatabaseRegionObservation.extent</h3>

<p>The <code>extent</code> property lets you specify the duration of the observation. See <a href="#observation-extent">Observation Extent</a> for more details:</p>
<pre class="highlight swift"><code><span class="c1">// This observation lasts until the database connection is closed</span>
<span class="k">var</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">DatabaseRegionObservation</span><span class="o">...</span>
<span class="n">observation</span><span class="o">.</span><span class="n">extent</span> <span class="o">=</span> <span class="o">.</span><span class="n">databaseLifetime</span>
<span class="n">_</span> <span class="o">=</span> <span class="k">try</span> <span class="n">observation</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">)</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>
</code></pre>

<p>The default extent is <code>.observerLifetime</code>: the observation stops when the observer returned by <code>start</code> is deinitialized.</p>

<p>Regardless of the extent of an observation, you can always stop observation with the <code>remove(transactionObserver:)</code> method:</p>
<pre class="highlight swift"><code><span class="c1">// Start</span>
<span class="k">let</span> <span class="nv">observer</span> <span class="o">=</span> <span class="k">try</span> <span class="n">observation</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">dbQueue</span><span class="p">)</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>

<span class="c1">// Stop</span>
<span class="n">dbQueue</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="nv">transactionObserver</span><span class="p">:</span> <span class="n">observer</span><span class="p">)</span>
</code></pre>
<h2 id='transactionobserver-protocol' class='heading'>TransactionObserver Protocol</h2>

<p>The <code><a href="Protocols/TransactionObserver.html">TransactionObserver</a></code> protocol lets you <strong>observe individual database changes and transactions</strong>:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">TransactionObserver</span> <span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
    <span class="c1">/// Notifies a database change:</span>
    <span class="c1">/// - event.kind (insert, update, or delete)</span>
    <span class="c1">/// - event.tableName</span>
    <span class="c1">/// - event.rowID</span>
    <span class="c1">///</span>
    <span class="c1">/// For performance reasons, the event is only valid for the duration of</span>
    <span class="c1">/// this method call. If you need to keep it longer, store a copy:</span>
    <span class="c1">/// event.copy().</span>
    <span class="kd">func</span> <span class="nf">databaseDidChange</span><span class="p">(</span><span class="n">with</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">DatabaseEvent</span><span class="p">)</span>

    <span class="c1">/// Filters the database changes that should be notified to the</span>
    <span class="c1">/// `databaseDidChange(with:)` method.</span>
    <span class="kd">func</span> <span class="nf">observes</span><span class="p">(</span><span class="n">eventsOfKind</span> <span class="nv">eventKind</span><span class="p">:</span> <span class="kt">DatabaseEventKind</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span>

    <span class="c1">/// An opportunity to rollback pending changes by throwing an error.</span>
    <span class="kd">func</span> <span class="nf">databaseWillCommit</span><span class="p">()</span> <span class="k">throws</span>

    <span class="c1">/// Database changes have been committed.</span>
    <span class="kd">func</span> <span class="nf">databaseDidCommit</span><span class="p">(</span><span class="n">_</span> <span class="nv">db</span><span class="p">:</span> <span class="kt">Database</span><span class="p">)</span>

    <span class="c1">/// Database changes have been rollbacked.</span>
    <span class="kd">func</span> <span class="nf">databaseDidRollback</span><span class="p">(</span><span class="n">_</span> <span class="nv">db</span><span class="p">:</span> <span class="kt">Database</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<ul>
<li><a href="#activate-a-transaction-observer">Activate a Transaction Observer</a></li>
<li><a href="#database-changes-and-transactions">Database Changes And Transactions</a></li>
<li><a href="#filtering-database-events">Filtering Database Events</a></li>
<li><a href="#observation-extent">Observation Extent</a></li>
<li><a href="#databaseregion">DatabaseRegion</a></li>
<li><a href="#support-for-sqlite-pre-update-hooks">Support for SQLite Pre-Update Hooks</a></li>
</ul>
<h3 id='activate-a-transaction-observer' class='heading'>Activate a Transaction Observer</h3>

<p><strong>To activate a transaction observer, add it to the database queue or pool:</strong></p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">observer</span> <span class="o">=</span> <span class="kt">MyObserver</span><span class="p">()</span>
<span class="n">dbQueue</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">transactionObserver</span><span class="p">:</span> <span class="n">observer</span><span class="p">)</span>
</code></pre>

<p>By default, database holds weak references to its transaction observers: they are not retained, and stop getting notifications after they are deinitialized. See <a href="#observation-extent">Observation Extent</a> for more options.</p>
<h3 id='database-changes-and-transactions' class='heading'>Database Changes And Transactions</h3>

<p><strong>A transaction observer is notified of all database changes</strong>: inserts, updates and deletes. This includes indirect changes triggered by ON DELETE and ON UPDATE actions associated to <a href="https://www.sqlite.org/foreignkeys.html#fk_actions">foreign keys</a>, and <a href="https://www.sqlite.org/lang_createtrigger.html">SQL triggers</a>.</p>

<blockquote>
<p>:point_up: <strong>Note</strong>: Some changes are not notified: changes to internal system tables (such as <code>sqlite_master</code>), changes to <a href="https://www.sqlite.org/withoutrowid.html"><code>WITHOUT ROWID</code></a> tables, and the deletion of duplicate rows triggered by <a href="https://www.sqlite.org/lang_conflict.html"><code>ON CONFLICT REPLACE</code></a> clauses (this last exception might change in a future release of SQLite).</p>
</blockquote>

<p>Notified changes are not actually written to disk until the <a href="#transactions-and-savepoints">transaction</a> commits, and the <code>databaseDidCommit</code> callback is called. On the other side, <code>databaseDidRollback</code> confirms their invalidation:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT ..."</span><span class="p">)</span> <span class="c1">// 1. didChange</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE ..."</span><span class="p">)</span> <span class="c1">// 2. didChange</span>
<span class="p">}</span>                                     <span class="c1">// 3. willCommit, 4. didCommit</span>

<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">inTransaction</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT ..."</span><span class="p">)</span> <span class="c1">// 1. didChange</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE ..."</span><span class="p">)</span> <span class="c1">// 2. didChange</span>
    <span class="k">return</span> <span class="o">.</span><span class="n">rollback</span>                  <span class="c1">// 3. didRollback</span>
<span class="p">}</span>

<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT ..."</span><span class="p">)</span> <span class="c1">// 1. didChange</span>
    <span class="k">throw</span> <span class="kt">SomeError</span><span class="p">()</span>
<span class="p">}</span>                                     <span class="c1">// 2. didRollback</span>
</code></pre>

<p>Database statements that are executed outside of any transaction do not drop off the radar:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">inDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT ..."</span><span class="p">)</span> <span class="c1">// 1. didChange, 2. willCommit, 3. didCommit</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE ..."</span><span class="p">)</span> <span class="c1">// 4. didChange, 5. willCommit, 6. didCommit</span>
<span class="p">}</span>
</code></pre>

<p>Changes that are on hold because of a <a href="https://www.sqlite.org/lang_savepoint.html">savepoint</a> are only notified after the savepoint has been released. This makes sure that notified events are only events that have an opportunity to be committed:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">inTransaction</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"INSERT ..."</span><span class="p">)</span>            <span class="c1">// 1. didChange</span>

    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"SAVEPOINT foo"</span><span class="p">)</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE ..."</span><span class="p">)</span>            <span class="c1">// delayed</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE ..."</span><span class="p">)</span>            <span class="c1">// delayed</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"RELEASE SAVEPOINT foo"</span><span class="p">)</span> <span class="c1">// 2. didChange, 3. didChange</span>

    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"SAVEPOINT foo"</span><span class="p">)</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE ..."</span><span class="p">)</span>            <span class="c1">// not notified</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"ROLLBACK TO SAVEPOINT foo"</span><span class="p">)</span>

    <span class="k">return</span> <span class="o">.</span><span class="n">commit</span>                               <span class="c1">// 4. willCommit, 5. didCommit</span>
<span class="p">}</span>
</code></pre>

<p><strong>Eventual errors</strong> thrown from <code>databaseWillCommit</code> are exposed to the application code:</p>
<pre class="highlight swift"><code><span class="k">do</span> <span class="p">{</span>
    <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">inTransaction</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="o">.</span><span class="n">commit</span>           <span class="c1">// 1. willCommit (throws), 2. didRollback</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
    <span class="c1">// 3. The error thrown by the transaction observer.</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: all callbacks are called in a protected dispatch queue, and serialized with all database updates.</p>

<p>:point_up: <strong>Note</strong>: the databaseDidChange(with:) and databaseWillCommit() callbacks must not touch the SQLite database. This limitation does not apply to databaseDidCommit and databaseDidRollback which can use their database argument.</p>
</blockquote>

<p><a href="#databaseregionobservation">DatabaseRegionObservation</a> and <a href="#valueobservation">ValueObservation</a> are based on the TransactionObserver protocol.</p>

<p>See also <a href="https://gist.github.com/groue/2e21172719e634657dfd">TableChangeObserver.swift</a>, which shows a transaction observer that notifies of modified database tables with NSNotificationCenter.</p>
<h3 id='filtering-database-events' class='heading'>Filtering Database Events</h3>

<p><strong>Transaction observers can avoid being notified of database changes they are not interested in.</strong></p>

<p>The filtering happens in the <code>observes(eventsOfKind:)</code> method, which tells whether the observer wants notification of specific kinds of changes, or not. For example, here is how an observer can focus on the changes that happen on the &quot;player&rdquo; database table:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">PlayerObserver</span><span class="p">:</span> <span class="kt">TransactionObserver</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">observes</span><span class="p">(</span><span class="n">eventsOfKind</span> <span class="nv">eventKind</span><span class="p">:</span> <span class="kt">DatabaseEventKind</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="c1">// Only observe changes to the "player" table.</span>
        <span class="k">return</span> <span class="n">eventKind</span><span class="o">.</span><span class="n">tableName</span> <span class="o">==</span> <span class="s">"player"</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">databaseDidChange</span><span class="p">(</span><span class="n">with</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">DatabaseEvent</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This method is only called for changes that happen to</span>
        <span class="c1">// the "player" table.</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Generally speaking, the <code>observes(eventsOfKind:)</code> method can distinguish insertions from deletions and updates, and is also able to inspect the columns that are about to be changed:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">PlayerScoreObserver</span><span class="p">:</span> <span class="kt">TransactionObserver</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">observes</span><span class="p">(</span><span class="n">eventsOfKind</span> <span class="nv">eventKind</span><span class="p">:</span> <span class="kt">DatabaseEventKind</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="c1">// Only observe changes to the "score" column of the "player" table.</span>
        <span class="k">switch</span> <span class="n">eventKind</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="k">let</span> <span class="nv">tableName</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">tableName</span> <span class="o">==</span> <span class="s">"player"</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">delete</span><span class="p">(</span><span class="k">let</span> <span class="nv">tableName</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">tableName</span> <span class="o">==</span> <span class="s">"player"</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">update</span><span class="p">(</span><span class="k">let</span> <span class="nv">tableName</span><span class="p">,</span> <span class="k">let</span> <span class="nv">columnNames</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">tableName</span> <span class="o">==</span> <span class="s">"player"</span> <span class="o">&amp;&amp;</span> <span class="n">columnNames</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"score"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>When the <code>observes(eventsOfKind:)</code> method returns false for all event kinds, the observer is still notified of commits and rollbacks:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">PureTransactionObserver</span><span class="p">:</span> <span class="kt">TransactionObserver</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">observes</span><span class="p">(</span><span class="n">eventsOfKind</span> <span class="nv">eventKind</span><span class="p">:</span> <span class="kt">DatabaseEventKind</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="c1">// Ignore all individual changes</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">databaseDidChange</span><span class="p">(</span><span class="n">with</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">DatabaseEvent</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* Never called */</span> <span class="p">}</span>
    <span class="kd">func</span> <span class="nf">databaseWillCommit</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span> <span class="cm">/* Called before commit */</span> <span class="p">}</span>
    <span class="kd">func</span> <span class="nf">databaseDidRollback</span><span class="p">(</span><span class="n">_</span> <span class="nv">db</span><span class="p">:</span> <span class="kt">Database</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* Called on rollback */</span> <span class="p">}</span>
    <span class="kd">func</span> <span class="nf">databaseDidCommit</span><span class="p">(</span><span class="n">_</span> <span class="nv">db</span><span class="p">:</span> <span class="kt">Database</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* Called on commit */</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>For more information about event filtering, see <a href="#databaseregion">DatabaseRegion</a>.</p>
<h3 id='observation-extent' class='heading'>Observation Extent</h3>

<p><strong>You can specify how long an observer is notified of database changes and transactions.</strong></p>

<p>The <code>remove(transactionObserver:)</code> method explicitly stops notifications, at any time:</p>
<pre class="highlight swift"><code><span class="c1">// From a database queue or pool:</span>
<span class="n">dbQueue</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="nv">transactionObserver</span><span class="p">:</span> <span class="n">observer</span><span class="p">)</span>

<span class="c1">// From a database connection:</span>
<span class="n">dbQueue</span><span class="o">.</span><span class="n">inDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="n">db</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="nv">transactionObserver</span><span class="p">:</span> <span class="n">observer</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Alternatively, use the <code>extent</code> parameter of the <code>add(transactionObserver:extent:)</code> method:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">observer</span> <span class="o">=</span> <span class="kt">MyObserver</span><span class="p">()</span>

<span class="c1">// On a database queue or pool:</span>
<span class="n">dbQueue</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">transactionObserver</span><span class="p">:</span> <span class="n">observer</span><span class="p">)</span> <span class="c1">// default extent</span>
<span class="n">dbQueue</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">transactionObserver</span><span class="p">:</span> <span class="n">observer</span><span class="p">,</span> <span class="nv">extent</span><span class="p">:</span> <span class="o">.</span><span class="n">observerLifetime</span><span class="p">)</span>
<span class="n">dbQueue</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">transactionObserver</span><span class="p">:</span> <span class="n">observer</span><span class="p">,</span> <span class="nv">extent</span><span class="p">:</span> <span class="o">.</span><span class="n">nextTransaction</span><span class="p">)</span>
<span class="n">dbQueue</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">transactionObserver</span><span class="p">:</span> <span class="n">observer</span><span class="p">,</span> <span class="nv">extent</span><span class="p">:</span> <span class="o">.</span><span class="n">databaseLifetime</span><span class="p">)</span>

<span class="c1">// On a database connection:</span>
<span class="n">dbQueue</span><span class="o">.</span><span class="n">inDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="n">db</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">transactionObserver</span><span class="p">:</span> <span class="o">...</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<ul>
<li><p>The default extent is <code>.observerLifetime</code>: the database holds a weak reference to the observer, and the observation automatically ends when the observer is deinitialized. Meanwhile, observer is notified of all changes and transactions.</p></li>
<li><p><code>.nextTransaction</code> activates the observer until the current or next transaction completes. The database keeps a strong reference to the observer until its <code>databaseDidCommit</code> or <code>databaseDidRollback</code> method is eventually called. Hereafter the observer won&rsquo;t get any further notification.</p></li>
<li><p><code>.databaseLifetime</code> has the database retain and notify the observer until the database connection is closed.</p></li>
</ul>

<p>Finally, an observer may ignore all database changes until the end of the current transaction:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">PlayerObserver</span><span class="p">:</span> <span class="kt">TransactionObserver</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">playerTableWasModified</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kd">func</span> <span class="nf">observes</span><span class="p">(</span><span class="n">eventsOfKind</span> <span class="nv">eventKind</span><span class="p">:</span> <span class="kt">DatabaseEventKind</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="n">eventKind</span><span class="o">.</span><span class="n">tableName</span> <span class="o">==</span> <span class="s">"player"</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">databaseDidChange</span><span class="p">(</span><span class="n">with</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">DatabaseEvent</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">playerTableWasModified</span> <span class="o">=</span> <span class="kc">true</span>

        <span class="c1">// It is pointless to keep on tracking further changes:</span>
        <span class="nf">stopObservingDatabaseChangesUntilNextTransaction</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>After <code>stopObservingDatabaseChangesUntilNextTransaction()</code>, the <code>databaseDidChange(with:)</code> method will not be notified of any change for the remaining duration of the current transaction. This helps GRDB optimize database observation.</p>
<h3 id='databaseregion' class='heading'>DatabaseRegion</h3>

<p>A <code><a href="Structs/DatabaseRegion.html">DatabaseRegion</a></code> is a reunion of database tables, and combination of columns and rows (identified by their rowid):</p>
<pre class="highlight plaintext"><code>|Table1 |   |Table2 |   |Table3 |   |Table4 |   |Table5 |
|-------|   |-------|   |-------|   |-------|   |-------|
|x|x|x|x|   |x| | | |   |x|x|x|x|   |x|x| |x|   | | | | |
|x|x|x|x|   |x| | | |   | | | | |   | | | | |   | |x| | |
|x|x|x|x|   |x| | | |   | | | | |   |x|x| |x|   | | | | |
|x|x|x|x|   |x| | | |   | | | | |   | | | | |   | | | | |
</code></pre>

<p>DatabaseRegion helps <a href="#valueobservation">ValueObservation</a> and <a href="#databaseregionobservation">DatabaseRegionObservation</a> track changes in the database through the <a href="#transactionobserver-protocol">TransactionObserver</a> protocol.</p>

<p><strong>Note that observing a database region spots <em>potential</em> changes, not <em>actual</em> changes in the results of a request.</strong> A change is notified if and only if a statement has actually modified the tracked tables and columns by inserting, updating, or deleting a row.</p>

<p>For example, if you observe the region of <code>Player.select(max(Column(&quot;score&quot;)))</code>, then you&rsquo;ll get be notified of all changes performed on the <code>score</code> column of the <code>player</code> table (updates, insertions and deletions), even if they do not modify the value of the maximum score. However, you will not get any notification for changes performed on other database tables, or updates to other columns of the player table.</p>

<p>For more details, see the <a href="https://groue.github.io/GRDB.swift/docs/5.21/Structs/DatabaseRegion.html">reference</a>.</p>
<h4 id='the-databaseregionconvertible-protocol' class='heading'>The DatabaseRegionConvertible Protocol</h4>

<p><strong>DatabaseRegionConvertible</strong> is a protocol for all types that can turn into a <a href="#databaseregion">DatabaseRegion</a>:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">DatabaseRegionConvertible</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">databaseRegion</span><span class="p">(</span><span class="n">_</span> <span class="nv">db</span><span class="p">:</span> <span class="kt">Database</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">DatabaseRegion</span>
<span class="p">}</span>
</code></pre>

<p>All <a href="#requests">requests</a> adopt this protocol, and this allows them to be observed with <a href="#databaseregionobservation">DatabaseRegionObservation</a> and <a href="#valueobservation">ValueObservation</a>.</p>

<p>For example:</p>
<pre class="highlight swift"><code><span class="c1">// An observation triggered by all changes to the database</span>
<span class="kt">DatabaseRegionObservation</span><span class="p">(</span><span class="nv">tracking</span><span class="p">:</span> <span class="o">.</span><span class="n">fullDatabase</span><span class="p">)</span>

<span class="c1">// An observation triggered by all changes to the player table</span>
<span class="kt">DatabaseRegionObservation</span><span class="p">(</span><span class="nv">tracking</span><span class="p">:</span> <span class="kt">Table</span><span class="p">(</span><span class="s">"player"</span><span class="p">))</span>

<span class="c1">// An observation triggered by all changes to the row with rowid 1 in the player table</span>
<span class="kt">DatabaseRegionObservation</span><span class="p">(</span><span class="nv">tracking</span><span class="p">:</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1">// An observation triggered by all changes to the score column of the player table</span>
<span class="kt">DatabaseRegionObservation</span><span class="p">(</span><span class="nv">tracking</span><span class="p">:</span> <span class="kt">SQLRequest</span><span class="p">(</span><span class="s">"SELECT score FROM player"</span><span class="p">))</span>
</code></pre>

<p>Note that specifying a region as a request <em>does not run the request</em>. In the above example, <code>Player.filter(id: 1)</code> and <code>SELECT score FROM player</code> are never executed. They are only <em>compiled</em> by SQLite, so that GRDB understands the tables, rows, and columns that constitute the database region.</p>
<h3 id='support-for-sqlite-pre-update-hooks' class='heading'>Support for SQLite Pre-Update Hooks</h3>

<p>When SQLite is built with the SQLITE_ENABLE_PREUPDATE_HOOK option, TransactionObserverType gets an extra callback which lets you observe individual column values in the rows modified by a transaction:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">TransactionObserverType</span> <span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
    <span class="cp">#if SQLITE_ENABLE_PREUPDATE_HOOK</span>
    <span class="c1">/// Notifies before a database change (insert, update, or delete)</span>
    <span class="c1">/// with change information (initial / final values for the row's</span>
    <span class="c1">/// columns).</span>
    <span class="c1">///</span>
    <span class="c1">/// The event is only valid for the duration of this method call. If you</span>
    <span class="c1">/// need to keep it longer, store a copy: event.copy().</span>
    <span class="kd">func</span> <span class="nf">databaseWillChange</span><span class="p">(</span><span class="n">with</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">DatabasePreUpdateEvent</span><span class="p">)</span>
    <span class="cp">#endif</span>
<span class="p">}</span>
</code></pre>

<p>This extra API can be activated in two ways:</p>

<ol>
<li><p>Use the GRDB.swift CocoaPod with a custom compilation option, as below. It uses the system SQLite, which is compiled with SQLITE_ENABLE_PREUPDATE_HOOK support, but only on iOS 11.0+ (we don&rsquo;t know the minimum version of macOS, tvOS, watchOS):</p>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'GRDB.swift'</span>
<span class="n">platform</span> <span class="ss">:ios</span><span class="p">,</span> <span class="s1">'11.0'</span> <span class="c1"># or above</span>

<span class="n">post_install</span> <span class="k">do</span> <span class="o">|</span><span class="n">installer</span><span class="o">|</span>
  <span class="n">installer</span><span class="p">.</span><span class="nf">pods_project</span><span class="p">.</span><span class="nf">targets</span><span class="p">.</span><span class="nf">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">target</span><span class="o">|</span> <span class="n">target</span><span class="p">.</span><span class="nf">name</span> <span class="o">==</span> <span class="s2">"GRDB.swift"</span> <span class="p">}.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">target</span><span class="o">|</span>
    <span class="n">target</span><span class="p">.</span><span class="nf">build_configurations</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
      <span class="c1"># Enable extra GRDB APIs</span>
      <span class="n">config</span><span class="p">.</span><span class="nf">build_settings</span><span class="p">[</span><span class="s1">'OTHER_SWIFT_FLAGS'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"$(inherited) -D SQLITE_ENABLE_PREUPDATE_HOOK"</span>
      <span class="c1"># Enable extra SQLite APIs</span>
      <span class="n">config</span><span class="p">.</span><span class="nf">build_settings</span><span class="p">[</span><span class="s1">'GCC_PREPROCESSOR_DEFINITIONS'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"$(inherited) GRDB_SQLITE_ENABLE_PREUPDATE_HOOK=1"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<blockquote>
<p>:warning: <strong>Warning</strong>: make sure you use the right platform version! You will get runtime errors on devices with a lower version.</p>

<p>:point_up: <strong>Note</strong>: the <code>GRDB_SQLITE_ENABLE_PREUPDATE_HOOK=1</code> option in <code>GCC_PREPROCESSOR_DEFINITIONS</code> defines some C function prototypes that are lacking from the system <code>&lt;sqlite3.h&gt;</code> header. When Xcode eventually ships with an SDK that includes a complete header, you may get a compiler error about duplicate function definitions. When this happens, just remove this <code>GRDB_SQLITE_ENABLE_PREUPDATE_HOOK=1</code> option.</p>
</blockquote></li>
<li><p>Use a <a href="Documentation/CustomSQLiteBuilds.md">custom SQLite build</a> and activate the <code>SQLITE_ENABLE_PREUPDATE_HOOK</code> compilation option.</p></li>
</ol>
<h1 id='encryption' class='heading'>Encryption</h1>

<p><strong>GRDB can encrypt your database with <a href="http://sqlcipher.net">SQLCipher</a> v3.4+.</strong></p>

<p>Use <a href="http://cocoapods.org/">CocoaPods</a>, and specify in your <code>Podfile</code>:</p>
<pre class="highlight ruby"><code><span class="c1"># GRDB with SQLCipher 4</span>
<span class="n">pod</span> <span class="s1">'GRDB.swift/SQLCipher'</span>
<span class="n">pod</span> <span class="s1">'SQLCipher'</span><span class="p">,</span> <span class="s1">'~&gt; 4.0'</span>

<span class="c1"># GRDB with SQLCipher 3</span>
<span class="n">pod</span> <span class="s1">'GRDB.swift/SQLCipher'</span>
<span class="n">pod</span> <span class="s1">'SQLCipher'</span><span class="p">,</span> <span class="s1">'~&gt; 3.4'</span>
</code></pre>

<p>Make sure you remove any existing <code>pod &#39;GRDB.swift&#39;</code> from your Podfile. <code>GRDB.swift/SQLCipher</code> must be the only active GRDB pod in your whole project, or you will face linker or runtime errors, due to the conflicts between SQLCipher and the system SQLite.</p>

<ul>
<li><a href="#creating-or-opening-an-encrypted-database">Creating or Opening an Encrypted Database</a></li>
<li><a href="#changing-the-passphrase-of-an-encrypted-database">Changing the Passphrase of an Encrypted Database</a></li>
<li><a href="#exporting-a-database-to-an-encrypted-database">Exporting a Database to an Encrypted Database</a></li>
<li><a href="#security-considerations">Security Considerations</a></li>
</ul>
<h3 id='creating-or-opening-an-encrypted-database' class='heading'>Creating or Opening an Encrypted Database</h3>

<p><strong>You create and open an encrypted database</strong> by providing a passphrase to your <a href="#database-connections">database connection</a>:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">usePassphrase</span><span class="p">(</span><span class="s">"secret"</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>
</code></pre>

<p>It is also in <code>prepareDatabase</code> that you perform other <a href="https://www.zetetic.net/sqlcipher/sqlcipher-api/">SQLCipher configuration steps</a> that must happen early in the lifetime of a SQLCipher connection. For example:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">usePassphrase</span><span class="p">(</span><span class="s">"secret"</span><span class="p">)</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"PRAGMA cipher_page_size = ..."</span><span class="p">)</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"PRAGMA kdf_iter = ..."</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>
</code></pre>

<p>When you want to open an existing SQLCipher 3 database with SQLCipher 4, you may want to run the <code>cipher_compatibility</code> pragma:</p>
<pre class="highlight swift"><code><span class="c1">// Open an SQLCipher 3 database with SQLCipher 4</span>
<span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">usePassphrase</span><span class="p">(</span><span class="s">"secret"</span><span class="p">)</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"PRAGMA cipher_compatibility = 3"</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>
</code></pre>

<p>See <a href="https://www.zetetic.net/blog/2018/11/30/sqlcipher-400-release/">SQLCipher 4.0.0 Release</a> and <a href="https://discuss.zetetic.net/t/upgrading-to-sqlcipher-4/3283">Upgrading to SQLCipher 4</a> for more information.</p>
<h3 id='changing-the-passphrase-of-an-encrypted-database' class='heading'>Changing the Passphrase of an Encrypted Database</h3>

<p><strong>You can change the passphrase</strong> of an already encrypted database.</p>

<p>When you use a <a href="#database-queues">database queue</a>, open the database with the old passphrase, and then apply the new passphrase:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">changePassphrase</span><span class="p">(</span><span class="s">"newSecret"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>When you use a <a href="#database-pools">database pool</a>, make sure that no concurrent read can happen by changing the passphrase within the <code>barrierWriteWithoutTransaction</code> block. You must also ensure all future reads open a new database connection by calling the <code>invalidateReadOnlyConnections</code> method:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbPool</span><span class="o">.</span><span class="n">barrierWriteWithoutTransaction</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">changePassphrase</span><span class="p">(</span><span class="s">"newSecret"</span><span class="p">)</span>
    <span class="n">dbPool</span><span class="o">.</span><span class="nf">invalidateReadOnlyConnections</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>:point_up: <strong>Note</strong>: When an application wants to keep on using a database queue or pool after the passphrase has changed, it is responsible for providing the correct passphrase to the <code>usePassphrase</code> method called in the database preparation function. Consider:</p>
<pre class="highlight swift"><code><span class="c1">// WRONG: this won't work across a passphrase change</span>
<span class="k">let</span> <span class="nv">passphrase</span> <span class="o">=</span> <span class="k">try</span> <span class="nf">getPassphrase</span><span class="p">()</span>
<span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">usePassphrase</span><span class="p">(</span><span class="n">passphrase</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// CORRECT: get the latest passphrase when it is needed</span>
<span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">passphrase</span> <span class="o">=</span> <span class="k">try</span> <span class="nf">getPassphrase</span><span class="p">()</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">usePassphrase</span><span class="p">(</span><span class="n">passphrase</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>:point_up: <strong>Note</strong>: The <code>DatabasePool.barrierWriteWithoutTransaction</code> method does not prevent <a href="Documentation/Concurrency.md#database-snapshots">database snapshots</a> from accessing the database during the passphrase change, or after the new passphrase has been applied to the database. Those database accesses may throw errors. Applications should provide their own mechanism for invalidating open snapshots before the passphrase is changed.</p>

<p>:point_up: <strong>Note</strong>: Instead of changing the passphrase &ldquo;in place&rdquo; as described here, you can also export the database in a new encrypted database that uses the new passphrase. See <a href="#exporting-a-database-to-an-encrypted-database">Exporting a Database to an Encrypted Database</a>.</p>
</blockquote>
<h3 id='exporting-a-database-to-an-encrypted-database' class='heading'>Exporting a Database to an Encrypted Database</h3>

<p>Providing a passphrase won&rsquo;t encrypt a clear-text database that already exists, though. SQLCipher can&rsquo;t do that, and you will get an error instead: <code>SQLite error 26: file is encrypted or is not a database</code>.</p>

<p>Instead, create a new encrypted database, at a distinct location, and export the content of the existing database. This can both encrypt a clear-text database, or change the passphrase of an encrypted database.</p>

<p>The technique to do that is <a href="https://discuss.zetetic.net/t/how-to-encrypt-a-plaintext-sqlite-database-to-use-sqlcipher-and-avoid-file-is-encrypted-or-is-not-a-database-errors/868/1">documented</a> by SQLCipher.</p>

<p>With GRDB, it gives:</p>
<pre class="highlight swift"><code><span class="c1">// The existing database</span>
<span class="k">let</span> <span class="nv">existingDBQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="s">"/path/to/existing.db"</span><span class="p">)</span>

<span class="c1">// The new encrypted database, at some distinct location:</span>
<span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">usePassphrase</span><span class="p">(</span><span class="s">"secret"</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">newDBQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="s">"/path/to/new.db"</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>

<span class="k">try</span> <span class="n">existingDBQueue</span><span class="o">.</span><span class="n">inDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span>
        <span class="nv">sql</span><span class="p">:</span> <span class="s">"""
            ATTACH DATABASE ? AS encrypted KEY ?;
            SELECT sqlcipher_export('encrypted');
            DETACH DATABASE encrypted;
            """</span><span class="p">,</span>
        <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="n">newDBQueue</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">"secret"</span><span class="p">])</span>
<span class="p">}</span>

<span class="c1">// Now the export is completed, and the existing database can be deleted.</span>
</code></pre>
<h3 id='security-considerations' class='heading'>Security Considerations</h3>
<h4 id='managing-the-lifetime-of-the-passphrase-string' class='heading'>Managing the lifetime of the passphrase string</h4>

<p>It is recommended to avoid keeping the passphrase in memory longer than necessary. To do this, make sure you load the passphrase from the <code>prepareDatabase</code> method:</p>
<pre class="highlight swift"><code><span class="c1">// NOT RECOMMENDED: this keeps the passphrase in memory longer than necessary</span>
<span class="k">let</span> <span class="nv">passphrase</span> <span class="o">=</span> <span class="k">try</span> <span class="nf">getPassphrase</span><span class="p">()</span>
<span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">usePassphrase</span><span class="p">(</span><span class="n">passphrase</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// RECOMMENDED: only load the passphrase when it is needed</span>
<span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">passphrase</span> <span class="o">=</span> <span class="k">try</span> <span class="nf">getPassphrase</span><span class="p">()</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">usePassphrase</span><span class="p">(</span><span class="n">passphrase</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>This technique helps manages the lifetime of the passphrase, although keep in mind that the content of a String may remain intact in memory long after the object has been released.</p>

<p>For even better control over the lifetime of the passphrase in memory, use a Data object which natively provides the <code>resetBytes</code> function.</p>
<pre class="highlight swift"><code><span class="c1">// RECOMMENDED: only load the passphrase when it is needed and reset its content immediately after use</span>
<span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">passphrase</span> <span class="o">=</span> <span class="k">try</span> <span class="nf">getPassphraseData</span><span class="p">()</span> <span class="c1">// Data</span>
    <span class="k">defer</span> <span class="p">{</span>
        <span class="n">passphrase</span><span class="o">.</span><span class="nf">resetBytes</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="mi">0</span><span class="o">..&lt;</span><span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">usePassphrase</span><span class="p">(</span><span class="n">passphrase</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Some demanding users will want to go further, and manage the lifetime of the raw passphrase bytes. See below.</p>
<h4 id='managing-the-lifetime-of-the-passphrase-bytes' class='heading'>Managing the lifetime of the passphrase bytes</h4>

<p>GRDB offers convenience methods for providing the database passphrases as Swift strings: <code>usePassphrase(_:)</code> and <code>changePassphrase(_:)</code>. Those methods don&rsquo;t keep the passphrase String in memory longer than necessary. But they are as secure as the standard String type: the lifetime of actual passphrase bytes in memory is not under control.</p>

<p>When you want to precisely manage the passphrase bytes, talk directly to SQLCipher, using its raw C functions.</p>

<p>For example:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="o">...</span> <span class="c1">// Carefully load passphrase bytes</span>
    <span class="k">let</span> <span class="nv">code</span> <span class="o">=</span> <span class="nf">sqlite3_key</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">sqliteConnection</span><span class="p">,</span> <span class="cm">/* passphrase bytes */</span><span class="p">)</span>
    <span class="o">...</span> <span class="c1">// Carefully dispose passphrase bytes</span>
    <span class="k">guard</span> <span class="n">code</span> <span class="o">==</span> <span class="kt">SQLITE_OK</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">DatabaseError</span><span class="p">(</span>
            <span class="nv">resultCode</span><span class="p">:</span> <span class="kt">ResultCode</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="n">code</span><span class="p">),</span> 
            <span class="nv">message</span><span class="p">:</span> <span class="n">db</span><span class="o">.</span><span class="n">lastErrorMessage</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>
</code></pre>
<h4 id='passphrase-availability-vs-database-availability' class='heading'>Passphrase availability vs. Database availability</h4>

<p>When the passphrase is securely stored in the system keychain, your application can protect it using the <a href="https://developer.apple.com/documentation/security/ksecattraccessible"><code>kSecAttrAccessible</code></a> attribute.</p>

<p>Such protection prevents GRDB from creating SQLite connections when the passphrase is not available:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">passphrase</span> <span class="o">=</span> <span class="k">try</span> <span class="nf">loadPassphraseFromSystemKeychain</span><span class="p">()</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">usePassphrase</span><span class="p">(</span><span class="n">passphrase</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Success if and only if the passphrase is available</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>
</code></pre>

<p>For the same reason, <a href="#database-pools">database pools</a>, which open SQLite connections on demand, may fail at any time as soon as the passphrase becomes unavailable:</p>
<pre class="highlight swift"><code><span class="c1">// Success if and only if the passphrase is available</span>
<span class="k">let</span> <span class="nv">dbPool</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabasePool</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>

<span class="c1">// May fail if passphrase has turned unavailable</span>
<span class="k">try</span> <span class="n">dbPool</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="c1">// May trigger value observation failure if passphrase has turned unavailable</span>
<span class="k">try</span> <span class="n">dbPool</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre>

<p>Because DatabasePool maintains a pool of long-lived SQLite connections, some database accesses will use an existing connection, and succeed. And some other database accesses will fail, as soon as the pool wants to open a new connection. It is impossible to predict which accesses will succeed or fail.</p>

<p>For the same reason, a database queue, which also maintains a long-lived SQLite connection, will remain available even after the passphrase has turned unavailable.</p>

<p>Applications are thus responsible for protecting database accesses when the passphrase is unavailable. To this end, they can use <a href="#data-protection">Data Protection</a>. They can also destroy their instances of database queue or pool when the passphrase becomes unavailable.</p>
<h2 id='backup' class='heading'>Backup</h2>

<p><strong>You can backup (copy) a database into another.</strong></p>

<p>Backups can for example help you copying an in-memory database to and from a database file when you implement NSDocument subclasses.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">source</span><span class="p">:</span> <span class="kt">DatabaseQueue</span> <span class="o">=</span> <span class="o">...</span>      <span class="c1">// or DatabasePool</span>
<span class="k">let</span> <span class="nv">destination</span><span class="p">:</span> <span class="kt">DatabaseQueue</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// or DatabasePool</span>
<span class="k">try</span> <span class="n">source</span><span class="o">.</span><span class="nf">backup</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">destination</span><span class="p">)</span>
</code></pre>

<p>The <code>backup</code> method blocks the current thread until the destination database contains the same contents as the source database.</p>

<p>When the source is a <a href="#database-pools">database pool</a>, concurrent writes can happen during the backup. Those writes may, or may not, be reflected in the backup, but they won&rsquo;t trigger any error.</p>

<p><code><a href="Classes/Database.html">Database</a></code> has an analogous <code>backup</code> method.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">source</span><span class="p">:</span> <span class="kt">DatabaseQueue</span> <span class="o">=</span> <span class="o">...</span>      <span class="c1">// or DatabasePool</span>
<span class="k">let</span> <span class="nv">destination</span><span class="p">:</span> <span class="kt">DatabaseQueue</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// or DatabasePool</span>
<span class="k">try</span> <span class="n">source</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">sourceDb</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">destination</span><span class="o">.</span><span class="n">barrierWriteWithoutTransaction</span> <span class="p">{</span> <span class="n">destDb</span> <span class="k">in</span>
        <span class="k">try</span> <span class="n">sourceDb</span><span class="o">.</span><span class="nf">backup</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">destDb</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>This method allows for the choice of source and destination <code><a href="Classes/Database.html">Database</a></code> handles with which to backup the database.</p>
<h3 id='backup-progress-reporting' class='heading'>Backup Progress Reporting</h3>

<p>The <code>backup</code> methods take optional <code>pagesPerStep</code> and <code>progress</code> parameters. Together these parameters can be used to track a database backup in progress and abort an incomplete backup.</p>

<p>When <code>pagesPerStep</code> is provided, the database backup is performed in <em>steps</em>. At each step, no more than <code>pagesPerStep</code> database pages are copied from the source to the destination. The backup proceeds one step at a time until all pages have been copied.</p>

<p>When a <code>progress</code> callback is provided, <code>progress</code> is called after every backup step, including the last. Even if a non-default <code>pagesPerStep</code> is specified or the backup is otherwise completed in a single step, the <code>progress</code> callback will be called.</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">source</span><span class="o">.</span><span class="nf">backup</span><span class="p">(</span>
    <span class="nv">to</span><span class="p">:</span> <span class="n">destination</span><span class="p">,</span>
    <span class="nv">pagesPerStep</span><span class="p">:</span> <span class="o">...</span><span class="p">)</span>
    <span class="p">{</span> <span class="n">backupProgress</span> <span class="k">in</span>
       <span class="nf">print</span><span class="p">(</span><span class="s">"Database backup progress:"</span><span class="p">,</span> <span class="n">backupProgress</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre>
<h3 id='aborting-an-incomplete-backup' class='heading'>Aborting an Incomplete Backup</h3>

<p>If a call to <code>progress</code> throws when <code>backupProgress.isComplete == false</code>, the backup will be aborted and the error rethrown. However, if a call to <code>progress</code> throws when <code>backupProgress.isComplete == true</code>, the backup is unaffected and the error is silently ignored.</p>

<blockquote>
<p>:warning: <strong>Warning</strong>: Passing non-default values of <code>pagesPerStep</code> or <code>progress</code> to the backup methods is an advanced API intended to provide additional capabilities to expert users. GRDB&rsquo;s backup API provides a faithful, low-level wrapper to the underlying SQLite online backup API. GRDB&rsquo;s documentation is not a comprehensive substitute for the official SQLite <a href="https://www.sqlite.org/c3ref/backup_finish.html">documentation of their backup API</a>.</p>
</blockquote>
<h2 id='interrupt-a-database' class='heading'>Interrupt a Database</h2>

<p><strong>The <code>interrupt()</code> method</strong> causes any pending database operation to abort and return at its earliest opportunity.</p>

<p>It can be called from any thread.</p>
<pre class="highlight swift"><code><span class="n">dbQueue</span><span class="o">.</span><span class="nf">interrupt</span><span class="p">()</span>
<span class="n">dbPool</span><span class="o">.</span><span class="nf">interrupt</span><span class="p">()</span>
</code></pre>

<p>A call to <code>interrupt()</code> that occurs when there are no running SQL statements is a no-op and has no effect on SQL statements that are started after <code>interrupt()</code> returns.</p>

<p>A database operation that is interrupted will throw a DatabaseError with code <code>SQLITE_INTERRUPT</code>. If the interrupted SQL operation is an INSERT, UPDATE, or DELETE that is inside an explicit transaction, then the entire transaction will be rolled back automatically. If the rolled back transaction was started by a transaction-wrapping method such as <code>DatabaseWriter.write</code> or <code>Database.inTransaction</code>, then all database accesses will throw a DatabaseError with code <code>SQLITE_ABORT</code> until the wrapping method returns.</p>

<p>For example:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Player</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>     <span class="c1">// throws SQLITE_INTERRUPT</span>
    <span class="k">try</span> <span class="kt">Player</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>     <span class="c1">// not executed</span>
<span class="p">}</span>                                  <span class="c1">// throws SQLITE_INTERRUPT</span>

<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="k">try</span> <span class="kt">Player</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// throws SQLITE_INTERRUPT</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>                                  <span class="c1">// throws SQLITE_ABORT</span>

<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="k">try</span> <span class="kt">Player</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="c1">// throws SQLITE_INTERRUPT</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">try</span> <span class="kt">Player</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>     <span class="c1">// throws SQLITE_ABORT</span>
<span class="p">}</span>                                  <span class="c1">// throws SQLITE_ABORT</span>
</code></pre>

<p>You can catch both <code>SQLITE_INTERRUPT</code> and <code>SQLITE_ABORT</code> errors:</p>
<pre class="highlight swift"><code><span class="k">do</span> <span class="p">{</span>
    <span class="k">try</span> <span class="n">dbPool</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>
<span class="p">}</span> <span class="k">catch</span> <span class="kt">DatabaseError</span><span class="o">.</span><span class="kt">SQLITE_INTERRUPT</span><span class="p">,</span> <span class="kt">DatabaseError</span><span class="o">.</span><span class="kt">SQLITE_ABORT</span> <span class="p">{</span>
    <span class="c1">// Oops, the database was interrupted.</span>
<span class="p">}</span>
</code></pre>

<p>For more information, see <a href="https://www.sqlite.org/c3ref/interrupt.html">Interrupt A Long-Running Query</a>.</p>
<h2 id='avoiding-sql-injection' class='heading'>Avoiding SQL Injection</h2>

<p>SQL injection is a technique that lets an attacker nuke your database.</p>

<blockquote>
<p><img src="https://imgs.xkcd.com/comics/exploits_of_a_mom.png" alt="XKCD: Exploits of a Mom"></p>

<p><a href="https://xkcd.com/327/">https://xkcd.com/327/</a></p>
</blockquote>

<p>Here is an example of code that is vulnerable to SQL injection:</p>
<pre class="highlight swift"><code><span class="c1">// BAD BAD BAD</span>
<span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">textField</span><span class="o">.</span><span class="n">text</span>
<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE students SET name = '</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">' WHERE id = </span><span class="se">\(</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>If the user enters a funny string like <code>Robert&#39;; DROP TABLE students; --</code>, SQLite will see the following SQL, and drop your database table instead of updating a name as intended:</p>
<pre class="highlight sql"><code><span class="k">UPDATE</span> <span class="n">students</span> <span class="k">SET</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'Robert'</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">students</span><span class="p">;</span>
<span class="c1">--' WHERE id = 1</span>
</code></pre>

<p>To avoid those problems, <strong>never embed raw values in your SQL queries</strong>. The only correct technique is to provide <a href="#executing-updates">arguments</a> to your raw SQL queries:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">textField</span><span class="o">.</span><span class="n">text</span>
<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// Good</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span>
        <span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE students SET name = ? WHERE id = ?"</span><span class="p">,</span>
        <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">id</span><span class="p">])</span>

    <span class="c1">// Just as good</span>
    <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span>
        <span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE students SET name = :name WHERE id = :id"</span><span class="p">,</span>
        <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="s">"name"</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s">"id"</span><span class="p">:</span> <span class="n">id</span><span class="p">])</span>
<span class="p">}</span>
</code></pre>

<p>When you use <a href="#records">records</a> and the <a href="#the-query-interface">query interface</a>, GRDB always prevents SQL injection for you:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">textField</span><span class="o">.</span><span class="n">text</span>
<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">var</span> <span class="nv">student</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Student</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">student</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">try</span> <span class="n">student</span><span class="o">.</span><span class="nf">update</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h2 id='error-handling' class='heading'>Error Handling</h2>

<p>GRDB can throw <a href="#databaseerror">DatabaseError</a>, <a href="#persistenceerror">PersistenceError</a>, or crash your program with a <a href="#fatal-errors">fatal error</a>.</p>

<p>Considering that a local database is not some JSON loaded from a remote server, GRDB focuses on <strong>trusted databases</strong>. Dealing with <a href="#how-to-deal-with-untrusted-inputs">untrusted databases</a> requires extra care.</p>

<ul>
<li><a href="#databaseerror">DatabaseError</a></li>
<li><a href="#persistenceerror">PersistenceError</a></li>
<li><a href="#fatal-errors">Fatal Errors</a></li>
<li><a href="#how-to-deal-with-untrusted-inputs">How to Deal with Untrusted Inputs</a></li>
<li><a href="#error-log">Error Log</a></li>
</ul>
<h3 id='databaseerror' class='heading'>DatabaseError</h3>

<p><strong>DatabaseError</strong> are thrown on SQLite errors:</p>
<pre class="highlight swift"><code><span class="k">do</span> <span class="p">{</span>
    <span class="k">try</span> <span class="kt">Pet</span><span class="p">(</span><span class="nv">masterId</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Bobby"</span><span class="p">)</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="k">let</span> <span class="nv">error</span> <span class="k">as</span> <span class="kt">DatabaseError</span> <span class="p">{</span>
    <span class="c1">// The SQLite error code: 19 (SQLITE_CONSTRAINT)</span>
    <span class="n">error</span><span class="o">.</span><span class="n">resultCode</span>

    <span class="c1">// The extended error code: 787 (SQLITE_CONSTRAINT_FOREIGNKEY)</span>
    <span class="n">error</span><span class="o">.</span><span class="n">extendedResultCode</span>

    <span class="c1">// The eventual SQLite message: FOREIGN KEY constraint failed</span>
    <span class="n">error</span><span class="o">.</span><span class="n">message</span>

    <span class="c1">// The eventual erroneous SQL query</span>
    <span class="c1">// "INSERT INTO pet (masterId, name) VALUES (?, ?)"</span>
    <span class="n">error</span><span class="o">.</span><span class="n">sql</span>

    <span class="c1">// The eventual SQL arguments</span>
    <span class="c1">// [1, "Bobby"]</span>
    <span class="n">error</span><span class="o">.</span><span class="n">arguments</span>

    <span class="c1">// Full error description</span>
    <span class="c1">// &gt; SQLite error 19: FOREIGN KEY constraint failed -</span>
    <span class="c1">// &gt; while executing `INSERT INTO pet (masterId, name) VALUES (?, ?)`</span>
    <span class="n">error</span><span class="o">.</span><span class="n">description</span>
<span class="p">}</span>
</code></pre>

<p>If you want to see statement arguments in the error description, <a href="#database-configuration">make statement arguments public</a>.</p>

<p><strong>SQLite uses <a href="https://www.sqlite.org/rescode.html">results codes</a> to distinguish between various errors</strong>.</p>

<p>You can catch a DatabaseError and match on result codes:</p>
<pre class="highlight swift"><code><span class="k">do</span> <span class="p">{</span>
    <span class="k">try</span> <span class="o">...</span>
<span class="p">}</span> <span class="k">catch</span> <span class="k">let</span> <span class="nv">error</span> <span class="k">as</span> <span class="kt">DatabaseError</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kt">DatabaseError</span><span class="o">.</span><span class="kt">SQLITE_CONSTRAINT_FOREIGNKEY</span><span class="p">:</span>
        <span class="c1">// foreign key constraint error</span>
    <span class="k">case</span> <span class="kt">DatabaseError</span><span class="o">.</span><span class="kt">SQLITE_CONSTRAINT</span><span class="p">:</span>
        <span class="c1">// any other constraint error</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="c1">// any other database error</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>You can also directly match errors on result codes:</p>
<pre class="highlight swift"><code><span class="k">do</span> <span class="p">{</span>
    <span class="k">try</span> <span class="o">...</span>
<span class="p">}</span> <span class="k">catch</span> <span class="kt">DatabaseError</span><span class="o">.</span><span class="kt">SQLITE_CONSTRAINT_FOREIGNKEY</span> <span class="p">{</span>
    <span class="c1">// foreign key constraint error</span>
<span class="p">}</span> <span class="k">catch</span> <span class="kt">DatabaseError</span><span class="o">.</span><span class="kt">SQLITE_CONSTRAINT</span> <span class="p">{</span>
    <span class="c1">// any other constraint error</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
    <span class="c1">// any other database error</span>
<span class="p">}</span>
</code></pre>

<p>Each DatabaseError has two codes: an <code>extendedResultCode</code> (see <a href="https://www.sqlite.org/rescode.html#extended_result_code_list">extended result code</a>), and a less precise <code>resultCode</code> (see <a href="https://www.sqlite.org/rescode.html#primary_result_code_list">primary result code</a>). Extended result codes are refinements of primary result codes, as <code>SQLITE_CONSTRAINT_FOREIGNKEY</code> is to <code>SQLITE_CONSTRAINT</code>, for example.</p>

<blockquote>
<p>:warning: <strong>Warning</strong>: SQLite has progressively introduced extended result codes across its versions. The <a href="http://www.sqlite.org/changes.html">SQLite release notes</a> are unfortunately not quite clear about that: write your handling of extended result codes with care.</p>
</blockquote>
<h3 id='persistenceerror' class='heading'>PersistenceError</h3>

<p><strong>PersistenceError</strong> is thrown by the <a href="#persistablerecord-protocol">PersistableRecord</a> protocol, in a single case: when the <code>update</code> method could not find any row to update:</p>
<pre class="highlight swift"><code><span class="k">do</span> <span class="p">{</span>
    <span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">update</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="k">let</span> <span class="nv">PersistenceError</span><span class="o">.</span><span class="nf">recordNotFound</span><span class="p">(</span><span class="nv">databaseTableName</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Key </span><span class="se">\(</span><span class="n">key</span><span class="se">)</span><span class="s"> was not found in table </span><span class="se">\(</span><span class="n">table</span><span class="se">)</span><span class="s">."</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<h3 id='fatal-errors' class='heading'>Fatal Errors</h3>

<p><strong>Fatal errors notify that the program, or the database, has to be changed.</strong></p>

<p>They uncover programmer errors, false assumptions, and prevent misuses. Here are a few examples:</p>

<ul>
<li><p><strong>The code asks for a non-optional value, when the database contains NULL:</strong></p>
<pre class="highlight swift"><code><span class="c1">// fatal error: could not convert NULL to String.</span>
<span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span>
</code></pre>

<p>Solution: fix the contents of the database, use <a href="#create-tables">NOT NULL constraints</a>, or load an optional:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span>
</code></pre></li>
<li><p><strong>Conversion from database value to Swift type fails:</strong></p>
<pre class="highlight swift"><code><span class="c1">// fatal error: could not convert "Mom’s birthday" to Date.</span>
<span class="k">let</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">Date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"date"</span><span class="p">]</span>

<span class="c1">// fatal error: could not convert "" to URL.</span>
<span class="k">let</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"url"</span><span class="p">]</span>
</code></pre>

<p>Solution: fix the contents of the database, or use <a href="#databasevalue">DatabaseValue</a> to handle all possible cases:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">dbValue</span><span class="p">:</span> <span class="kt">DatabaseValue</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"date"</span><span class="p">]</span>
<span class="k">if</span> <span class="n">dbValue</span><span class="o">.</span><span class="n">isNull</span> <span class="p">{</span>
    <span class="c1">// Handle NULL</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">date</span> <span class="o">=</span> <span class="kt">Date</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">dbValue</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handle valid date</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Handle invalid date</span>
<span class="p">}</span>
</code></pre></li>
<li><p><strong>The database can&rsquo;t guarantee that the code does what it says:</strong></p>
<pre class="highlight swift"><code><span class="c1">// fatal error: table player has no unique index on column email</span>
<span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">deleteOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="p">[</span><span class="s">"email"</span><span class="p">:</span> <span class="s">"arthur@example.com"</span><span class="p">])</span>
</code></pre>

<p>Solution: add a unique index to the player.email column, or use the <code>deleteAll</code> method to make it clear that you may delete more than one row:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"email"</span><span class="p">)</span> <span class="o">==</span> <span class="s">"arthur@example.com"</span><span class="p">)</span><span class="o">.</span><span class="nf">deleteAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre></li>
<li><p><strong>Database connections are not reentrant:</strong></p>
<pre class="highlight swift"><code><span class="c1">// fatal error: Database methods are not reentrant.</span>
<span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="n">dbQueue</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Solution: avoid reentrancy, and instead pass a database connection along.</p></li>
</ul>
<h3 id='how-to-deal-with-untrusted-inputs' class='heading'>How to Deal with Untrusted Inputs</h3>

<p>Let&rsquo;s consider the code below:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">sql</span> <span class="o">=</span> <span class="s">"SELECT ..."</span>

<span class="c1">// Some untrusted arguments for the query</span>
<span class="k">let</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">let</span> <span class="nv">rows</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="n">sql</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="kt">StatementArguments</span><span class="p">(</span><span class="n">arguments</span><span class="p">))</span>

<span class="k">while</span> <span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rows</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Some untrusted database value:</span>
    <span class="k">let</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">Date</span><span class="p">?</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">}</span>
</code></pre>

<p>It has two opportunities to throw fatal errors:</p>

<ul>
<li><strong>Untrusted arguments</strong>: The dictionary may contain values that do not conform to the <a href="#values">DatabaseValueConvertible protocol</a>, or may miss keys required by the statement.</li>
<li><strong>Untrusted database content</strong>: The row may contain a non-null value that can&rsquo;t be turned into a date.</li>
</ul>

<p>In such a situation, you can still avoid fatal errors by exposing and handling each failure point, one level down in the GRDB API:</p>
<pre class="highlight swift"><code><span class="c1">// Untrusted arguments</span>
<span class="k">if</span> <span class="k">let</span> <span class="nv">arguments</span> <span class="o">=</span> <span class="kt">StatementArguments</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">statement</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">makeStatement</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="n">sql</span><span class="p">)</span>
    <span class="k">try</span> <span class="n">statement</span><span class="o">.</span><span class="nf">setArguments</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>

    <span class="k">var</span> <span class="nv">cursor</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Row</span><span class="o">.</span><span class="nf">fetchCursor</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
    <span class="k">while</span> <span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="k">try</span> <span class="n">iterator</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Untrusted database content</span>
        <span class="k">let</span> <span class="nv">dbValue</span><span class="p">:</span> <span class="kt">DatabaseValue</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dbValue</span><span class="o">.</span><span class="n">isNull</span> <span class="p">{</span>
            <span class="c1">// Handle NULL</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">date</span> <span class="o">=</span> <span class="kt">Date</span><span class="o">.</span><span class="nf">fromDatabaseValue</span><span class="p">(</span><span class="n">dbValue</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Handle valid date</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Handle invalid date</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>See <a href="#prepared-statements">prepared statements</a> and <a href="#databasevalue">DatabaseValue</a> for more information.</p>
<h3 id='error-log' class='heading'>Error Log</h3>

<p><strong>SQLite can be configured to invoke a callback function containing an error code and a terse error message whenever anomalies occur.</strong></p>

<p>This global error callback must be configured early in the lifetime of your application:</p>
<pre class="highlight swift"><code><span class="kt">Database</span><span class="o">.</span><span class="n">logError</span> <span class="o">=</span> <span class="p">{</span> <span class="p">(</span><span class="n">resultCode</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> <span class="k">in</span>
    <span class="kt">NSLog</span><span class="p">(</span><span class="s">"%@"</span><span class="p">,</span> <span class="s">"SQLite error </span><span class="se">\(</span><span class="n">resultCode</span><span class="se">)</span><span class="s">: </span><span class="se">\(</span><span class="n">message</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>:warning: <strong>Warning</strong>: Database.logError must be set before any database connection is opened. This includes the connections that your application opens with GRDB, but also connections opened by other tools, such as third-party libraries. Setting it after a connection has been opened is an SQLite misuse, and has no effect.</p>
</blockquote>

<p>See <a href="https://sqlite.org/errlog.html">The Error And Warning Log</a> for more information.</p>
<h2 id='unicode' class='heading'>Unicode</h2>

<p>SQLite lets you store unicode strings in the database.</p>

<p>However, SQLite does not provide any unicode-aware string transformations or comparisons.</p>
<h3 id='unicode-functions' class='heading'>Unicode functions</h3>

<p>The <code>UPPER</code> and <code>LOWER</code> built-in SQLite functions are not unicode-aware:</p>
<pre class="highlight swift"><code><span class="c1">// "JéRôME"</span>
<span class="k">try</span> <span class="kt">String</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT UPPER('Jérôme')"</span><span class="p">)</span>
</code></pre>

<p>GRDB extends SQLite with <a href="#custom-sql-functions-and-aggregates">SQL functions</a> that call the Swift built-in string functions <code>capitalized</code>, <code>lowercased</code>, <code>uppercased</code>, <code>localizedCapitalized</code>, <code>localizedLowercased</code> and <code>localizedUppercased</code>:</p>
<pre class="highlight swift"><code><span class="c1">// "JÉRÔME"</span>
<span class="k">let</span> <span class="nv">uppercased</span> <span class="o">=</span> <span class="kt">DatabaseFunction</span><span class="o">.</span><span class="n">uppercase</span>
<span class="k">try</span> <span class="kt">String</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT </span><span class="se">\(</span><span class="n">uppercased</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">('Jérôme')"</span><span class="p">)</span>
</code></pre>

<p>Those unicode-aware string functions are also readily available in the <a href="#sql-functions">query interface</a>:</p>
<pre class="highlight swift"><code><span class="kt">Player</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">nameColumn</span><span class="o">.</span><span class="n">uppercased</span><span class="p">)</span>
</code></pre>
<h3 id='string-comparison' class='heading'>String Comparison</h3>

<p>SQLite compares strings in many occasions: when you sort rows according to a string column, or when you use a comparison operator such as <code>=</code> and <code>&lt;=</code>.</p>

<p>The comparison result comes from a <em>collating function</em>, or <em>collation</em>. SQLite comes with three built-in collations that do not support Unicode: <a href="https://www.sqlite.org/datatype3.html#collation">binary, nocase, and rtrim</a>.</p>

<p>GRDB comes with five extra collations that leverage unicode-aware comparisons based on the standard Swift String comparison functions and operators:</p>

<ul>
<li><code>unicodeCompare</code> (uses the built-in <code>&lt;=</code> and <code>==</code> Swift operators)</li>
<li><code>caseInsensitiveCompare</code></li>
<li><code>localizedCaseInsensitiveCompare</code></li>
<li><code>localizedCompare</code></li>
<li><code>localizedStandardCompare</code></li>
</ul>

<p>A collation can be applied to a table column. All comparisons involving this column will then automatically trigger the comparison function:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">table</span><span class="p">:</span> <span class="s">"player"</span><span class="p">)</span> <span class="p">{</span> <span class="n">t</span> <span class="k">in</span>
    <span class="c1">// Guarantees case-insensitive email unicity</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"email"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="nf">unique</span><span class="p">()</span><span class="o">.</span><span class="nf">collate</span><span class="p">(</span><span class="o">.</span><span class="n">nocase</span><span class="p">)</span>

    <span class="c1">// Sort names in a localized case insensitive way</span>
    <span class="n">t</span><span class="o">.</span><span class="nf">column</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="nf">collate</span><span class="p">(</span><span class="o">.</span><span class="n">localizedCaseInsensitiveCompare</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Players are sorted in a localized case insensitive way:</span>
<span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">nameColumn</span><span class="p">)</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre>

<blockquote>
<p>:warning: <strong>Warning</strong>: SQLite <em>requires</em> host applications to provide the definition of any collation other than binary, nocase and rtrim. When a database file has to be shared or migrated to another SQLite library of platform (such as the Android version of your application), make sure you provide a compatible collation.</p>
</blockquote>

<p>If you can&rsquo;t or don&rsquo;t want to define the comparison behavior of a column (see warning above), you can still use an explicit collation in SQL requests and in the <a href="#the-query-interface">query interface</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">collation</span> <span class="o">=</span> <span class="kt">DatabaseCollation</span><span class="o">.</span><span class="n">localizedCaseInsensitiveCompare</span>
<span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span>
    <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM player ORDER BY name COLLATE </span><span class="se">\(</span><span class="n">collation</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">)"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">order</span><span class="p">(</span><span class="n">nameColumn</span><span class="o">.</span><span class="nf">collating</span><span class="p">(</span><span class="n">collation</span><span class="p">))</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre>

<p><strong>You can also define your own collations</strong>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">collation</span> <span class="o">=</span> <span class="kt">DatabaseCollation</span><span class="p">(</span><span class="s">"customCollation"</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">NSComparisonResult</span> <span class="k">in</span>
    <span class="c1">// return the comparison of lhs and rhs strings.</span>
<span class="p">}</span>

<span class="c1">// Make the collation available to a database connection</span>
<span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="n">db</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">collation</span><span class="p">:</span> <span class="n">collation</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>
</code></pre>
<h2 id='memory-management' class='heading'>Memory Management</h2>

<p>Both SQLite and GRDB use non-essential memory that help them perform better.</p>

<p>You can reclaim this memory with the <code>releaseMemory</code> method:</p>
<pre class="highlight swift"><code><span class="c1">// Release as much memory as possible.</span>
<span class="n">dbQueue</span><span class="o">.</span><span class="nf">releaseMemory</span><span class="p">()</span>
<span class="n">dbPool</span><span class="o">.</span><span class="nf">releaseMemory</span><span class="p">()</span>
</code></pre>

<p>This method blocks the current thread until all current database accesses are completed, and the memory collected.</p>
<h3 id='memory-management-on-ios' class='heading'>Memory Management on iOS</h3>

<p><strong>The iOS operating system likes applications that do not consume much memory.</strong></p>

<p><a href="#database-queues">Database queues</a> and <a href="#database-pools">pools</a> automatically call the <code>releaseMemory</code> method when the application receives a memory warning, and when the application enters background.</p>
<h2 id='data-protection' class='heading'>Data Protection</h2>

<p><a href="https://developer.apple.com/library/content/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/StrategiesforImplementingYourApp/StrategiesforImplementingYourApp.html#//apple_ref/doc/uid/TP40007072-CH5-SW21">Data Protection</a> lets you protect files so that they are encrypted and unavailable until the device is unlocked.</p>

<p>Data protection can be enabled <a href="https://developer.apple.com/library/content/documentation/IDEs/Conceptual/AppDistributionGuide/AddingCapabilities/AddingCapabilities.html#//apple_ref/doc/uid/TP40012582-CH26-SW30">globally</a> for all files created by an application.</p>

<p>You can also explicitly protect a database, by configuring its enclosing <em>directory</em>. This will not only protect the database file, but also all <a href="https://www.sqlite.org/tempfiles.html">temporary files</a> created by SQLite (including the persistent <code>.shm</code> and <code>.wal</code> files created by <a href="#database-pools">database pools</a>).</p>

<p>For example, to explicitly use <a href="https://developer.apple.com/reference/foundation/fileprotectiontype/1616200-complete">complete</a> protection:</p>
<pre class="highlight swift"><code><span class="c1">// Paths</span>
<span class="k">let</span> <span class="nv">fileManager</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span>
<span class="k">let</span> <span class="nv">directoryURL</span> <span class="o">=</span> <span class="k">try</span> <span class="n">fileManager</span>
    <span class="o">.</span><span class="nf">url</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">applicationSupportDirectory</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">userDomainMask</span><span class="p">,</span> <span class="nv">appropriateFor</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">create</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">appendingPathComponent</span><span class="p">(</span><span class="s">"database"</span><span class="p">,</span> <span class="nv">isDirectory</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">databaseURL</span> <span class="o">=</span> <span class="n">directoryURL</span><span class="o">.</span><span class="nf">appendingPathComponent</span><span class="p">(</span><span class="s">"db.sqlite"</span><span class="p">)</span>

<span class="c1">// Create directory if needed</span>
<span class="k">var</span> <span class="nv">isDirectory</span><span class="p">:</span> <span class="kt">ObjCBool</span> <span class="o">=</span> <span class="kc">false</span>
<span class="k">if</span> <span class="o">!</span><span class="n">fileManager</span><span class="o">.</span><span class="nf">fileExists</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">directoryURL</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="nv">isDirectory</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">isDirectory</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="n">fileManager</span><span class="o">.</span><span class="nf">createDirectory</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">directoryURL</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="nv">withIntermediateDirectories</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">!</span><span class="n">isDirectory</span><span class="o">.</span><span class="n">boolValue</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="kt">NSError</span><span class="p">(</span><span class="nv">domain</span><span class="p">:</span> <span class="kt">NSCocoaErrorDomain</span><span class="p">,</span> <span class="nv">code</span><span class="p">:</span> <span class="kt">NSFileWriteFileExistsError</span><span class="p">,</span> <span class="nv">userInfo</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Enable data protection</span>
<span class="k">try</span> <span class="n">fileManager</span><span class="o">.</span><span class="nf">setAttributes</span><span class="p">([</span><span class="o">.</span><span class="nv">protectionKey</span> <span class="p">:</span> <span class="kt">FileProtectionType</span><span class="o">.</span><span class="n">complete</span><span class="p">],</span> <span class="nv">ofItemAtPath</span><span class="p">:</span> <span class="n">directoryURL</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

<span class="c1">// Open database</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">databaseURL</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</code></pre>

<p>When a database is protected, an application that runs in the background on a locked device won&rsquo;t be able to read or write from it. Instead, it will get <a href="#error-handling">DatabaseError</a> with code <a href="https://www.sqlite.org/rescode.html#ioerr"><code>SQLITE_IOERR</code></a> (10) &ldquo;disk I/O error&rdquo;, or <a href="https://www.sqlite.org/rescode.html#auth"><code>SQLITE_AUTH</code></a> (23) &ldquo;not authorized&rdquo;.</p>

<p>You can catch those errors and wait for <a href="https://developer.apple.com/reference/uikit/uiapplicationdelegate/1623044-applicationprotecteddatadidbecom">UIApplicationDelegate.applicationProtectedDataDidBecomeAvailable(_:)</a> or <a href="https://developer.apple.com/reference/uikit/uiapplicationprotecteddatadidbecomeavailable">UIApplicationProtectedDataDidBecomeAvailable</a> notification in order to retry the failed database operation.</p>
<h1 id='faq' class='heading'>FAQ</h1>

<p><strong><a href="#faq-opening-connections">FAQ: Opening Connections</a></strong></p>

<ul>
<li><a href="#how-do-i-create-a-database-in-my-application">How do I create a database in my application?</a></li>
<li><a href="#how-do-i-open-a-database-stored-as-a-resource-of-my-application">How do I open a database stored as a resource of my application?</a></li>
<li><a href="#how-do-i-close-a-database-connection">How do I close a database connection?</a></li>
</ul>

<p><strong><a href="#faq-sql">FAQ: SQL</a></strong></p>

<ul>
<li><a href="#how-do-i-print-a-request-as-sql">How do I print a request as SQL?</a></li>
</ul>

<p><strong><a href="#faq-general">FAQ: General</a></strong></p>

<ul>
<li><a href="#how-do-i-monitor-the-duration-of-database-statements-execution">How do I monitor the duration of database statements execution?</a></li>
<li><a href="#what-are-experimental-features">What Are Experimental Features?</a></li>
<li><a href="#does-grdb-support-library-evolution-and-abi-stability">Does GRDB support library evolution and ABI stability?</a></li>
</ul>

<p><strong><a href="#faq-associations">FAQ: Associations</a></strong></p>

<ul>
<li><a href="#how-do-i-filter-records-and-only-keep-those-that-are-associated-to-another-record">How do I filter records and only keep those that are associated to another record?</a></li>
<li><a href="#how-do-i-filter-records-and-only-keep-those-that-are-not-associated-to-another-record">How do I filter records and only keep those that are NOT associated to another record?</a></li>
<li><a href="#how-do-i-select-only-one-column-of-an-associated-record">How do I select only one column of an associated record?</a></li>
</ul>

<p><strong><a href="#faq-valueobservation">FAQ: ValueObservation</a></strong></p>

<ul>
<li><a href="#why-is-valueobservation-not-publishing-value-changes">Why is ValueObservation not publishing value changes?</a></li>
</ul>

<p><strong><a href="#faq-errors">FAQ: Errors</a></strong></p>

<ul>
<li><a href="#generic-parameter-t-could-not-be-inferred">Generic parameter &lsquo;T&rsquo; could not be inferred</a></li>
<li><a href="#mutation-of-captured-var-in-concurrently-executing-code">Mutation of captured var in concurrently-executing code</a></li>
<li><a href="#sqlite-error-1-no-such-column">SQLite error 1 &ldquo;no such column&rdquo;</a></li>
<li><a href="#sqlite-error-10-disk-io-error-sqlite-error-23-not-authorized">SQLite error 10 &ldquo;disk I/O error&rdquo;, SQLite error 23 &ldquo;not authorized&rdquo;</a></li>
<li><a href="#sqlite-error-21-wrong-number-of-statement-arguments-with-like-queries">SQLite error 21 &ldquo;wrong number of statement arguments&rdquo; with LIKE queries</a></li>
</ul>
<h2 id='faq-opening-connections' class='heading'>FAQ: Opening Connections</h2>

<ul>
<li>:arrow_up: <a href="#faq">FAQ</a></li>
<li><a href="#how-do-i-create-a-database-in-my-application">How do I create a database in my application?</a></li>
<li><a href="#how-do-i-open-a-database-stored-as-a-resource-of-my-application">How do I open a database stored as a resource of my application?</a></li>
<li><a href="#how-do-i-close-a-database-connection">How do I close a database connection?</a></li>
</ul>
<h3 id='how-do-i-create-a-database-in-my-application' class='heading'>How do I create a database in my application?</h3>

<p>This question assumes that your application has to create a new database from scratch. If your app has to open an existing database that is embedded inside your application as a resource, see <a href="#how-do-i-open-a-database-stored-as-a-resource-of-my-application">How do I open a database stored as a resource of my application?</a> instead.</p>

<p>The database has to be stored in a valid place where it can be created and modified. For example, in the <a href="https://developer.apple.com/library/content/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/FileSystemOverview/FileSystemOverview.html">Application Support directory</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">databaseURL</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span>
    <span class="o">.</span><span class="nf">url</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">applicationSupportDirectory</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">userDomainMask</span><span class="p">,</span> <span class="nv">appropriateFor</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">create</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">appendingPathComponent</span><span class="p">(</span><span class="s">"db.sqlite"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">databaseURL</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</code></pre>
<h3 id='how-do-i-open-a-database-stored-as-a-resource-of-my-application' class='heading'>How do I open a database stored as a resource of my application?</h3>

<p>If your application does not need to modify the database, open a read-only <a href="#database-connections">connection</a> to your resource:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">readonly</span> <span class="o">=</span> <span class="kc">true</span>
<span class="k">let</span> <span class="nv">dbPath</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"db"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"sqlite"</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>
</code></pre>

<p>If the application should modify the database, you need to copy it to a place where it can be modified. For example, in the <a href="https://developer.apple.com/library/content/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/FileSystemOverview/FileSystemOverview.html">Application Support directory</a>. Only then, open a <a href="#database-connections">connection</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">fileManager</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span>
<span class="k">let</span> <span class="nv">dbPath</span> <span class="o">=</span> <span class="k">try</span> <span class="n">fileManager</span>
    <span class="o">.</span><span class="nf">url</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">applicationSupportDirectory</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">userDomainMask</span><span class="p">,</span> <span class="nv">appropriateFor</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">create</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">appendingPathComponent</span><span class="p">(</span><span class="s">"db.sqlite"</span><span class="p">)</span>
    <span class="o">.</span><span class="n">path</span>
<span class="k">if</span> <span class="o">!</span><span class="n">fileManager</span><span class="o">.</span><span class="nf">fileExists</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">dbResourcePath</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"db"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"sqlite"</span><span class="p">)</span><span class="o">!</span>
    <span class="k">try</span> <span class="n">fileManager</span><span class="o">.</span><span class="nf">copyItem</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">dbResourcePath</span><span class="p">,</span> <span class="nv">toPath</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">)</span>
</code></pre>
<h3 id='how-do-i-close-a-database-connection' class='heading'>How do I close a database connection?</h3>

<p>Database connections are automatically closed when they are deinitialized.</p>

<p>When the correct execution of your program depends on precise database closing, use the <code>close()</code> method:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre>

<p>This explicit <code>close()</code> may fail with an error. See the inline documentation of this method for more information. Generally speaking, you should not call this method: rely on automatic closing instead.</p>
<h2 id='faq-sql' class='heading'>FAQ: SQL</h2>

<ul>
<li>:arrow_up: <a href="#faq">FAQ</a></li>
<li><a href="#how-do-i-print-a-request-as-sql">How do I print a request as SQL?</a></li>
</ul>
<h3 id='how-do-i-print-a-request-as-sql' class='heading'>How do I print a request as SQL?</h3>

<p>When you want to debug a request that does not deliver the expected results, you may want to print the SQL that is actually executed.</p>

<p>You can compile the request into a prepared statement:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"email"</span><span class="p">)</span> <span class="o">==</span> <span class="s">"arthur@example.com"</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">statement</span> <span class="o">=</span> <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">makePreparedRequest</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="o">.</span><span class="n">statement</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span> <span class="c1">// SELECT * FROM player WHERE email = ?</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">statement</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span> <span class="c1">// ["arthur@example.com"]</span>
<span class="p">}</span>
</code></pre>

<p>Another option is to setup a tracing function that prints out the executed SQL requests. For example, provide a tracing function when you connect to the database:</p>
<pre class="highlight swift"><code><span class="c1">// Prints all SQL statements</span>
<span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="n">db</span><span class="o">.</span><span class="n">trace</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>

<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// Prints "SELECT * FROM player WHERE email = ?"</span>
    <span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"email"</span><span class="p">)</span> <span class="o">==</span> <span class="s">"arthur@example.com"</span><span class="p">)</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>If you want to see statement arguments such as <code>&#39;arthur@example.com&#39;</code> in the logged statements, <a href="#database-configuration">make statement arguments public</a>.</p>

<blockquote>
<p>:point_up: <strong>Note</strong>: the generated SQL may change between GRDB releases, without notice: don&rsquo;t have your application rely on any specific SQL output.</p>
</blockquote>
<h2 id='faq-general' class='heading'>FAQ: General</h2>

<ul>
<li>:arrow_up: <a href="#faq">FAQ</a></li>
<li><a href="#how-do-i-monitor-the-duration-of-database-statements-execution">How do I monitor the duration of database statements execution?</a></li>
<li><a href="#what-are-experimental-features">What Are Experimental Features?</a></li>
<li><a href="#does-grdb-support-library-evolution-and-abi-stability">Does GRDB support library evolution and ABI stability?</a></li>
</ul>
<h3 id='how-do-i-monitor-the-duration-of-database-statements-execution' class='heading'>How do I monitor the duration of database statements execution?</h3>

<p>Use the <code>trace(options:_:)</code> method, with the <code>.profile</code> option:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="n">db</span><span class="o">.</span><span class="nf">trace</span><span class="p">(</span><span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">profile</span><span class="p">)</span> <span class="p">{</span> <span class="n">event</span> <span class="k">in</span>
        <span class="c1">// Prints all SQL statements with their duration</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="c1">// Access to detailed profiling information</span>
        <span class="k">if</span> <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">profile</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span> <span class="o">=</span> <span class="n">event</span><span class="p">,</span> <span class="n">duration</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Slow query: </span><span class="se">\(</span><span class="n">statement</span><span class="o">.</span><span class="n">sql</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>

<span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="kt">Column</span><span class="p">(</span><span class="s">"email"</span><span class="p">)</span> <span class="o">==</span> <span class="s">"arthur@example.com"</span><span class="p">)</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="c1">// Prints "0.003s SELECT * FROM player WHERE email = ?"</span>
<span class="p">}</span>
</code></pre>

<p>If you want to see statement arguments such as <code>&#39;arthur@example.com&#39;</code> in the logged statements, <a href="#database-configuration">make statement arguments public</a>.</p>
<h3 id='what-are-experimental-features' class='heading'>What Are Experimental Features?</h3>

<p>Since GRDB 1.0, all backwards compatibility guarantees of <a href="http://semver.org">semantic versioning</a> apply: no breaking change will happen until the next major version of the library.</p>

<p>There is an exception, though: <em>experimental features</em>, marked with the &ldquo;<strong>:fire: EXPERIMENTAL</strong>&rdquo; badge. Those are advanced features that are too young, or lack user feedback. They are not stabilized yet.</p>

<p>Those experimental features are not protected by semantic versioning, and may break between two minor releases of the library. To help them becoming stable, <a href="https://github.com/groue/GRDB.swift/issues">your feedback</a> is greatly appreciated.</p>
<h3 id='does-grdb-support-library-evolution-and-abi-stability' class='heading'>Does GRDB support library evolution and ABI stability?</h3>

<p>No, GRDB does not support library evolution and ABI stability. The only promise is API stability according to <a href="http://semver.org">semantic versioning</a>, with an exception for <a href="#what-are-experimental-features">experimental features</a>.</p>

<p>Yet, GRDB can be built with the &ldquo;Build Libraries for Distribution&rdquo; Xcode option (<code>BUILD_LIBRARY_FOR_DISTRIBUTION</code>), so that you can build binary frameworks at your convenience.</p>
<h2 id='faq-associations' class='heading'>FAQ: Associations</h2>

<ul>
<li>:arrow_up: <a href="#faq">FAQ</a></li>
<li><a href="#how-do-i-filter-records-and-only-keep-those-that-are-associated-to-another-record">How do I filter records and only keep those that are associated to another record?</a></li>
<li><a href="#how-do-i-filter-records-and-only-keep-those-that-are-not-associated-to-another-record">How do I filter records and only keep those that are NOT associated to another record?</a></li>
<li><a href="#how-do-i-select-only-one-column-of-an-associated-record">How do I select only one column of an associated record?</a></li>
</ul>
<h3 id='how-do-i-filter-records-and-only-keep-those-that-are-associated-to-another-record' class='heading'>How do I filter records and only keep those that are associated to another record?</h3>

<p>Let&rsquo;s say you have two record types, <code>Book</code> and <code>Author</code>, and you want to only fetch books that have an author, and discard anonymous books.</p>

<p>We start by defining the association between books and authors:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Book</span><span class="p">:</span> <span class="kt">TableRecord</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">author</span> <span class="o">=</span> <span class="nf">belongsTo</span><span class="p">(</span><span class="kt">Author</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Author</span><span class="p">:</span> <span class="kt">TableRecord</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre>

<p>And then we can write our request and only fetch books that have an author, discarding anonymous ones:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">books</span><span class="p">:</span> <span class="p">[</span><span class="kt">Book</span><span class="p">]</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// SELECT book.* FROM book </span>
    <span class="c1">// JOIN author ON author.id = book.authorID</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Book</span><span class="o">.</span><span class="nf">joining</span><span class="p">(</span><span class="nv">required</span><span class="p">:</span> <span class="kt">Book</span><span class="o">.</span><span class="n">author</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Note how this request does not use the <code>filter</code> method. Indeed, we don&rsquo;t have any condition to express on any column. Instead, we just need to &ldquo;require that a book can be joined to its author&rdquo;.</p>

<p>See <a href="#how-do-i-filter-records-and-only-keep-those-that-are-not-associated-to-another-record">How do I filter records and only keep those that are NOT associated to another record?</a> below for the opposite question.</p>
<h3 id='how-do-i-filter-records-and-only-keep-those-that-are-not-associated-to-another-record' class='heading'>How do I filter records and only keep those that are NOT associated to another record?</h3>

<p>Let&rsquo;s say you have two record types, <code>Book</code> and <code>Author</code>, and you want to only fetch anonymous books that do not have any author.</p>

<p>We start by defining the association between books and authors:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Book</span><span class="p">:</span> <span class="kt">TableRecord</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">author</span> <span class="o">=</span> <span class="nf">belongsTo</span><span class="p">(</span><span class="kt">Author</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Author</span><span class="p">:</span> <span class="kt">TableRecord</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre>

<p>And then we can write our request and only fetch anonymous books that don&rsquo;t have any author:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">books</span><span class="p">:</span> <span class="p">[</span><span class="kt">Book</span><span class="p">]</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// SELECT book.* FROM book</span>
    <span class="c1">// LEFT JOIN author ON author.id = book.authorID</span>
    <span class="c1">// WHERE author.id IS NULL</span>
    <span class="k">let</span> <span class="nv">authorAlias</span> <span class="o">=</span> <span class="kt">TableAlias</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Book</span>
        <span class="o">.</span><span class="nf">joining</span><span class="p">(</span><span class="nv">optional</span><span class="p">:</span> <span class="kt">Book</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="nf">aliased</span><span class="p">(</span><span class="n">authorAlias</span><span class="p">))</span>
        <span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="n">authorAlias</span><span class="o">.</span><span class="n">exists</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">try</span> <span class="n">request</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>This request uses a TableAlias in order to be able to filter on the eventual associated author. We make sure that the <code>Author.primaryKey</code> is nil, which is another way to say it does not exist: the book has no author.</p>

<p>See <a href="#how-do-i-filter-records-and-only-keep-those-that-are-associated-to-another-record">How do I filter records and only keep those that are associated to another record?</a> above for the opposite question.</p>
<h3 id='how-do-i-select-only-one-column-of-an-associated-record' class='heading'>How do I select only one column of an associated record?</h3>

<p>Let&rsquo;s say you have two record types, <code>Book</code> and <code>Author</code>, and you want to fetch all books with their author name, but not the full associated author records.</p>

<p>We start by defining the association between books and authors:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Book</span><span class="p">:</span> <span class="kt">Decodable</span><span class="p">,</span> <span class="kt">TableRecord</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">author</span> <span class="o">=</span> <span class="nf">belongsTo</span><span class="p">(</span><span class="kt">Author</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Author</span><span class="p">:</span> <span class="kt">Decodable</span><span class="p">,</span> <span class="kt">TableRecord</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="kd">enum</span> <span class="kt">Columns</span> <span class="p">{</span>
        <span class="kd">static</span> <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="kt">Column</span><span class="p">(</span><span class="kt">CodingKeys</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>And then we can write our request and the ad-hoc record that decodes it:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">BookInfo</span><span class="p">:</span> <span class="kt">Decodable</span><span class="p">,</span> <span class="kt">FetchableRecord</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">book</span><span class="p">:</span> <span class="kt">Book</span>
    <span class="k">var</span> <span class="nv">authorName</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="c1">// nil when the book is anonymous</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">all</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">QueryInterfaceRequest</span><span class="o">&lt;</span><span class="kt">BookInfo</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="c1">// SELECT book.*, author.name AS authorName</span>
        <span class="c1">// FROM book</span>
        <span class="c1">// LEFT JOIN author ON author.id = book.authorID</span>
        <span class="k">let</span> <span class="nv">authorName</span> <span class="o">=</span> <span class="kt">Author</span><span class="o">.</span><span class="kt">Columns</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="nf">forKey</span><span class="p">(</span><span class="kt">CodingKeys</span><span class="o">.</span><span class="n">authorName</span><span class="p">)</span>
        <span class="k">return</span> <span class="kt">Book</span>
            <span class="o">.</span><span class="nf">annotated</span><span class="p">(</span><span class="nv">withOptional</span><span class="p">:</span> <span class="kt">Book</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="nf">select</span><span class="p">(</span><span class="n">authorName</span><span class="p">))</span>
            <span class="o">.</span><span class="nf">asRequest</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="kt">BookInfo</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">bookInfos</span><span class="p">:</span> <span class="p">[</span><span class="kt">BookInfo</span><span class="p">]</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="kt">BookInfo</span><span class="o">.</span><span class="nf">all</span><span class="p">()</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>By defining the request as a static method of BookInfo, you have access to the private <code>CodingKeys.authorName</code>, and a compiler-checked SQL column name.</p>

<p>By using the <code>annotated(withOptional:)</code> method, you append the author name to the top-level selection that can be decoded by the ad-hoc record.</p>

<p>By using <code>asRequest(of:)</code>, you enhance the type-safety of your request.</p>
<h2 id='faq-valueobservation' class='heading'>FAQ: ValueObservation</h2>

<ul>
<li>:arrow_up: <a href="#faq">FAQ</a></li>
<li><a href="#why-is-valueobservation-not-publishing-value-changes">Why is ValueObservation not publishing value changes?</a></li>
</ul>
<h3 id='why-is-valueobservation-not-publishing-value-changes' class='heading'>Why is ValueObservation not publishing value changes?</h3>

<p>Sometimes it looks that a <a href="#valueobservation">ValueObservation</a> does not notify the changes you expect.</p>

<p>There may be four possible reasons for this:</p>

<ol>
<li>The expected changes were not committed into the database.</li>
<li>The expected changes were committed into the database, but were quickly overwritten.</li>
<li>The observation was stopped.</li>
<li>The observation does not track the expected database region.</li>
</ol>

<p>To answer the first two questions, look at SQL statements executed by the database. This is done when you open the database connection:</p>
<pre class="highlight swift"><code><span class="c1">// Prints all SQL statements</span>
<span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">prepareDatabase</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="n">db</span><span class="o">.</span><span class="n">trace</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="s">"SQL: </span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">dbQueue</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">DatabaseQueue</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>
</code></pre>

<p>If, after that, you are convinced that the expected changes were committed into the database, and not overwritten soon after, trace observation events:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">observation</span> <span class="o">=</span> <span class="kt">ValueObservation</span>
    <span class="o">.</span><span class="n">tracking</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>
    <span class="o">.</span><span class="nf">print</span><span class="p">()</span> <span class="c1">// &lt;- trace observation events</span>
<span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre>

<p>Look at the observation logs which start with <code>cancel</code> or <code>failure</code>: maybe the observation was cancelled by your app, or did fail with an error.</p>

<p>Look at the observation logs which start with <code>value</code>: make sure, again, that the expected value was not actually notified, then overwritten.</p>

<p>Finally, look at the observation logs which start with <code>tracked region</code>. Does the printed database region cover the expected changes?</p>

<p>For example:</p>

<ul>
<li><code>empty</code>: The empty region, which tracks nothing and never triggers the observation.</li>
<li><code>player(*)</code>: The full <code>player</code> table</li>
<li><code>player(id,name)</code>: The <code>id</code> and <code>name</code> columns of the <code>player</code> table</li>
<li><code>player(id,name)[1]</code>: The <code>id</code> and <code>name</code> columns of the row with id 1 in the <code>player</code> table</li>
<li><code>player(*),team(*)</code>: Both the full <code>player</code> and <code>team</code> tables</li>
</ul>

<p>If you happen to use the <code><a href="Structs/ValueObservation.html#/s:4GRDB16ValueObservationVA2A0B8ReducersO4AutoORszrlE22trackingConstantRegionyACyAE5FetchVy_qd__GGqd__AA8DatabaseCKclFZ">ValueObservation.trackingConstantRegion(_:)</a></code> method and see a mismatch between the tracked region and your expectation, then change the definition of your observation by using <code>tracking(_:)</code>. You should witness that the logs which start with <code>tracked region</code> now evolve in order to include the expected changes, and that you get the expected notifications.</p>

<p>If after all those steps (thanks you!), your observation is still failing you, please <a href="https://github.com/groue/GRDB.swift/issues/new">open an issue</a> and provide a <a href="https://stackoverflow.com/help/minimal-reproducible-example">minimal reproducible example</a>!</p>
<h2 id='faq-errors' class='heading'>FAQ: Errors</h2>

<ul>
<li>:arrow_up: <a href="#faq">FAQ</a></li>
<li><a href="#generic-parameter-t-could-not-be-inferred">Generic parameter &lsquo;T&rsquo; could not be inferred</a></li>
<li><a href="#mutation-of-captured-var-in-concurrently-executing-code">Mutation of captured var in concurrently-executing code</a></li>
<li><a href="#sqlite-error-1-no-such-column">SQLite error 1 &ldquo;no such column&rdquo;</a></li>
<li><a href="#sqlite-error-10-disk-io-error-sqlite-error-23-not-authorized">SQLite error 10 &ldquo;disk I/O error&rdquo;, SQLite error 23 &ldquo;not authorized&rdquo;</a></li>
<li><a href="#sqlite-error-21-wrong-number-of-statement-arguments-with-like-queries">SQLite error 21 &ldquo;wrong number of statement arguments&rdquo; with LIKE queries</a></li>
</ul>
<h3 id='generic-parameter-39-t-39-could-not-be-inferred' class='heading'>Generic parameter &lsquo;T&rsquo; could not be inferred</h3>

<p>You may get this error when using the <code>read</code> and <code>write</code> methods of database queues and pools:</p>
<pre class="highlight swift"><code><span class="c1">// Generic parameter 'T' could not be inferred</span>
<span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">String</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
<span class="p">}</span>
</code></pre>

<p>This is a limitation of the Swift compiler.</p>

<p>The general workaround is to explicitly declare the type of the closure result:</p>
<pre class="highlight swift"><code><span class="c1">// General Workaround</span>
<span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">String</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
<span class="p">}</span>
</code></pre>

<p>You can also, when possible, write a single-line closure:</p>
<pre class="highlight swift"><code><span class="c1">// Single-line closure workaround:</span>
<span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">String</span><span class="o">.</span><span class="nf">fetchOne</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<h3 id='mutation-of-captured-var-in-concurrently-executing-code' class='heading'>Mutation of captured var in concurrently-executing code</h3>

<p>The <code>insert</code> and <code>save</code> <a href="#persistablerecord-protocol">persistence methods</a> can trigger a compiler error in async contexts:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">player</span> <span class="o">=</span> <span class="kt">Player</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Arthur"</span><span class="p">)</span>
<span class="k">try</span> <span class="k">await</span> <span class="n">dbWriter</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="c1">// Error: Mutation of captured var 'player' in concurrently-executing code</span>
    <span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="c1">// A non-nil id</span>
</code></pre>

<p>When this happens, prefer the <code>inserted</code> and <code>saved</code> methods instead:</p>
<pre class="highlight swift"><code><span class="c1">// OK</span>
<span class="k">var</span> <span class="nv">player</span> <span class="o">=</span> <span class="kt">Player</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Arthur"</span><span class="p">)</span>
<span class="n">player</span> <span class="o">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">dbWriter</span><span class="o">.</span><span class="n">write</span> <span class="p">{</span> <span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">return</span> <span class="k">try</span> <span class="n">player</span><span class="o">.</span><span class="nf">inserted</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="c1">// A non-nil id</span>
</code></pre>
<h3 id='sqlite-error-1-quot-no-such-column-quot' class='heading'>SQLite error 1 &ldquo;no such column&rdquo;</h3>

<p>This error message is self-explanatory: do check for misspelled or non-existing column names.</p>

<p>However, sometimes this error only happens when an app runs on a recent operating system (iOS 14+, Big Sur+, etc.) The error does not happen with previous ones.</p>

<p>When this is the case, there are two possible explanations:</p>

<ol>
<li><p>Maybe a column name is <em>really</em> misspelled or missing from the database schema.</p>

<p>To find it, check the SQL statement that comes with the <a href="#databaseerror">DatabaseError</a>.</p></li>
<li><p>Maybe the application is using the character <code>&quot;</code> instead of the single quote <code>&#39;</code> as the delimiter for string literals in raw SQL queries. Recent versions of SQLite have learned to tell about this deviation from the SQL standard, and this is why you are seeing this error. </p>

<p>For example: this is not standard SQL: <code>UPDATE player SET name = &quot;Arthur&quot;</code>.</p>

<p>The standard version is: <code>UPDATE player SET name = &#39;Arthur&#39;</code>.</p>

<p>It just happens that old versions of SQLite used to accept the former, non-standard version. Newer versions are able to reject it with an error.</p>

<p>The fix is to change the SQL statements run by the application: replace <code>&quot;</code> with <code>&#39;</code> in your string literals.</p>

<p>It may also be time to learn about statement arguments and <a href="#avoiding-sql-injection">SQL injection</a>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// NOT STANDARD (double quote)</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"""
    UPDATE player SET name = "</span><span class="p">\(</span><span class="n">name</span><span class="p">)</span><span class="s">"
    """</span><span class="p">)</span>

<span class="c1">// STANDARD, BUT STILL NOT RECOMMENDED (single quote)</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE player SET name = '</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">'"</span><span class="p">)</span>

<span class="c1">// STANDARD, AND RECOMMENDED (statement arguments)</span>
<span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">sql</span><span class="p">:</span> <span class="s">"UPDATE player SET name = ?"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">])</span>
</code></pre></li>
</ol>

<p>For more information, see <a href="https://sqlite.org/quirks.html#dblquote">Double-quoted String Literals Are Accepted</a>, and <a href="http://groue.github.io/GRDB.swift/docs/5.21/Structs/Configuration.html#/s:4GRDB13ConfigurationV33acceptsDoubleQuotedStringLiteralsSbvp">Configuration.acceptsDoubleQuotedStringLiterals</a>.</p>
<h3 id='sqlite-error-10-quot-disk-i-o-error-quot-sqlite-error-23-quot-not-authorized-quot' class='heading'>SQLite error 10 &ldquo;disk I/O error&rdquo;, SQLite error 23 &ldquo;not authorized&rdquo;</h3>

<p>Those errors may be the sign that SQLite can&rsquo;t access the database due to <a href="#data-protection">data protection</a>.</p>

<p>When your application should be able to run in the background on a locked device, it has to catch this error, and, for example, wait for <a href="https://developer.apple.com/reference/uikit/uiapplicationdelegate/1623044-applicationprotecteddatadidbecom">UIApplicationDelegate.applicationProtectedDataDidBecomeAvailable(_:)</a> or <a href="https://developer.apple.com/reference/uikit/uiapplicationprotecteddatadidbecomeavailable">UIApplicationProtectedDataDidBecomeAvailable</a> notification and retry the failed database operation.</p>
<pre class="highlight swift"><code><span class="k">do</span> <span class="p">{</span>
    <span class="k">try</span> <span class="o">...</span>
<span class="p">}</span> <span class="k">catch</span> <span class="kt">DatabaseError</span><span class="o">.</span><span class="kt">SQLITE_IOERR</span><span class="p">,</span> <span class="kt">DatabaseError</span><span class="o">.</span><span class="kt">SQLITE_AUTH</span> <span class="p">{</span>
    <span class="c1">// Handle possible data protection error</span>
<span class="p">}</span>
</code></pre>

<p>This error can also be prevented altogether by using a more relaxed <a href="https://developer.apple.com/reference/foundation/filemanager/1653059-file_protection_values">file protection</a>.</p>
<h3 id='sqlite-error-21-quot-wrong-number-of-statement-arguments-quot-with-like-queries' class='heading'>SQLite error 21 &ldquo;wrong number of statement arguments&rdquo; with LIKE queries</h3>

<p>You may get the error &ldquo;wrong number of statement arguments&rdquo; when executing a LIKE query similar to:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">textField</span><span class="o">.</span><span class="n">text</span>
<span class="k">let</span> <span class="nv">players</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM player WHERE name LIKE '%?%'"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">])</span>
<span class="p">}</span>
</code></pre>

<p>The problem lies in the <code>&#39;%?%&#39;</code> pattern.</p>

<p>SQLite only interprets <code>?</code> as a parameter when it is a placeholder for a whole value (int, double, string, blob, null). In this incorrect query, <code>?</code> is just a character in the <code>&#39;%?%&#39;</code> string: it is not a query parameter, and is not processed in any way. See <a href="https://www.sqlite.org/lang_expr.html#varparam">https://www.sqlite.org/lang_expr.html#varparam</a> for more information about SQLite parameters.</p>

<p>To fix the error, you can feed the request with the pattern itself, instead of the name:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">textField</span><span class="o">.</span><span class="n">text</span>
<span class="k">let</span> <span class="nv">players</span><span class="p">:</span> <span class="p">[</span><span class="kt">Player</span><span class="p">]</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dbQueue</span><span class="o">.</span><span class="n">read</span> <span class="p">{</span> <span class="n">db</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">pattern</span> <span class="o">=</span> <span class="s">"%</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">%"</span>
    <span class="k">return</span> <span class="k">try</span> <span class="kt">Player</span><span class="o">.</span><span class="nf">fetchAll</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nv">sql</span><span class="p">:</span> <span class="s">"SELECT * FROM player WHERE name LIKE ?"</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="p">[</span><span class="n">pattern</span><span class="p">])</span>
<span class="p">}</span>
</code></pre>
<h1 id='sample-code' class='heading'>Sample Code</h1>

<ul>
<li>The <a href="#documentation">Documentation</a> is full of GRDB snippets.</li>
<li><a href="Documentation/DemoApps">Demo Applications</a></li>
<li>Open <code>GRDB.xcworkspace</code>: it contains GRDB-enabled playgrounds to play with.</li>
<li><a href="https://github.com/groue/SortedDifference">groue/SortedDifference</a>: How to synchronize a database table with a JSON payload</li>
</ul>

<hr>

<p><strong>Thanks</strong></p>

<ul>
<li><a href="http://pierlis.com">Pierlis</a>, where we write great software.</li>
<li><a href="https://github.com/alextrob">@alextrob</a>, <a href="https://github.com/alexwlchan">@alexwlchan</a>, <a href="https://github.com/bellebethcooper">@bellebethcooper</a>, <a href="https://github.com/bfad">@bfad</a>, <a href="https://github.com/cfilipov">@cfilipov</a>, <a href="https://github.com/charlesmchen-signal">@charlesmchen-signal</a>, <a href="https://github.com/Chiliec">@Chiliec</a>, <a href="https://github.com/chrisballinger">@chrisballinger</a>, <a href="https://github.com/darrenclark">@darrenclark</a>, <a href="https://github.com/davidkraus">@davidkraus</a>, <a href="https://github.com/eburns-vmware">@eburns-vmware</a>, <a href="https://github.com/felixscheinost">@felixscheinost</a>, <a href="http://github.com/fpillet">@fpillet</a>, <a href="https://github.com/gcox">@gcox</a>, <a href="https://github.com/GetToSet">@GetToSet</a>, <a href="https://github.com/gjeck">@gjeck</a>, <a href="https://github.com/guidedways">@guidedways</a>, <a href="https://github.com/gusrota">@gusrota</a>, <a href="https://github.com/haikusw">@haikusw</a>, <a href="https://github.com/hartbit">@hartbit</a>, <a href="https://github.com/holsety">@holsety</a>, <a href="https://github.com/jroselightricks">@jroselightricks</a>, <a href="https://github.com/kdubb">@kdubb</a>, <a href="https://github.com/kluufger">@kluufger</a>, <a href="https://github.com/KyleLeneau">@KyleLeneau</a>, <a href="https://github.com/layoutSubviews">@layoutSubviews</a>, <a href="https://github.com/mallman">@mallman</a>, <a href="https://github.com/MartinP7r">@MartinP7r</a>, <a href="https://github.com/Marus">@Marus</a>, <a href="https://github.com/mattgallagher">@mattgallagher</a>, <a href="https://github.com/MaxDesiatov">@MaxDesiatov</a>, <a href="https://github.com/michaelkirk-signal">@michaelkirk-signal</a>, <a href="https://github.com/mtancock">@mtancock</a>, <a href="https://github.com/pakko972">@pakko972</a>, <a href="https://github.com/peter-ss">@peter-ss</a>, <a href="https://github.com/pierlo">@pierlo</a>, <a href="https://github.com/pocketpixels">@pocketpixels</a>, <a href="https://github.com/pp5x">@pp5x</a>, <a href="https://github.com/professordeng">@professordeng</a>, <a href="https://github.com/robcas3">@robcas3</a>, <a href="https://github.com/runhum">@runhum</a>, <a href="https://github.com/sberrevoets">@sberrevoets</a>, <a href="https://github.com/schveiguy">@schveiguy</a>, <a href="https://github.com/SD10">@SD10</a>, <a href="https://github.com/sobri909">@sobri909</a>, <a href="https://github.com/sroddy">@sroddy</a>, <a href="https://github.com/steipete">@steipete</a>, <a href="https://github.com/swiftlyfalling">@swiftlyfalling</a>, <a href="https://github.com/Timac">@Timac</a>, <a href="https://github.com/tternes">@tternes</a>, <a href="https://github.com/valexa">@valexa</a>, <a href="https://github.com/wuyuehyang">@wuyuehyang</a>, <a href="https://github.com/ZevEisenberg">@ZevEisenberg</a>, and <a href="https://github.com/zmeyc">@zmeyc</a> for their contributions, help, and feedback on GRDB.</li>
<li><a href="https://github.com/aymerick">@aymerick</a> and <a href="https://github.com/kali">@kali</a> because SQL.</li>
<li><a href="https://github.com/ccgus/fmdb">ccgus/fmdb</a> for its excellency.</li>
</ul>

<hr>

<p><a href="https://www.w3.org/Provider/Style/URI">URIs don&rsquo;t change: people change them.</a></p>
<h4 id='changes-tracking' class='heading'>Changes Tracking</h4>

<p>This chapter has been renamed <a href="#record-comparison">Record Comparison</a>.</p>
<h4 id='customized-decoding-of-database-rows' class='heading'>Customized Decoding of Database Rows</h4>

<p>This chapter has been renamed <a href="#beyond-fetchablerecord">Beyond FetchableRecord</a>.</p>
<h4 id='dealing-with-external-connections' class='heading'>Dealing with External Connections</h4>

<p>This chapter has been superseded by the <a href="Documentation/SharingADatabase.md">Sharing a Database</a> guide.</p>
<h4 id='enabling-fts5-support' class='heading'>Enabling FTS5 Support</h4>

<p>This chapter has <a href="Documentation/FullTextSearch.md#enabling-fts5-support">moved</a>.</p>
<h4 id='fetchedrecordscontroller' class='heading'>FetchedRecordsController</h4>

<p>FetchedRecordsController has been removed in GRDB 5.</p>

<p>The <a href="#database-changes-observation">Database Observation</a> chapter describes the other ways to observe the database.</p>
<h4 id='full-text-search' class='heading'>Full-Text Search</h4>

<p>This chapter has <a href="Documentation/FullTextSearch.md">moved</a>.</p>
<h4 id='migrations' class='heading'>Migrations</h4>

<p>This chapter has <a href="Documentation/Migrations.md">moved</a>.</p>
<h4 id='nsnumber-and-nsdecimalnumber' class='heading'>NSNumber and NSDecimalNumber</h4>

<p>This chapter has <a href="#nsnumber-nsdecimalnumber-and-decimal">moved</a></p>
<h4 id='persistable-protocol' class='heading'>Persistable Protocol</h4>

<p>This protocol has been renamed <a href="#persistablerecord-protocol">PersistableRecord</a> in GRDB 3.0.</p>
<h4 id='rowconvertible-protocol' class='heading'>RowConvertible Protocol</h4>

<p>This protocol has been renamed <a href="#fetchablerecord-protocol">FetchableRecord</a> in GRDB 3.0.</p>
<h4 id='tablemapping-protocol' class='heading'>TableMapping Protocol</h4>

<p>This protocol has been renamed <a href="#tablerecord-protocol">TableRecord</a> in GRDB 3.0.</p>
<h4 id='valueobservation-and-databaseregionobservation' class='heading'>ValueObservation and DatabaseRegionObservation</h4>

<p>This chapter has been superseded by <a href="#valueobservation">ValueObservation</a> and <a href="#databaseregionobservation">DatabaseRegionObservation</a>.</p>
<h4 id='concurrency' class='heading'>Concurrency</h4>

<p>This chapter has <a href="Documentation/Concurrency.md">moved</a>.</p>
<h4 id='guarantees-and-rules' class='heading'>Guarantees and Rules</h4>

<p>This chapter is now split into <a href="Documentation/Concurrency.md#concurrency-rules">Concurrency Rules</a> and <a href="Documentation/Concurrency.md#safe-and-unsafe-database-accesses">Safe and Unsafe Database Accesses</a>.</p>
<h4 id='differences-between-database-queues-and-pools' class='heading'>Differences between Database Queues and Pools</h4>

<p>This chapter has <a href="Documentation/Concurrency.md#differences-between-database-queues-and-pools">moved</a>.</p>
<h4 id='advanced-databasepool' class='heading'>Advanced DatabasePool</h4>

<p>This chapter has <a href="Documentation/Concurrency.md#advanced-databasepool">moved</a>.</p>
<h4 id='database-snapshots' class='heading'>Database Snapshots</h4>

<p>This chapter has <a href="Documentation/Concurrency.md#database-snapshots">moved</a>.</p>
<h4 id='databasewriter-and-databasereader-protocols' class='heading'>DatabaseWriter and DatabaseReader Protocols</h4>

<p>This chapter was removed. See the references of <a href="http://groue.github.io/GRDB.swift/docs/5.21/Protocols/DatabaseReader.html">DatabaseReader</a> and <a href="http://groue.github.io/GRDB.swift/docs/5.21/Protocols/DatabaseWriter.html">DatabaseWriter</a>.</p>
<h4 id='asynchronous-apis' class='heading'>Asynchronous APIs</h4>

<p>This chapter has <a href="Documentation/Concurrency.md#synchronous-and-asynchronous-database-accesses">moved</a>.</p>
<h4 id='unsafe-concurrency-apis' class='heading'>Unsafe Concurrency APIs</h4>

<p>This chapter has <a href="Documentation/Concurrency.md#safe-and-unsafe-database-accesses">moved</a>.</p>
<h3 id='adding-support-for-missing-sql-functions-or-operators' class='heading'>Adding support for missing SQL functions or operators</h3>

<p>This chapter was renamed to <a href="#embedding-sql-in-query-interface-requests">Embedding SQL in Query Interface Requests</a>.</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2022 <a class="link" href="https://github.com/groue" target="_blank" rel="external noopener">Gwendal Roué</a>. All rights reserved. (Last updated: 2022-02-06)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external noopener">jazzy ♪♫ v0.14.1</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external noopener">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</html>
